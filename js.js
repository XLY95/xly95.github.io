const _0x460b8d=_0x2e42;(function(_0x5d10ce,_0x5193df){const _0x2088a4=_0x2e42,_0x4f62d7=_0x5d10ce();while(!![]){try{const _0x4aadc3=parseInt(_0x2088a4(0x140))/0x1+parseInt(_0x2088a4(0x161))/0x2*(-parseInt(_0x2088a4(0x158))/0x3)+-parseInt(_0x2088a4(0x134))/0x4*(-parseInt(_0x2088a4(0x192))/0x5)+parseInt(_0x2088a4(0x163))/0x6+-parseInt(_0x2088a4(0x194))/0x7+parseInt(_0x2088a4(0x132))/0x8*(-parseInt(_0x2088a4(0x103))/0x9)+parseInt(_0x2088a4(0x186))/0xa;if(_0x4aadc3===_0x5193df)break;else _0x4f62d7['push'](_0x4f62d7['shift']());}catch(_0x3372e6){_0x4f62d7['push'](_0x4f62d7['shift']());}}}(_0x3e04,0xe68b4));let bleDevice,gattServer,epdService,epdCharacteristic,startTime,msgIndex,appVersion,canvas,ctx,textDecoder;const EpdCmd={'SET_PINS':0x0,'INIT':0x1,'CLEAR':0x2,'SEND_CMD':0x3,'SEND_DATA':0x4,'REFRESH':0x5,'SLEEP':0x6,'SET_TIME':0x20,'WRITE_IMG':0x30,'SET_CONFIG':0x90,'SYS_RESET':0x91,'SYS_SLEEP':0x92,'CFG_ERASE':0x99,'EPD_CMD_J_H':0xff,'EPD_CMD_N_Z':0xef,'EPD_CMD_J_S':0xee,'EPD_CMD_D_S':0xed,'EPD_CMD_LED':0xec,'EPD_CMD_MY':0xeb,'EPD_CMD_COLOR':0xea,'EPD_CMD_4_MS':0xfe,'EPD_CMD_4_C0LOR':0xfd,'EPD_CMD_4_XZ':0xfc,'EPD_CMD_4_ZF':0xfb},canvasSizes=[{'name':'1.54_152_152','width':0x98,'height':0x98},{'name':_0x460b8d(0x122),'width':0xc8,'height':0xc8},{'name':_0x460b8d(0x127),'width':0xd4,'height':0x68},{'name':_0x460b8d(0x1b5),'width':0xfa,'height':0x7a},{'name':'2.66_296_152','width':0x128,'height':0x98},{'name':'2.9_296_128','width':0x128,'height':0x80},{'name':_0x460b8d(0x18b),'width':0x180,'height':0xa8},{'name':'3.5_384_184','width':0x180,'height':0xb8},{'name':_0x460b8d(0x184),'width':0x1a0,'height':0xf0},{'name':_0x460b8d(0x195),'width':0x320,'height':0x1e0},{'name':_0x460b8d(0x143),'width':0x190,'height':0x12c},{'name':_0x460b8d(0x160),'width':0x318,'height':0x110},{'name':'7.5_800_480','width':0x320,'height':0x1e0},{'name':_0x460b8d(0x19f),'width':0x3c0,'height':0x280},{'name':_0x460b8d(0x1c5),'width':0x550,'height':0x1e0},{'name':_0x460b8d(0x137),'width':0x3c0,'height':0x280},{'name':_0x460b8d(0x12b),'width':0x258,'height':0x190},{'name':_0x460b8d(0x115),'width':0x1e0,'height':0x320}];function hex2bytes(_0xadd7f3){const _0x5b6366=_0x460b8d;for(var _0x31087b=[],_0x1e39be=0x0;_0x1e39be<_0xadd7f3[_0x5b6366(0x14c)];_0x1e39be+=0x2)_0x31087b[_0x5b6366(0x123)](parseInt(_0xadd7f3[_0x5b6366(0x17a)](_0x1e39be,0x2),0x10));return new Uint8Array(_0x31087b);}function bytes2hex(_0x27d87d){const _0x3cdc39=_0x460b8d;return new Uint8Array(_0x27d87d)[_0x3cdc39(0x10b)](function(_0xc0a74,_0x56204a){const _0x4739b4=_0x3cdc39;return _0xc0a74+('0'+_0x56204a[_0x4739b4(0x1b6)](0x10))[_0x4739b4(0x1b1)](-0x2);},'');}function intToHex(_0x2d7699){const _0x435794=_0x460b8d;let _0x5375df=(_0x435794(0x111)+_0x2d7699[_0x435794(0x1b6)](0x10))[_0x435794(0x17a)](-0x4);return _0x5375df['substring'](0x2,0x4)+_0x5375df[_0x435794(0x18d)](0x0,0x2);}function resetVariables(){const _0x103347=_0x460b8d;gattServer=null,epdService=null,epdCharacteristic=null,msgIndex=0x0,document[_0x103347(0x107)]('log')['value']='';}async function write(_0x53ea20,_0x3ea1a1,_0x358f42=!![]){const _0x5962a1=_0x460b8d;if(!epdCharacteristic)return addLog('没有链接蓝牙'),![];let _0x112a44=[_0x53ea20];if(_0x3ea1a1){if(typeof _0x3ea1a1=='string')_0x3ea1a1=hex2bytes(_0x3ea1a1);if(_0x3ea1a1 instanceof Uint8Array)_0x3ea1a1=Array[_0x5962a1(0x167)](_0x3ea1a1);_0x112a44['push'](..._0x3ea1a1);}try{if(_0x358f42)await epdCharacteristic[_0x5962a1(0x17b)](Uint8Array[_0x5962a1(0x167)](_0x112a44));else await epdCharacteristic[_0x5962a1(0x181)](Uint8Array[_0x5962a1(0x167)](_0x112a44));}catch(_0x3fd24f){console['error'](_0x3fd24f);if(_0x3fd24f[_0x5962a1(0x15b)])addLog(_0x5962a1(0x113)+_0x3fd24f[_0x5962a1(0x15b)]);return![];}return!![];}async function writeImage(_0x3bf730,_0x346107='bw'){const _0x19bfc7=_0x460b8d,_0x5cdba3=document[_0x19bfc7(0x107)](_0x19bfc7(0x121))[_0x19bfc7(0x191)]-0x2,_0x3d6fd7=document[_0x19bfc7(0x107)]('interleavedcount')[_0x19bfc7(0x191)],_0x441944=Math[_0x19bfc7(0x15f)](_0x3bf730[_0x19bfc7(0x14c)]/_0x5cdba3);let _0x3bd1b3=0x0,_0x425478=_0x3d6fd7;for(let _0x2e9f85=0x0;_0x2e9f85<_0x3bf730[_0x19bfc7(0x14c)];_0x2e9f85+=_0x5cdba3){let _0x1fdab1=(new Date()['getTime']()-startTime)/0x3e8;setStatus((_0x346107=='bw'?'黑白':'红色')+_0x19bfc7(0x182)+(_0x3bd1b3+0x1)+'/'+(_0x441944+0x1)+_0x19bfc7(0x18f)+_0x1fdab1+'s');const _0x5350db=[(_0x346107=='bw'?0xf:0x0)|(_0x2e9f85==0x0?0x0:0xf0),..._0x3bf730[_0x19bfc7(0x1b1)](_0x2e9f85,_0x2e9f85+_0x5cdba3)];_0x425478>0x0?(await write(EpdCmd[_0x19bfc7(0x149)],_0x5350db,![]),_0x425478--):(await write(EpdCmd[_0x19bfc7(0x149)],_0x5350db,!![]),_0x425478=_0x3d6fd7),_0x3bd1b3++;}}async function setDriver(){const _0x4ce7ce=_0x460b8d;await write(EpdCmd[_0x4ce7ce(0x118)],document[_0x4ce7ce(0x107)]('epdpins')[_0x4ce7ce(0x191)]),await write(EpdCmd[_0x4ce7ce(0x180)],document['getElementById']('epddriver')['value']);}async function set_EPD_CMD_J_H(){const _0x50a980=_0x460b8d;await write(EpdCmd['EPD_CMD_J_H'],document[_0x50a980(0x107)](_0x50a980(0x1ba))[_0x50a980(0x191)]);}async function set_EPD_CMD_N_Z(){const _0x2f2b31=_0x460b8d,_0x2ce87e=document[_0x2f2b31(0x107)](_0x2f2b31(0x16e))['value'],_0x405962=document[_0x2f2b31(0x107)](_0x2f2b31(0x116))[_0x2f2b31(0x191)],_0x1c998b=document[_0x2f2b31(0x107)](_0x2f2b31(0x177))[_0x2f2b31(0x191)],_0x15c7b3=[0x4];_0x15c7b3[0x0]=0x0,_0x15c7b3[0x1]=0x0,_0x15c7b3[0x2]=_0x2ce87e,_0x15c7b3[0x3]=_0x405962,_0x15c7b3[0x4]=_0x1c998b,await write(EpdCmd[_0x2f2b31(0x164)],_0x15c7b3);}async function set_EPD_CMD_D_S(){const _0x39d838=_0x460b8d,_0x35673e=document[_0x39d838(0x107)]('D_S_hour')['value'],_0x881e5a=document['getElementById'](_0x39d838(0x147))[_0x39d838(0x191)],_0x17f49f=document[_0x39d838(0x107)](_0x39d838(0x187))[_0x39d838(0x191)],_0x9ed395=[0x4];_0x9ed395[0x0]=0x0,_0x9ed395[0x1]=0x0,_0x9ed395[0x2]=_0x35673e,_0x9ed395[0x3]=_0x881e5a,_0x9ed395[0x4]=_0x17f49f,await write(EpdCmd[_0x39d838(0x159)],_0x9ed395);}async function set_EPD_CMD_J_S(){const _0x163e88=_0x460b8d,_0x200acd=document['getElementById'](_0x163e88(0x13d))['value'],_0x376c2d=document['getElementById']('J_S_min')[_0x163e88(0x191)],_0x35d1b6=document[_0x163e88(0x107)](_0x163e88(0x171))[_0x163e88(0x191)],_0x191b13=[0x4];_0x191b13[0x0]=0x0,_0x191b13[0x1]=0x0,_0x191b13[0x2]=_0x200acd,_0x191b13[0x3]=_0x376c2d,_0x191b13[0x4]=_0x35d1b6,await write(EpdCmd[_0x163e88(0x17d)],_0x191b13);}async function set_EPD_CMD_LED(){const _0xbcaab9=_0x460b8d,_0x5f3cf9=document[_0xbcaab9(0x107)]('color_led')['value'],_0x1faeae=document[_0xbcaab9(0x107)](_0xbcaab9(0x1ae))[_0xbcaab9(0x191)],_0x457970=document[_0xbcaab9(0x107)](_0xbcaab9(0x126))[_0xbcaab9(0x191)],_0x14239f=document[_0xbcaab9(0x107)](_0xbcaab9(0x189))[_0xbcaab9(0x191)],_0x243ee8=document['getElementById']('liangdu')[_0xbcaab9(0x191)],_0x597d57=[0x5];_0x597d57[0x0]=_0x5f3cf9,_0x597d57[0x1]=_0x1faeae,_0x597d57[0x2]=_0x457970,_0x597d57[0x3]=_0x14239f,_0x597d57[0x4]=_0x243ee8,await write(EpdCmd[_0xbcaab9(0x128)],_0x597d57);}async function set_EPD_CMD_MY(){const _0x46ec20=_0x460b8d,_0x24206e=document[_0x46ec20(0x107)](_0x46ec20(0x13f))[_0x46ec20(0x191)],_0x30ae37=document[_0x46ec20(0x107)](_0x46ec20(0x10f))['value'],_0x5ee97d=document[_0x46ec20(0x107)]('qiangzhi_shuaxing')[_0x46ec20(0x191)],_0x5ccfaa=document[_0x46ec20(0x107)](_0x46ec20(0x106))['value'],_0x427737=[0x4];_0x427737[0x0]=_0x24206e,_0x427737[0x1]=_0x30ae37,_0x427737[0x2]=_0x5ee97d,_0x427737[0x3]=_0x5ccfaa,await write(EpdCmd[_0x46ec20(0x14b)],_0x427737);}async function set_EPD_CMD_COLOR(){const _0xaf44cb=_0x460b8d,_0x224e0d=document['getElementById'](_0xaf44cb(0x124))[_0xaf44cb(0x191)],_0x485b65=document['getElementById'](_0xaf44cb(0x18a))['value'],_0x18a0ec=document[_0xaf44cb(0x107)](_0xaf44cb(0x13b))[_0xaf44cb(0x191)],_0x2336d2=document[_0xaf44cb(0x107)](_0xaf44cb(0x1a4))[_0xaf44cb(0x191)],_0x7346d=document[_0xaf44cb(0x107)]('shichen_color')[_0xaf44cb(0x191)],_0x35d0c1=document[_0xaf44cb(0x107)]('jieqi_color')[_0xaf44cb(0x191)],_0x407b90=document[_0xaf44cb(0x107)]('r_jushua_time')[_0xaf44cb(0x191)],_0x5d2dfe=[0x7];_0x5d2dfe[0x0]=_0x224e0d,_0x5d2dfe[0x1]=_0x485b65,_0x5d2dfe[0x2]=_0x18a0ec,_0x5d2dfe[0x3]=_0x2336d2,_0x5d2dfe[0x4]=_0x7346d,_0x5d2dfe[0x5]=_0x35d0c1,_0x5d2dfe[0x6]=_0x407b90,await write(EpdCmd[_0xaf44cb(0x14d)],_0x5d2dfe);}async function set_EPD_CMD_4_MS(){const _0x10cab4=_0x460b8d,_0x3e15e1=document[_0x10cab4(0x107)](_0x10cab4(0x19e))['value'],_0x1bc19b=document[_0x10cab4(0x107)](_0x10cab4(0x19c))['value'],_0x249404=document[_0x10cab4(0x107)](_0x10cab4(0x1a8))[_0x10cab4(0x191)],_0x2638a4=document['getElementById'](_0x10cab4(0x1b3))[_0x10cab4(0x191)],_0x1cedc7=document[_0x10cab4(0x107)](_0x10cab4(0x14e))['value'],_0x4c152b=document['getElementById'](_0x10cab4(0x138))[_0x10cab4(0x191)],_0x3a5c62=document[_0x10cab4(0x107)]('silian_ziti')[_0x10cab4(0x191)],_0x4b5a3a=[0x7];_0x4b5a3a[0x0]=_0x3e15e1,_0x4b5a3a[0x1]=_0x1bc19b,_0x4b5a3a[0x2]=_0x249404,_0x4b5a3a[0x3]=_0x2638a4,_0x4b5a3a[0x4]=_0x1cedc7,_0x4b5a3a[0x5]=_0x4c152b,_0x4b5a3a[0x6]=_0x3a5c62,await write(EpdCmd['EPD_CMD_4_MS'],_0x4b5a3a);}async function set_EPD_CMD_4_ZF(_0x4ef42d){const _0x53936a=_0x460b8d,_0x5eea4a=[0x1];_0x5eea4a[0x0]=_0x4ef42d,await write(EpdCmd[_0x53936a(0x1bd)],_0x5eea4a),_0x4ef42d==0x0&&(syncTime(0x2),addLog('主机已同步时间！'));}async function syncTime(_0x3518d6){const _0x49d0fb=_0x460b8d,_0x545cfa=new Date()[_0x49d0fb(0x169)]()/0x3e8,_0x49013d=new Uint8Array([_0x545cfa>>0x18&0xff,_0x545cfa>>0x10&0xff,_0x545cfa>>0x8&0xff,_0x545cfa&0xff,-(new Date()['getTimezoneOffset']()/0x3c),_0x3518d6]);await write(EpdCmd[_0x49d0fb(0x1a3)],_0x49013d)&&addLog('已同步时间！');}async function clearScreen(){const _0x1c39d8=_0x460b8d;0x1&&(await write(EpdCmd[_0x1c39d8(0x10d)]),addLog('已清除屏慕！'));}async function sendcmd(){const _0x5f4d24=_0x460b8d,_0x4a827d=document[_0x5f4d24(0x107)](_0x5f4d24(0x19b))[_0x5f4d24(0x191)];if(_0x4a827d=='')return;const _0x397ac3=hex2bytes(_0x4a827d);await write(_0x397ac3[0x0],_0x397ac3[_0x5f4d24(0x14c)]>0x1?_0x397ac3['slice'](0x1):null);}async function sendimg(){const _0x49ee51=_0x460b8d,_0x4772f0=document[_0x49ee51(0x107)](_0x49ee51(0x11d))[_0x49ee51(0x191)],_0x1623cc=document[_0x49ee51(0x107)](_0x49ee51(0x120))[_0x49ee51(0x191)],_0x1ed41c=document[_0x49ee51(0x107)](_0x49ee51(0x125)),_0x1ae125=_0x1ed41c[_0x49ee51(0x17f)][_0x1ed41c['selectedIndex']];startTime=new Date()[_0x49ee51(0x169)]();const _0x5b6967=document['getElementById'](_0x49ee51(0x15e));_0x5b6967[_0x49ee51(0x1b4)][_0x49ee51(0x197)][_0x49ee51(0x16c)]='block';const _0x5f5021=ctx[_0x49ee51(0x1c7)](0x0,0x0,canvas[_0x49ee51(0x154)],canvas[_0x49ee51(0x10e)]),_0x967dc6=processImageData(_0x5f5021,_0x1623cc);updateButtonStatus(!![]);if(_0x1623cc==='fourColor')await writeImage(_0x967dc6,_0x49ee51(0x1ad));else{if(_0x1623cc===_0x49ee51(0x1a5)){const _0x22432f=Math['floor'](_0x967dc6[_0x49ee51(0x14c)]/0x2);await writeImage(_0x967dc6[_0x49ee51(0x1b1)](0x0,_0x22432f),'bw'),await writeImage(_0x967dc6[_0x49ee51(0x1b1)](_0x22432f),'red');}else{if(_0x1623cc===_0x49ee51(0x17c))await writeImage(_0x967dc6,'bw');else{addLog(_0x49ee51(0x142)),updateButtonStatus();return;}}}await write(EpdCmd[_0x49ee51(0x1b2)]),updateButtonStatus();const _0x5ddddd=(new Date()['getTime']()-startTime)/0x3e8;addLog(_0x49ee51(0x1ca)+_0x5ddddd+'s'),setStatus(_0x49ee51(0x1ca)+_0x5ddddd+'s'),addLog('请等待屏幕刷新完成！'),setTimeout(()=>{const _0x1c1fb9=_0x49ee51;_0x5b6967[_0x1c1fb9(0x1b4)][_0x1c1fb9(0x197)][_0x1c1fb9(0x16c)]=_0x1c1fb9(0x135);},0x1388);}function downloadDataArray(){const _0x5af75b=_0x460b8d;if(isCropMode())return;const _0x3ce999=document[_0x5af75b(0x107)]('ditherMode')[_0x5af75b(0x191)],_0x2430ac=ctx[_0x5af75b(0x1c7)](0x0,0x0,canvas['width'],canvas[_0x5af75b(0x10e)]),_0x40e216=processImageData(_0x2430ac,_0x3ce999);if(_0x3ce999===_0x5af75b(0x157)&&_0x40e216[_0x5af75b(0x14c)]!==canvas[_0x5af75b(0x154)]*canvas[_0x5af75b(0x10e)]){console[_0x5af75b(0x12a)](_0x5af75b(0x11e)+canvas[_0x5af75b(0x154)]*canvas[_0x5af75b(0x10e)]+_0x5af75b(0x19a)+_0x40e216[_0x5af75b(0x14c)]+'字节');return;}const _0x1be379=[];for(let _0x47d92c=0x0;_0x47d92c<_0x40e216['length'];_0x47d92c++){const _0x3d5b24=(_0x40e216[_0x47d92c]&0xff)['toString'](0x10)['padStart'](0x2,'0');_0x1be379['push']('0x'+_0x3d5b24);}const _0x9a7ae0=[];for(let _0x6fe2fa=0x0;_0x6fe2fa<_0x1be379[_0x5af75b(0x14c)];_0x6fe2fa+=0x10){_0x9a7ae0[_0x5af75b(0x123)](_0x1be379[_0x5af75b(0x1b1)](_0x6fe2fa,_0x6fe2fa+0x10)[_0x5af75b(0x11b)](',\x20'));}const _0x41627d=_0x3ce999===_0x5af75b(0x157)?0x0:_0x3ce999===_0x5af75b(0x1a0)?0x1:_0x3ce999===_0x5af75b(0x17c)?0x2:0x3,_0x4147ab=[_0x5af75b(0x13c),_0x9a7ae0[_0x5af75b(0x11b)](',\x0a'),'};',_0x5af75b(0x16b)+canvas[_0x5af75b(0x154)]+';',_0x5af75b(0x1b9)+canvas[_0x5af75b(0x10e)]+';',_0x5af75b(0x193)+_0x41627d+';'][_0x5af75b(0x11b)]('\x0a'),_0x253699=new Blob([_0x4147ab],{'type':_0x5af75b(0x16a)}),_0x4dd83c=document[_0x5af75b(0x1b0)]('a');_0x4dd83c[_0x5af75b(0x13e)]='image.h',_0x4dd83c[_0x5af75b(0x190)]=URL[_0x5af75b(0x15d)](_0x253699),_0x4dd83c[_0x5af75b(0x1a6)](),URL[_0x5af75b(0x1cf)](_0x4dd83c[_0x5af75b(0x190)]);}function updateButtonStatus(_0x53b42b=![]){const _0x1c0760=_0x460b8d,_0xfbefee=gattServer!=null&&gattServer[_0x1c0760(0x172)],_0x2c2ca3=_0x53b42b?_0x1c0760(0x104):_0xfbefee?null:_0x1c0760(0x104);document['getElementById'](_0x1c0760(0x145))[_0x1c0760(0x104)]=gattServer==null||gattServer[_0x1c0760(0x172)]?_0x1c0760(0x104):null,document[_0x1c0760(0x107)](_0x1c0760(0x10c))['disabled']=_0x2c2ca3,document[_0x1c0760(0x107)](_0x1c0760(0x1ac))[_0x1c0760(0x104)]=_0x2c2ca3,document['getElementById'](_0x1c0760(0x1cd))[_0x1c0760(0x104)]=_0x2c2ca3,document[_0x1c0760(0x107)](_0x1c0760(0x19d))[_0x1c0760(0x104)]=_0x2c2ca3,document[_0x1c0760(0x107)](_0x1c0760(0x11a))[_0x1c0760(0x104)]=_0x2c2ca3,document[_0x1c0760(0x107)]('setDriverbutton')[_0x1c0760(0x104)]=_0x2c2ca3;}function disconnect(){const _0x23de91=_0x460b8d;updateButtonStatus(),resetVariables(),addLog(_0x23de91(0x150)),document[_0x23de91(0x107)](_0x23de91(0x10a))[_0x23de91(0x1c4)]='连接';}async function preConnect(){const _0x350f89=_0x460b8d;if(gattServer!=null&&gattServer[_0x350f89(0x172)])bleDevice!=null&&bleDevice[_0x350f89(0x1a2)][_0x350f89(0x172)]&&bleDevice['gatt']['disconnect']();else{resetVariables();try{bleDevice=await navigator[_0x350f89(0x1bc)][_0x350f89(0x165)]({'optionalServices':[_0x350f89(0x101)],'acceptAllDevices':!![]});}catch(_0x4b85f9){console['error'](_0x4b85f9);if(_0x4b85f9['message'])addLog(_0x350f89(0x141)+_0x4b85f9[_0x350f89(0x15b)]);addLog('请检查蓝牙，推荐使用Edge浏览器！');return;}await bleDevice[_0x350f89(0x14a)](_0x350f89(0x144),disconnect),setTimeout(async function(){await connect();},0x12c);}}async function reConnect(){const _0x22a152=_0x460b8d;if(bleDevice!=null&&bleDevice[_0x22a152(0x1a2)][_0x22a152(0x172)])bleDevice[_0x22a152(0x1a2)][_0x22a152(0x162)]();resetVariables(),addLog(_0x22a152(0x14f)),setTimeout(async function(){await connect();},0x12c);}function handleNotify(_0x471dae,_0x5c6c29){const _0x194872=_0x460b8d,_0x28d16c=new Uint8Array(_0x471dae['buffer'],_0x471dae['byteOffset'],_0x471dae['byteLength']);if(_0x5c6c29==0x0){}else{if(textDecoder==null)textDecoder=new TextDecoder();const _0x59f018=textDecoder[_0x194872(0x1cc)](_0x28d16c);if(_0x59f018[_0x194872(0x1cb)]('mtu=')&&_0x59f018[_0x194872(0x14c)]>0x4){const _0x259342=parseInt(_0x59f018[_0x194872(0x18d)](0x4));document[_0x194872(0x107)]('mtusize')['value']=_0x259342;}else{if(_0x59f018[_0x194872(0x1cb)]('t=')&&_0x59f018[_0x194872(0x14c)]>0x2){const _0x5b1a83=parseInt(_0x59f018[_0x194872(0x18d)](0x2))+new Date()[_0x194872(0x129)]()*0x3c;}}}}async function connect(){const _0x58b1a5=_0x460b8d;if(bleDevice==null||epdCharacteristic!=null)return;try{addLog(_0x58b1a5(0x1a1)+bleDevice[_0x58b1a5(0x174)]),gattServer=await bleDevice['gatt'][_0x58b1a5(0x179)](),epdService=await gattServer[_0x58b1a5(0x1a7)](_0x58b1a5(0x101)),epdCharacteristic=await epdService[_0x58b1a5(0x151)](_0x58b1a5(0x176)),addLog(_0x58b1a5(0x130));}catch(_0x3e80ae){console['error'](_0x3e80ae);if(_0x3e80ae['message'])addLog(_0x58b1a5(0x133)+_0x3e80ae[_0x58b1a5(0x15b)]);disconnect();return;}try{const _0x3b86c8=await epdService[_0x58b1a5(0x151)](_0x58b1a5(0x139)),_0x56c6d8=await _0x3b86c8[_0x58b1a5(0x1be)]();appVersion=_0x56c6d8[_0x58b1a5(0x12d)](0x0);}catch(_0x47d7bc){console[_0x58b1a5(0x1ce)](_0x47d7bc),appVersion=0x15;}try{await epdCharacteristic[_0x58b1a5(0x114)](),epdCharacteristic[_0x58b1a5(0x14a)](_0x58b1a5(0x152),_0x3483e6=>{const _0x48ecae=_0x58b1a5;handleNotify(_0x3483e6[_0x48ecae(0x1af)][_0x48ecae(0x191)],msgIndex++);});}catch(_0x54096e){console[_0x58b1a5(0x1ce)](_0x54096e);if(_0x54096e[_0x58b1a5(0x15b)])addLog(_0x58b1a5(0x1bb)+_0x54096e[_0x58b1a5(0x15b)]);}await write(EpdCmd['INIT']),document[_0x58b1a5(0x107)](_0x58b1a5(0x10a))[_0x58b1a5(0x1c4)]='断开',updateButtonStatus();}function setStatus(_0x1fe0a1){const _0x5e658a=_0x460b8d;document[_0x5e658a(0x107)](_0x5e658a(0x15e))[_0x5e658a(0x1c4)]=_0x1fe0a1;}function addLog(_0x493987,_0x5701c0=''){const _0x1f155e=_0x460b8d,_0x152cba=document['getElementById'](_0x1f155e(0x12a)),_0x887fc4=new Date(),_0x59306e=String(_0x887fc4[_0x1f155e(0x188)]())[_0x1f155e(0x112)](0x2,'0')+':'+String(_0x887fc4[_0x1f155e(0x17e)]())[_0x1f155e(0x112)](0x2,'0')+':'+String(_0x887fc4[_0x1f155e(0x12f)]())[_0x1f155e(0x112)](0x2,'0')+'\x20',_0x183485=document[_0x1f155e(0x1b0)](_0x1f155e(0x15a)),_0x149b8d=document[_0x1f155e(0x1b0)]('span');_0x149b8d[_0x1f155e(0x11c)]=_0x1f155e(0x11f),_0x149b8d[_0x1f155e(0x136)]=_0x59306e,_0x183485[_0x1f155e(0x110)](_0x149b8d);if(_0x5701c0!==''){const _0x15da99=document['createElement'](_0x1f155e(0x105));_0x15da99[_0x1f155e(0x11c)]=_0x1f155e(0x102),_0x15da99[_0x1f155e(0x1c4)]=_0x5701c0,_0x183485['appendChild'](_0x15da99);}_0x183485[_0x1f155e(0x110)](document[_0x1f155e(0x146)](_0x493987)),_0x152cba[_0x1f155e(0x110)](_0x183485),_0x152cba[_0x1f155e(0x117)]=_0x152cba[_0x1f155e(0x100)];while(_0x152cba[_0x1f155e(0x12c)][_0x1f155e(0x14c)]>0x14){_0x152cba[_0x1f155e(0x170)](_0x152cba[_0x1f155e(0x1a9)]);}}function clearLog(){const _0x3487fe=_0x460b8d;document[_0x3487fe(0x107)](_0x3487fe(0x12a))[_0x3487fe(0x1c4)]='';}function fillCanvas(_0x4f0d22){const _0x4f2811=_0x460b8d;ctx[_0x4f2811(0x108)]=_0x4f0d22,ctx[_0x4f2811(0x185)](0x0,0x0,canvas['width'],canvas[_0x4f2811(0x10e)]);}function _0x3e04(){const _0x449eaa=['7.3E6','N_Z_min','scrollTop','SET_PINS','pathname','sendimgbutton','join','className','canvasSize','错误：预期','time','ditherMode','mtusize','1.54_200_200','push','color_1','epddriver','liang_add','2.13_212_104','EPD_CMD_LED','getTimezoneOffset','log','4E_600_400','childNodes','getUint8','rotate','getSeconds','已连接！','data-color','82312ivdXYd','connect:\x20','136VcNNCH','none','textContent','11.6_960_640','color_11','62750003-d828-918d-fb46-b6c11c675aec','drawImage','wendu_color','const\x20uint8_t\x20imageData[]\x20IMAGE\x20=\x20{','J_S_hour','download','fanxian','63694IFXLse','requestDevice:\x20','当前固件不支持此颜色模式。','4.2_400_300','gattserverdisconnected','reconnectbutton','createTextNode','D_S_min','input','WRITE_IMG','addEventListener','EPD_CMD_MY','length','EPD_CMD_COLOR','moshi_id','正在重连','已断开连接.','getCharacteristic','characteristicvaluechanged','location','width','save','imageFile','sixColor','6LGwdVG','EPD_CMD_D_S','div','message','data-size','createObjectURL','status','round','5.79_792_272','1057704IJnrBz','disconnect','1897326zxPZWH','EPD_CMD_N_Z','requestDevice','ditherContrast','from','canvas','getTime','text/plain','const\x20uint16_t\x20imageWidth\x20=\x20','display','files','N_Z_hour','getAttribute','removeChild','J_S_start','connected','debug-mode','name','rotationDegrees','62750002-d828-918d-fb46-b6c11c675aec','N_Z_start','ditherStrength','connect','substr','writeValueWithResponse','blackWhiteColor','EPD_CMD_J_S','getMinutes','options','INIT','writeValueWithoutResponse','块:\x20','onload','3.7_416_240','fillRect','31547250bnIgNo','D_S_start','getHours','liangdu','time_color','2.9_384_168','data','substring','innerText',',\x20总用时:\x20','href','value','192155WKrwKz','const\x20uint8_t\x20colorMode\x20=\x20','6694765xgXIhS','3.97_800_480','get','style','putImageData','#FFFFFF','字节，但得到','cmdTXT','xuanzhuan1','clearscreenbutton','fanxian1','10.2_960_640','fourColor','正在连接:\x20','gatt','SET_TIME','gongli_color','threeColor','click','getPrimaryService','jushua_time1','firstChild','min','white','calendarmodebutton','color','liang_time','target','createElement','slice','REFRESH','xianshi_peizhi','parentElement','2.13_250_122','toString','src','abs','const\x20uint16_t\x20imageHeight\x20=\x20','epdpins','startNotifications:\x20','bluetooth','EPD_CMD_4_ZF','readValue','debug','change','translate','ditherContrastValue','setAttribute','innerHTML','10.85_1360_480','restore','getImageData','clearRect','selectedIndex','发送完成！耗时:\x20','startsWith','decode','clockmodebutton','error','revokeObjectURL','find','scrollHeight','62750001-d828-918d-fb46-b6c11c675aec','action','1647igGHHL','disabled','span','jushua_time','getElementById','fillStyle','body','connectbutton','reduce','sendcmdbutton','CLEAR','height','xuanzhuan','appendChild','0000','padStart','write:\x20','startNotifications'];_0x3e04=function(){return _0x449eaa;};return _0x3e04();}const image=new Image();function updateImage(){const _0x5ccc7a=_0x460b8d,_0x7a936e=document['getElementById'](_0x5ccc7a(0x156));if(_0x7a936e[_0x5ccc7a(0x16d)][_0x5ccc7a(0x14c)]==0x0){fillCanvas(_0x5ccc7a(0x1ab));return;}image['onload']=function(){const _0x3ae5fd=_0x5ccc7a;URL[_0x3ae5fd(0x1cf)](this[_0x3ae5fd(0x1b7)]);if(image['width']/ image['height']==canvas[_0x3ae5fd(0x154)]/canvas[_0x3ae5fd(0x10e)]){if(isCropMode())exitCropMode();ctx[_0x3ae5fd(0x13a)](image,0x0,0x0,image[_0x3ae5fd(0x154)],image[_0x3ae5fd(0x10e)],0x0,0x0,canvas[_0x3ae5fd(0x154)],canvas[_0x3ae5fd(0x10e)]),redrawTextElements(),redrawLineSegments(),convertDithering();}else initializeCrop();},image[_0x5ccc7a(0x1b7)]=URL[_0x5ccc7a(0x15d)](_0x7a936e[_0x5ccc7a(0x16d)][0x0]);}function updateCanvasSize(){const _0x16afbe=_0x460b8d,_0x57a2ce=document[_0x16afbe(0x107)](_0x16afbe(0x11d))[_0x16afbe(0x191)],_0x1c70f8=canvasSizes[_0x16afbe(0x1d0)](_0x2390e4=>_0x2390e4[_0x16afbe(0x174)]===_0x57a2ce);canvas[_0x16afbe(0x154)]=_0x1c70f8['width'],canvas['height']=_0x1c70f8['height'],updateImage();}function updateDitcherOptions(){const _0x50fa3c=_0x460b8d,_0x38ff70=document[_0x50fa3c(0x107)](_0x50fa3c(0x125)),_0x1bef6e=_0x38ff70[_0x50fa3c(0x17f)][_0x38ff70[_0x50fa3c(0x1c9)]],_0xd7a4f=_0x1bef6e[_0x50fa3c(0x16f)](_0x50fa3c(0x131)),_0x215733=_0x1bef6e[_0x50fa3c(0x16f)](_0x50fa3c(0x15c));if(_0xd7a4f)document['getElementById']('ditherMode')[_0x50fa3c(0x191)]=_0xd7a4f;if(_0x215733)document[_0x50fa3c(0x107)](_0x50fa3c(0x11d))[_0x50fa3c(0x191)]=_0x215733;updateCanvasSize();}function rotateCanvas(){const _0x2184c8=_0x460b8d,_0x5ed78d=canvas[_0x2184c8(0x154)],_0x22a599=canvas['height'];canvas[_0x2184c8(0x154)]=_0x22a599,canvas[_0x2184c8(0x10e)]=_0x5ed78d,updateImage();}function clearCanvas(){const _0x579bd8=_0x460b8d;if(0x1){fillCanvas(_0x579bd8(0x1ab)),textElements=[],lineSegments=[];if(isCropMode())exitCropMode();return!![];}return![];}function _0x2e42(_0xd673fd,_0x56bbde){const _0x3e0480=_0x3e04();return _0x2e42=function(_0x2e4283,_0x4ded8e){_0x2e4283=_0x2e4283-0x100;let _0x780ef1=_0x3e0480[_0x2e4283];return _0x780ef1;},_0x2e42(_0xd673fd,_0x56bbde);}function convertDithering(){const _0x426f58=_0x460b8d,_0x10f062=parseFloat(document['getElementById'](_0x426f58(0x166))['value']),_0x15b92=ctx[_0x426f58(0x1c7)](0x0,0x0,canvas[_0x426f58(0x154)],canvas[_0x426f58(0x10e)]),_0x295ee8=new ImageData(new Uint8ClampedArray(_0x15b92[_0x426f58(0x18c)]),_0x15b92[_0x426f58(0x154)],_0x15b92[_0x426f58(0x10e)]);adjustContrast(_0x295ee8,_0x10f062);const _0x213f4c=document['getElementById']('ditherAlg')['value'],_0x21383a=parseFloat(document[_0x426f58(0x107)](_0x426f58(0x178))[_0x426f58(0x191)]),_0x4329d0=document['getElementById'](_0x426f58(0x120))[_0x426f58(0x191)],_0x53a9d1=processImageData(ditherImage(_0x295ee8,_0x213f4c,_0x21383a,_0x4329d0),_0x4329d0),_0x2ef6c3=decodeProcessedData(_0x53a9d1,canvas[_0x426f58(0x154)],canvas[_0x426f58(0x10e)],_0x4329d0);ctx[_0x426f58(0x198)](_0x2ef6c3,0x0,0x0);}function initEventHandlers(){const _0x45f049=_0x460b8d;document[_0x45f049(0x107)](_0x45f049(0x125))[_0x45f049(0x14a)](_0x45f049(0x1c0),updateDitcherOptions),document[_0x45f049(0x107)]('imageFile')[_0x45f049(0x14a)](_0x45f049(0x1c0),updateImage),document[_0x45f049(0x107)]('ditherMode')[_0x45f049(0x14a)](_0x45f049(0x1c0),finishCrop),document[_0x45f049(0x107)]('ditherAlg')[_0x45f049(0x14a)](_0x45f049(0x1c0),finishCrop),document['getElementById'](_0x45f049(0x178))[_0x45f049(0x14a)](_0x45f049(0x148),function(){const _0xb416e1=_0x45f049;finishCrop(),document[_0xb416e1(0x107)]('ditherStrengthValue')[_0xb416e1(0x18e)]=parseFloat(this[_0xb416e1(0x191)])['toFixed'](0x1);}),document['getElementById'](_0x45f049(0x166))[_0x45f049(0x14a)](_0x45f049(0x148),function(){const _0x8f85cf=_0x45f049;finishCrop(),document[_0x8f85cf(0x107)](_0x8f85cf(0x1c2))[_0x8f85cf(0x18e)]=parseFloat(this[_0x8f85cf(0x191)])['toFixed'](0x1);}),document['getElementById']('canvasSize')[_0x45f049(0x14a)](_0x45f049(0x1c0),updateCanvasSize);}function checkDebugMode(){const _0x2f18b7=_0x460b8d,_0x250c0e=document[_0x2f18b7(0x107)]('debug-toggle'),_0x3b6c5a=new URLSearchParams(window[_0x2f18b7(0x153)]['search']),_0x3068c0=_0x3b6c5a[_0x2f18b7(0x196)](_0x2f18b7(0x1bf));document[_0x2f18b7(0x109)]['classList']['add'](_0x2f18b7(0x173)),_0x250c0e[_0x2f18b7(0x1c3)](_0x2f18b7(0x190),window[_0x2f18b7(0x153)][_0x2f18b7(0x119)]);}document['body'][_0x460b8d(0x183)]=()=>{const _0x3c520f=_0x460b8d;textDecoder=null,canvas=document[_0x3c520f(0x107)](_0x3c520f(0x168)),ctx=canvas['getContext']('2d'),ctx['fillStyle']=_0x3c520f(0x1ab),ctx['fillRect'](0x0,0x0,canvas[_0x3c520f(0x154)],canvas[_0x3c520f(0x10e)]),initPaintTools(),initCropTools(),initEventHandlers(),updateButtonStatus(),checkDebugMode();};let currentRotation=0x0,originalImage=null;originalImage=image;const statusElement=document[_0x460b8d(0x107)](_0x460b8d(0x15e)),rotationDisplay=document[_0x460b8d(0x107)](_0x460b8d(0x175)),logElement=document[_0x460b8d(0x107)](_0x460b8d(0x12a));function drawImage(){const _0x40361b=_0x460b8d;ctx[_0x40361b(0x1c8)](0x0,0x0,canvas[_0x40361b(0x154)],canvas['height']),ctx[_0x40361b(0x108)]=_0x40361b(0x199),ctx[_0x40361b(0x185)](0x0,0x0,canvas[_0x40361b(0x154)],canvas[_0x40361b(0x10e)]),ctx[_0x40361b(0x155)](),ctx[_0x40361b(0x1c1)](canvas[_0x40361b(0x154)]/0x2,canvas[_0x40361b(0x10e)]/0x2),ctx[_0x40361b(0x12e)](currentRotation*Math['PI']/0xb4);let _0x39c539=originalImage[_0x40361b(0x154)],_0x40fdc6=originalImage[_0x40361b(0x10e)];Math[_0x40361b(0x1b8)](currentRotation)%0xb4===0x5a&&([_0x39c539,_0x40fdc6]=[_0x40fdc6,_0x39c539]);const _0x203fe7=Math[_0x40361b(0x1aa)](canvas[_0x40361b(0x154)]/_0x39c539,canvas[_0x40361b(0x10e)]/_0x40fdc6);ctx[_0x40361b(0x13a)](originalImage,-originalImage[_0x40361b(0x154)]*_0x203fe7/0x2,-originalImage[_0x40361b(0x10e)]*_0x203fe7/0x2,originalImage[_0x40361b(0x154)]*_0x203fe7,originalImage[_0x40361b(0x10e)]*_0x203fe7),convertDithering(),ctx[_0x40361b(0x1c6)]();}function rotateImage(_0x423cb8){currentRotation=(currentRotation+_0x423cb8)%0x168,drawImage(),addLog('图片已旋转\x20'+currentRotation+'°');}
