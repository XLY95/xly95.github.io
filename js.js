const _0x1652a4=_0x548c;(function(_0x4d573c,_0x3fee7d){const _0x318544=_0x548c,_0x371395=_0x4d573c();while(!![]){try{const _0xb4b525=-parseInt(_0x318544(0x192))/0x1*(-parseInt(_0x318544(0x1f4))/0x2)+-parseInt(_0x318544(0x179))/0x3*(-parseInt(_0x318544(0x1b5))/0x4)+parseInt(_0x318544(0x164))/0x5*(-parseInt(_0x318544(0x177))/0x6)+-parseInt(_0x318544(0x165))/0x7*(-parseInt(_0x318544(0x17b))/0x8)+parseInt(_0x318544(0x1c3))/0x9*(parseInt(_0x318544(0x160))/0xa)+parseInt(_0x318544(0x222))/0xb*(-parseInt(_0x318544(0x19b))/0xc)+parseInt(_0x318544(0x17e))/0xd;if(_0xb4b525===_0x3fee7d)break;else _0x371395['push'](_0x371395['shift']());}catch(_0x17db03){_0x371395['push'](_0x371395['shift']());}}}(_0x1623,0x9c0a6));let bleDevice,gattServer,epdService,epdCharacteristic,startTime,msgIndex,appVersion,canvas,ctx,textDecoder;const EpdCmd={'SET_PINS':0x0,'INIT':0x1,'CLEAR':0x2,'SEND_CMD':0x3,'SEND_DATA':0x4,'REFRESH':0x5,'SLEEP':0x6,'SET_TIME':0x20,'WRITE_IMG':0x30,'SET_CONFIG':0x90,'SYS_RESET':0x91,'SYS_SLEEP':0x92,'CFG_ERASE':0x99,'EPD_CMD_J_H':0xff,'EPD_CMD_N_Z':0xef,'EPD_CMD_J_S':0xee,'EPD_CMD_D_S':0xed,'EPD_CMD_LED':0xec,'EPD_CMD_MY':0xeb,'EPD_CMD_COLOR':0xea,'EPD_CMD_4_MS':0xfe,'EPD_CMD_4_LED':0xfd,'EPD_CMD_4_XZ':0xfc,'EPD_CMD_4_ZF':0xfb},canvasSizes=[{'name':_0x1652a4(0x186),'width':0x98,'height':0x98},{'name':'1.54_200_200','width':0xc8,'height':0xc8},{'name':_0x1652a4(0x169),'width':0xd4,'height':0x68},{'name':_0x1652a4(0x14f),'width':0xfa,'height':0x7a},{'name':_0x1652a4(0x190),'width':0x128,'height':0x98},{'name':_0x1652a4(0x217),'width':0x128,'height':0x80},{'name':_0x1652a4(0x1fa),'width':0x180,'height':0xa8},{'name':_0x1652a4(0x158),'width':0x180,'height':0xb8},{'name':_0x1652a4(0x1b8),'width':0x1a0,'height':0xf0},{'name':'3.97_800_480','width':0x320,'height':0x1e0},{'name':_0x1652a4(0x157),'width':0x190,'height':0x12c},{'name':_0x1652a4(0x1f2),'width':0x318,'height':0x110},{'name':'7.5_800_480','width':0x320,'height':0x1e0},{'name':_0x1652a4(0x1a9),'width':0x3c0,'height':0x280},{'name':_0x1652a4(0x1cd),'width':0x550,'height':0x1e0},{'name':_0x1652a4(0x211),'width':0x3c0,'height':0x280},{'name':_0x1652a4(0x1ee),'width':0x258,'height':0x190},{'name':'7.3E6','width':0x1e0,'height':0x320}];function hex2bytes(_0xda4f1e){const _0x350c8c=_0x1652a4;for(var _0xfe5553=[],_0x2519df=0x0;_0x2519df<_0xda4f1e[_0x350c8c(0x1dd)];_0x2519df+=0x2)_0xfe5553['push'](parseInt(_0xda4f1e[_0x350c8c(0x171)](_0x2519df,0x2),0x10));return new Uint8Array(_0xfe5553);}function bytes2hex(_0x2586b4){return new Uint8Array(_0x2586b4)['reduce'](function(_0x565bad,_0x485a34){const _0x51fd3e=_0x548c;return _0x565bad+('0'+_0x485a34['toString'](0x10))[_0x51fd3e(0x1dc)](-0x2);},'');}function intToHex(_0x4ca3ee){const _0xb1af4a=_0x1652a4;let _0x3a6211=(_0xb1af4a(0x189)+_0x4ca3ee[_0xb1af4a(0x16a)](0x10))[_0xb1af4a(0x171)](-0x4);return _0x3a6211[_0xb1af4a(0x1d1)](0x2,0x4)+_0x3a6211[_0xb1af4a(0x1d1)](0x0,0x2);}function resetVariables(){const _0x40f7b0=_0x1652a4;gattServer=null,epdService=null,epdCharacteristic=null,msgIndex=0x0,document[_0x40f7b0(0x172)](_0x40f7b0(0x1b2))[_0x40f7b0(0x1cc)]='';}async function write(_0x485a4a,_0xea20f6,_0x457d2f=!![]){const _0x239fff=_0x1652a4;if(!epdCharacteristic)return addLog(_0x239fff(0x20c)),![];let _0x4e80c8=[_0x485a4a];if(_0xea20f6){if(typeof _0xea20f6=='string')_0xea20f6=hex2bytes(_0xea20f6);if(_0xea20f6 instanceof Uint8Array)_0xea20f6=Array[_0x239fff(0x17c)](_0xea20f6);_0x4e80c8[_0x239fff(0x1b9)](..._0xea20f6);}try{if(_0x457d2f)await epdCharacteristic[_0x239fff(0x16b)](Uint8Array[_0x239fff(0x17c)](_0x4e80c8));else await epdCharacteristic['writeValueWithoutResponse'](Uint8Array[_0x239fff(0x17c)](_0x4e80c8));}catch(_0x5f5ada){console[_0x239fff(0x220)](_0x5f5ada);if(_0x5f5ada[_0x239fff(0x20d)])addLog(_0x239fff(0x21f)+_0x5f5ada[_0x239fff(0x20d)]);return![];}return!![];}async function writeImage(_0x129af2,_0x49aa7a='bw'){const _0x1112ca=_0x1652a4,_0x3d86d2=document[_0x1112ca(0x172)](_0x1112ca(0x209))[_0x1112ca(0x1cc)]-0x2,_0x16520a=document['getElementById'](_0x1112ca(0x162))[_0x1112ca(0x1cc)],_0x8a1e70=Math[_0x1112ca(0x163)](_0x129af2[_0x1112ca(0x1dd)]/_0x3d86d2);let _0x377885=0x0,_0x1f23ab=_0x16520a;for(let _0x24c7aa=0x0;_0x24c7aa<_0x129af2[_0x1112ca(0x1dd)];_0x24c7aa+=_0x3d86d2){let _0x338128=(new Date()[_0x1112ca(0x170)]()-startTime)/0x3e8;setStatus((_0x49aa7a=='bw'?'黑白':'红色')+_0x1112ca(0x212)+(_0x377885+0x1)+'/'+(_0x8a1e70+0x1)+_0x1112ca(0x193)+_0x338128+'s');const _0x3dda87=[(_0x49aa7a=='bw'?0xf:0x0)|(_0x24c7aa==0x0?0x0:0xf0),..._0x129af2[_0x1112ca(0x1dc)](_0x24c7aa,_0x24c7aa+_0x3d86d2)];_0x1f23ab>0x0?(await write(EpdCmd[_0x1112ca(0x224)],_0x3dda87,![]),_0x1f23ab--):(await write(EpdCmd['WRITE_IMG'],_0x3dda87,!![]),_0x1f23ab=_0x16520a),_0x377885++;}}async function setDriver(){const _0x54e328=_0x1652a4;await write(EpdCmd[_0x54e328(0x1c9)],document[_0x54e328(0x172)]('epdpins')[_0x54e328(0x1cc)]),await write(EpdCmd['INIT'],document['getElementById'](_0x54e328(0x1d3))[_0x54e328(0x1cc)]);}async function set_EPD_CMD_J_H(){const _0x1398d5=_0x1652a4;await write(EpdCmd[_0x1398d5(0x15d)],document['getElementById'](_0x1398d5(0x15c))['value']);}async function set_EPD_CMD_N_Z(){const _0x19fdd6=_0x1652a4,_0x3f84f0=document[_0x19fdd6(0x172)](_0x19fdd6(0x207))[_0x19fdd6(0x1cc)],_0x584a1f=document[_0x19fdd6(0x172)]('N_Z_min')['value'],_0x27dbea=document[_0x19fdd6(0x172)](_0x19fdd6(0x16c))['value'],_0x17149a=[0x4];_0x17149a[0x0]=0x0,_0x17149a[0x1]=0x0,_0x17149a[0x2]=_0x3f84f0,_0x17149a[0x3]=_0x584a1f,_0x17149a[0x4]=_0x27dbea,await write(EpdCmd['EPD_CMD_N_Z'],_0x17149a);}async function set_EPD_CMD_D_S(){const _0x3b9cab=_0x1652a4,_0xd6a41f=document[_0x3b9cab(0x172)](_0x3b9cab(0x159))[_0x3b9cab(0x1cc)],_0x16f9be=document[_0x3b9cab(0x172)](_0x3b9cab(0x1a7))[_0x3b9cab(0x1cc)],_0x1bba2c=document[_0x3b9cab(0x172)](_0x3b9cab(0x21d))[_0x3b9cab(0x1cc)],_0x294f9d=[0x4];_0x294f9d[0x0]=0x0,_0x294f9d[0x1]=0x0,_0x294f9d[0x2]=_0xd6a41f,_0x294f9d[0x3]=_0x16f9be,_0x294f9d[0x4]=_0x1bba2c,await write(EpdCmd['EPD_CMD_D_S'],_0x294f9d);}async function set_EPD_CMD_J_S(){const _0x5c6d02=_0x1652a4,_0x503f3b=document[_0x5c6d02(0x172)](_0x5c6d02(0x1ab))['value'],_0x920e5b=document['getElementById'](_0x5c6d02(0x1f9))[_0x5c6d02(0x1cc)],_0x2e76ff=document[_0x5c6d02(0x172)]('J_S_start')[_0x5c6d02(0x1cc)],_0x48b986=[0x4];_0x48b986[0x0]=0x0,_0x48b986[0x1]=0x0,_0x48b986[0x2]=_0x503f3b,_0x48b986[0x3]=_0x920e5b,_0x48b986[0x4]=_0x2e76ff,await write(EpdCmd[_0x5c6d02(0x178)],_0x48b986);}async function set_EPD_CMD_LED(){const _0xd1addb=_0x1652a4,_0xbad90a=document[_0xd1addb(0x172)](_0xd1addb(0x1bb))[_0xd1addb(0x1cc)],_0x4ebfcd=document[_0xd1addb(0x172)](_0xd1addb(0x18a))[_0xd1addb(0x1cc)],_0x44ea30=document[_0xd1addb(0x172)](_0xd1addb(0x1b6))[_0xd1addb(0x1cc)],_0x4fc60f=document[_0xd1addb(0x172)](_0xd1addb(0x1c4))[_0xd1addb(0x1cc)],_0x3fee32=document['getElementById'](_0xd1addb(0x1c4))[_0xd1addb(0x1cc)],_0x335634=[0x5];_0x335634[0x0]=_0xbad90a,_0x335634[0x1]=_0x4ebfcd,_0x335634[0x2]=_0x44ea30,_0x335634[0x3]=_0x4fc60f,_0x335634[0x4]=_0x3fee32,await write(EpdCmd[_0xd1addb(0x1db)],_0x335634);}async function set_EPD_CMD_LED1(){const _0x3a8e16=_0x1652a4,_0x2b6bf7=document[_0x3a8e16(0x172)]('color_led')[_0x3a8e16(0x1cc)],_0x4cb70a=document[_0x3a8e16(0x172)](_0x3a8e16(0x18a))[_0x3a8e16(0x1cc)],_0x23ab56=document['getElementById']('liang_add')['value'],_0x1f0dc9=document[_0x3a8e16(0x172)](_0x3a8e16(0x1c4))['value'],_0x499eb6=document['getElementById'](_0x3a8e16(0x1c4))[_0x3a8e16(0x1cc)],_0x3b76fb=[0x5];_0x3b76fb[0x0]=_0x2b6bf7,_0x3b76fb[0x1]=_0x4cb70a,_0x3b76fb[0x2]=_0x23ab56,_0x3b76fb[0x3]=_0x1f0dc9,_0x3b76fb[0x4]=_0x499eb6,await write(EpdCmd[_0x3a8e16(0x1c1)],_0x3b76fb);}async function set_EPD_CMD_MY(){const _0x384494=_0x1652a4,_0x3b3b5f=document[_0x384494(0x172)](_0x384494(0x1da))[_0x384494(0x1cc)],_0x11230a=document[_0x384494(0x172)](_0x384494(0x185))[_0x384494(0x1cc)],_0x1bbc53=document[_0x384494(0x172)]('qiangzhi_shuaxing')[_0x384494(0x1cc)],_0x29ae13=document['getElementById']('jushua_time')[_0x384494(0x1cc)],_0x254ca6=[0x4];_0x254ca6[0x0]=_0x3b3b5f,_0x254ca6[0x1]=_0x11230a,_0x254ca6[0x2]=_0x1bbc53,_0x254ca6[0x3]=_0x29ae13,await write(EpdCmd['EPD_CMD_MY'],_0x254ca6);}async function set_EPD_CMD_COLOR(){const _0x318c0b=_0x1652a4,_0x2b4bdb=document[_0x318c0b(0x172)](_0x318c0b(0x21e))[_0x318c0b(0x1cc)],_0x54e649=document['getElementById'](_0x318c0b(0x15f))[_0x318c0b(0x1cc)],_0x4cd195=document[_0x318c0b(0x172)](_0x318c0b(0x1ca))[_0x318c0b(0x1cc)],_0x49ce5a=document[_0x318c0b(0x172)](_0x318c0b(0x208))[_0x318c0b(0x1cc)],_0x2190db=document['getElementById'](_0x318c0b(0x1ec))[_0x318c0b(0x1cc)],_0x187ce4=document[_0x318c0b(0x172)](_0x318c0b(0x218))[_0x318c0b(0x1cc)],_0x3e7820=document[_0x318c0b(0x172)](_0x318c0b(0x1ce))[_0x318c0b(0x1cc)],_0x1a9955=[0x7];_0x1a9955[0x0]=_0x2b4bdb,_0x1a9955[0x1]=_0x54e649,_0x1a9955[0x2]=_0x4cd195,_0x1a9955[0x3]=_0x49ce5a,_0x1a9955[0x4]=_0x2190db,_0x1a9955[0x5]=_0x187ce4,_0x1a9955[0x6]=_0x3e7820,await write(EpdCmd[_0x318c0b(0x176)],_0x1a9955);}async function set_EPD_CMD_4_MS(){const _0x1da788=_0x1652a4,_0xb717a7=document[_0x1da788(0x172)](_0x1da788(0x1e3))['value'],_0x3b2fed=document[_0x1da788(0x172)](_0x1da788(0x1e4))[_0x1da788(0x1cc)],_0x4231a0=document[_0x1da788(0x172)](_0x1da788(0x1bc))[_0x1da788(0x1cc)],_0x2c6936=document[_0x1da788(0x172)]('xianshi_peizhi')[_0x1da788(0x1cc)],_0x38152f=document[_0x1da788(0x172)](_0x1da788(0x1fd))[_0x1da788(0x1cc)],_0x472f04=document[_0x1da788(0x172)](_0x1da788(0x1f3))[_0x1da788(0x1cc)],_0x48d092=document[_0x1da788(0x172)](_0x1da788(0x1be))[_0x1da788(0x1cc)],_0x1c69a5=[0x7];_0x1c69a5[0x0]=_0xb717a7,_0x1c69a5[0x1]=_0x3b2fed,_0x1c69a5[0x2]=_0x4231a0,_0x1c69a5[0x3]=_0x2c6936,_0x1c69a5[0x4]=_0x38152f,_0x1c69a5[0x5]=_0x472f04,_0x1c69a5[0x6]=_0x48d092,await write(EpdCmd['EPD_CMD_4_MS'],_0x1c69a5);}async function set_EPD_CMD_4_ZF(_0x1a8726){const _0x1d690f=_0x1652a4,_0x10c80a=[0x1];_0x10c80a[0x0]=_0x1a8726,await write(EpdCmd[_0x1d690f(0x1ff)],_0x10c80a),_0x1a8726==0x0&&(syncTime(0x2),addLog(_0x1d690f(0x1cb)));}async function syncTime(_0x47914e){const _0x52af93=_0x1652a4,_0x43600a=new Date()[_0x52af93(0x170)]()/0x3e8,_0x46141c=new Uint8Array([_0x43600a>>0x18&0xff,_0x43600a>>0x10&0xff,_0x43600a>>0x8&0xff,_0x43600a&0xff,-(new Date()[_0x52af93(0x204)]()/0x3c),_0x47914e]);await write(EpdCmd[_0x52af93(0x1aa)],_0x46141c)&&addLog(_0x52af93(0x18f));}async function clearScreen(){const _0x7deddf=_0x1652a4;0x1&&(await write(EpdCmd[_0x7deddf(0x1bf)]),addLog(_0x7deddf(0x219)));}async function sendcmd(){const _0x505c0b=_0x1652a4,_0x25f996=document[_0x505c0b(0x172)](_0x505c0b(0x20b))[_0x505c0b(0x1cc)];if(_0x25f996=='')return;const _0xaf3b8b=hex2bytes(_0x25f996);await write(_0xaf3b8b[0x0],_0xaf3b8b[_0x505c0b(0x1dd)]>0x1?_0xaf3b8b[_0x505c0b(0x1dc)](0x1):null);}function _0x1623(){const _0x381db=['childNodes','blackWhiteColor','join','block','2.9_296_128','jieqi_color','已清除屏慕！','restore','sendimgbutton','action','D_S_start','color_1','write:\x20','error','requestDevice','2332495DuYoiu','color','WRITE_IMG','2.13_250_122','getMinutes','请检查蓝牙，推荐使用Edge浏览器！','sixColor','min','ditherStrengthValue','white','setAttribute','4.2_400_300','3.5_384_184','D_S_hour','byteOffset','ditherAlg','epdpins','EPD_CMD_J_H','错误：预期','time_color','65630eYFZso','gattserverdisconnected','interleavedcount','round','975iYEXYO','791259fiKLLk','translate','files','setDriverbutton','2.13_212_104','toString','writeValueWithResponse','N_Z_start','toFixed','className','startNotifications','getTime','substr','getElementById','body','createElement','const\x20uint8_t\x20imageData[]\x20IMAGE\x20=\x20{','EPD_CMD_COLOR','28848vesDrp','EPD_CMD_J_S','17526vvIskb','drawImage','56zbZozd','from','ditherStrength','15220933KIRmEp','innerHTML','onload','revokeObjectURL','get','search','getUint8','xuanzhuan','1.54_152_152','data-size','getContext','0000','liang_time','62750002-d828-918d-fb46-b6c11c675aec','clockmodebutton','style','#FFFFFF','已同步时间！','2.66_296_152','clearRect','4TvQMsI',',\x20总用时:\x20','decode','pathname','canvasSize','selectedIndex','createTextNode','location','padStart','60DlZqQq','disabled','putImageData','sendcmdbutton','width','firstChild','bluetooth','imageFile','requestDevice:\x20','startsWith','canvas','status','D_S_min','getHours','10.2_960_640','SET_TIME','J_S_hour','已连接！','connect','debug','data-color','ditherContrast','parentElement','log','ditherMode','removeChild','44dMbaxD','liang_add','change','3.7_416_240','push','当前固件不支持此颜色模式。','color_led','jushua_time1','image.h','silian_ziti','CLEAR','download','EPD_CMD_4_LED','正在重连','747EFIsvs','liangdu','createObjectURL','src','62750001-d828-918d-fb46-b6c11c675aec','add','SET_PINS','wendu_color','主机已同步时间！','value','10.85_1360_480','r_jushua_time','REFRESH','connectbutton','substring','data','epddriver','div','input','debug-mode','textContent','getImageData','mtu=','fanxian','EPD_CMD_LED','slice','length','target','display','fillRect','disconnect','已断开连接.','fanxian1','xuanzhuan1','click','字节，但得到','const\x20uint8_t\x20colorMode\x20=\x20','scrollHeight','clearscreenbutton','scrollTop','请等待屏幕刷新完成！','shichen_color','abs','4E_600_400','fourColor','calendarmodebutton','正在连接:\x20','5.79_792_272','color_11','32918kwLIgE','threeColor','characteristicvaluechanged','fillStyle','options','J_S_min','2.9_384_168','span','appendChild','moshi_id','getCharacteristic','EPD_CMD_4_ZF','gatt','图片已旋转\x20','addEventListener','height','getTimezoneOffset','connected','发送完成！耗时:\x20','N_Z_hour','gongli_color','mtusize','find','cmdTXT','没有链接蓝牙','message','rotate','href','classList','11.6_960_640','块:\x20'];_0x1623=function(){return _0x381db;};return _0x1623();}async function sendimg(){const _0x156232=_0x1652a4,_0x58f44a=document['getElementById']('canvasSize')[_0x156232(0x1cc)],_0x48a85c=document[_0x156232(0x172)]('ditherMode')[_0x156232(0x1cc)],_0x30242c=document[_0x156232(0x172)](_0x156232(0x1d3)),_0x285413=_0x30242c['options'][_0x30242c[_0x156232(0x197)]];startTime=new Date()[_0x156232(0x170)]();const _0x5913c0=document[_0x156232(0x172)](_0x156232(0x1a6));_0x5913c0[_0x156232(0x1b1)]['style'][_0x156232(0x1df)]=_0x156232(0x216);const _0x1450f1=ctx[_0x156232(0x1d8)](0x0,0x0,canvas[_0x156232(0x19f)],canvas[_0x156232(0x203)]),_0x56ed96=processImageData(_0x1450f1,_0x48a85c);updateButtonStatus(!![]);if(_0x48a85c===_0x156232(0x1ef))await writeImage(_0x56ed96,_0x156232(0x223));else{if(_0x48a85c===_0x156232(0x1f5)){const _0x5d382a=Math['floor'](_0x56ed96[_0x156232(0x1dd)]/0x2);await writeImage(_0x56ed96['slice'](0x0,_0x5d382a),'bw'),await writeImage(_0x56ed96[_0x156232(0x1dc)](_0x5d382a),'red');}else{if(_0x48a85c===_0x156232(0x214))await writeImage(_0x56ed96,'bw');else{addLog(_0x156232(0x1ba)),updateButtonStatus();return;}}}await write(EpdCmd[_0x156232(0x1cf)]),updateButtonStatus();const _0x4e33d4=(new Date()['getTime']()-startTime)/0x3e8;addLog('发送完成！耗时:\x20'+_0x4e33d4+'s'),setStatus(_0x156232(0x206)+_0x4e33d4+'s'),addLog(_0x156232(0x1eb)),setTimeout(()=>{const _0x481ad8=_0x156232;_0x5913c0['parentElement'][_0x481ad8(0x18d)][_0x481ad8(0x1df)]='none';},0x1388);}function downloadDataArray(){const _0x6a7f08=_0x1652a4;if(isCropMode())return;const _0x316767=document[_0x6a7f08(0x172)](_0x6a7f08(0x1b3))[_0x6a7f08(0x1cc)],_0xd2f7ac=ctx['getImageData'](0x0,0x0,canvas[_0x6a7f08(0x19f)],canvas[_0x6a7f08(0x203)]),_0x170b00=processImageData(_0xd2f7ac,_0x316767);if(_0x316767===_0x6a7f08(0x152)&&_0x170b00[_0x6a7f08(0x1dd)]!==canvas[_0x6a7f08(0x19f)]*canvas['height']){console[_0x6a7f08(0x1b2)](_0x6a7f08(0x15e)+canvas[_0x6a7f08(0x19f)]*canvas[_0x6a7f08(0x203)]+_0x6a7f08(0x1e6)+_0x170b00[_0x6a7f08(0x1dd)]+'字节');return;}const _0x4d6c5d=[];for(let _0x49457e=0x0;_0x49457e<_0x170b00[_0x6a7f08(0x1dd)];_0x49457e++){const _0x5350ab=(_0x170b00[_0x49457e]&0xff)['toString'](0x10)[_0x6a7f08(0x19a)](0x2,'0');_0x4d6c5d[_0x6a7f08(0x1b9)]('0x'+_0x5350ab);}const _0x1e3e51=[];for(let _0x176901=0x0;_0x176901<_0x4d6c5d[_0x6a7f08(0x1dd)];_0x176901+=0x10){_0x1e3e51['push'](_0x4d6c5d['slice'](_0x176901,_0x176901+0x10)[_0x6a7f08(0x215)](',\x20'));}const _0x2ed2d9=_0x316767===_0x6a7f08(0x152)?0x0:_0x316767==='fourColor'?0x1:_0x316767===_0x6a7f08(0x214)?0x2:0x3,_0x1d089d=[_0x6a7f08(0x175),_0x1e3e51[_0x6a7f08(0x215)](',\x0a'),'};','const\x20uint16_t\x20imageWidth\x20=\x20'+canvas[_0x6a7f08(0x19f)]+';','const\x20uint16_t\x20imageHeight\x20=\x20'+canvas[_0x6a7f08(0x203)]+';',_0x6a7f08(0x1e7)+_0x2ed2d9+';'][_0x6a7f08(0x215)]('\x0a'),_0x5e8903=new Blob([_0x1d089d],{'type':'text/plain'}),_0x89ebf6=document[_0x6a7f08(0x174)]('a');_0x89ebf6[_0x6a7f08(0x1c0)]=_0x6a7f08(0x1bd),_0x89ebf6[_0x6a7f08(0x20f)]=URL[_0x6a7f08(0x1c5)](_0x5e8903),_0x89ebf6[_0x6a7f08(0x1e5)](),URL[_0x6a7f08(0x181)](_0x89ebf6[_0x6a7f08(0x20f)]);}function updateButtonStatus(_0x500567=![]){const _0x5f5cd6=_0x1652a4,_0x270673=gattServer!=null&&gattServer[_0x5f5cd6(0x205)],_0x442b04=_0x500567?'disabled':_0x270673?null:_0x5f5cd6(0x19c);document[_0x5f5cd6(0x172)]('reconnectbutton')['disabled']=gattServer==null||gattServer[_0x5f5cd6(0x205)]?_0x5f5cd6(0x19c):null,document[_0x5f5cd6(0x172)](_0x5f5cd6(0x19e))[_0x5f5cd6(0x19c)]=_0x442b04,document[_0x5f5cd6(0x172)](_0x5f5cd6(0x1f0))[_0x5f5cd6(0x19c)]=_0x442b04,document[_0x5f5cd6(0x172)](_0x5f5cd6(0x18c))['disabled']=_0x442b04,document[_0x5f5cd6(0x172)](_0x5f5cd6(0x1e9))[_0x5f5cd6(0x19c)]=_0x442b04,document[_0x5f5cd6(0x172)](_0x5f5cd6(0x21b))[_0x5f5cd6(0x19c)]=_0x442b04,document[_0x5f5cd6(0x172)](_0x5f5cd6(0x168))[_0x5f5cd6(0x19c)]=_0x442b04;}function disconnect(){const _0x20c3b1=_0x1652a4;updateButtonStatus(),resetVariables(),addLog(_0x20c3b1(0x1e2)),document[_0x20c3b1(0x172)](_0x20c3b1(0x1d0))['innerHTML']='连接';}async function preConnect(){const _0x294b0e=_0x1652a4;if(gattServer!=null&&gattServer[_0x294b0e(0x205)])bleDevice!=null&&bleDevice[_0x294b0e(0x200)][_0x294b0e(0x205)]&&bleDevice[_0x294b0e(0x200)][_0x294b0e(0x1e1)]();else{resetVariables();try{bleDevice=await navigator[_0x294b0e(0x1a1)][_0x294b0e(0x221)]({'optionalServices':['62750001-d828-918d-fb46-b6c11c675aec'],'acceptAllDevices':!![]});}catch(_0x297c3b){console[_0x294b0e(0x220)](_0x297c3b);if(_0x297c3b['message'])addLog(_0x294b0e(0x1a3)+_0x297c3b[_0x294b0e(0x20d)]);addLog(_0x294b0e(0x151));return;}await bleDevice['addEventListener'](_0x294b0e(0x161),disconnect),setTimeout(async function(){await connect();},0x12c);}}function _0x548c(_0x2014e8,_0x49fdab){const _0x1623e8=_0x1623();return _0x548c=function(_0x548c3a,_0x5de4c6){_0x548c3a=_0x548c3a-0x14f;let _0x17289a=_0x1623e8[_0x548c3a];return _0x17289a;},_0x548c(_0x2014e8,_0x49fdab);}async function reConnect(){const _0x28743f=_0x1652a4;if(bleDevice!=null&&bleDevice[_0x28743f(0x200)]['connected'])bleDevice[_0x28743f(0x200)][_0x28743f(0x1e1)]();resetVariables(),addLog(_0x28743f(0x1c2)),setTimeout(async function(){await connect();},0x12c);}function handleNotify(_0x2f4639,_0x40be5a){const _0x541415=_0x1652a4,_0x3590c8=new Uint8Array(_0x2f4639['buffer'],_0x2f4639[_0x541415(0x15a)],_0x2f4639['byteLength']);if(_0x40be5a==0x0){}else{if(textDecoder==null)textDecoder=new TextDecoder();const _0x234bbe=textDecoder[_0x541415(0x194)](_0x3590c8);if(_0x234bbe[_0x541415(0x1a4)](_0x541415(0x1d9))&&_0x234bbe[_0x541415(0x1dd)]>0x4){const _0x31214f=parseInt(_0x234bbe[_0x541415(0x1d1)](0x4));document[_0x541415(0x172)](_0x541415(0x209))[_0x541415(0x1cc)]=_0x31214f;}else{if(_0x234bbe['startsWith']('t=')&&_0x234bbe[_0x541415(0x1dd)]>0x2){const _0x3bfc62=parseInt(_0x234bbe[_0x541415(0x1d1)](0x2))+new Date()[_0x541415(0x204)]()*0x3c;}}}}async function connect(){const _0x5f2406=_0x1652a4;if(bleDevice==null||epdCharacteristic!=null)return;try{addLog(_0x5f2406(0x1f1)+bleDevice['name']),gattServer=await bleDevice[_0x5f2406(0x200)][_0x5f2406(0x1ad)](),epdService=await gattServer['getPrimaryService'](_0x5f2406(0x1c7)),epdCharacteristic=await epdService[_0x5f2406(0x1fe)](_0x5f2406(0x18b)),addLog(_0x5f2406(0x1ac));}catch(_0x249ca2){console['error'](_0x249ca2);if(_0x249ca2[_0x5f2406(0x20d)])addLog('connect:\x20'+_0x249ca2[_0x5f2406(0x20d)]);disconnect();return;}try{const _0x765a30=await epdService['getCharacteristic']('62750003-d828-918d-fb46-b6c11c675aec'),_0x4b23ea=await _0x765a30['readValue']();appVersion=_0x4b23ea[_0x5f2406(0x184)](0x0);}catch(_0x244db4){console['error'](_0x244db4),appVersion=0x15;}try{await epdCharacteristic[_0x5f2406(0x16f)](),epdCharacteristic[_0x5f2406(0x202)](_0x5f2406(0x1f6),_0x161b5d=>{const _0x250581=_0x5f2406;handleNotify(_0x161b5d[_0x250581(0x1de)][_0x250581(0x1cc)],msgIndex++);});}catch(_0x4d4eb1){console[_0x5f2406(0x220)](_0x4d4eb1);if(_0x4d4eb1[_0x5f2406(0x20d)])addLog('startNotifications:\x20'+_0x4d4eb1[_0x5f2406(0x20d)]);}await write(EpdCmd['INIT']),document[_0x5f2406(0x172)](_0x5f2406(0x1d0))['innerHTML']='断开',updateButtonStatus();}function setStatus(_0x14d2c8){const _0x46e0e2=_0x1652a4;document[_0x46e0e2(0x172)](_0x46e0e2(0x1a6))[_0x46e0e2(0x17f)]=_0x14d2c8;}function addLog(_0x5907ab,_0x4844f2=''){const _0x464640=_0x1652a4,_0x55ead9=document[_0x464640(0x172)](_0x464640(0x1b2)),_0x582d0a=new Date(),_0x2f09b6=String(_0x582d0a[_0x464640(0x1a8)]())[_0x464640(0x19a)](0x2,'0')+':'+String(_0x582d0a[_0x464640(0x150)]())[_0x464640(0x19a)](0x2,'0')+':'+String(_0x582d0a['getSeconds']())['padStart'](0x2,'0')+'\x20',_0x57ff88=document[_0x464640(0x174)](_0x464640(0x1d4)),_0x48e22=document[_0x464640(0x174)](_0x464640(0x1fb));_0x48e22[_0x464640(0x16e)]='time',_0x48e22[_0x464640(0x1d7)]=_0x2f09b6,_0x57ff88[_0x464640(0x1fc)](_0x48e22);if(_0x4844f2!==''){const _0x82b230=document[_0x464640(0x174)](_0x464640(0x1fb));_0x82b230[_0x464640(0x16e)]=_0x464640(0x21c),_0x82b230['innerHTML']=_0x4844f2,_0x57ff88[_0x464640(0x1fc)](_0x82b230);}_0x57ff88[_0x464640(0x1fc)](document[_0x464640(0x198)](_0x5907ab)),_0x55ead9[_0x464640(0x1fc)](_0x57ff88),_0x55ead9[_0x464640(0x1ea)]=_0x55ead9[_0x464640(0x1e8)];while(_0x55ead9[_0x464640(0x213)][_0x464640(0x1dd)]>0x14){_0x55ead9[_0x464640(0x1b4)](_0x55ead9[_0x464640(0x1a0)]);}}function clearLog(){const _0x31f34d=_0x1652a4;document['getElementById'](_0x31f34d(0x1b2))[_0x31f34d(0x17f)]='';}function fillCanvas(_0x3a9deb){const _0x54c710=_0x1652a4;ctx[_0x54c710(0x1f7)]=_0x3a9deb,ctx[_0x54c710(0x1e0)](0x0,0x0,canvas['width'],canvas['height']);}const image=new Image();function updateImage(){const _0xbc4a3b=_0x1652a4,_0x1b9673=document[_0xbc4a3b(0x172)](_0xbc4a3b(0x1a2));if(_0x1b9673['files'][_0xbc4a3b(0x1dd)]==0x0){fillCanvas('white');return;}image['onload']=function(){const _0x1feb6c=_0xbc4a3b;URL[_0x1feb6c(0x181)](this[_0x1feb6c(0x1c6)]);if(image[_0x1feb6c(0x19f)]/ image[_0x1feb6c(0x203)]==canvas[_0x1feb6c(0x19f)]/canvas[_0x1feb6c(0x203)]){if(isCropMode())exitCropMode();ctx['drawImage'](image,0x0,0x0,image[_0x1feb6c(0x19f)],image[_0x1feb6c(0x203)],0x0,0x0,canvas[_0x1feb6c(0x19f)],canvas[_0x1feb6c(0x203)]),redrawTextElements(),redrawLineSegments(),convertDithering();}else initializeCrop();},image['src']=URL[_0xbc4a3b(0x1c5)](_0x1b9673[_0xbc4a3b(0x167)][0x0]);}function updateCanvasSize(){const _0x4c8b41=_0x1652a4,_0x2ffd9d=document[_0x4c8b41(0x172)](_0x4c8b41(0x196))[_0x4c8b41(0x1cc)],_0x3683c5=canvasSizes[_0x4c8b41(0x20a)](_0xa709ae=>_0xa709ae['name']===_0x2ffd9d);canvas['width']=_0x3683c5[_0x4c8b41(0x19f)],canvas['height']=_0x3683c5[_0x4c8b41(0x203)],updateImage();}function updateDitcherOptions(){const _0x372760=_0x1652a4,_0x5ecca5=document[_0x372760(0x172)]('epddriver'),_0x2e43a1=_0x5ecca5[_0x372760(0x1f8)][_0x5ecca5[_0x372760(0x197)]],_0x45e272=_0x2e43a1['getAttribute'](_0x372760(0x1af)),_0x589f7b=_0x2e43a1['getAttribute'](_0x372760(0x187));if(_0x45e272)document['getElementById'](_0x372760(0x1b3))[_0x372760(0x1cc)]=_0x45e272;if(_0x589f7b)document[_0x372760(0x172)](_0x372760(0x196))[_0x372760(0x1cc)]=_0x589f7b;updateCanvasSize();}function rotateCanvas(){const _0x210616=_0x1652a4,_0x5abcf5=canvas[_0x210616(0x19f)],_0x55fe05=canvas[_0x210616(0x203)];canvas[_0x210616(0x19f)]=_0x55fe05,canvas['height']=_0x5abcf5,updateImage();}function clearCanvas(){const _0x2691de=_0x1652a4;if(0x1){fillCanvas(_0x2691de(0x155)),textElements=[],lineSegments=[];if(isCropMode())exitCropMode();return!![];}return![];}function convertDithering(){const _0x2d16d0=_0x1652a4,_0x12db9b=parseFloat(document[_0x2d16d0(0x172)](_0x2d16d0(0x1b0))[_0x2d16d0(0x1cc)]),_0x561036=ctx[_0x2d16d0(0x1d8)](0x0,0x0,canvas[_0x2d16d0(0x19f)],canvas[_0x2d16d0(0x203)]),_0x2f4e2b=new ImageData(new Uint8ClampedArray(_0x561036[_0x2d16d0(0x1d2)]),_0x561036[_0x2d16d0(0x19f)],_0x561036[_0x2d16d0(0x203)]);adjustContrast(_0x2f4e2b,_0x12db9b);const _0x17a564=document[_0x2d16d0(0x172)](_0x2d16d0(0x15b))[_0x2d16d0(0x1cc)],_0x2392a4=parseFloat(document[_0x2d16d0(0x172)](_0x2d16d0(0x17d))[_0x2d16d0(0x1cc)]),_0x9d958a=document['getElementById'](_0x2d16d0(0x1b3))[_0x2d16d0(0x1cc)],_0xb028f5=processImageData(ditherImage(_0x2f4e2b,_0x17a564,_0x2392a4,_0x9d958a),_0x9d958a),_0x3397bf=decodeProcessedData(_0xb028f5,canvas[_0x2d16d0(0x19f)],canvas[_0x2d16d0(0x203)],_0x9d958a);ctx[_0x2d16d0(0x19d)](_0x3397bf,0x0,0x0);}function initEventHandlers(){const _0x369880=_0x1652a4;document[_0x369880(0x172)]('epddriver')[_0x369880(0x202)]('change',updateDitcherOptions),document[_0x369880(0x172)](_0x369880(0x1a2))[_0x369880(0x202)](_0x369880(0x1b7),updateImage),document[_0x369880(0x172)]('ditherMode')[_0x369880(0x202)](_0x369880(0x1b7),finishCrop),document[_0x369880(0x172)](_0x369880(0x15b))[_0x369880(0x202)](_0x369880(0x1b7),finishCrop),document[_0x369880(0x172)]('ditherStrength')[_0x369880(0x202)]('input',function(){const _0x3a2fef=_0x369880;finishCrop(),document[_0x3a2fef(0x172)](_0x3a2fef(0x154))['innerText']=parseFloat(this[_0x3a2fef(0x1cc)])[_0x3a2fef(0x16d)](0x1);}),document['getElementById'](_0x369880(0x1b0))[_0x369880(0x202)](_0x369880(0x1d5),function(){const _0x199073=_0x369880;finishCrop(),document['getElementById']('ditherContrastValue')['innerText']=parseFloat(this[_0x199073(0x1cc)])[_0x199073(0x16d)](0x1);}),document[_0x369880(0x172)](_0x369880(0x196))['addEventListener'](_0x369880(0x1b7),updateCanvasSize);}function checkDebugMode(){const _0x120d23=_0x1652a4,_0x5df854=document['getElementById']('debug-toggle'),_0xd41a50=new URLSearchParams(window[_0x120d23(0x199)][_0x120d23(0x183)]),_0x5b02cc=_0xd41a50[_0x120d23(0x182)](_0x120d23(0x1ae));document[_0x120d23(0x173)][_0x120d23(0x210)][_0x120d23(0x1c8)](_0x120d23(0x1d6)),_0x5df854[_0x120d23(0x156)](_0x120d23(0x20f),window[_0x120d23(0x199)][_0x120d23(0x195)]);}document[_0x1652a4(0x173)][_0x1652a4(0x180)]=()=>{const _0xaf05e3=_0x1652a4;textDecoder=null,canvas=document[_0xaf05e3(0x172)](_0xaf05e3(0x1a5)),ctx=canvas[_0xaf05e3(0x188)]('2d'),ctx[_0xaf05e3(0x1f7)]=_0xaf05e3(0x155),ctx[_0xaf05e3(0x1e0)](0x0,0x0,canvas['width'],canvas[_0xaf05e3(0x203)]),initPaintTools(),initCropTools(),initEventHandlers(),updateButtonStatus(),checkDebugMode();};let currentRotation=0x0,originalImage=null;originalImage=image;const statusElement=document['getElementById']('status'),rotationDisplay=document[_0x1652a4(0x172)]('rotationDegrees'),logElement=document['getElementById'](_0x1652a4(0x1b2));function drawImage(){const _0xab0d94=_0x1652a4;ctx[_0xab0d94(0x191)](0x0,0x0,canvas[_0xab0d94(0x19f)],canvas[_0xab0d94(0x203)]),ctx[_0xab0d94(0x1f7)]=_0xab0d94(0x18e),ctx[_0xab0d94(0x1e0)](0x0,0x0,canvas[_0xab0d94(0x19f)],canvas[_0xab0d94(0x203)]),ctx['save'](),ctx[_0xab0d94(0x166)](canvas[_0xab0d94(0x19f)]/0x2,canvas[_0xab0d94(0x203)]/0x2),ctx[_0xab0d94(0x20e)](currentRotation*Math['PI']/0xb4);let _0x542c7c=originalImage['width'],_0xba4851=originalImage[_0xab0d94(0x203)];Math[_0xab0d94(0x1ed)](currentRotation)%0xb4===0x5a&&([_0x542c7c,_0xba4851]=[_0xba4851,_0x542c7c]);const _0x49e593=Math[_0xab0d94(0x153)](canvas[_0xab0d94(0x19f)]/_0x542c7c,canvas[_0xab0d94(0x203)]/_0xba4851);ctx[_0xab0d94(0x17a)](originalImage,-originalImage[_0xab0d94(0x19f)]*_0x49e593/0x2,-originalImage['height']*_0x49e593/0x2,originalImage[_0xab0d94(0x19f)]*_0x49e593,originalImage[_0xab0d94(0x203)]*_0x49e593),convertDithering(),ctx[_0xab0d94(0x21a)]();}function rotateImage(_0x36888b){const _0x3b56fa=_0x1652a4;currentRotation=(currentRotation+_0x36888b)%0x168,drawImage(),addLog(_0x3b56fa(0x201)+currentRotation+'°');}
