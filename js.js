const _0x1850f5=_0x50d2;(function(_0x4edeb1,_0xf58e91){const _0x2568a6=_0x50d2,_0x23afec=_0x4edeb1();while(!![]){try{const _0x1fe588=parseInt(_0x2568a6(0x187))/0x1*(parseInt(_0x2568a6(0x1f4))/0x2)+parseInt(_0x2568a6(0x1be))/0x3+-parseInt(_0x2568a6(0x168))/0x4*(parseInt(_0x2568a6(0x176))/0x5)+-parseInt(_0x2568a6(0x1f0))/0x6+-parseInt(_0x2568a6(0x21c))/0x7*(parseInt(_0x2568a6(0x1b3))/0x8)+-parseInt(_0x2568a6(0x21b))/0x9+parseInt(_0x2568a6(0x184))/0xa*(parseInt(_0x2568a6(0x21e))/0xb);if(_0x1fe588===_0xf58e91)break;else _0x23afec['push'](_0x23afec['shift']());}catch(_0x1e22cd){_0x23afec['push'](_0x23afec['shift']());}}}(_0x5152,0xad0d7));let bleDevice,gattServer,epdService,epdCharacteristic,startTime,msgIndex,appVersion,canvas,ctx,textDecoder;const EpdCmd={'SET_PINS':0x0,'INIT':0x1,'CLEAR':0x2,'SEND_CMD':0x3,'SEND_DATA':0x4,'REFRESH':0x5,'SLEEP':0x6,'SET_TIME':0x20,'WRITE_IMG':0x30,'SET_CONFIG':0x90,'SYS_RESET':0x91,'SYS_SLEEP':0x92,'CFG_ERASE':0x99,'EPD_CMD_J_H':0xff,'EPD_CMD_N_Z':0xef,'EPD_CMD_J_S':0xee,'EPD_CMD_D_S':0xed,'EPD_CMD_LED':0xec,'EPD_CMD_MY':0xeb,'EPD_CMD_COLOR':0xea,'EPD_CMD_4_MS':0xfe,'EPD_CMD_4_LED':0xfd,'EPD_CMD_4_XZ':0xfc,'EPD_CMD_4_ZF':0xfb},canvasSizes=[{'name':_0x1850f5(0x169),'width':0x98,'height':0x98},{'name':_0x1850f5(0x19a),'width':0xc8,'height':0xc8},{'name':'2.13_212_104','width':0xd4,'height':0x68},{'name':_0x1850f5(0x20a),'width':0xfa,'height':0x7a},{'name':_0x1850f5(0x158),'width':0x128,'height':0x98},{'name':_0x1850f5(0x1c1),'width':0x128,'height':0x80},{'name':_0x1850f5(0x1d4),'width':0x180,'height':0xa8},{'name':'3.5_384_184','width':0x180,'height':0xb8},{'name':_0x1850f5(0x1a0),'width':0x1a0,'height':0xf0},{'name':'3.97_800_480','width':0x320,'height':0x1e0},{'name':_0x1850f5(0x163),'width':0x190,'height':0x12c},{'name':_0x1850f5(0x227),'width':0x318,'height':0x110},{'name':'7.5_800_480','width':0x320,'height':0x1e0},{'name':'10.2_960_640','width':0x3c0,'height':0x280},{'name':_0x1850f5(0x1a2),'width':0x550,'height':0x1e0},{'name':'11.6_960_640','width':0x3c0,'height':0x280},{'name':_0x1850f5(0x212),'width':0x258,'height':0x190},{'name':_0x1850f5(0x174),'width':0x1e0,'height':0x320}];function hex2bytes(_0x1c41cf){const _0x385a16=_0x1850f5;for(var _0x27a9f9=[],_0xf00eeb=0x0;_0xf00eeb<_0x1c41cf[_0x385a16(0x159)];_0xf00eeb+=0x2)_0x27a9f9[_0x385a16(0x19b)](parseInt(_0x1c41cf['substr'](_0xf00eeb,0x2),0x10));return new Uint8Array(_0x27a9f9);}function _0x5152(){const _0x1bfa57=['J_S_hour','4E_600_400','round','disconnect','62750003-d828-918d-fb46-b6c11c675aec','min','slice','fourColor','block','revokeObjectURL','9511101xABHiJ','1918hYcwdV','white','51095xctWBo','gatt','message','createTextNode','color','div','clockmodebutton','ditherAlg','removeChild','5.79_792_272','padStart','getImageData','reconnectbutton','body','2.66_296_152','length','xuanzhuan1','jushua_time','string','selectedIndex','requestDevice','scrollHeight','fillStyle','N_Z_start','debug-toggle','4.2_400_300','主机已同步时间！','mtusize','EPD_CMD_4_ZF','href','12bXMNGX','1.54_152_152','display','const\x20uint8_t\x20colorMode\x20=\x20','addEventListener','请检查蓝牙，推荐使用Edge浏览器！','location','getCharacteristic','xuanzhuan','toString','gongli_color','jieqi_color','7.3E6','liang_add','1063570JjEatt','color_led','getContext','options','CLEAR','epddriver','#FFFFFF','threeColor','rotationDegrees','xianshi_peizhi','find','rotate','add','const\x20uint8_t\x20imageData[]\x20IMAGE\x20=\x20{','4150pxXPIa','files','EPD_CMD_4_LED','47JTHgxG','EPD_CMD_COLOR','getTimezoneOffset','data','error','epdpins','byteOffset','appendChild','none','sendimgbutton','J_S_start','save','parentElement','innerHTML','mtu=','shichen_color','target','const\x20uint16_t\x20imageHeight\x20=\x20','62750001-d828-918d-fb46-b6c11c675aec','1.54_200_200','push','请等待屏幕刷新完成！','search','EPD_CMD_MY','62750002-d828-918d-fb46-b6c11c675aec','3.7_416_240','span','10.85_1360_480','status','startsWith','0000','name','canvasSize','没有链接蓝牙','liang_time','join','D_S_min','getTime','pathname','liangdu','get','正在重连','from','action','32216BjZzwA','字节，但得到','moshi_id','toFixed','substring','liang_s','silian_ziti','已同步时间！','className','scrollTop','decode','4091169TspSJn','D_S_start','connected','2.9_296_128','const\x20uint16_t\x20imageWidth\x20=\x20','input','jushua_time1','INIT','click','sixColor','onload','J_S_min','value','data-size','getMinutes','createElement','connectbutton','color_1','EPD_CMD_4_MS','debug-mode','connect:\x20','innerText','2.9_384_168','fanxian1','buffer','log','已连接！','debug','getAttribute','substr','setDriverbutton','EPD_CMD_J_H',',\x20总用时:\x20','height','red','getSeconds','EPD_CMD_LED','WRITE_IMG','width','translate','data-color','ditherContrast','download','EPD_CMD_N_Z','EPD_CMD_J_S','canvas','change','ditherMode','gattserverdisconnected','SET_TIME','2044074OPSOWl','textContent','calendarmodebutton','错误：预期','23678wdlFWt','N_Z_hour','fillRect','drawImage','当前固件不支持此颜色模式。','N_Z_min','putImageData','blackWhiteColor','imageFile','byteLength','SET_PINS','getElementById','style','requestDevice:\x20','createObjectURL','write:\x20','clearscreenbutton','ditherStrengthValue','src','connect','color_11','ditherStrength','2.13_250_122','disabled','cmdTXT','characteristicvaluechanged','bluetooth','图片已旋转\x20','startNotifications'];_0x5152=function(){return _0x1bfa57;};return _0x5152();}function bytes2hex(_0x3591a7){return new Uint8Array(_0x3591a7)['reduce'](function(_0x104ad5,_0x4f3c09){const _0x27dbfb=_0x50d2;return _0x104ad5+('0'+_0x4f3c09[_0x27dbfb(0x171)](0x10))[_0x27dbfb(0x217)](-0x2);},'');}function intToHex(_0x42023a){const _0x1903b7=_0x1850f5;let _0x2662f4=(_0x1903b7(0x1a5)+_0x42023a['toString'](0x10))[_0x1903b7(0x1db)](-0x4);return _0x2662f4[_0x1903b7(0x1b7)](0x2,0x4)+_0x2662f4[_0x1903b7(0x1b7)](0x0,0x2);}function resetVariables(){const _0x588e36=_0x1850f5;gattServer=null,epdService=null,epdCharacteristic=null,msgIndex=0x0,document[_0x588e36(0x1ff)](_0x588e36(0x1d7))[_0x588e36(0x1ca)]='';}async function write(_0x442635,_0x29861e,_0x22f6aa=!![]){const _0x16d58e=_0x1850f5;if(!epdCharacteristic)return addLog(_0x16d58e(0x1a8)),![];let _0x39cbf2=[_0x442635];if(_0x29861e){if(typeof _0x29861e==_0x16d58e(0x15c))_0x29861e=hex2bytes(_0x29861e);if(_0x29861e instanceof Uint8Array)_0x29861e=Array['from'](_0x29861e);_0x39cbf2[_0x16d58e(0x19b)](..._0x29861e);}try{if(_0x22f6aa)await epdCharacteristic['writeValueWithResponse'](Uint8Array[_0x16d58e(0x1b1)](_0x39cbf2));else await epdCharacteristic['writeValueWithoutResponse'](Uint8Array['from'](_0x39cbf2));}catch(_0x44fcbe){console[_0x16d58e(0x18b)](_0x44fcbe);if(_0x44fcbe[_0x16d58e(0x220)])addLog(_0x16d58e(0x203)+_0x44fcbe[_0x16d58e(0x220)]);return![];}return!![];}async function writeImage(_0x31cafc,_0x413b2e='bw'){const _0x59812a=_0x1850f5,_0x380d5c=document['getElementById'](_0x59812a(0x165))[_0x59812a(0x1ca)]-0x2,_0x76fca=document[_0x59812a(0x1ff)]('interleavedcount')[_0x59812a(0x1ca)],_0x2ee513=Math[_0x59812a(0x213)](_0x31cafc[_0x59812a(0x159)]/_0x380d5c);let _0x5702a1=0x0,_0x48902a=_0x76fca;for(let _0x56bcb9=0x0;_0x56bcb9<_0x31cafc[_0x59812a(0x159)];_0x56bcb9+=_0x380d5c){let _0x2a7fda=(new Date()[_0x59812a(0x1ac)]()-startTime)/0x3e8;setStatus((_0x413b2e=='bw'?'黑白':'红色')+'块:\x20'+(_0x5702a1+0x1)+'/'+(_0x2ee513+0x1)+_0x59812a(0x1de)+_0x2a7fda+'s');const _0x57da9a=[(_0x413b2e=='bw'?0xf:0x0)|(_0x56bcb9==0x0?0x0:0xf0),..._0x31cafc[_0x59812a(0x217)](_0x56bcb9,_0x56bcb9+_0x380d5c)];_0x48902a>0x0?(await write(EpdCmd[_0x59812a(0x1e3)],_0x57da9a,![]),_0x48902a--):(await write(EpdCmd[_0x59812a(0x1e3)],_0x57da9a,!![]),_0x48902a=_0x76fca),_0x5702a1++;}}async function setDriver(){const _0x322487=_0x1850f5;await write(EpdCmd[_0x322487(0x1fe)],document[_0x322487(0x1ff)](_0x322487(0x18c))[_0x322487(0x1ca)]),await write(EpdCmd[_0x322487(0x1c5)],document[_0x322487(0x1ff)](_0x322487(0x17b))[_0x322487(0x1ca)]);}async function set_EPD_CMD_J_H(){const _0x41957a=_0x1850f5;await write(EpdCmd[_0x41957a(0x1dd)],document[_0x41957a(0x1ff)](_0x41957a(0x18c))[_0x41957a(0x1ca)]);}async function set_EPD_CMD_N_Z(){const _0x3f69e1=_0x1850f5,_0x64fb6=document[_0x3f69e1(0x1ff)](_0x3f69e1(0x1f5))[_0x3f69e1(0x1ca)],_0x52fd39=document['getElementById'](_0x3f69e1(0x1f9))[_0x3f69e1(0x1ca)],_0x1f39db=document['getElementById'](_0x3f69e1(0x161))['value'],_0x491d19=[0x4];_0x491d19[0x0]=0x0,_0x491d19[0x1]=0x0,_0x491d19[0x2]=_0x64fb6,_0x491d19[0x3]=_0x52fd39,_0x491d19[0x4]=_0x1f39db,await write(EpdCmd[_0x3f69e1(0x1e9)],_0x491d19);}async function set_EPD_CMD_D_S(){const _0x131c0e=_0x1850f5,_0xac45e6=document['getElementById']('D_S_hour')[_0x131c0e(0x1ca)],_0x29d8fd=document[_0x131c0e(0x1ff)](_0x131c0e(0x1ab))[_0x131c0e(0x1ca)],_0x33d40e=document[_0x131c0e(0x1ff)](_0x131c0e(0x1bf))[_0x131c0e(0x1ca)],_0x38e207=[0x4];_0x38e207[0x0]=0x0,_0x38e207[0x1]=0x0,_0x38e207[0x2]=_0xac45e6,_0x38e207[0x3]=_0x29d8fd,_0x38e207[0x4]=_0x33d40e,await write(EpdCmd['EPD_CMD_D_S'],_0x38e207);}async function set_EPD_CMD_J_S(){const _0xd2eb3d=_0x1850f5,_0x15c316=document[_0xd2eb3d(0x1ff)](_0xd2eb3d(0x211))[_0xd2eb3d(0x1ca)],_0x3d64b2=document[_0xd2eb3d(0x1ff)](_0xd2eb3d(0x1c9))[_0xd2eb3d(0x1ca)],_0x116c6d=document['getElementById'](_0xd2eb3d(0x191))['value'],_0x29f14c=[0x4];_0x29f14c[0x0]=0x0,_0x29f14c[0x1]=0x0,_0x29f14c[0x2]=_0x15c316,_0x29f14c[0x3]=_0x3d64b2,_0x29f14c[0x4]=_0x116c6d,await write(EpdCmd[_0xd2eb3d(0x1ea)],_0x29f14c);}async function set_EPD_CMD_LED(){const _0x9f748e=_0x1850f5,_0x114111=document[_0x9f748e(0x1ff)](_0x9f748e(0x177))[_0x9f748e(0x1ca)],_0x3188ba=document['getElementById'](_0x9f748e(0x1a9))[_0x9f748e(0x1ca)],_0x5b3b47=document[_0x9f748e(0x1ff)]('liang_add')['value'],_0x3ed4e9=document[_0x9f748e(0x1ff)](_0x9f748e(0x1ae))[_0x9f748e(0x1ca)],_0x195534=document['getElementById'](_0x9f748e(0x1b8))['value'],_0x301b83=[0x5];_0x301b83[0x0]=_0x114111,_0x301b83[0x1]=_0x3188ba,_0x301b83[0x2]=_0x5b3b47,_0x301b83[0x3]=_0x3ed4e9,_0x301b83[0x4]=_0x195534,await write(EpdCmd[_0x9f748e(0x1e2)],_0x301b83);}async function set_EPD_CMD_LED1(){const _0x53f8f0=_0x1850f5,_0x4e3cb5=document[_0x53f8f0(0x1ff)](_0x53f8f0(0x177))[_0x53f8f0(0x1ca)],_0x348b0c=document['getElementById']('liang_time')[_0x53f8f0(0x1ca)],_0x498fed=document[_0x53f8f0(0x1ff)](_0x53f8f0(0x175))[_0x53f8f0(0x1ca)],_0x11d86e=document['getElementById'](_0x53f8f0(0x1ae))[_0x53f8f0(0x1ca)],_0x53661f=document[_0x53f8f0(0x1ff)](_0x53f8f0(0x1b8))[_0x53f8f0(0x1ca)],_0xdc772=[0x5];_0xdc772[0x0]=_0x4e3cb5,_0xdc772[0x1]=_0x348b0c,_0xdc772[0x2]=_0x498fed,_0xdc772[0x3]=_0x11d86e,_0xdc772[0x4]=_0x53661f,await write(EpdCmd[_0x53f8f0(0x186)],_0xdc772);}async function set_EPD_CMD_MY(){const _0xa3ffa3=_0x1850f5,_0x383b2a=document[_0xa3ffa3(0x1ff)]('fanxian')['value'],_0x5a01df=document[_0xa3ffa3(0x1ff)](_0xa3ffa3(0x170))[_0xa3ffa3(0x1ca)],_0x25539d=document[_0xa3ffa3(0x1ff)]('qiangzhi_shuaxing')[_0xa3ffa3(0x1ca)],_0x582da3=document[_0xa3ffa3(0x1ff)](_0xa3ffa3(0x15b))['value'],_0x107537=[0x4];_0x107537[0x0]=_0x383b2a,_0x107537[0x1]=_0x5a01df,_0x107537[0x2]=_0x25539d,_0x107537[0x3]=_0x582da3,await write(EpdCmd[_0xa3ffa3(0x19e)],_0x107537);}async function set_EPD_CMD_COLOR(){const _0x57768b=_0x1850f5,_0x33cdb9=document[_0x57768b(0x1ff)](_0x57768b(0x1cf))[_0x57768b(0x1ca)],_0x57fc05=document[_0x57768b(0x1ff)]('time_color')['value'],_0x1a2c0a=document[_0x57768b(0x1ff)]('wendu_color')['value'],_0x26b262=document[_0x57768b(0x1ff)](_0x57768b(0x172))[_0x57768b(0x1ca)],_0x8e1bcd=document[_0x57768b(0x1ff)](_0x57768b(0x196))['value'],_0x476e5d=document[_0x57768b(0x1ff)](_0x57768b(0x173))[_0x57768b(0x1ca)],_0x5b5473=document[_0x57768b(0x1ff)]('r_jushua_time')[_0x57768b(0x1ca)],_0x2913ab=[0x7];_0x2913ab[0x0]=_0x33cdb9,_0x2913ab[0x1]=_0x57fc05,_0x2913ab[0x2]=_0x1a2c0a,_0x2913ab[0x3]=_0x26b262,_0x2913ab[0x4]=_0x8e1bcd,_0x2913ab[0x5]=_0x476e5d,_0x2913ab[0x6]=_0x5b5473,await write(EpdCmd[_0x57768b(0x188)],_0x2913ab);}async function set_EPD_CMD_4_MS(){const _0x300a7d=_0x1850f5,_0x45235b=document[_0x300a7d(0x1ff)](_0x300a7d(0x1d5))[_0x300a7d(0x1ca)],_0x4a5971=document[_0x300a7d(0x1ff)](_0x300a7d(0x15a))[_0x300a7d(0x1ca)],_0x59afd6=document[_0x300a7d(0x1ff)](_0x300a7d(0x1c4))['value'],_0x4fba9e=document[_0x300a7d(0x1ff)](_0x300a7d(0x17f))['value'],_0x3218bc=document[_0x300a7d(0x1ff)](_0x300a7d(0x1b5))['value'],_0x15e884=document[_0x300a7d(0x1ff)](_0x300a7d(0x208))[_0x300a7d(0x1ca)],_0x10d6b9=document[_0x300a7d(0x1ff)](_0x300a7d(0x1b9))[_0x300a7d(0x1ca)],_0x1e8320=[0x7];_0x1e8320[0x0]=_0x45235b,_0x1e8320[0x1]=_0x4a5971,_0x1e8320[0x2]=_0x59afd6,_0x1e8320[0x3]=_0x4fba9e,_0x1e8320[0x4]=_0x3218bc,_0x1e8320[0x5]=_0x15e884,_0x1e8320[0x6]=_0x10d6b9,await write(EpdCmd[_0x300a7d(0x1d0)],_0x1e8320);}async function set_EPD_CMD_4_ZF(_0x52f904){const _0x14d289=_0x1850f5,_0x5ecd21=[0x1];_0x5ecd21[0x0]=_0x52f904,await write(EpdCmd[_0x14d289(0x166)],_0x5ecd21),_0x52f904==0x0&&(syncTime(0x2),addLog(_0x14d289(0x164)));}async function syncTime(_0x24100d){const _0x400d9b=_0x1850f5,_0xbbdf75=new Date()[_0x400d9b(0x1ac)]()/0x3e8,_0x4f5b15=new Uint8Array([_0xbbdf75>>0x18&0xff,_0xbbdf75>>0x10&0xff,_0xbbdf75>>0x8&0xff,_0xbbdf75&0xff,-(new Date()[_0x400d9b(0x189)]()/0x3c),_0x24100d]);await write(EpdCmd[_0x400d9b(0x1ef)],_0x4f5b15)&&addLog(_0x400d9b(0x1ba));}async function clearScreen(){const _0x53341a=_0x1850f5;0x1&&(await write(EpdCmd[_0x53341a(0x17a)]),addLog('已清除屏慕！'));}async function sendcmd(){const _0x593371=_0x1850f5,_0x1261e2=document[_0x593371(0x1ff)](_0x593371(0x20c))[_0x593371(0x1ca)];if(_0x1261e2=='')return;const _0x461816=hex2bytes(_0x1261e2);await write(_0x461816[0x0],_0x461816[_0x593371(0x159)]>0x1?_0x461816[_0x593371(0x217)](0x1):null);}async function sendimg(){const _0x26b570=_0x1850f5,_0x182995=document[_0x26b570(0x1ff)](_0x26b570(0x1a7))[_0x26b570(0x1ca)],_0x1d069b=document[_0x26b570(0x1ff)](_0x26b570(0x1ed))[_0x26b570(0x1ca)],_0x315ec9=document['getElementById']('epddriver'),_0x421983=_0x315ec9[_0x26b570(0x179)][_0x315ec9[_0x26b570(0x15d)]];startTime=new Date()[_0x26b570(0x1ac)]();const _0x4ee319=document[_0x26b570(0x1ff)](_0x26b570(0x1a3));_0x4ee319[_0x26b570(0x193)]['style'][_0x26b570(0x16a)]=_0x26b570(0x219);const _0x5b9f37=ctx[_0x26b570(0x229)](0x0,0x0,canvas[_0x26b570(0x1e4)],canvas[_0x26b570(0x1df)]),_0x2abf86=processImageData(_0x5b9f37,_0x1d069b);updateButtonStatus(!![]);if(_0x1d069b==='fourColor')await writeImage(_0x2abf86,_0x26b570(0x222));else{if(_0x1d069b===_0x26b570(0x17d)){const _0x1a42bb=Math['floor'](_0x2abf86['length']/0x2);await writeImage(_0x2abf86['slice'](0x0,_0x1a42bb),'bw'),await writeImage(_0x2abf86[_0x26b570(0x217)](_0x1a42bb),_0x26b570(0x1e0));}else{if(_0x1d069b===_0x26b570(0x1fb))await writeImage(_0x2abf86,'bw');else{addLog(_0x26b570(0x1f8)),updateButtonStatus();return;}}}await write(EpdCmd['REFRESH']),updateButtonStatus();const _0x1d57ea=(new Date()[_0x26b570(0x1ac)]()-startTime)/0x3e8;addLog('发送完成！耗时:\x20'+_0x1d57ea+'s'),setStatus('发送完成！耗时:\x20'+_0x1d57ea+'s'),addLog(_0x26b570(0x19c)),setTimeout(()=>{const _0xbe9c86=_0x26b570;_0x4ee319[_0xbe9c86(0x193)][_0xbe9c86(0x200)][_0xbe9c86(0x16a)]=_0xbe9c86(0x18f);},0x1388);}function downloadDataArray(){const _0xdd5363=_0x1850f5;if(isCropMode())return;const _0x4b0763=document[_0xdd5363(0x1ff)](_0xdd5363(0x1ed))[_0xdd5363(0x1ca)],_0x450f6a=ctx[_0xdd5363(0x229)](0x0,0x0,canvas[_0xdd5363(0x1e4)],canvas[_0xdd5363(0x1df)]),_0x2dbf71=processImageData(_0x450f6a,_0x4b0763);if(_0x4b0763===_0xdd5363(0x1c7)&&_0x2dbf71[_0xdd5363(0x159)]!==canvas[_0xdd5363(0x1e4)]*canvas['height']){console['log'](_0xdd5363(0x1f3)+canvas[_0xdd5363(0x1e4)]*canvas[_0xdd5363(0x1df)]+_0xdd5363(0x1b4)+_0x2dbf71[_0xdd5363(0x159)]+'字节');return;}const _0x2b638a=[];for(let _0x31fb7e=0x0;_0x31fb7e<_0x2dbf71[_0xdd5363(0x159)];_0x31fb7e++){const _0x4a1f83=(_0x2dbf71[_0x31fb7e]&0xff)[_0xdd5363(0x171)](0x10)[_0xdd5363(0x228)](0x2,'0');_0x2b638a[_0xdd5363(0x19b)]('0x'+_0x4a1f83);}const _0x52d5ca=[];for(let _0x42028f=0x0;_0x42028f<_0x2b638a[_0xdd5363(0x159)];_0x42028f+=0x10){_0x52d5ca[_0xdd5363(0x19b)](_0x2b638a[_0xdd5363(0x217)](_0x42028f,_0x42028f+0x10)[_0xdd5363(0x1aa)](',\x20'));}const _0xf9551=_0x4b0763===_0xdd5363(0x1c7)?0x0:_0x4b0763===_0xdd5363(0x218)?0x1:_0x4b0763===_0xdd5363(0x1fb)?0x2:0x3,_0x2827e3=[_0xdd5363(0x183),_0x52d5ca['join'](',\x0a'),'};',_0xdd5363(0x1c2)+canvas['width']+';',_0xdd5363(0x198)+canvas[_0xdd5363(0x1df)]+';',_0xdd5363(0x16b)+_0xf9551+';']['join']('\x0a'),_0x839d38=new Blob([_0x2827e3],{'type':'text/plain'}),_0x537c99=document['createElement']('a');_0x537c99[_0xdd5363(0x1e8)]='image.h',_0x537c99[_0xdd5363(0x167)]=URL[_0xdd5363(0x202)](_0x839d38),_0x537c99[_0xdd5363(0x1c6)](),URL[_0xdd5363(0x21a)](_0x537c99[_0xdd5363(0x167)]);}function updateButtonStatus(_0x3cf5c3=![]){const _0x4aafd6=_0x1850f5,_0x2b1c13=gattServer!=null&&gattServer[_0x4aafd6(0x1c0)],_0x1266fb=_0x3cf5c3?_0x4aafd6(0x20b):_0x2b1c13?null:_0x4aafd6(0x20b);document['getElementById'](_0x4aafd6(0x22a))[_0x4aafd6(0x20b)]=gattServer==null||gattServer['connected']?_0x4aafd6(0x20b):null,document['getElementById']('sendcmdbutton')['disabled']=_0x1266fb,document['getElementById'](_0x4aafd6(0x1f2))[_0x4aafd6(0x20b)]=_0x1266fb,document['getElementById'](_0x4aafd6(0x224))[_0x4aafd6(0x20b)]=_0x1266fb,document[_0x4aafd6(0x1ff)](_0x4aafd6(0x204))[_0x4aafd6(0x20b)]=_0x1266fb,document['getElementById'](_0x4aafd6(0x190))[_0x4aafd6(0x20b)]=_0x1266fb,document['getElementById'](_0x4aafd6(0x1dc))[_0x4aafd6(0x20b)]=_0x1266fb;}function disconnect(){const _0x1e8469=_0x1850f5;updateButtonStatus(),resetVariables(),addLog('已断开连接.'),document[_0x1e8469(0x1ff)](_0x1e8469(0x1ce))[_0x1e8469(0x194)]='连接';}async function preConnect(){const _0x4b0ca7=_0x1850f5;if(gattServer!=null&&gattServer[_0x4b0ca7(0x1c0)])bleDevice!=null&&bleDevice[_0x4b0ca7(0x21f)][_0x4b0ca7(0x1c0)]&&bleDevice[_0x4b0ca7(0x21f)]['disconnect']();else{resetVariables();try{bleDevice=await navigator[_0x4b0ca7(0x20e)][_0x4b0ca7(0x15e)]({'optionalServices':[_0x4b0ca7(0x199)],'acceptAllDevices':!![]});}catch(_0x27c266){console['error'](_0x27c266);if(_0x27c266[_0x4b0ca7(0x220)])addLog(_0x4b0ca7(0x201)+_0x27c266[_0x4b0ca7(0x220)]);addLog(_0x4b0ca7(0x16d));return;}await bleDevice[_0x4b0ca7(0x16c)](_0x4b0ca7(0x1ee),disconnect),setTimeout(async function(){await connect();},0x12c);}}async function reConnect(){const _0x10f82d=_0x1850f5;if(bleDevice!=null&&bleDevice[_0x10f82d(0x21f)]['connected'])bleDevice[_0x10f82d(0x21f)][_0x10f82d(0x214)]();resetVariables(),addLog(_0x10f82d(0x1b0)),setTimeout(async function(){await connect();},0x12c);}function handleNotify(_0x523147,_0x1c6356){const _0x1c6d85=_0x1850f5,_0xe4c704=new Uint8Array(_0x523147[_0x1c6d85(0x1d6)],_0x523147[_0x1c6d85(0x18d)],_0x523147[_0x1c6d85(0x1fd)]);if(_0x1c6356==0x0){}else{if(textDecoder==null)textDecoder=new TextDecoder();const _0x513e75=textDecoder[_0x1c6d85(0x1bd)](_0xe4c704);if(_0x513e75[_0x1c6d85(0x1a4)](_0x1c6d85(0x195))&&_0x513e75['length']>0x4){const _0x42cd29=parseInt(_0x513e75[_0x1c6d85(0x1b7)](0x4));document['getElementById']('mtusize')[_0x1c6d85(0x1ca)]=_0x42cd29;}else{if(_0x513e75['startsWith']('t=')&&_0x513e75[_0x1c6d85(0x159)]>0x2){const _0x1b2c92=parseInt(_0x513e75[_0x1c6d85(0x1b7)](0x2))+new Date()[_0x1c6d85(0x189)]()*0x3c;}}}}async function connect(){const _0x3eab8a=_0x1850f5;if(bleDevice==null||epdCharacteristic!=null)return;try{addLog('正在连接:\x20'+bleDevice[_0x3eab8a(0x1a6)]),gattServer=await bleDevice['gatt'][_0x3eab8a(0x207)](),epdService=await gattServer['getPrimaryService'](_0x3eab8a(0x199)),epdCharacteristic=await epdService[_0x3eab8a(0x16f)](_0x3eab8a(0x19f)),addLog(_0x3eab8a(0x1d8));}catch(_0x3a19ec){console['error'](_0x3a19ec);if(_0x3a19ec[_0x3eab8a(0x220)])addLog(_0x3eab8a(0x1d2)+_0x3a19ec[_0x3eab8a(0x220)]);disconnect();return;}try{const _0x4b5aa9=await epdService[_0x3eab8a(0x16f)](_0x3eab8a(0x215)),_0x4c1049=await _0x4b5aa9['readValue']();appVersion=_0x4c1049['getUint8'](0x0);}catch(_0x44a549){console[_0x3eab8a(0x18b)](_0x44a549),appVersion=0x15;}try{await epdCharacteristic[_0x3eab8a(0x210)](),epdCharacteristic['addEventListener'](_0x3eab8a(0x20d),_0x1da46e=>{const _0x3c6b2e=_0x3eab8a;handleNotify(_0x1da46e[_0x3c6b2e(0x197)]['value'],msgIndex++);});}catch(_0x43b335){console[_0x3eab8a(0x18b)](_0x43b335);if(_0x43b335[_0x3eab8a(0x220)])addLog('startNotifications:\x20'+_0x43b335['message']);}await write(EpdCmd['INIT']),document[_0x3eab8a(0x1ff)](_0x3eab8a(0x1ce))[_0x3eab8a(0x194)]='断开',updateButtonStatus();}function setStatus(_0x4abbb1){const _0xdf6534=_0x1850f5;document['getElementById'](_0xdf6534(0x1a3))[_0xdf6534(0x194)]=_0x4abbb1;}function addLog(_0x186ae9,_0x59f2e0=''){const _0x8b8034=_0x1850f5,_0x305477=document['getElementById']('log'),_0xa1021f=new Date(),_0x59dac7=String(_0xa1021f['getHours']())[_0x8b8034(0x228)](0x2,'0')+':'+String(_0xa1021f[_0x8b8034(0x1cc)]())[_0x8b8034(0x228)](0x2,'0')+':'+String(_0xa1021f[_0x8b8034(0x1e1)]())['padStart'](0x2,'0')+'\x20',_0x38e412=document[_0x8b8034(0x1cd)](_0x8b8034(0x223)),_0x33dcc2=document[_0x8b8034(0x1cd)]('span');_0x33dcc2['className']='time',_0x33dcc2[_0x8b8034(0x1f1)]=_0x59dac7,_0x38e412[_0x8b8034(0x18e)](_0x33dcc2);if(_0x59f2e0!==''){const _0x4651b5=document[_0x8b8034(0x1cd)](_0x8b8034(0x1a1));_0x4651b5[_0x8b8034(0x1bb)]=_0x8b8034(0x1b2),_0x4651b5[_0x8b8034(0x194)]=_0x59f2e0,_0x38e412['appendChild'](_0x4651b5);}_0x38e412[_0x8b8034(0x18e)](document[_0x8b8034(0x221)](_0x186ae9)),_0x305477[_0x8b8034(0x18e)](_0x38e412),_0x305477[_0x8b8034(0x1bc)]=_0x305477[_0x8b8034(0x15f)];while(_0x305477['childNodes'][_0x8b8034(0x159)]>0x14){_0x305477[_0x8b8034(0x226)](_0x305477['firstChild']);}}function clearLog(){const _0x47b3da=_0x1850f5;document[_0x47b3da(0x1ff)](_0x47b3da(0x1d7))[_0x47b3da(0x194)]='';}function fillCanvas(_0x1a9a7c){const _0x4ffb9e=_0x1850f5;ctx[_0x4ffb9e(0x160)]=_0x1a9a7c,ctx[_0x4ffb9e(0x1f6)](0x0,0x0,canvas['width'],canvas[_0x4ffb9e(0x1df)]);}const image=new Image();function updateImage(){const _0x186409=_0x1850f5,_0x34816d=document[_0x186409(0x1ff)]('imageFile');if(_0x34816d['files'][_0x186409(0x159)]==0x0){fillCanvas(_0x186409(0x21d));return;}image[_0x186409(0x1c8)]=function(){const _0x4c19a6=_0x186409;URL['revokeObjectURL'](this[_0x4c19a6(0x206)]);if(image[_0x4c19a6(0x1e4)]/ image['height']==canvas[_0x4c19a6(0x1e4)]/canvas[_0x4c19a6(0x1df)]){if(isCropMode())exitCropMode();ctx[_0x4c19a6(0x1f7)](image,0x0,0x0,image['width'],image[_0x4c19a6(0x1df)],0x0,0x0,canvas['width'],canvas[_0x4c19a6(0x1df)]),redrawTextElements(),redrawLineSegments(),convertDithering();}else initializeCrop();},image[_0x186409(0x206)]=URL[_0x186409(0x202)](_0x34816d[_0x186409(0x185)][0x0]);}function updateCanvasSize(){const _0x5db66a=_0x1850f5,_0x33e38c=document[_0x5db66a(0x1ff)](_0x5db66a(0x1a7))[_0x5db66a(0x1ca)],_0x338836=canvasSizes[_0x5db66a(0x180)](_0x5e948c=>_0x5e948c[_0x5db66a(0x1a6)]===_0x33e38c);canvas[_0x5db66a(0x1e4)]=_0x338836[_0x5db66a(0x1e4)],canvas[_0x5db66a(0x1df)]=_0x338836[_0x5db66a(0x1df)],updateImage();}function updateDitcherOptions(){const _0x50c96d=_0x1850f5,_0x19f0ee=document['getElementById'](_0x50c96d(0x17b)),_0x482918=_0x19f0ee[_0x50c96d(0x179)][_0x19f0ee[_0x50c96d(0x15d)]],_0x578e28=_0x482918['getAttribute'](_0x50c96d(0x1e6)),_0x4a1b50=_0x482918[_0x50c96d(0x1da)](_0x50c96d(0x1cb));if(_0x578e28)document[_0x50c96d(0x1ff)]('ditherMode')['value']=_0x578e28;if(_0x4a1b50)document[_0x50c96d(0x1ff)](_0x50c96d(0x1a7))['value']=_0x4a1b50;updateCanvasSize();}function rotateCanvas(){const _0x4fae8b=_0x1850f5,_0x14d60f=canvas[_0x4fae8b(0x1e4)],_0x5a050b=canvas['height'];canvas[_0x4fae8b(0x1e4)]=_0x5a050b,canvas[_0x4fae8b(0x1df)]=_0x14d60f,updateImage();}function clearCanvas(){const _0x4d262c=_0x1850f5;if(0x1){fillCanvas(_0x4d262c(0x21d)),textElements=[],lineSegments=[];if(isCropMode())exitCropMode();return!![];}return![];}function convertDithering(){const _0x10daee=_0x1850f5,_0x4e0f40=parseFloat(document[_0x10daee(0x1ff)]('ditherContrast')[_0x10daee(0x1ca)]),_0x2addb1=ctx[_0x10daee(0x229)](0x0,0x0,canvas['width'],canvas['height']),_0xbdf823=new ImageData(new Uint8ClampedArray(_0x2addb1[_0x10daee(0x18a)]),_0x2addb1[_0x10daee(0x1e4)],_0x2addb1['height']);adjustContrast(_0xbdf823,_0x4e0f40);const _0x2a7949=document['getElementById'](_0x10daee(0x225))[_0x10daee(0x1ca)],_0x28ee34=parseFloat(document[_0x10daee(0x1ff)](_0x10daee(0x209))[_0x10daee(0x1ca)]),_0x319425=document[_0x10daee(0x1ff)]('ditherMode')[_0x10daee(0x1ca)],_0x3c7d5b=processImageData(ditherImage(_0xbdf823,_0x2a7949,_0x28ee34,_0x319425),_0x319425),_0x2d2e50=decodeProcessedData(_0x3c7d5b,canvas[_0x10daee(0x1e4)],canvas[_0x10daee(0x1df)],_0x319425);ctx[_0x10daee(0x1fa)](_0x2d2e50,0x0,0x0);}function initEventHandlers(){const _0x3c4e1a=_0x1850f5;document[_0x3c4e1a(0x1ff)](_0x3c4e1a(0x17b))[_0x3c4e1a(0x16c)](_0x3c4e1a(0x1ec),updateDitcherOptions),document['getElementById'](_0x3c4e1a(0x1fc))[_0x3c4e1a(0x16c)](_0x3c4e1a(0x1ec),updateImage),document[_0x3c4e1a(0x1ff)]('ditherMode')[_0x3c4e1a(0x16c)]('change',finishCrop),document[_0x3c4e1a(0x1ff)]('ditherAlg')[_0x3c4e1a(0x16c)]('change',finishCrop),document[_0x3c4e1a(0x1ff)](_0x3c4e1a(0x209))['addEventListener'](_0x3c4e1a(0x1c3),function(){const _0x408412=_0x3c4e1a;finishCrop(),document['getElementById'](_0x408412(0x205))[_0x408412(0x1d3)]=parseFloat(this[_0x408412(0x1ca)])[_0x408412(0x1b6)](0x1);}),document[_0x3c4e1a(0x1ff)](_0x3c4e1a(0x1e7))[_0x3c4e1a(0x16c)](_0x3c4e1a(0x1c3),function(){const _0x4106b8=_0x3c4e1a;finishCrop(),document[_0x4106b8(0x1ff)]('ditherContrastValue')[_0x4106b8(0x1d3)]=parseFloat(this[_0x4106b8(0x1ca)])['toFixed'](0x1);}),document[_0x3c4e1a(0x1ff)](_0x3c4e1a(0x1a7))[_0x3c4e1a(0x16c)](_0x3c4e1a(0x1ec),updateCanvasSize);}function checkDebugMode(){const _0x4b478f=_0x1850f5,_0x2aeb92=document[_0x4b478f(0x1ff)](_0x4b478f(0x162)),_0x5bc0c8=new URLSearchParams(window[_0x4b478f(0x16e)][_0x4b478f(0x19d)]),_0x5bb440=_0x5bc0c8[_0x4b478f(0x1af)](_0x4b478f(0x1d9));document[_0x4b478f(0x157)]['classList'][_0x4b478f(0x182)](_0x4b478f(0x1d1)),_0x2aeb92['setAttribute']('href',window[_0x4b478f(0x16e)][_0x4b478f(0x1ad)]);}document['body']['onload']=()=>{const _0x3537b3=_0x1850f5;textDecoder=null,canvas=document[_0x3537b3(0x1ff)](_0x3537b3(0x1eb)),ctx=canvas[_0x3537b3(0x178)]('2d'),ctx['fillStyle']=_0x3537b3(0x21d),ctx[_0x3537b3(0x1f6)](0x0,0x0,canvas[_0x3537b3(0x1e4)],canvas[_0x3537b3(0x1df)]),initPaintTools(),initCropTools(),initEventHandlers(),updateButtonStatus(),checkDebugMode();};let currentRotation=0x0,originalImage=null;originalImage=image;function _0x50d2(_0x24fd8f,_0x44f66b){const _0x51522f=_0x5152();return _0x50d2=function(_0x50d220,_0x5d6880){_0x50d220=_0x50d220-0x157;let _0x27d6a9=_0x51522f[_0x50d220];return _0x27d6a9;},_0x50d2(_0x24fd8f,_0x44f66b);}const statusElement=document[_0x1850f5(0x1ff)]('status'),rotationDisplay=document['getElementById'](_0x1850f5(0x17e)),logElement=document[_0x1850f5(0x1ff)](_0x1850f5(0x1d7));function drawImage(){const _0x444e59=_0x1850f5;ctx['clearRect'](0x0,0x0,canvas[_0x444e59(0x1e4)],canvas[_0x444e59(0x1df)]),ctx['fillStyle']=_0x444e59(0x17c),ctx[_0x444e59(0x1f6)](0x0,0x0,canvas[_0x444e59(0x1e4)],canvas[_0x444e59(0x1df)]),ctx[_0x444e59(0x192)](),ctx[_0x444e59(0x1e5)](canvas[_0x444e59(0x1e4)]/0x2,canvas[_0x444e59(0x1df)]/0x2),ctx[_0x444e59(0x181)](currentRotation*Math['PI']/0xb4);let _0x3a0468=originalImage[_0x444e59(0x1e4)],_0x6dc928=originalImage['height'];Math['abs'](currentRotation)%0xb4===0x5a&&([_0x3a0468,_0x6dc928]=[_0x6dc928,_0x3a0468]);const _0x3c1c4f=Math[_0x444e59(0x216)](canvas['width']/_0x3a0468,canvas[_0x444e59(0x1df)]/_0x6dc928);ctx[_0x444e59(0x1f7)](originalImage,-originalImage[_0x444e59(0x1e4)]*_0x3c1c4f/0x2,-originalImage[_0x444e59(0x1df)]*_0x3c1c4f/0x2,originalImage[_0x444e59(0x1e4)]*_0x3c1c4f,originalImage['height']*_0x3c1c4f),convertDithering(),ctx['restore']();}function rotateImage(_0x483a1a){const _0x4a5afe=_0x1850f5;currentRotation=(currentRotation+_0x483a1a)%0x168,drawImage(),addLog(_0x4a5afe(0x20f)+currentRotation+'°');}
