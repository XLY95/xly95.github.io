const _0x593dfd=_0x5cf9;(function(_0x463cf0,_0x1f40f9){const _0x4f14b6=_0x5cf9,_0x1b50c9=_0x463cf0();while(!![]){try{const _0x2f68cf=parseInt(_0x4f14b6(0x256))/0x1*(parseInt(_0x4f14b6(0x209))/0x2)+parseInt(_0x4f14b6(0x1de))/0x3*(-parseInt(_0x4f14b6(0x272))/0x4)+-parseInt(_0x4f14b6(0x25c))/0x5+-parseInt(_0x4f14b6(0x27a))/0x6+parseInt(_0x4f14b6(0x1e6))/0x7*(parseInt(_0x4f14b6(0x1e4))/0x8)+-parseInt(_0x4f14b6(0x227))/0x9+parseInt(_0x4f14b6(0x254))/0xa;if(_0x2f68cf===_0x1f40f9)break;else _0x1b50c9['push'](_0x1b50c9['shift']());}catch(_0x34e979){_0x1b50c9['push'](_0x1b50c9['shift']());}}}(_0xc26c,0x4a46a));let bleDevice,gattServer,epdService,epdCharacteristic,startTime,msgIndex,appVersion,canvas,ctx,textDecoder;const EpdCmd={'SET_PINS':0x0,'INIT':0x1,'CLEAR':0x2,'SEND_CMD':0x3,'SEND_DATA':0x4,'REFRESH':0x5,'SLEEP':0x6,'SET_TIME':0x20,'WRITE_IMG':0x30,'SET_CONFIG':0x90,'SYS_RESET':0x91,'SYS_SLEEP':0x92,'CFG_ERASE':0x99,'EPD_CMD_J_H':0xff,'EPD_CMD_N_Z':0xef,'EPD_CMD_J_S':0xee,'EPD_CMD_D_S':0xed,'EPD_CMD_LED':0xec,'EPD_CMD_MY':0xeb,'EPD_CMD_COLOR':0xea,'EPD_CMD_4_MS':0xfe,'EPD_CMD_4_C0LOR':0xfd,'EPD_CMD_4_XZ':0xfc,'EPD_CMD_4_ZF':0xfb},canvasSizes=[{'name':_0x593dfd(0x213),'width':0x98,'height':0x98},{'name':'1.54_200_200','width':0xc8,'height':0xc8},{'name':'2.13_212_104','width':0xd4,'height':0x68},{'name':_0x593dfd(0x24f),'width':0xfa,'height':0x7a},{'name':_0x593dfd(0x20a),'width':0x128,'height':0x98},{'name':'2.9_296_128','width':0x128,'height':0x80},{'name':_0x593dfd(0x238),'width':0x180,'height':0xa8},{'name':_0x593dfd(0x1da),'width':0x180,'height':0xb8},{'name':'3.7_416_240','width':0x1a0,'height':0xf0},{'name':_0x593dfd(0x1e0),'width':0x320,'height':0x1e0},{'name':_0x593dfd(0x26f),'width':0x190,'height':0x12c},{'name':_0x593dfd(0x22d),'width':0x318,'height':0x110},{'name':_0x593dfd(0x249),'width':0x320,'height':0x1e0},{'name':_0x593dfd(0x1eb),'width':0x3c0,'height':0x280},{'name':_0x593dfd(0x253),'width':0x550,'height':0x1e0},{'name':_0x593dfd(0x22c),'width':0x3c0,'height':0x280},{'name':'4E_600_400','width':0x258,'height':0x190},{'name':_0x593dfd(0x1d4),'width':0x1e0,'height':0x320}];function hex2bytes(_0x1b928c){const _0x87b368=_0x593dfd;for(var _0x23da69=[],_0x2e2b89=0x0;_0x2e2b89<_0x1b928c[_0x87b368(0x24d)];_0x2e2b89+=0x2)_0x23da69[_0x87b368(0x23b)](parseInt(_0x1b928c['substr'](_0x2e2b89,0x2),0x10));return new Uint8Array(_0x23da69);}function bytes2hex(_0x2c5d17){return new Uint8Array(_0x2c5d17)['reduce'](function(_0x58057b,_0x4289d2){const _0x55211f=_0x5cf9;return _0x58057b+('0'+_0x4289d2[_0x55211f(0x23a)](0x10))[_0x55211f(0x1c3)](-0x2);},'');}function intToHex(_0x4a1158){const _0x4b2996=_0x593dfd;let _0x490ab4=(_0x4b2996(0x1c4)+_0x4a1158[_0x4b2996(0x23a)](0x10))['substr'](-0x4);return _0x490ab4[_0x4b2996(0x207)](0x2,0x4)+_0x490ab4[_0x4b2996(0x207)](0x0,0x2);}function resetVariables(){const _0x154f57=_0x593dfd;gattServer=null,epdService=null,epdCharacteristic=null,msgIndex=0x0,document['getElementById'](_0x154f57(0x202))['value']='';}async function write(_0x3a8456,_0x11f08b,_0x182815=!![]){const _0x3bf6de=_0x593dfd;if(!epdCharacteristic)return addLog(_0x3bf6de(0x1dc)),![];let _0x13147f=[_0x3a8456];if(_0x11f08b){if(typeof _0x11f08b==_0x3bf6de(0x1e1))_0x11f08b=hex2bytes(_0x11f08b);if(_0x11f08b instanceof Uint8Array)_0x11f08b=Array[_0x3bf6de(0x23c)](_0x11f08b);_0x13147f[_0x3bf6de(0x23b)](..._0x11f08b);}try{if(_0x182815)await epdCharacteristic[_0x3bf6de(0x1c8)](Uint8Array[_0x3bf6de(0x23c)](_0x13147f));else await epdCharacteristic['writeValueWithoutResponse'](Uint8Array[_0x3bf6de(0x23c)](_0x13147f));}catch(_0x5b5265){console[_0x3bf6de(0x1cd)](_0x5b5265);if(_0x5b5265[_0x3bf6de(0x230)])addLog(_0x3bf6de(0x231)+_0x5b5265[_0x3bf6de(0x230)]);return![];}return!![];}async function writeImage(_0x2e86ba,_0x54d2e6='bw'){const _0x4c7024=_0x593dfd,_0x512ce3=document['getElementById'](_0x4c7024(0x236))['value']-0x2,_0x2ff618=document['getElementById'](_0x4c7024(0x1f0))[_0x4c7024(0x24e)],_0x297b7b=Math['round'](_0x2e86ba[_0x4c7024(0x24d)]/_0x512ce3);let _0xda45aa=0x0,_0x1c5e5e=_0x2ff618;for(let _0x462f41=0x0;_0x462f41<_0x2e86ba['length'];_0x462f41+=_0x512ce3){let _0x13fe1e=(new Date()[_0x4c7024(0x21d)]()-startTime)/0x3e8;setStatus((_0x54d2e6=='bw'?'黑白':'红色')+_0x4c7024(0x1fa)+(_0xda45aa+0x1)+'/'+(_0x297b7b+0x1)+_0x4c7024(0x265)+_0x13fe1e+'s');const _0x755599=[(_0x54d2e6=='bw'?0xf:0x0)|(_0x462f41==0x0?0x0:0xf0),..._0x2e86ba[_0x4c7024(0x1c3)](_0x462f41,_0x462f41+_0x512ce3)];_0x1c5e5e>0x0?(await write(EpdCmd['WRITE_IMG'],_0x755599,![]),_0x1c5e5e--):(await write(EpdCmd[_0x4c7024(0x1f1)],_0x755599,!![]),_0x1c5e5e=_0x2ff618),_0xda45aa++;}}async function setDriver(){const _0x446275=_0x593dfd;await write(EpdCmd[_0x446275(0x27e)],document[_0x446275(0x269)]('epdpins')[_0x446275(0x24e)]),await write(EpdCmd[_0x446275(0x280)],document[_0x446275(0x269)](_0x446275(0x267))['value']);}async function set_EPD_CMD_J_H(){const _0x585965=_0x593dfd;await write(EpdCmd[_0x585965(0x212)],document[_0x585965(0x269)](_0x585965(0x1db))[_0x585965(0x24e)]);}async function set_EPD_CMD_N_Z(){const _0x2a7574=_0x593dfd,_0x3b62b8=document[_0x2a7574(0x269)](_0x2a7574(0x205))['value'],_0x447de6=document[_0x2a7574(0x269)](_0x2a7574(0x224))[_0x2a7574(0x24e)],_0x42cd0b=document[_0x2a7574(0x269)](_0x2a7574(0x222))['value'],_0x17c548=[0x4];_0x17c548[0x0]=0x0,_0x17c548[0x1]=0x0,_0x17c548[0x2]=_0x3b62b8,_0x17c548[0x3]=_0x447de6,_0x17c548[0x4]=_0x42cd0b,await write(EpdCmd[_0x2a7574(0x1c1)],_0x17c548);}async function set_EPD_CMD_D_S(){const _0x1ff051=_0x593dfd,_0x7c975e=document[_0x1ff051(0x269)](_0x1ff051(0x273))[_0x1ff051(0x24e)],_0x162b88=document[_0x1ff051(0x269)](_0x1ff051(0x282))[_0x1ff051(0x24e)],_0x8e86a=document[_0x1ff051(0x269)](_0x1ff051(0x1fb))['value'],_0xca3d35=[0x4];_0xca3d35[0x0]=0x0,_0xca3d35[0x1]=0x0,_0xca3d35[0x2]=_0x7c975e,_0xca3d35[0x3]=_0x162b88,_0xca3d35[0x4]=_0x8e86a,await write(EpdCmd['EPD_CMD_D_S'],_0xca3d35);}async function set_EPD_CMD_J_S(){const _0x4f1d54=_0x593dfd,_0x562a58=document[_0x4f1d54(0x269)](_0x4f1d54(0x20f))[_0x4f1d54(0x24e)],_0x4bcaa6=document[_0x4f1d54(0x269)](_0x4f1d54(0x271))[_0x4f1d54(0x24e)],_0x49e816=document[_0x4f1d54(0x269)](_0x4f1d54(0x206))[_0x4f1d54(0x24e)],_0xbfe02c=[0x4];_0xbfe02c[0x0]=0x0,_0xbfe02c[0x1]=0x0,_0xbfe02c[0x2]=_0x562a58,_0xbfe02c[0x3]=_0x4bcaa6,_0xbfe02c[0x4]=_0x49e816,await write(EpdCmd[_0x4f1d54(0x276)],_0xbfe02c);}async function set_EPD_CMD_LED(){const _0xee81d9=_0x593dfd,_0x51605e=document[_0xee81d9(0x269)]('color_led')[_0xee81d9(0x24e)],_0x17c069=document[_0xee81d9(0x269)]('liang_time')[_0xee81d9(0x24e)],_0x3923a3=document['getElementById'](_0xee81d9(0x27c))[_0xee81d9(0x24e)],_0x37019d=document[_0xee81d9(0x269)](_0xee81d9(0x210))[_0xee81d9(0x24e)],_0x5899ff=document[_0xee81d9(0x269)](_0xee81d9(0x210))['value'],_0x3ad845=[0x5];_0x3ad845[0x0]=_0x51605e,_0x3ad845[0x1]=_0x17c069,_0x3ad845[0x2]=_0x3923a3,_0x3ad845[0x3]=_0x37019d,_0x3ad845[0x4]=_0x5899ff,await write(EpdCmd[_0xee81d9(0x24b)],_0x3ad845);}async function set_EPD_CMD_MY(){const _0x32fb94=_0x593dfd,_0x3b957c=document[_0x32fb94(0x269)]('fanxian')[_0x32fb94(0x24e)],_0xc968ae=document[_0x32fb94(0x269)]('xuanzhuan')['value'],_0x4d845c=document[_0x32fb94(0x269)](_0x32fb94(0x1e5))[_0x32fb94(0x24e)],_0x35016a=document['getElementById'](_0x32fb94(0x20e))[_0x32fb94(0x24e)],_0x36edc2=[0x4];_0x36edc2[0x0]=_0x3b957c,_0x36edc2[0x1]=_0xc968ae,_0x36edc2[0x2]=_0x4d845c,_0x36edc2[0x3]=_0x35016a,await write(EpdCmd[_0x32fb94(0x278)],_0x36edc2);}async function set_EPD_CMD_COLOR(){const _0x3e79af=_0x593dfd,_0x560e72=document[_0x3e79af(0x269)](_0x3e79af(0x286))[_0x3e79af(0x24e)],_0x45d4fd=document[_0x3e79af(0x269)](_0x3e79af(0x1ef))['value'],_0x1e4470=document['getElementById'](_0x3e79af(0x24c))[_0x3e79af(0x24e)],_0x2d6b64=document[_0x3e79af(0x269)](_0x3e79af(0x220))['value'],_0x44b775=document['getElementById']('shichen_color')[_0x3e79af(0x24e)],_0x5cdf75=document[_0x3e79af(0x269)](_0x3e79af(0x26b))[_0x3e79af(0x24e)],_0x3823bc=document[_0x3e79af(0x269)]('r_jushua_time')[_0x3e79af(0x24e)],_0x11a9a8=[0x7];_0x11a9a8[0x0]=_0x560e72,_0x11a9a8[0x1]=_0x45d4fd,_0x11a9a8[0x2]=_0x1e4470,_0x11a9a8[0x3]=_0x2d6b64,_0x11a9a8[0x4]=_0x44b775,_0x11a9a8[0x5]=_0x5cdf75,_0x11a9a8[0x6]=_0x3823bc,await write(EpdCmd[_0x3e79af(0x234)],_0x11a9a8);}async function set_EPD_CMD_4_MS(){const _0x515a7d=_0x593dfd,_0x3e85ac=document['getElementById']('fanxian1')['value'],_0x2d21c8=document['getElementById']('xuanzhuan1')[_0x515a7d(0x24e)],_0x332cf3=document[_0x515a7d(0x269)]('jushua_time1')[_0x515a7d(0x24e)],_0x46dde1=document[_0x515a7d(0x269)](_0x515a7d(0x1e7))[_0x515a7d(0x24e)],_0x42cfce=document[_0x515a7d(0x269)]('moshi_id')['value'],_0x56165b=[0x4];_0x56165b[0x0]=_0x3e85ac,_0x56165b[0x1]=_0x2d21c8,_0x56165b[0x2]=_0x332cf3,_0x56165b[0x3]=_0x46dde1,_0x56165b[0x4]=_0x42cfce,await write(EpdCmd[_0x515a7d(0x266)],_0x56165b);}async function set_EPD_CMD_4_ZF(_0x6f9b87){const _0x5704eb=_0x593dfd,_0xd5d5d0=[0x1];_0xd5d5d0[0x0]=_0x6f9b87,await write(EpdCmd[_0x5704eb(0x1d6)],_0xd5d5d0);}async function syncTime(_0x488dd9){const _0x3c3669=_0x593dfd,_0x1a6f66=new Date()[_0x3c3669(0x21d)]()/0x3e8,_0x5da76b=new Uint8Array([_0x1a6f66>>0x18&0xff,_0x1a6f66>>0x10&0xff,_0x1a6f66>>0x8&0xff,_0x1a6f66&0xff,-(new Date()[_0x3c3669(0x229)]()/0x3c),_0x488dd9]);await write(EpdCmd['SET_TIME'],_0x5da76b)&&addLog(_0x3c3669(0x21a));}async function clearScreen(){0x1&&(await write(EpdCmd['CLEAR']),addLog('已清除屏慕！'));}async function sendcmd(){const _0x1ee7c7=_0x593dfd,_0xf9261d=document[_0x1ee7c7(0x269)](_0x1ee7c7(0x20c))[_0x1ee7c7(0x24e)];if(_0xf9261d=='')return;const _0x11b289=hex2bytes(_0xf9261d);await write(_0x11b289[0x0],_0x11b289[_0x1ee7c7(0x24d)]>0x1?_0x11b289[_0x1ee7c7(0x1c3)](0x1):null);}async function sendimg(){const _0x156863=_0x593dfd,_0x551c01=document[_0x156863(0x269)](_0x156863(0x1f2))[_0x156863(0x24e)],_0x236829=document[_0x156863(0x269)](_0x156863(0x283))[_0x156863(0x24e)],_0x19dc1a=document[_0x156863(0x269)]('epddriver'),_0x4e139f=_0x19dc1a[_0x156863(0x237)][_0x19dc1a[_0x156863(0x1cc)]];startTime=new Date()['getTime']();const _0x1231de=document[_0x156863(0x269)](_0x156863(0x26e));_0x1231de[_0x156863(0x260)]['style']['display']=_0x156863(0x233);const _0x1b3988=ctx[_0x156863(0x1df)](0x0,0x0,canvas[_0x156863(0x25e)],canvas['height']),_0x38ecd5=processImageData(_0x1b3988,_0x236829);updateButtonStatus(!![]);if(_0x236829===_0x156863(0x247))await writeImage(_0x38ecd5,'color');else{if(_0x236829===_0x156863(0x22e)){const _0x1d0435=Math['floor'](_0x38ecd5[_0x156863(0x24d)]/0x2);await writeImage(_0x38ecd5['slice'](0x0,_0x1d0435),'bw'),await writeImage(_0x38ecd5['slice'](_0x1d0435),_0x156863(0x235));}else{if(_0x236829==='blackWhiteColor')await writeImage(_0x38ecd5,'bw');else{addLog(_0x156863(0x1e9)),updateButtonStatus();return;}}}await write(EpdCmd[_0x156863(0x1d7)]),updateButtonStatus();const _0x2750c9=(new Date()[_0x156863(0x21d)]()-startTime)/0x3e8;addLog(_0x156863(0x27d)+_0x2750c9+'s'),setStatus('发送完成！耗时:\x20'+_0x2750c9+'s'),addLog(_0x156863(0x221)),setTimeout(()=>{const _0x1e3365=_0x156863;_0x1231de[_0x1e3365(0x260)][_0x1e3365(0x27b)]['display']='none';},0x1388);}function _0xc26c(){const _0x562cd9=['appendChild','color_1','EPD_CMD_N_Z','files','slice','0000','target','drawImage','join','writeValueWithResponse','name','data','debug','selectedIndex','error','getContext','className','getPrimaryService','ditherStrengthValue','getMinutes','connectbutton','7.3E6','createElement','EPD_CMD_4_ZF','REFRESH','data-color','正在连接:\x20','3.5_384_184','epdpins','没有链接蓝牙','62750003-d828-918d-fb46-b6c11c675aec','50211HeuQLI','getImageData','3.97_800_480','string','const\x20uint16_t\x20imageWidth\x20=\x20','time','16NyLcpu','qiangzhi_shuaxing','297997oLOrKq','xianshi_peizhi','fillStyle','当前固件不支持此颜色模式。','connect','10.2_960_640','connected','white','byteLength','time_color','interleavedcount','WRITE_IMG','canvasSize','clearRect','debug-toggle','span','location','div','createObjectURL','scrollHeight','块:\x20','D_S_start','请检查蓝牙，推荐使用Edge浏览器！','getAttribute','textContent','min','abs','clockmodebutton','log','download','createTextNode','N_Z_hour','J_S_start','substring','scrollTop','2kYazFi','2.66_296_152','rotationDegrees','cmdTXT','height','jushua_time','J_S_hour','liangdu','toFixed','EPD_CMD_J_H','1.54_152_152','text/plain','get','click','字节，但得到','characteristicvaluechanged','clearscreenbutton','已同步时间！','change','62750001-d828-918d-fb46-b6c11c675aec','getTime','sendcmdbutton','padStart','gongli_color','请等待屏幕刷新完成！','N_Z_start','disconnect','N_Z_min','data-size','href','16092BOCWQy','setAttribute','getTimezoneOffset','startNotifications:\x20','ditherAlg','11.6_960_640','5.79_792_272','threeColor','add','message','write:\x20','revokeObjectURL','block','EPD_CMD_COLOR','red','mtusize','options','2.9_384_168','rotate','toString','push','from','已断开连接.','addEventListener','gatt','getUint8','ditherStrength','childNodes','translate','src','find','gattserverdisconnected','fourColor','requestDevice','7.5_800_480','ditherContrast','EPD_CMD_LED','wendu_color','length','value','2.13_250_122','const\x20uint8_t\x20imageData[]\x20IMAGE\x20=\x20{','sixColor','input','10.85_1360_480','11948980lYUsjf','restore','263796JvpqqG','setDriverbutton','imageFile','innerHTML','body','图片已旋转\x20','2630175eEpbqL','错误：预期','width','sendimgbutton','parentElement','innerText','buffer','getSeconds','正在重连',',\x20总用时:\x20','EPD_CMD_4_MS','epddriver','canvas','getElementById','startsWith','jieqi_color','save','decode','status','4.2_400_300','image.h','J_S_min','104DbeFMh','D_S_hour','ditherContrastValue','byteOffset','EPD_CMD_J_S','fillRect','EPD_CMD_MY','onload','1659702jyknVZ','style','liang_add','发送完成！耗时:\x20','SET_PINS','disabled','INIT','firstChild','D_S_min','ditherMode','getCharacteristic'];_0xc26c=function(){return _0x562cd9;};return _0xc26c();}function downloadDataArray(){const _0x4c2c99=_0x593dfd;if(isCropMode())return;const _0x5541a8=document[_0x4c2c99(0x269)](_0x4c2c99(0x283))['value'],_0x42bdd4=ctx[_0x4c2c99(0x1df)](0x0,0x0,canvas[_0x4c2c99(0x25e)],canvas[_0x4c2c99(0x20d)]),_0x258808=processImageData(_0x42bdd4,_0x5541a8);if(_0x5541a8===_0x4c2c99(0x251)&&_0x258808[_0x4c2c99(0x24d)]!==canvas[_0x4c2c99(0x25e)]*canvas['height']){console[_0x4c2c99(0x202)](_0x4c2c99(0x25d)+canvas[_0x4c2c99(0x25e)]*canvas[_0x4c2c99(0x20d)]+_0x4c2c99(0x217)+_0x258808[_0x4c2c99(0x24d)]+'字节');return;}const _0x598a09=[];for(let _0xeae6fa=0x0;_0xeae6fa<_0x258808[_0x4c2c99(0x24d)];_0xeae6fa++){const _0x3eb9a3=(_0x258808[_0xeae6fa]&0xff)[_0x4c2c99(0x23a)](0x10)[_0x4c2c99(0x21f)](0x2,'0');_0x598a09[_0x4c2c99(0x23b)]('0x'+_0x3eb9a3);}const _0x485c98=[];for(let _0x45780b=0x0;_0x45780b<_0x598a09[_0x4c2c99(0x24d)];_0x45780b+=0x10){_0x485c98['push'](_0x598a09[_0x4c2c99(0x1c3)](_0x45780b,_0x45780b+0x10)[_0x4c2c99(0x1c7)](',\x20'));}const _0x37e429=_0x5541a8===_0x4c2c99(0x251)?0x0:_0x5541a8==='fourColor'?0x1:_0x5541a8==='blackWhiteColor'?0x2:0x3,_0x11cf9f=[_0x4c2c99(0x250),_0x485c98[_0x4c2c99(0x1c7)](',\x0a'),'};',_0x4c2c99(0x1e2)+canvas[_0x4c2c99(0x25e)]+';','const\x20uint16_t\x20imageHeight\x20=\x20'+canvas['height']+';','const\x20uint8_t\x20colorMode\x20=\x20'+_0x37e429+';']['join']('\x0a'),_0x14375c=new Blob([_0x11cf9f],{'type':_0x4c2c99(0x214)}),_0x51115c=document[_0x4c2c99(0x1d5)]('a');_0x51115c[_0x4c2c99(0x203)]=_0x4c2c99(0x270),_0x51115c[_0x4c2c99(0x226)]=URL[_0x4c2c99(0x1f8)](_0x14375c),_0x51115c[_0x4c2c99(0x216)](),URL[_0x4c2c99(0x232)](_0x51115c['href']);}function updateButtonStatus(_0x42f228=![]){const _0x4dafb8=_0x593dfd,_0x5258fb=gattServer!=null&&gattServer[_0x4dafb8(0x1ec)],_0xa2f16a=_0x42f228?_0x4dafb8(0x27f):_0x5258fb?null:_0x4dafb8(0x27f);document[_0x4dafb8(0x269)]('reconnectbutton')[_0x4dafb8(0x27f)]=gattServer==null||gattServer[_0x4dafb8(0x1ec)]?_0x4dafb8(0x27f):null,document[_0x4dafb8(0x269)](_0x4dafb8(0x21e))[_0x4dafb8(0x27f)]=_0xa2f16a,document[_0x4dafb8(0x269)]('calendarmodebutton')[_0x4dafb8(0x27f)]=_0xa2f16a,document[_0x4dafb8(0x269)](_0x4dafb8(0x201))[_0x4dafb8(0x27f)]=_0xa2f16a,document[_0x4dafb8(0x269)](_0x4dafb8(0x219))['disabled']=_0xa2f16a,document['getElementById'](_0x4dafb8(0x25f))[_0x4dafb8(0x27f)]=_0xa2f16a,document['getElementById'](_0x4dafb8(0x257))[_0x4dafb8(0x27f)]=_0xa2f16a;}function disconnect(){const _0x508a52=_0x593dfd;updateButtonStatus(),resetVariables(),addLog(_0x508a52(0x23d)),document[_0x508a52(0x269)](_0x508a52(0x1d3))[_0x508a52(0x259)]='连接';}function _0x5cf9(_0x5a8e29,_0x18b45e){const _0xc26cb9=_0xc26c();return _0x5cf9=function(_0x5cf9f4,_0x2c0916){_0x5cf9f4=_0x5cf9f4-0x1c1;let _0x2241d2=_0xc26cb9[_0x5cf9f4];return _0x2241d2;},_0x5cf9(_0x5a8e29,_0x18b45e);}async function preConnect(){const _0x23fc69=_0x593dfd;if(gattServer!=null&&gattServer[_0x23fc69(0x1ec)])bleDevice!=null&&bleDevice[_0x23fc69(0x23f)][_0x23fc69(0x1ec)]&&bleDevice[_0x23fc69(0x23f)][_0x23fc69(0x223)]();else{resetVariables();try{bleDevice=await navigator['bluetooth'][_0x23fc69(0x248)]({'optionalServices':[_0x23fc69(0x21c)],'acceptAllDevices':!![]});}catch(_0x5d5f3b){console[_0x23fc69(0x1cd)](_0x5d5f3b);if(_0x5d5f3b['message'])addLog('requestDevice:\x20'+_0x5d5f3b[_0x23fc69(0x230)]);addLog(_0x23fc69(0x1fc));return;}await bleDevice['addEventListener'](_0x23fc69(0x246),disconnect),setTimeout(async function(){await connect();},0x12c);}}async function reConnect(){const _0x5e495a=_0x593dfd;if(bleDevice!=null&&bleDevice[_0x5e495a(0x23f)][_0x5e495a(0x1ec)])bleDevice['gatt'][_0x5e495a(0x223)]();resetVariables(),addLog(_0x5e495a(0x264)),setTimeout(async function(){await connect();},0x12c);}function handleNotify(_0xe805ac,_0x71f9ed){const _0x5e2a49=_0x593dfd,_0x1882b0=new Uint8Array(_0xe805ac[_0x5e2a49(0x262)],_0xe805ac[_0x5e2a49(0x275)],_0xe805ac[_0x5e2a49(0x1ee)]);if(_0x71f9ed==0x0){}else{if(textDecoder==null)textDecoder=new TextDecoder();const _0x2637aa=textDecoder[_0x5e2a49(0x26d)](_0x1882b0);if(_0x2637aa[_0x5e2a49(0x26a)]('mtu=')&&_0x2637aa[_0x5e2a49(0x24d)]>0x4){const _0xe7d9c0=parseInt(_0x2637aa[_0x5e2a49(0x207)](0x4));document[_0x5e2a49(0x269)](_0x5e2a49(0x236))['value']=_0xe7d9c0;}else{if(_0x2637aa[_0x5e2a49(0x26a)]('t=')&&_0x2637aa[_0x5e2a49(0x24d)]>0x2){const _0xe47329=parseInt(_0x2637aa[_0x5e2a49(0x207)](0x2))+new Date()[_0x5e2a49(0x229)]()*0x3c;}}}}async function connect(){const _0x10df2f=_0x593dfd;if(bleDevice==null||epdCharacteristic!=null)return;try{addLog(_0x10df2f(0x1d9)+bleDevice[_0x10df2f(0x1c9)]),gattServer=await bleDevice[_0x10df2f(0x23f)][_0x10df2f(0x1ea)](),epdService=await gattServer[_0x10df2f(0x1d0)]('62750001-d828-918d-fb46-b6c11c675aec'),epdCharacteristic=await epdService[_0x10df2f(0x284)]('62750002-d828-918d-fb46-b6c11c675aec'),addLog('已连接！');}catch(_0x2003cb){console[_0x10df2f(0x1cd)](_0x2003cb);if(_0x2003cb[_0x10df2f(0x230)])addLog('connect:\x20'+_0x2003cb[_0x10df2f(0x230)]);disconnect();return;}try{const _0x1022a6=await epdService[_0x10df2f(0x284)](_0x10df2f(0x1dd)),_0x2dcd91=await _0x1022a6['readValue']();appVersion=_0x2dcd91[_0x10df2f(0x240)](0x0);}catch(_0x5f5cca){console['error'](_0x5f5cca),appVersion=0x15;}try{await epdCharacteristic['startNotifications'](),epdCharacteristic[_0x10df2f(0x23e)](_0x10df2f(0x218),_0x2c32e2=>{const _0x27dc9c=_0x10df2f;handleNotify(_0x2c32e2[_0x27dc9c(0x1c5)]['value'],msgIndex++);});}catch(_0x55b3e6){console[_0x10df2f(0x1cd)](_0x55b3e6);if(_0x55b3e6['message'])addLog(_0x10df2f(0x22a)+_0x55b3e6[_0x10df2f(0x230)]);}await write(EpdCmd[_0x10df2f(0x280)]),document[_0x10df2f(0x269)](_0x10df2f(0x1d3))['innerHTML']='断开',updateButtonStatus();}function setStatus(_0x55b903){const _0x670b12=_0x593dfd;document[_0x670b12(0x269)]('status')[_0x670b12(0x259)]=_0x55b903;}function addLog(_0x4f4820,_0xa2782f=''){const _0x2454f7=_0x593dfd,_0x9b6961=document[_0x2454f7(0x269)](_0x2454f7(0x202)),_0x31a301=new Date(),_0x300840=String(_0x31a301['getHours']())['padStart'](0x2,'0')+':'+String(_0x31a301[_0x2454f7(0x1d2)]())[_0x2454f7(0x21f)](0x2,'0')+':'+String(_0x31a301[_0x2454f7(0x263)]())[_0x2454f7(0x21f)](0x2,'0')+'\x20',_0x1fb471=document[_0x2454f7(0x1d5)](_0x2454f7(0x1f7)),_0x251bac=document['createElement'](_0x2454f7(0x1f5));_0x251bac[_0x2454f7(0x1cf)]=_0x2454f7(0x1e3),_0x251bac[_0x2454f7(0x1fe)]=_0x300840,_0x1fb471[_0x2454f7(0x285)](_0x251bac);if(_0xa2782f!==''){const _0x36aa63=document[_0x2454f7(0x1d5)](_0x2454f7(0x1f5));_0x36aa63[_0x2454f7(0x1cf)]='action',_0x36aa63['innerHTML']=_0xa2782f,_0x1fb471[_0x2454f7(0x285)](_0x36aa63);}_0x1fb471[_0x2454f7(0x285)](document[_0x2454f7(0x204)](_0x4f4820)),_0x9b6961[_0x2454f7(0x285)](_0x1fb471),_0x9b6961[_0x2454f7(0x208)]=_0x9b6961[_0x2454f7(0x1f9)];while(_0x9b6961[_0x2454f7(0x242)][_0x2454f7(0x24d)]>0x14){_0x9b6961['removeChild'](_0x9b6961[_0x2454f7(0x281)]);}}function clearLog(){const _0x4f6039=_0x593dfd;document['getElementById'](_0x4f6039(0x202))['innerHTML']='';}function fillCanvas(_0x1c2203){const _0x152608=_0x593dfd;ctx['fillStyle']=_0x1c2203,ctx[_0x152608(0x277)](0x0,0x0,canvas[_0x152608(0x25e)],canvas[_0x152608(0x20d)]);}const image=new Image();function updateImage(){const _0x3d0815=_0x593dfd,_0x281e06=document[_0x3d0815(0x269)](_0x3d0815(0x258));if(_0x281e06[_0x3d0815(0x1c2)]['length']==0x0){fillCanvas(_0x3d0815(0x1ed));return;}image[_0x3d0815(0x279)]=function(){const _0x12585e=_0x3d0815;URL['revokeObjectURL'](this['src']);if(image[_0x12585e(0x25e)]/ image[_0x12585e(0x20d)]==canvas[_0x12585e(0x25e)]/canvas[_0x12585e(0x20d)]){if(isCropMode())exitCropMode();ctx['drawImage'](image,0x0,0x0,image[_0x12585e(0x25e)],image[_0x12585e(0x20d)],0x0,0x0,canvas[_0x12585e(0x25e)],canvas[_0x12585e(0x20d)]),redrawTextElements(),redrawLineSegments(),convertDithering();}else initializeCrop();},image[_0x3d0815(0x244)]=URL['createObjectURL'](_0x281e06[_0x3d0815(0x1c2)][0x0]);}function updateCanvasSize(){const _0x267d63=_0x593dfd,_0x40fc12=document[_0x267d63(0x269)](_0x267d63(0x1f2))[_0x267d63(0x24e)],_0x583185=canvasSizes[_0x267d63(0x245)](_0xa4889c=>_0xa4889c['name']===_0x40fc12);canvas[_0x267d63(0x25e)]=_0x583185['width'],canvas[_0x267d63(0x20d)]=_0x583185[_0x267d63(0x20d)],updateImage();}function updateDitcherOptions(){const _0x32fe46=_0x593dfd,_0x638d24=document[_0x32fe46(0x269)](_0x32fe46(0x267)),_0x4d6565=_0x638d24['options'][_0x638d24[_0x32fe46(0x1cc)]],_0x5b07f5=_0x4d6565[_0x32fe46(0x1fd)](_0x32fe46(0x1d8)),_0x37dfc6=_0x4d6565[_0x32fe46(0x1fd)](_0x32fe46(0x225));if(_0x5b07f5)document[_0x32fe46(0x269)](_0x32fe46(0x283))['value']=_0x5b07f5;if(_0x37dfc6)document[_0x32fe46(0x269)](_0x32fe46(0x1f2))['value']=_0x37dfc6;updateCanvasSize();}function rotateCanvas(){const _0x3a805b=_0x593dfd,_0x35f17a=canvas[_0x3a805b(0x25e)],_0x2ed0bc=canvas[_0x3a805b(0x20d)];canvas[_0x3a805b(0x25e)]=_0x2ed0bc,canvas[_0x3a805b(0x20d)]=_0x35f17a,updateImage();}function clearCanvas(){const _0x4afbf0=_0x593dfd;if(0x1){fillCanvas(_0x4afbf0(0x1ed)),textElements=[],lineSegments=[];if(isCropMode())exitCropMode();return!![];}return![];}function convertDithering(){const _0xbc4271=_0x593dfd,_0x128c69=parseFloat(document[_0xbc4271(0x269)](_0xbc4271(0x24a))[_0xbc4271(0x24e)]),_0x2cc6c3=ctx['getImageData'](0x0,0x0,canvas[_0xbc4271(0x25e)],canvas[_0xbc4271(0x20d)]),_0x2640be=new ImageData(new Uint8ClampedArray(_0x2cc6c3[_0xbc4271(0x1ca)]),_0x2cc6c3[_0xbc4271(0x25e)],_0x2cc6c3[_0xbc4271(0x20d)]);adjustContrast(_0x2640be,_0x128c69);const _0x4a06fd=document[_0xbc4271(0x269)](_0xbc4271(0x22b))['value'],_0x10a3e5=parseFloat(document[_0xbc4271(0x269)](_0xbc4271(0x241))['value']),_0xbbb68e=document[_0xbc4271(0x269)]('ditherMode')['value'],_0x25d8ce=processImageData(ditherImage(_0x2640be,_0x4a06fd,_0x10a3e5,_0xbbb68e),_0xbbb68e),_0x4c16d2=decodeProcessedData(_0x25d8ce,canvas[_0xbc4271(0x25e)],canvas[_0xbc4271(0x20d)],_0xbbb68e);ctx['putImageData'](_0x4c16d2,0x0,0x0);}function initEventHandlers(){const _0x3395df=_0x593dfd;document[_0x3395df(0x269)](_0x3395df(0x267))[_0x3395df(0x23e)](_0x3395df(0x21b),updateDitcherOptions),document['getElementById'](_0x3395df(0x258))[_0x3395df(0x23e)](_0x3395df(0x21b),updateImage),document['getElementById']('ditherMode')[_0x3395df(0x23e)](_0x3395df(0x21b),finishCrop),document['getElementById'](_0x3395df(0x22b))[_0x3395df(0x23e)](_0x3395df(0x21b),finishCrop),document[_0x3395df(0x269)](_0x3395df(0x241))[_0x3395df(0x23e)]('input',function(){const _0x2c3c89=_0x3395df;finishCrop(),document[_0x2c3c89(0x269)](_0x2c3c89(0x1d1))['innerText']=parseFloat(this[_0x2c3c89(0x24e)])[_0x2c3c89(0x211)](0x1);}),document[_0x3395df(0x269)](_0x3395df(0x24a))[_0x3395df(0x23e)](_0x3395df(0x252),function(){const _0x2663b5=_0x3395df;finishCrop(),document[_0x2663b5(0x269)](_0x2663b5(0x274))[_0x2663b5(0x261)]=parseFloat(this[_0x2663b5(0x24e)])[_0x2663b5(0x211)](0x1);}),document[_0x3395df(0x269)](_0x3395df(0x1f2))[_0x3395df(0x23e)](_0x3395df(0x21b),updateCanvasSize);}function checkDebugMode(){const _0x123005=_0x593dfd,_0x42b44f=document[_0x123005(0x269)](_0x123005(0x1f4)),_0x3b4513=new URLSearchParams(window[_0x123005(0x1f6)]['search']),_0x29e566=_0x3b4513[_0x123005(0x215)](_0x123005(0x1cb));document[_0x123005(0x25a)]['classList'][_0x123005(0x22f)]('debug-mode'),_0x42b44f[_0x123005(0x228)](_0x123005(0x226),window[_0x123005(0x1f6)]['pathname']);}document[_0x593dfd(0x25a)]['onload']=()=>{const _0x154492=_0x593dfd;textDecoder=null,canvas=document[_0x154492(0x269)](_0x154492(0x268)),ctx=canvas[_0x154492(0x1ce)]('2d'),ctx['fillStyle']=_0x154492(0x1ed),ctx['fillRect'](0x0,0x0,canvas[_0x154492(0x25e)],canvas[_0x154492(0x20d)]),initPaintTools(),initCropTools(),initEventHandlers(),updateButtonStatus(),checkDebugMode();};let currentRotation=0x0,originalImage=null;originalImage=image;const statusElement=document[_0x593dfd(0x269)](_0x593dfd(0x26e)),rotationDisplay=document['getElementById'](_0x593dfd(0x20b)),logElement=document['getElementById'](_0x593dfd(0x202));function drawImage(){const _0x18ac27=_0x593dfd;ctx[_0x18ac27(0x1f3)](0x0,0x0,canvas['width'],canvas[_0x18ac27(0x20d)]),ctx[_0x18ac27(0x1e8)]='#FFFFFF',ctx[_0x18ac27(0x277)](0x0,0x0,canvas[_0x18ac27(0x25e)],canvas[_0x18ac27(0x20d)]),ctx[_0x18ac27(0x26c)](),ctx[_0x18ac27(0x243)](canvas[_0x18ac27(0x25e)]/0x2,canvas[_0x18ac27(0x20d)]/0x2),ctx[_0x18ac27(0x239)](currentRotation*Math['PI']/0xb4);let _0x57ac09=originalImage[_0x18ac27(0x25e)],_0x50fba7=originalImage[_0x18ac27(0x20d)];Math[_0x18ac27(0x200)](currentRotation)%0xb4===0x5a&&([_0x57ac09,_0x50fba7]=[_0x50fba7,_0x57ac09]);const _0x474021=Math[_0x18ac27(0x1ff)](canvas[_0x18ac27(0x25e)]/_0x57ac09,canvas[_0x18ac27(0x20d)]/_0x50fba7);ctx[_0x18ac27(0x1c6)](originalImage,-originalImage[_0x18ac27(0x25e)]*_0x474021/0x2,-originalImage[_0x18ac27(0x20d)]*_0x474021/0x2,originalImage[_0x18ac27(0x25e)]*_0x474021,originalImage[_0x18ac27(0x20d)]*_0x474021),convertDithering(),ctx[_0x18ac27(0x255)]();}function rotateImage(_0x331d6a){const _0x4dee17=_0x593dfd;currentRotation=(currentRotation+_0x331d6a)%0x168,drawImage(),addLog(_0x4dee17(0x25b)+currentRotation+'°');}
