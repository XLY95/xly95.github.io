const _0x1fd5e3=_0x5681;(function(_0x473d26,_0x3c90bf){const _0x4dc452=_0x5681,_0x400a04=_0x473d26();while(!![]){try{const _0x5151c8=-parseInt(_0x4dc452(0x249))/0x1*(parseInt(_0x4dc452(0x1ff))/0x2)+-parseInt(_0x4dc452(0x22d))/0x3+-parseInt(_0x4dc452(0x1bb))/0x4+-parseInt(_0x4dc452(0x1e0))/0x5+-parseInt(_0x4dc452(0x1a5))/0x6*(-parseInt(_0x4dc452(0x20e))/0x7)+parseInt(_0x4dc452(0x1bc))/0x8+parseInt(_0x4dc452(0x20c))/0x9;if(_0x5151c8===_0x3c90bf)break;else _0x400a04['push'](_0x400a04['shift']());}catch(_0x4f24ec){_0x400a04['push'](_0x400a04['shift']());}}}(_0x31d5,0x6152a));let sourceImage=null,originalImage=null,canvas,ctx,floatCanvas,floatCtx,originalCanvasData=null,startTime,currentParams={'saturation':0x64,'brightness':0x64,'contrast':0x64,'diffusion':0x32,'ditherAlg':_0x1fd5e3(0x1c5)},currentMode='image',canvasRotation=0x0,isDrawing=![],lastX=0x0,lastY=0x0,currentTool=_0x1fd5e3(0x26b),brushSize=0x3,brushColor=_0x1fd5e3(0x25b),imageScale=0x64,imageOffset={'x':0x0,'y':0x0},isDraggingImage=![],dragStartPos={'x':0x0,'y':0x0},shiftKeyPressed=![],imageRotation=0x0,isDrawingModeActive=![],isDragging=![],dragOffset={'x':0x0,'y':0x0},isResizing=![],bleDevice,gattServer,epdService,epdCharacteristic,msgIndex,appVersion,textDecoder;const EpdCmd={'SET_PINS':0xaa,'INIT':0xa9,'CLEAR':0xa8,'SEND_CMD':0xa7,'SEND_DATA':0xa6,'REFRESH':0xa5,'SLEEP':0xa4,'SET_TIME':0xa3,'WEEK_START':0xa2,'WRITE_IMG':0xa1,'SET_CONFIG':0xa0,'SYS_RESET':0xab,'SYS_SLEEP':0xac,'CFG_ERASE':0xad,'SET_MODE':0xae,'EPD_CMD_J_H':0xff,'EPD_CMD_N_Z':0xef,'EPD_CMD_J_S':0xee,'EPD_CMD_D_S':0xed,'EPD_CMD_LED':0xec,'EPD_CMD_MY':0xeb,'EPD_CMD_COLOR':0xea,'EPD_CMD_4_MS':0xfe,'EPD_CMD_4_LED':0xfd,'EPD_CMD_4_XZ':0xfc,'EPD_CMD_4_ZF':0xfb},DisplayMode={'IMAGE':0x0,'CLOCK':0x1,'CALENDAR':0x2},canvasSizes=[{'name':_0x1fd5e3(0x292),'width':0x7a,'height':0xfa},{'name':_0x1fd5e3(0x1e8),'width':0x190,'height':0x12c},{'name':'7.5_800_480','width':0x320,'height':0x1e0}],threeColorPalette=[{'name':'黑色','r':0x0,'g':0x0,'b':0x0,'value':0x0},{'name':'白色','r':0xff,'g':0xff,'b':0xff,'value':0x1},{'name':'红色','r':0xff,'g':0x0,'b':0x0,'value':0x2}],blackWhitePalette=[{'name':'黑色','r':0x0,'g':0x0,'b':0x0,'value':0x0},{'name':'白色','r':0xff,'g':0xff,'b':0xff,'value':0x1}];function adjustContrast(_0x5cc4ba,_0x20c9b8){const _0x361270=_0x1fd5e3,_0x1e74d9=_0x5cc4ba[_0x361270(0x279)];for(let _0x343d93=0x0;_0x343d93<_0x1e74d9['length'];_0x343d93+=0x4){_0x1e74d9[_0x343d93]=Math['min'](0xff,Math[_0x361270(0x282)](0x0,(_0x1e74d9[_0x343d93]-0x80)*_0x20c9b8+0x80)),_0x1e74d9[_0x343d93+0x1]=Math[_0x361270(0x1c0)](0xff,Math[_0x361270(0x282)](0x0,(_0x1e74d9[_0x343d93+0x1]-0x80)*_0x20c9b8+0x80)),_0x1e74d9[_0x343d93+0x2]=Math[_0x361270(0x1c0)](0xff,Math[_0x361270(0x282)](0x0,(_0x1e74d9[_0x343d93+0x2]-0x80)*_0x20c9b8+0x80));}return _0x5cc4ba;}function adjustBrightness(_0x21c85d,_0x30da0b){const _0x3af4d7=_0x1fd5e3,_0x3a74c8=_0x30da0b/0x64,_0x201215=_0x21c85d[_0x3af4d7(0x279)];for(let _0x4ef392=0x0;_0x4ef392<_0x201215[_0x3af4d7(0x220)];_0x4ef392+=0x4){_0x201215[_0x4ef392]=Math[_0x3af4d7(0x1c0)](0xff,Math[_0x3af4d7(0x282)](0x0,_0x201215[_0x4ef392]*_0x3a74c8)),_0x201215[_0x4ef392+0x1]=Math[_0x3af4d7(0x1c0)](0xff,Math[_0x3af4d7(0x282)](0x0,_0x201215[_0x4ef392+0x1]*_0x3a74c8)),_0x201215[_0x4ef392+0x2]=Math['min'](0xff,Math['max'](0x0,_0x201215[_0x4ef392+0x2]*_0x3a74c8));}return _0x21c85d;}function adjustSaturation(_0x1d6d94,_0x218177){const _0x24f494=_0x1fd5e3,_0x6cd49d=_0x1d6d94['data'];for(let _0x5b248c=0x0;_0x5b248c<_0x6cd49d['length'];_0x5b248c+=0x4){const _0x4b37fb=0.299*_0x6cd49d[_0x5b248c]+0.587*_0x6cd49d[_0x5b248c+0x1]+0.114*_0x6cd49d[_0x5b248c+0x2];_0x6cd49d[_0x5b248c]=Math[_0x24f494(0x1c0)](0xff,Math[_0x24f494(0x282)](0x0,_0x4b37fb+(_0x6cd49d[_0x5b248c]-_0x4b37fb)*_0x218177)),_0x6cd49d[_0x5b248c+0x1]=Math['min'](0xff,Math[_0x24f494(0x282)](0x0,_0x4b37fb+(_0x6cd49d[_0x5b248c+0x1]-_0x4b37fb)*_0x218177)),_0x6cd49d[_0x5b248c+0x2]=Math[_0x24f494(0x1c0)](0xff,Math[_0x24f494(0x282)](0x0,_0x4b37fb+(_0x6cd49d[_0x5b248c+0x2]-_0x4b37fb)*_0x218177));}return _0x1d6d94;}function rgbToLab(_0x5e947f,_0x3774e1,_0x22c447){const _0x33a64e=_0x1fd5e3;_0x5e947f=_0x5e947f/0xff,_0x3774e1=_0x3774e1/0xff,_0x22c447=_0x22c447/0xff,_0x5e947f=_0x5e947f>0.04045?Math[_0x33a64e(0x15a)]((_0x5e947f+0.055)/1.055,2.4):_0x5e947f/12.92,_0x3774e1=_0x3774e1>0.04045?Math[_0x33a64e(0x15a)]((_0x3774e1+0.055)/1.055,2.4):_0x3774e1/12.92,_0x22c447=_0x22c447>0.04045?Math[_0x33a64e(0x15a)]((_0x22c447+0.055)/1.055,2.4):_0x22c447/12.92,_0x5e947f*=0x64,_0x3774e1*=0x64,_0x22c447*=0x64;let _0x499100=_0x5e947f*0.4124+_0x3774e1*0.3576+_0x22c447*0.1805,_0x466810=_0x5e947f*0.2126+_0x3774e1*0.7152+_0x22c447*0.0722,_0x3b0b76=_0x5e947f*0.0193+_0x3774e1*0.1192+_0x22c447*0.9505;_0x499100/=95.047,_0x466810/=0x64,_0x3b0b76/=108.883,_0x499100=_0x499100>0.008856?Math[_0x33a64e(0x15a)](_0x499100,0x1/0x3):7.787*_0x499100+0x10/0x74,_0x466810=_0x466810>0.008856?Math[_0x33a64e(0x15a)](_0x466810,0x1/0x3):7.787*_0x466810+0x10/0x74,_0x3b0b76=_0x3b0b76>0.008856?Math[_0x33a64e(0x15a)](_0x3b0b76,0x1/0x3):7.787*_0x3b0b76+0x10/0x74;const _0x8cfac4=0x74*_0x466810-0x10,_0xf9fc5a=0x1f4*(_0x499100-_0x466810),_0x71b49e=0xc8*(_0x466810-_0x3b0b76);return{'l':_0x8cfac4,'a':_0xf9fc5a,'b':_0x71b49e};}function labDistance(_0x11c444,_0x33faa1){const _0xeb29ff=_0x1fd5e3,_0x655ea7=_0x11c444['l']-_0x33faa1['l'],_0xf1589a=_0x11c444['a']-_0x33faa1['a'],_0x781083=_0x11c444['b']-_0x33faa1['b'];return Math[_0xeb29ff(0x26f)](0.2*_0x655ea7*_0x655ea7+0x3*_0xf1589a*_0xf1589a+0x3*_0x781083*_0x781083);}function findClosestColor(_0x47854b,_0x1e4c0,_0x449e2f,_0x4bfdbc){let _0x24a970;if(_0x4bfdbc==='threeColor'){_0x24a970=threeColorPalette;if(_0x47854b>0x78&&_0x47854b>_0x1e4c0*1.5&&_0x47854b>_0x449e2f*1.5)return threeColorPalette[0x2];const _0x367623=0.299*_0x47854b+0.587*_0x1e4c0+0.114*_0x449e2f;return _0x367623<0x80?threeColorPalette[0x0]:threeColorPalette[0x1];}else{_0x24a970=blackWhitePalette;const _0x1cd82d=0.299*_0x47854b+0.587*_0x1e4c0+0.114*_0x449e2f;return _0x1cd82d<0x80?blackWhitePalette[0x0]:blackWhitePalette[0x1];}}const DitherAlgorithms={'floydSteinberg':function(_0x509936,_0x145fd2,_0x36cf3f){const _0x2b7754=_0x1fd5e3,_0x470028=_0x509936['width'],_0xc15a94=_0x509936[_0x2b7754(0x1b8)],_0x2ea06e=_0x509936['data'],_0x27d7c6=new Uint8ClampedArray(_0x2ea06e);for(let _0x3973d4=0x0;_0x3973d4<_0xc15a94;_0x3973d4++){for(let _0x2526fd=0x0;_0x2526fd<_0x470028;_0x2526fd++){const _0x246c1=(_0x3973d4*_0x470028+_0x2526fd)*0x4,_0x21ef60=_0x27d7c6[_0x246c1],_0x417ed0=_0x27d7c6[_0x246c1+0x1],_0x4da807=_0x27d7c6[_0x246c1+0x2],_0x22d543=findClosestColor(_0x21ef60,_0x417ed0,_0x4da807,_0x36cf3f),_0x1fef7b=(_0x21ef60-_0x22d543['r'])*_0x145fd2,_0x44e9f2=(_0x417ed0-_0x22d543['g'])*_0x145fd2,_0x12ba53=(_0x4da807-_0x22d543['b'])*_0x145fd2;if(_0x2526fd+0x1<_0x470028){const _0x516fa4=_0x246c1+0x4;_0x27d7c6[_0x516fa4]=Math[_0x2b7754(0x1c0)](0xff,Math['max'](0x0,_0x27d7c6[_0x516fa4]+_0x1fef7b*0x7/0x10)),_0x27d7c6[_0x516fa4+0x1]=Math[_0x2b7754(0x1c0)](0xff,Math[_0x2b7754(0x282)](0x0,_0x27d7c6[_0x516fa4+0x1]+_0x44e9f2*0x7/0x10)),_0x27d7c6[_0x516fa4+0x2]=Math[_0x2b7754(0x1c0)](0xff,Math[_0x2b7754(0x282)](0x0,_0x27d7c6[_0x516fa4+0x2]+_0x12ba53*0x7/0x10));}if(_0x3973d4+0x1<_0xc15a94){if(_0x2526fd>0x0){const _0x11fd9b=_0x246c1+_0x470028*0x4-0x4;_0x27d7c6[_0x11fd9b]=Math[_0x2b7754(0x1c0)](0xff,Math[_0x2b7754(0x282)](0x0,_0x27d7c6[_0x11fd9b]+_0x1fef7b*0x3/0x10)),_0x27d7c6[_0x11fd9b+0x1]=Math[_0x2b7754(0x1c0)](0xff,Math[_0x2b7754(0x282)](0x0,_0x27d7c6[_0x11fd9b+0x1]+_0x44e9f2*0x3/0x10)),_0x27d7c6[_0x11fd9b+0x2]=Math[_0x2b7754(0x1c0)](0xff,Math[_0x2b7754(0x282)](0x0,_0x27d7c6[_0x11fd9b+0x2]+_0x12ba53*0x3/0x10));}const _0x3cebdb=_0x246c1+_0x470028*0x4;_0x27d7c6[_0x3cebdb]=Math[_0x2b7754(0x1c0)](0xff,Math[_0x2b7754(0x282)](0x0,_0x27d7c6[_0x3cebdb]+_0x1fef7b*0x5/0x10)),_0x27d7c6[_0x3cebdb+0x1]=Math['min'](0xff,Math['max'](0x0,_0x27d7c6[_0x3cebdb+0x1]+_0x44e9f2*0x5/0x10)),_0x27d7c6[_0x3cebdb+0x2]=Math['min'](0xff,Math[_0x2b7754(0x282)](0x0,_0x27d7c6[_0x3cebdb+0x2]+_0x12ba53*0x5/0x10));if(_0x2526fd+0x1<_0x470028){const _0x2e5c79=_0x246c1+_0x470028*0x4+0x4;_0x27d7c6[_0x2e5c79]=Math[_0x2b7754(0x1c0)](0xff,Math[_0x2b7754(0x282)](0x0,_0x27d7c6[_0x2e5c79]+_0x1fef7b*0x1/0x10)),_0x27d7c6[_0x2e5c79+0x1]=Math[_0x2b7754(0x1c0)](0xff,Math[_0x2b7754(0x282)](0x0,_0x27d7c6[_0x2e5c79+0x1]+_0x44e9f2*0x1/0x10)),_0x27d7c6[_0x2e5c79+0x2]=Math[_0x2b7754(0x1c0)](0xff,Math[_0x2b7754(0x282)](0x0,_0x27d7c6[_0x2e5c79+0x2]+_0x12ba53*0x1/0x10));}}}}for(let _0x4b828a=0x0;_0x4b828a<_0xc15a94;_0x4b828a++){for(let _0x412cd4=0x0;_0x412cd4<_0x470028;_0x412cd4++){const _0x1205cf=(_0x4b828a*_0x470028+_0x412cd4)*0x4,_0x5eed0e=_0x27d7c6[_0x1205cf],_0x16e646=_0x27d7c6[_0x1205cf+0x1],_0xe8629e=_0x27d7c6[_0x1205cf+0x2],_0x96e1b9=findClosestColor(_0x5eed0e,_0x16e646,_0xe8629e,_0x36cf3f);_0x2ea06e[_0x1205cf]=_0x96e1b9['r'],_0x2ea06e[_0x1205cf+0x1]=_0x96e1b9['g'],_0x2ea06e[_0x1205cf+0x2]=_0x96e1b9['b'];}}return _0x509936;},'atkinson':function(_0x224477,_0x275cbc,_0x4ea999){const _0xaaf177=_0x1fd5e3,_0x4109df=_0x224477[_0xaaf177(0x241)],_0x5df7f3=_0x224477[_0xaaf177(0x1b8)],_0x12ab1c=_0x224477[_0xaaf177(0x279)],_0x379d28=new Uint8ClampedArray(_0x12ab1c),_0x3e15ff=_0x275cbc*0x1/0x8;for(let _0x5a5cb3=0x0;_0x5a5cb3<_0x5df7f3;_0x5a5cb3++){for(let _0x197ef3=0x0;_0x197ef3<_0x4109df;_0x197ef3++){const _0x16900f=(_0x5a5cb3*_0x4109df+_0x197ef3)*0x4,_0x4e61fb=_0x379d28[_0x16900f],_0x49a7d0=_0x379d28[_0x16900f+0x1],_0x115d6e=_0x379d28[_0x16900f+0x2],_0x3c8473=findClosestColor(_0x4e61fb,_0x49a7d0,_0x115d6e,_0x4ea999),_0x516954=(_0x4e61fb-_0x3c8473['r'])*_0x3e15ff,_0x251d88=(_0x49a7d0-_0x3c8473['g'])*_0x3e15ff,_0x18ecbd=(_0x115d6e-_0x3c8473['b'])*_0x3e15ff;if(_0x197ef3+0x1<_0x4109df){const _0x25509c=_0x16900f+0x4;_0x379d28[_0x25509c]=Math[_0xaaf177(0x1c0)](0xff,Math[_0xaaf177(0x282)](0x0,_0x379d28[_0x25509c]+_0x516954)),_0x379d28[_0x25509c+0x1]=Math['min'](0xff,Math['max'](0x0,_0x379d28[_0x25509c+0x1]+_0x251d88)),_0x379d28[_0x25509c+0x2]=Math[_0xaaf177(0x1c0)](0xff,Math[_0xaaf177(0x282)](0x0,_0x379d28[_0x25509c+0x2]+_0x18ecbd));}if(_0x197ef3+0x2<_0x4109df){const _0x5d3254=_0x16900f+0x8;_0x379d28[_0x5d3254]=Math[_0xaaf177(0x1c0)](0xff,Math[_0xaaf177(0x282)](0x0,_0x379d28[_0x5d3254]+_0x516954)),_0x379d28[_0x5d3254+0x1]=Math['min'](0xff,Math[_0xaaf177(0x282)](0x0,_0x379d28[_0x5d3254+0x1]+_0x251d88)),_0x379d28[_0x5d3254+0x2]=Math[_0xaaf177(0x1c0)](0xff,Math['max'](0x0,_0x379d28[_0x5d3254+0x2]+_0x18ecbd));}if(_0x5a5cb3+0x1<_0x5df7f3){if(_0x197ef3>0x0){const _0x268175=_0x16900f+_0x4109df*0x4-0x4;_0x379d28[_0x268175]=Math[_0xaaf177(0x1c0)](0xff,Math[_0xaaf177(0x282)](0x0,_0x379d28[_0x268175]+_0x516954)),_0x379d28[_0x268175+0x1]=Math[_0xaaf177(0x1c0)](0xff,Math[_0xaaf177(0x282)](0x0,_0x379d28[_0x268175+0x1]+_0x251d88)),_0x379d28[_0x268175+0x2]=Math['min'](0xff,Math[_0xaaf177(0x282)](0x0,_0x379d28[_0x268175+0x2]+_0x18ecbd));}const _0x1beafe=_0x16900f+_0x4109df*0x4;_0x379d28[_0x1beafe]=Math[_0xaaf177(0x1c0)](0xff,Math[_0xaaf177(0x282)](0x0,_0x379d28[_0x1beafe]+_0x516954)),_0x379d28[_0x1beafe+0x1]=Math[_0xaaf177(0x1c0)](0xff,Math['max'](0x0,_0x379d28[_0x1beafe+0x1]+_0x251d88)),_0x379d28[_0x1beafe+0x2]=Math[_0xaaf177(0x1c0)](0xff,Math[_0xaaf177(0x282)](0x0,_0x379d28[_0x1beafe+0x2]+_0x18ecbd));if(_0x197ef3+0x1<_0x4109df){const _0x1bcba7=_0x16900f+_0x4109df*0x4+0x4;_0x379d28[_0x1bcba7]=Math[_0xaaf177(0x1c0)](0xff,Math[_0xaaf177(0x282)](0x0,_0x379d28[_0x1bcba7]+_0x516954)),_0x379d28[_0x1bcba7+0x1]=Math[_0xaaf177(0x1c0)](0xff,Math[_0xaaf177(0x282)](0x0,_0x379d28[_0x1bcba7+0x1]+_0x251d88)),_0x379d28[_0x1bcba7+0x2]=Math[_0xaaf177(0x1c0)](0xff,Math[_0xaaf177(0x282)](0x0,_0x379d28[_0x1bcba7+0x2]+_0x18ecbd));}}}}for(let _0x4750a5=0x0;_0x4750a5<_0x5df7f3;_0x4750a5++){for(let _0x4d7d0d=0x0;_0x4d7d0d<_0x4109df;_0x4d7d0d++){const _0x7015a=(_0x4750a5*_0x4109df+_0x4d7d0d)*0x4,_0x37f231=_0x379d28[_0x7015a],_0x5d5585=_0x379d28[_0x7015a+0x1],_0x3fc4f1=_0x379d28[_0x7015a+0x2],_0x31cb9e=findClosestColor(_0x37f231,_0x5d5585,_0x3fc4f1,_0x4ea999);_0x12ab1c[_0x7015a]=_0x31cb9e['r'],_0x12ab1c[_0x7015a+0x1]=_0x31cb9e['g'],_0x12ab1c[_0x7015a+0x2]=_0x31cb9e['b'];}}return _0x224477;},'bayer':function(_0x50d142,_0x14a4ae,_0x191e9a){const _0x35b957=_0x1fd5e3,_0x4ccbcd=_0x50d142[_0x35b957(0x241)],_0x1cb8cf=_0x50d142[_0x35b957(0x1b8)],_0x5eceb3=_0x50d142['data'],_0x29b6af=[[0x0,0x8,0x2,0xa],[0xc,0x4,0xe,0x6],[0x3,0xb,0x1,0x9],[0xf,0x7,0xd,0x5]],_0x2d741a=0x4,_0x3c9f43=0x10;for(let _0x4ca667=0x0;_0x4ca667<_0x1cb8cf;_0x4ca667++){for(let _0x3c764f=0x0;_0x3c764f<_0x4ccbcd;_0x3c764f++){const _0xa3637f=(_0x4ca667*_0x4ccbcd+_0x3c764f)*0x4,_0x2b42da=_0x5eceb3[_0xa3637f],_0x4ed3b1=_0x5eceb3[_0xa3637f+0x1],_0x5a6afe=_0x5eceb3[_0xa3637f+0x2],_0x540cfb=0.299*_0x2b42da+0.587*_0x4ed3b1+0.114*_0x5a6afe,_0x9b512e=_0x3c764f%_0x2d741a,_0x19b1df=_0x4ca667%_0x2d741a,_0x3e00e8=_0x29b6af[_0x19b1df][_0x9b512e];let _0x315a9c=_0x540cfb;if(_0x191e9a===_0x35b957(0x21e)&&_0x2b42da>0x78&&_0x2b42da>_0x4ed3b1*1.5&&_0x2b42da>_0x5a6afe*1.5)_0x5eceb3[_0xa3637f]=0xff,_0x5eceb3[_0xa3637f+0x1]=0x0,_0x5eceb3[_0xa3637f+0x2]=0x0;else{const _0x46bc65=_0x3e00e8/_0x3c9f43*0xff*_0x14a4ae;_0x540cfb<0x80+(_0x46bc65-0x80)?(_0x5eceb3[_0xa3637f]=0x0,_0x5eceb3[_0xa3637f+0x1]=0x0,_0x5eceb3[_0xa3637f+0x2]=0x0):(_0x5eceb3[_0xa3637f]=0xff,_0x5eceb3[_0xa3637f+0x1]=0xff,_0x5eceb3[_0xa3637f+0x2]=0xff);}}}return _0x50d142;},'stucki':function(_0x42369f,_0x3a255e,_0x1ba32b){const _0x522826=_0x1fd5e3,_0x2aad34=_0x42369f[_0x522826(0x241)],_0x411ab7=_0x42369f[_0x522826(0x1b8)],_0xb2da0a=_0x42369f[_0x522826(0x279)],_0x64c085=new Uint8ClampedArray(_0xb2da0a),_0x1df47c=_0x3a255e*0x1/0x2a;for(let _0x128fd4=0x0;_0x128fd4<_0x411ab7;_0x128fd4++){for(let _0x35fb2a=0x0;_0x35fb2a<_0x2aad34;_0x35fb2a++){const _0xbb3217=(_0x128fd4*_0x2aad34+_0x35fb2a)*0x4,_0x579f7d=_0x64c085[_0xbb3217],_0x1f867f=_0x64c085[_0xbb3217+0x1],_0x5c4548=_0x64c085[_0xbb3217+0x2],_0xe2e250=findClosestColor(_0x579f7d,_0x1f867f,_0x5c4548,_0x1ba32b),_0x468447=(_0x579f7d-_0xe2e250['r'])*_0x1df47c,_0x5efcc1=(_0x1f867f-_0xe2e250['g'])*_0x1df47c,_0x4f8e1d=(_0x5c4548-_0xe2e250['b'])*_0x1df47c;if(_0x35fb2a+0x1<_0x2aad34){const _0x258483=_0xbb3217+0x4;_0x64c085[_0x258483]=Math['min'](0xff,Math[_0x522826(0x282)](0x0,_0x64c085[_0x258483]+_0x468447*0x8)),_0x64c085[_0x258483+0x1]=Math[_0x522826(0x1c0)](0xff,Math[_0x522826(0x282)](0x0,_0x64c085[_0x258483+0x1]+_0x5efcc1*0x8)),_0x64c085[_0x258483+0x2]=Math[_0x522826(0x1c0)](0xff,Math[_0x522826(0x282)](0x0,_0x64c085[_0x258483+0x2]+_0x4f8e1d*0x8));}if(_0x35fb2a+0x2<_0x2aad34){const _0x4ea536=_0xbb3217+0x8;_0x64c085[_0x4ea536]=Math[_0x522826(0x1c0)](0xff,Math[_0x522826(0x282)](0x0,_0x64c085[_0x4ea536]+_0x468447*0x4)),_0x64c085[_0x4ea536+0x1]=Math[_0x522826(0x1c0)](0xff,Math['max'](0x0,_0x64c085[_0x4ea536+0x1]+_0x5efcc1*0x4)),_0x64c085[_0x4ea536+0x2]=Math[_0x522826(0x1c0)](0xff,Math[_0x522826(0x282)](0x0,_0x64c085[_0x4ea536+0x2]+_0x4f8e1d*0x4));}if(_0x128fd4+0x1<_0x411ab7){if(_0x35fb2a>0x1){const _0x4209a7=_0xbb3217+_0x2aad34*0x4-0x8;_0x64c085[_0x4209a7]=Math['min'](0xff,Math[_0x522826(0x282)](0x0,_0x64c085[_0x4209a7]+_0x468447*0x2)),_0x64c085[_0x4209a7+0x1]=Math[_0x522826(0x1c0)](0xff,Math[_0x522826(0x282)](0x0,_0x64c085[_0x4209a7+0x1]+_0x5efcc1*0x2)),_0x64c085[_0x4209a7+0x2]=Math[_0x522826(0x1c0)](0xff,Math[_0x522826(0x282)](0x0,_0x64c085[_0x4209a7+0x2]+_0x4f8e1d*0x2));}if(_0x35fb2a>0x0){const _0x48430f=_0xbb3217+_0x2aad34*0x4-0x4;_0x64c085[_0x48430f]=Math[_0x522826(0x1c0)](0xff,Math[_0x522826(0x282)](0x0,_0x64c085[_0x48430f]+_0x468447*0x4)),_0x64c085[_0x48430f+0x1]=Math[_0x522826(0x1c0)](0xff,Math['max'](0x0,_0x64c085[_0x48430f+0x1]+_0x5efcc1*0x4)),_0x64c085[_0x48430f+0x2]=Math[_0x522826(0x1c0)](0xff,Math[_0x522826(0x282)](0x0,_0x64c085[_0x48430f+0x2]+_0x4f8e1d*0x4));}const _0x28c161=_0xbb3217+_0x2aad34*0x4;_0x64c085[_0x28c161]=Math[_0x522826(0x1c0)](0xff,Math[_0x522826(0x282)](0x0,_0x64c085[_0x28c161]+_0x468447*0x8)),_0x64c085[_0x28c161+0x1]=Math[_0x522826(0x1c0)](0xff,Math['max'](0x0,_0x64c085[_0x28c161+0x1]+_0x5efcc1*0x8)),_0x64c085[_0x28c161+0x2]=Math[_0x522826(0x1c0)](0xff,Math['max'](0x0,_0x64c085[_0x28c161+0x2]+_0x4f8e1d*0x8));if(_0x35fb2a+0x1<_0x2aad34){const _0x345f58=_0xbb3217+_0x2aad34*0x4+0x4;_0x64c085[_0x345f58]=Math[_0x522826(0x1c0)](0xff,Math[_0x522826(0x282)](0x0,_0x64c085[_0x345f58]+_0x468447*0x4)),_0x64c085[_0x345f58+0x1]=Math[_0x522826(0x1c0)](0xff,Math[_0x522826(0x282)](0x0,_0x64c085[_0x345f58+0x1]+_0x5efcc1*0x4)),_0x64c085[_0x345f58+0x2]=Math['min'](0xff,Math[_0x522826(0x282)](0x0,_0x64c085[_0x345f58+0x2]+_0x4f8e1d*0x4));}if(_0x35fb2a+0x2<_0x2aad34){const _0x4b610b=_0xbb3217+_0x2aad34*0x4+0x8;_0x64c085[_0x4b610b]=Math[_0x522826(0x1c0)](0xff,Math[_0x522826(0x282)](0x0,_0x64c085[_0x4b610b]+_0x468447*0x2)),_0x64c085[_0x4b610b+0x1]=Math[_0x522826(0x1c0)](0xff,Math[_0x522826(0x282)](0x0,_0x64c085[_0x4b610b+0x1]+_0x5efcc1*0x2)),_0x64c085[_0x4b610b+0x2]=Math[_0x522826(0x1c0)](0xff,Math[_0x522826(0x282)](0x0,_0x64c085[_0x4b610b+0x2]+_0x4f8e1d*0x2));}}}}for(let _0x4a5872=0x0;_0x4a5872<_0x411ab7;_0x4a5872++){for(let _0x3e7e7a=0x0;_0x3e7e7a<_0x2aad34;_0x3e7e7a++){const _0x507e65=(_0x4a5872*_0x2aad34+_0x3e7e7a)*0x4,_0x2a22ee=_0x64c085[_0x507e65],_0x51441d=_0x64c085[_0x507e65+0x1],_0xfdff5b=_0x64c085[_0x507e65+0x2],_0x4c51ea=findClosestColor(_0x2a22ee,_0x51441d,_0xfdff5b,_0x1ba32b);_0xb2da0a[_0x507e65]=_0x4c51ea['r'],_0xb2da0a[_0x507e65+0x1]=_0x4c51ea['g'],_0xb2da0a[_0x507e65+0x2]=_0x4c51ea['b'];}}return _0x42369f;},'jarvis':function(_0x939583,_0x24264a,_0x586ab9){const _0x5f202c=_0x1fd5e3,_0x2eb8e4=_0x939583[_0x5f202c(0x241)],_0x52e619=_0x939583['height'],_0x609600=_0x939583[_0x5f202c(0x279)],_0x27107b=new Uint8ClampedArray(_0x609600),_0x59fa7d=_0x24264a*0x1/0x30;for(let _0xf8fa76=0x0;_0xf8fa76<_0x52e619;_0xf8fa76++){for(let _0xe62c07=0x0;_0xe62c07<_0x2eb8e4;_0xe62c07++){const _0x5d52ac=(_0xf8fa76*_0x2eb8e4+_0xe62c07)*0x4,_0x469718=_0x27107b[_0x5d52ac],_0x175514=_0x27107b[_0x5d52ac+0x1],_0x582c1e=_0x27107b[_0x5d52ac+0x2],_0x3d0579=findClosestColor(_0x469718,_0x175514,_0x582c1e,_0x586ab9),_0x3f538e=(_0x469718-_0x3d0579['r'])*_0x59fa7d,_0x26ca8f=(_0x175514-_0x3d0579['g'])*_0x59fa7d,_0x2ee1b9=(_0x582c1e-_0x3d0579['b'])*_0x59fa7d;if(_0xe62c07+0x1<_0x2eb8e4){const _0x1ea4ea=_0x5d52ac+0x4;_0x27107b[_0x1ea4ea]=Math[_0x5f202c(0x1c0)](0xff,Math[_0x5f202c(0x282)](0x0,_0x27107b[_0x1ea4ea]+_0x3f538e*0x7)),_0x27107b[_0x1ea4ea+0x1]=Math[_0x5f202c(0x1c0)](0xff,Math[_0x5f202c(0x282)](0x0,_0x27107b[_0x1ea4ea+0x1]+_0x26ca8f*0x7)),_0x27107b[_0x1ea4ea+0x2]=Math[_0x5f202c(0x1c0)](0xff,Math[_0x5f202c(0x282)](0x0,_0x27107b[_0x1ea4ea+0x2]+_0x2ee1b9*0x7));}if(_0xe62c07+0x2<_0x2eb8e4){const _0x54d0a4=_0x5d52ac+0x8;_0x27107b[_0x54d0a4]=Math[_0x5f202c(0x1c0)](0xff,Math[_0x5f202c(0x282)](0x0,_0x27107b[_0x54d0a4]+_0x3f538e*0x5)),_0x27107b[_0x54d0a4+0x1]=Math[_0x5f202c(0x1c0)](0xff,Math[_0x5f202c(0x282)](0x0,_0x27107b[_0x54d0a4+0x1]+_0x26ca8f*0x5)),_0x27107b[_0x54d0a4+0x2]=Math[_0x5f202c(0x1c0)](0xff,Math[_0x5f202c(0x282)](0x0,_0x27107b[_0x54d0a4+0x2]+_0x2ee1b9*0x5));}if(_0xf8fa76+0x1<_0x52e619){if(_0xe62c07>0x1){const _0x22bd89=_0x5d52ac+_0x2eb8e4*0x4-0x8;_0x27107b[_0x22bd89]=Math['min'](0xff,Math[_0x5f202c(0x282)](0x0,_0x27107b[_0x22bd89]+_0x3f538e*0x3)),_0x27107b[_0x22bd89+0x1]=Math[_0x5f202c(0x1c0)](0xff,Math[_0x5f202c(0x282)](0x0,_0x27107b[_0x22bd89+0x1]+_0x26ca8f*0x3)),_0x27107b[_0x22bd89+0x2]=Math[_0x5f202c(0x1c0)](0xff,Math['max'](0x0,_0x27107b[_0x22bd89+0x2]+_0x2ee1b9*0x3));}if(_0xe62c07>0x0){const _0x312738=_0x5d52ac+_0x2eb8e4*0x4-0x4;_0x27107b[_0x312738]=Math[_0x5f202c(0x1c0)](0xff,Math[_0x5f202c(0x282)](0x0,_0x27107b[_0x312738]+_0x3f538e*0x5)),_0x27107b[_0x312738+0x1]=Math[_0x5f202c(0x1c0)](0xff,Math[_0x5f202c(0x282)](0x0,_0x27107b[_0x312738+0x1]+_0x26ca8f*0x5)),_0x27107b[_0x312738+0x2]=Math[_0x5f202c(0x1c0)](0xff,Math[_0x5f202c(0x282)](0x0,_0x27107b[_0x312738+0x2]+_0x2ee1b9*0x5));}const _0x168908=_0x5d52ac+_0x2eb8e4*0x4;_0x27107b[_0x168908]=Math['min'](0xff,Math[_0x5f202c(0x282)](0x0,_0x27107b[_0x168908]+_0x3f538e*0x7)),_0x27107b[_0x168908+0x1]=Math[_0x5f202c(0x1c0)](0xff,Math['max'](0x0,_0x27107b[_0x168908+0x1]+_0x26ca8f*0x7)),_0x27107b[_0x168908+0x2]=Math[_0x5f202c(0x1c0)](0xff,Math[_0x5f202c(0x282)](0x0,_0x27107b[_0x168908+0x2]+_0x2ee1b9*0x7));if(_0xe62c07+0x1<_0x2eb8e4){const _0x5d28ff=_0x5d52ac+_0x2eb8e4*0x4+0x4;_0x27107b[_0x5d28ff]=Math[_0x5f202c(0x1c0)](0xff,Math[_0x5f202c(0x282)](0x0,_0x27107b[_0x5d28ff]+_0x3f538e*0x5)),_0x27107b[_0x5d28ff+0x1]=Math[_0x5f202c(0x1c0)](0xff,Math[_0x5f202c(0x282)](0x0,_0x27107b[_0x5d28ff+0x1]+_0x26ca8f*0x5)),_0x27107b[_0x5d28ff+0x2]=Math['min'](0xff,Math[_0x5f202c(0x282)](0x0,_0x27107b[_0x5d28ff+0x2]+_0x2ee1b9*0x5));}if(_0xe62c07+0x2<_0x2eb8e4){const _0x2a1bd3=_0x5d52ac+_0x2eb8e4*0x4+0x8;_0x27107b[_0x2a1bd3]=Math[_0x5f202c(0x1c0)](0xff,Math[_0x5f202c(0x282)](0x0,_0x27107b[_0x2a1bd3]+_0x3f538e*0x3)),_0x27107b[_0x2a1bd3+0x1]=Math[_0x5f202c(0x1c0)](0xff,Math[_0x5f202c(0x282)](0x0,_0x27107b[_0x2a1bd3+0x1]+_0x26ca8f*0x3)),_0x27107b[_0x2a1bd3+0x2]=Math[_0x5f202c(0x1c0)](0xff,Math[_0x5f202c(0x282)](0x0,_0x27107b[_0x2a1bd3+0x2]+_0x2ee1b9*0x3));}}if(_0xf8fa76+0x2<_0x52e619){if(_0xe62c07>0x1){const _0x1edbb6=_0x5d52ac+_0x2eb8e4*0x4*0x2-0x8;_0x27107b[_0x1edbb6]=Math[_0x5f202c(0x1c0)](0xff,Math[_0x5f202c(0x282)](0x0,_0x27107b[_0x1edbb6]+_0x3f538e*0x1)),_0x27107b[_0x1edbb6+0x1]=Math[_0x5f202c(0x1c0)](0xff,Math[_0x5f202c(0x282)](0x0,_0x27107b[_0x1edbb6+0x1]+_0x26ca8f*0x1)),_0x27107b[_0x1edbb6+0x2]=Math[_0x5f202c(0x1c0)](0xff,Math[_0x5f202c(0x282)](0x0,_0x27107b[_0x1edbb6+0x2]+_0x2ee1b9*0x1));}if(_0xe62c07>0x0){const _0x3ef9b8=_0x5d52ac+_0x2eb8e4*0x4*0x2-0x4;_0x27107b[_0x3ef9b8]=Math[_0x5f202c(0x1c0)](0xff,Math[_0x5f202c(0x282)](0x0,_0x27107b[_0x3ef9b8]+_0x3f538e*0x3)),_0x27107b[_0x3ef9b8+0x1]=Math[_0x5f202c(0x1c0)](0xff,Math[_0x5f202c(0x282)](0x0,_0x27107b[_0x3ef9b8+0x1]+_0x26ca8f*0x3)),_0x27107b[_0x3ef9b8+0x2]=Math[_0x5f202c(0x1c0)](0xff,Math[_0x5f202c(0x282)](0x0,_0x27107b[_0x3ef9b8+0x2]+_0x2ee1b9*0x3));}const _0x200ce2=_0x5d52ac+_0x2eb8e4*0x4*0x2;_0x27107b[_0x200ce2]=Math[_0x5f202c(0x1c0)](0xff,Math[_0x5f202c(0x282)](0x0,_0x27107b[_0x200ce2]+_0x3f538e*0x5)),_0x27107b[_0x200ce2+0x1]=Math['min'](0xff,Math[_0x5f202c(0x282)](0x0,_0x27107b[_0x200ce2+0x1]+_0x26ca8f*0x5)),_0x27107b[_0x200ce2+0x2]=Math[_0x5f202c(0x1c0)](0xff,Math[_0x5f202c(0x282)](0x0,_0x27107b[_0x200ce2+0x2]+_0x2ee1b9*0x5));if(_0xe62c07+0x1<_0x2eb8e4){const _0xc04934=_0x5d52ac+_0x2eb8e4*0x4*0x2+0x4;_0x27107b[_0xc04934]=Math['min'](0xff,Math[_0x5f202c(0x282)](0x0,_0x27107b[_0xc04934]+_0x3f538e*0x3)),_0x27107b[_0xc04934+0x1]=Math[_0x5f202c(0x1c0)](0xff,Math[_0x5f202c(0x282)](0x0,_0x27107b[_0xc04934+0x1]+_0x26ca8f*0x3)),_0x27107b[_0xc04934+0x2]=Math[_0x5f202c(0x1c0)](0xff,Math[_0x5f202c(0x282)](0x0,_0x27107b[_0xc04934+0x2]+_0x2ee1b9*0x3));}if(_0xe62c07+0x2<_0x2eb8e4){const _0x5c4b52=_0x5d52ac+_0x2eb8e4*0x4*0x2+0x8;_0x27107b[_0x5c4b52]=Math['min'](0xff,Math[_0x5f202c(0x282)](0x0,_0x27107b[_0x5c4b52]+_0x3f538e*0x1)),_0x27107b[_0x5c4b52+0x1]=Math[_0x5f202c(0x1c0)](0xff,Math['max'](0x0,_0x27107b[_0x5c4b52+0x1]+_0x26ca8f*0x1)),_0x27107b[_0x5c4b52+0x2]=Math[_0x5f202c(0x1c0)](0xff,Math['max'](0x0,_0x27107b[_0x5c4b52+0x2]+_0x2ee1b9*0x1));}}}}for(let _0x320004=0x0;_0x320004<_0x52e619;_0x320004++){for(let _0x2d9188=0x0;_0x2d9188<_0x2eb8e4;_0x2d9188++){const _0x490f74=(_0x320004*_0x2eb8e4+_0x2d9188)*0x4,_0x2e2c44=_0x27107b[_0x490f74],_0x530c77=_0x27107b[_0x490f74+0x1],_0x1a3ebc=_0x27107b[_0x490f74+0x2],_0x432ab8=findClosestColor(_0x2e2c44,_0x530c77,_0x1a3ebc,_0x586ab9);_0x609600[_0x490f74]=_0x432ab8['r'],_0x609600[_0x490f74+0x1]=_0x432ab8['g'],_0x609600[_0x490f74+0x2]=_0x432ab8['b'];}}return _0x939583;}};function floydSteinbergDither(_0x2a8cc6,_0x19d6d5,_0x64ceb2){const _0x833d2e=_0x1fd5e3,_0x218651=_0x2a8cc6['width'],_0x18c359=_0x2a8cc6[_0x833d2e(0x1b8)],_0x923ad5=_0x2a8cc6[_0x833d2e(0x279)],_0x5d8c4e=new Uint8ClampedArray(_0x923ad5);for(let _0x244927=0x0;_0x244927<_0x18c359;_0x244927++){for(let _0x5626ff=0x0;_0x5626ff<_0x218651;_0x5626ff++){const _0x33bcba=(_0x244927*_0x218651+_0x5626ff)*0x4,_0xb8c2e6=_0x5d8c4e[_0x33bcba],_0x8b5fce=_0x5d8c4e[_0x33bcba+0x1],_0x203625=_0x5d8c4e[_0x33bcba+0x2],_0x2a8af2=findClosestColor(_0xb8c2e6,_0x8b5fce,_0x203625,_0x64ceb2),_0x56c487=(_0xb8c2e6-_0x2a8af2['r'])*_0x19d6d5,_0x4c3b18=(_0x8b5fce-_0x2a8af2['g'])*_0x19d6d5,_0x45e68d=(_0x203625-_0x2a8af2['b'])*_0x19d6d5;if(_0x5626ff+0x1<_0x218651){const _0x39cc3e=_0x33bcba+0x4;_0x5d8c4e[_0x39cc3e]=Math[_0x833d2e(0x1c0)](0xff,Math[_0x833d2e(0x282)](0x0,_0x5d8c4e[_0x39cc3e]+_0x56c487*0x7/0x10)),_0x5d8c4e[_0x39cc3e+0x1]=Math[_0x833d2e(0x1c0)](0xff,Math[_0x833d2e(0x282)](0x0,_0x5d8c4e[_0x39cc3e+0x1]+_0x4c3b18*0x7/0x10)),_0x5d8c4e[_0x39cc3e+0x2]=Math[_0x833d2e(0x1c0)](0xff,Math['max'](0x0,_0x5d8c4e[_0x39cc3e+0x2]+_0x45e68d*0x7/0x10));}if(_0x244927+0x1<_0x18c359){if(_0x5626ff>0x0){const _0x535607=_0x33bcba+_0x218651*0x4-0x4;_0x5d8c4e[_0x535607]=Math[_0x833d2e(0x1c0)](0xff,Math[_0x833d2e(0x282)](0x0,_0x5d8c4e[_0x535607]+_0x56c487*0x3/0x10)),_0x5d8c4e[_0x535607+0x1]=Math[_0x833d2e(0x1c0)](0xff,Math[_0x833d2e(0x282)](0x0,_0x5d8c4e[_0x535607+0x1]+_0x4c3b18*0x3/0x10)),_0x5d8c4e[_0x535607+0x2]=Math['min'](0xff,Math[_0x833d2e(0x282)](0x0,_0x5d8c4e[_0x535607+0x2]+_0x45e68d*0x3/0x10));}const _0x2046f3=_0x33bcba+_0x218651*0x4;_0x5d8c4e[_0x2046f3]=Math[_0x833d2e(0x1c0)](0xff,Math[_0x833d2e(0x282)](0x0,_0x5d8c4e[_0x2046f3]+_0x56c487*0x5/0x10)),_0x5d8c4e[_0x2046f3+0x1]=Math[_0x833d2e(0x1c0)](0xff,Math[_0x833d2e(0x282)](0x0,_0x5d8c4e[_0x2046f3+0x1]+_0x4c3b18*0x5/0x10)),_0x5d8c4e[_0x2046f3+0x2]=Math['min'](0xff,Math[_0x833d2e(0x282)](0x0,_0x5d8c4e[_0x2046f3+0x2]+_0x45e68d*0x5/0x10));if(_0x5626ff+0x1<_0x218651){const _0x1669c3=_0x33bcba+_0x218651*0x4+0x4;_0x5d8c4e[_0x1669c3]=Math[_0x833d2e(0x1c0)](0xff,Math['max'](0x0,_0x5d8c4e[_0x1669c3]+_0x56c487*0x1/0x10)),_0x5d8c4e[_0x1669c3+0x1]=Math[_0x833d2e(0x1c0)](0xff,Math[_0x833d2e(0x282)](0x0,_0x5d8c4e[_0x1669c3+0x1]+_0x4c3b18*0x1/0x10)),_0x5d8c4e[_0x1669c3+0x2]=Math[_0x833d2e(0x1c0)](0xff,Math[_0x833d2e(0x282)](0x0,_0x5d8c4e[_0x1669c3+0x2]+_0x45e68d*0x1/0x10));}}}}for(let _0x40631e=0x0;_0x40631e<_0x18c359;_0x40631e++){for(let _0xa9174d=0x0;_0xa9174d<_0x218651;_0xa9174d++){const _0x4f3a65=(_0x40631e*_0x218651+_0xa9174d)*0x4,_0x256c41=_0x5d8c4e[_0x4f3a65],_0x4ca37d=_0x5d8c4e[_0x4f3a65+0x1],_0x283e7d=_0x5d8c4e[_0x4f3a65+0x2],_0x40e8f6=findClosestColor(_0x256c41,_0x4ca37d,_0x283e7d,_0x64ceb2);_0x923ad5[_0x4f3a65]=_0x40e8f6['r'],_0x923ad5[_0x4f3a65+0x1]=_0x40e8f6['g'],_0x923ad5[_0x4f3a65+0x2]=_0x40e8f6['b'];}}return _0x2a8cc6;}function processImage1(_0x2e4c1d,_0x3731b7,_0x20124a,_0x2562d5,_0x50066a,_0x1d306d,_0x4b9eaa){const _0x2f542b=_0x1fd5e3,_0x2ffaeb=new ImageData(new Uint8ClampedArray(_0x2e4c1d[_0x2f542b(0x279)]),_0x2e4c1d[_0x2f542b(0x241)],_0x2e4c1d[_0x2f542b(0x1b8)]);return adjustBrightness(_0x2ffaeb,_0x3731b7),adjustContrast(_0x2ffaeb,_0x20124a),adjustSaturation(_0x2ffaeb,_0x2562d5),DitherAlgorithms[_0x4b9eaa]?DitherAlgorithms[_0x4b9eaa](_0x2ffaeb,_0x50066a,_0x1d306d):floydSteinbergDither(_0x2ffaeb,_0x50066a,_0x1d306d),_0x2ffaeb;}function imageDataToEpdBytes(_0x81aa19,_0x4638fb){const _0x206639=_0x1fd5e3,_0x14e333=_0x81aa19['width'],_0x412a0c=_0x81aa19[_0x206639(0x1b8)],_0x30d4de=_0x81aa19[_0x206639(0x279)];let _0x408327;if(_0x4638fb===_0x206639(0x21e)){_0x408327=new Uint8Array(Math[_0x206639(0x26d)](_0x14e333*_0x412a0c/0x8)*0x2);let _0x3231d2=0x0,_0x322fe9=Math[_0x206639(0x26d)](_0x14e333*_0x412a0c/0x8),_0x3435e5=0x0,_0x2e77a1=0x0,_0x22b53c=0x0;for(let _0x2e44a1=0x0;_0x2e44a1<_0x30d4de[_0x206639(0x220)];_0x2e44a1+=0x4){const _0x2fbfee=_0x30d4de[_0x2e44a1],_0x2e85bb=_0x30d4de[_0x2e44a1+0x1],_0x23237a=_0x30d4de[_0x2e44a1+0x2],_0x42a98a=_0x2fbfee>0xc8&&_0x2e85bb<0x32&&_0x23237a<0x32,_0x4974b6=!_0x42a98a&&0.299*_0x2fbfee+0.587*_0x2e85bb+0.114*_0x23237a<0x80;_0x4974b6&&(_0x2e77a1|=0x1<<0x7-_0x3435e5),_0x42a98a&&(_0x22b53c|=0x1<<0x7-_0x3435e5),_0x3435e5++,_0x3435e5===0x8&&(_0x408327[_0x3231d2++]=_0x2e77a1,_0x408327[_0x322fe9++]=_0x22b53c,_0x3435e5=0x0,_0x2e77a1=0x0,_0x22b53c=0x0);}_0x3435e5>0x0&&(_0x408327[_0x3231d2]=_0x2e77a1,_0x408327[_0x322fe9]=_0x22b53c);}else{_0x408327=new Uint8Array(Math[_0x206639(0x26d)](_0x14e333*_0x412a0c/0x8));let _0x3ae578=0x0,_0x188262=0x0,_0x513ff7=0x0;for(let _0x3255a7=0x0;_0x3255a7<_0x30d4de[_0x206639(0x220)];_0x3255a7+=0x4){const _0x450b06=_0x30d4de[_0x3255a7],_0x36b0f6=_0x30d4de[_0x3255a7+0x1],_0x32368c=_0x30d4de[_0x3255a7+0x2],_0x386271=0.299*_0x450b06+0.587*_0x36b0f6+0.114*_0x32368c<0x80;_0x386271&&(_0x513ff7|=0x1<<0x7-_0x188262),_0x188262++,_0x188262===0x8&&(_0x408327[_0x3ae578++]=_0x513ff7,_0x188262=0x0,_0x513ff7=0x0);}_0x188262>0x0&&(_0x408327[_0x3ae578]=_0x513ff7);}return _0x408327;}const imageUpload=document[_0x1fd5e3(0x239)]('imageFile'),previewCanvas=document[_0x1fd5e3(0x239)](_0x1fd5e3(0x269)),floatPreviewCanvas=document['getElementById']('floatPreviewCanvas'),noImagePlaceholder=document[_0x1fd5e3(0x239)]('noImagePlaceholder'),processedImageInfo=document['getElementById']('processedImageInfo'),btnProcess=document[_0x1fd5e3(0x239)](_0x1fd5e3(0x1b0)),btnSend=document[_0x1fd5e3(0x239)]('btnSend'),btnDownload=document[_0x1fd5e3(0x239)](_0x1fd5e3(0x181)),btnReset=document[_0x1fd5e3(0x239)](_0x1fd5e3(0x252)),btnClearLog=document['getElementById'](_0x1fd5e3(0x22e)),btnBlackWhite=document[_0x1fd5e3(0x239)]('btnBlackWhite'),btnBlackWhiteRed=document[_0x1fd5e3(0x239)](_0x1fd5e3(0x190)),ditherMode=document[_0x1fd5e3(0x239)](_0x1fd5e3(0x172)),ditherAlg=document[_0x1fd5e3(0x239)]('ditherAlg'),logContainer=document[_0x1fd5e3(0x239)](_0x1fd5e3(0x27f)),statusContainer=document['getElementById'](_0x1fd5e3(0x19f)),floatingCanvasContainer=document[_0x1fd5e3(0x239)](_0x1fd5e3(0x1f1)),toggleCanvasFloat=document[_0x1fd5e3(0x239)](_0x1fd5e3(0x23c)),closeCanvas=document[_0x1fd5e3(0x239)](_0x1fd5e3(0x21c)),canvasResizeHandle=document[_0x1fd5e3(0x239)](_0x1fd5e3(0x1d3)),imageScaleSlider=document[_0x1fd5e3(0x239)]('imageScale'),imageScaleValue=document['getElementById'](_0x1fd5e3(0x167)),addTextBtn=document['getElementById'](_0x1fd5e3(0x153)),timeDialog=document[_0x1fd5e3(0x239)](_0x1fd5e3(0x280)),datetimeInput=document['getElementById'](_0x1fd5e3(0x259)),closeTimeDialog=document[_0x1fd5e3(0x239)](_0x1fd5e3(0x208)),confirmTimeBtn=document[_0x1fd5e3(0x239)](_0x1fd5e3(0x14c)),imageWidthInput=document[_0x1fd5e3(0x239)](_0x1fd5e3(0x24d)),imageHeightInput=document[_0x1fd5e3(0x239)](_0x1fd5e3(0x23e)),toolPen=document[_0x1fd5e3(0x239)](_0x1fd5e3(0x19e)),toolEraser=document[_0x1fd5e3(0x239)](_0x1fd5e3(0x180)),toolText=document[_0x1fd5e3(0x239)](_0x1fd5e3(0x213)),toolClear=document[_0x1fd5e3(0x239)]('toolClear'),brushSizeSlider=document['getElementById']('brushSize'),fontSizeInput=document[_0x1fd5e3(0x239)]('fontSize'),fontFamilySelect=document[_0x1fd5e3(0x239)](_0x1fd5e3(0x203)),textInput=document[_0x1fd5e3(0x239)]('textInput'),drawingStatus=document[_0x1fd5e3(0x239)]('drawingStatus'),currentToolEl=document[_0x1fd5e3(0x239)](_0x1fd5e3(0x216)),currentSizeEl=document[_0x1fd5e3(0x239)](_0x1fd5e3(0x171)),drawingModeIndicator=document[_0x1fd5e3(0x239)](_0x1fd5e3(0x165)),toggleDrawingModeBtn=document[_0x1fd5e3(0x239)](_0x1fd5e3(0x17b)),floatToggleDrawingModeBtn=document[_0x1fd5e3(0x239)]('floatToggleDrawingMode'),sliders={'saturation':document[_0x1fd5e3(0x239)](_0x1fd5e3(0x176)),'brightness':document[_0x1fd5e3(0x239)](_0x1fd5e3(0x1da)),'contrast':document['getElementById'](_0x1fd5e3(0x248)),'diffusion':document[_0x1fd5e3(0x239)](_0x1fd5e3(0x14f))},ditherSlider=document[_0x1fd5e3(0x239)]('dither-strength'),sliderValues={'saturation':document[_0x1fd5e3(0x239)](_0x1fd5e3(0x290)),'brightness':document[_0x1fd5e3(0x239)](_0x1fd5e3(0x158)),'contrast':document[_0x1fd5e3(0x239)](_0x1fd5e3(0x27c)),'diffusion':document[_0x1fd5e3(0x239)](_0x1fd5e3(0x293))};function init(){const _0x2d60a8=_0x1fd5e3;canvas=previewCanvas,ctx=canvas[_0x2d60a8(0x174)]('2d'),floatCanvas=floatPreviewCanvas,floatCtx=floatCanvas[_0x2d60a8(0x174)]('2d'),updateCanvasSize();const _0x17ebb1=new Date(),_0x52578a=new Date(_0x17ebb1[_0x2d60a8(0x210)]()-_0x17ebb1['getTimezoneOffset']()*0xea60)[_0x2d60a8(0x285)]()['slice'](0x0,0x10);datetimeInput['value']=_0x52578a,canvas[_0x2d60a8(0x193)](_0x2d60a8(0x1a9),startDrawing),canvas[_0x2d60a8(0x193)](_0x2d60a8(0x1a3),draw),canvas[_0x2d60a8(0x193)](_0x2d60a8(0x211),stopDrawing),canvas['addEventListener'](_0x2d60a8(0x16f),stopDrawing),floatCanvas[_0x2d60a8(0x193)](_0x2d60a8(0x1a9),startDrawingFloat),floatCanvas['addEventListener'](_0x2d60a8(0x1a3),drawFloat),floatCanvas[_0x2d60a8(0x193)](_0x2d60a8(0x211),stopDrawing),floatCanvas[_0x2d60a8(0x193)](_0x2d60a8(0x16f),stopDrawing),canvas['addEventListener']('touchstart',handleTouchStart,{'passive':![]}),canvas[_0x2d60a8(0x193)]('touchmove',handleTouchMove,{'passive':![]}),canvas[_0x2d60a8(0x193)](_0x2d60a8(0x20b),handleTouchEnd),canvas['addEventListener'](_0x2d60a8(0x1bf),handleTouchEnd),floatCanvas[_0x2d60a8(0x193)]('touchstart',handleFloatTouchStart,{'passive':![]}),floatCanvas['addEventListener'](_0x2d60a8(0x21a),handleFloatTouchMove,{'passive':![]}),floatCanvas[_0x2d60a8(0x193)](_0x2d60a8(0x20b),handleTouchEnd),floatCanvas[_0x2d60a8(0x193)]('touchcancel',handleTouchEnd),document['addEventListener'](_0x2d60a8(0x28f),_0x379cee=>{const _0x4fad59=_0x2d60a8;_0x379cee[_0x4fad59(0x1ee)]==='Shift'&&(shiftKeyPressed=!![],sourceImage&&!isDrawingModeActive&&(canvas['style'][_0x4fad59(0x194)]=_0x4fad59(0x1d4),floatCanvas[_0x4fad59(0x160)][_0x4fad59(0x194)]=_0x4fad59(0x1d4)));}),document['addEventListener'](_0x2d60a8(0x289),_0x27bee5=>{const _0x386da3=_0x2d60a8;_0x27bee5[_0x386da3(0x1ee)]===_0x386da3(0x157)&&(shiftKeyPressed=![],updateCursorStyle());}),toggleDrawingModeBtn[_0x2d60a8(0x193)](_0x2d60a8(0x19b),toggleDrawingMode),floatToggleDrawingModeBtn['addEventListener'](_0x2d60a8(0x19b),toggleDrawingMode),btnProcess[_0x2d60a8(0x193)](_0x2d60a8(0x19b),processImage),btnSend['addEventListener'](_0x2d60a8(0x19b),sendimg),btnDownload[_0x2d60a8(0x193)](_0x2d60a8(0x19b),downloadImageFile),btnReset[_0x2d60a8(0x193)](_0x2d60a8(0x19b),resetProcessing),btnClearLog[_0x2d60a8(0x193)](_0x2d60a8(0x19b),clearLog),toggleCanvasFloat[_0x2d60a8(0x193)](_0x2d60a8(0x19b),toggleCanvas),closeCanvas[_0x2d60a8(0x193)](_0x2d60a8(0x19b),hideCanvas),btnSetTime[_0x2d60a8(0x193)](_0x2d60a8(0x19b),showTimeDialog),closeTimeDialog[_0x2d60a8(0x193)](_0x2d60a8(0x19b),hideTimeDialog),confirmTimeBtn[_0x2d60a8(0x193)](_0x2d60a8(0x19b),setTime),brushSizeSlider['addEventListener'](_0x2d60a8(0x235),function(){const _0xa9c35e=_0x2d60a8;brushSize=parseInt(this[_0xa9c35e(0x155)]),currentSizeEl[_0xa9c35e(0x1af)]=brushSize;});const _0x2abbf5=floatingCanvasContainer[_0x2d60a8(0x222)]('div:first-child');_0x2abbf5['addEventListener']('mousedown',startDrag),document['addEventListener'](_0x2d60a8(0x1a3),drag),document[_0x2d60a8(0x193)](_0x2d60a8(0x211),stopDrag),canvasResizeHandle[_0x2d60a8(0x193)](_0x2d60a8(0x1a9),startResize),document[_0x2d60a8(0x193)](_0x2d60a8(0x1a3),resize),document[_0x2d60a8(0x193)](_0x2d60a8(0x211),stopResize),Object[_0x2d60a8(0x21b)](sliders)[_0x2d60a8(0x218)](_0x406d39=>{const _0x5184c5=_0x2d60a8;sliders[_0x406d39][_0x5184c5(0x193)](_0x5184c5(0x235),_0x5893ec=>{const _0x4c7902=_0x5184c5;currentParams[_0x406d39]=parseInt(_0x5893ec[_0x4c7902(0x1f5)][_0x4c7902(0x155)]),sliderValues[_0x406d39]['textContent']=''+currentParams[_0x406d39];});}),document[_0x2d60a8(0x239)](_0x2d60a8(0x274))[_0x2d60a8(0x193)](_0x2d60a8(0x1f0),function(){const _0x4cab0d=_0x2d60a8,_0x4b6013=getSelectedCanvasSize();imageWidthInput[_0x4cab0d(0x155)]=_0x4b6013['width'],imageHeightInput['value']=_0x4b6013[_0x4cab0d(0x1b8)];}),addLog(_0x2d60a8(0x195)),updateButtonStatus();}function toggleDrawingMode(){const _0x4e1bde=_0x1fd5e3;isDrawingModeActive=!isDrawingModeActive,isDrawingModeActive?(toggleDrawingModeBtn[_0x4e1bde(0x1e1)]=_0x4e1bde(0x1c9),toggleDrawingModeBtn[_0x4e1bde(0x26e)]['remove']('bg-primary'),toggleDrawingModeBtn[_0x4e1bde(0x26e)][_0x4e1bde(0x22a)](_0x4e1bde(0x267)),floatToggleDrawingModeBtn[_0x4e1bde(0x1e1)]=_0x4e1bde(0x1c9),floatToggleDrawingModeBtn[_0x4e1bde(0x26e)][_0x4e1bde(0x22a)]('text-amber-300'),drawingModeIndicator[_0x4e1bde(0x26e)][_0x4e1bde(0x214)](_0x4e1bde(0x287)),addLog('已进入绘画模式，图片已锁定无法移动')):(toggleDrawingModeBtn[_0x4e1bde(0x1e1)]=_0x4e1bde(0x1e7),toggleDrawingModeBtn[_0x4e1bde(0x26e)][_0x4e1bde(0x214)](_0x4e1bde(0x267)),toggleDrawingModeBtn[_0x4e1bde(0x26e)]['add'](_0x4e1bde(0x1b5)),floatToggleDrawingModeBtn[_0x4e1bde(0x1e1)]=_0x4e1bde(0x1e7),floatToggleDrawingModeBtn['classList'][_0x4e1bde(0x214)](_0x4e1bde(0x227)),drawingModeIndicator['classList'][_0x4e1bde(0x22a)]('hidden'),addLog(_0x4e1bde(0x219))),updateCursorStyle();}function updateCursorStyle(){const _0xdaa926=_0x1fd5e3;if(isDrawingModeActive){if(currentTool===_0xdaa926(0x26b))canvas[_0xdaa926(0x160)][_0xdaa926(0x194)]=_0xdaa926(0x156),floatCanvas[_0xdaa926(0x160)]['cursor']=_0xdaa926(0x156);else{if(currentTool===_0xdaa926(0x17a))canvas[_0xdaa926(0x160)]['cursor']=_0xdaa926(0x27b),floatCanvas[_0xdaa926(0x160)][_0xdaa926(0x194)]=_0xdaa926(0x27b);else currentTool===_0xdaa926(0x151)&&(canvas[_0xdaa926(0x160)][_0xdaa926(0x194)]=_0xdaa926(0x151),floatCanvas['style'][_0xdaa926(0x194)]=_0xdaa926(0x151));}}else{if(shiftKeyPressed&&sourceImage)canvas[_0xdaa926(0x160)]['cursor']=_0xdaa926(0x1d4),floatCanvas[_0xdaa926(0x160)][_0xdaa926(0x194)]=_0xdaa926(0x1d4);else{if(currentTool==='pen')canvas[_0xdaa926(0x160)][_0xdaa926(0x194)]=_0xdaa926(0x156),floatCanvas[_0xdaa926(0x160)][_0xdaa926(0x194)]=_0xdaa926(0x156);else{if(currentTool===_0xdaa926(0x17a))canvas[_0xdaa926(0x160)][_0xdaa926(0x194)]=_0xdaa926(0x27b),floatCanvas['style'][_0xdaa926(0x194)]=_0xdaa926(0x27b);else currentTool===_0xdaa926(0x151)&&(canvas[_0xdaa926(0x160)][_0xdaa926(0x194)]='text',floatCanvas[_0xdaa926(0x160)][_0xdaa926(0x194)]=_0xdaa926(0x151));}}}}function setDrawingTool(_0x221abd){const _0x588903=_0x1fd5e3;currentTool=_0x221abd,[toolPen,toolEraser,toolText,toolClear][_0x588903(0x218)](_0x2da639=>{const _0x574955=_0x588903;_0x2da639[_0x574955(0x26e)]['remove']('active');});switch(_0x221abd){case'pen':toolPen[_0x588903(0x26e)][_0x588903(0x22a)](_0x588903(0x152)),currentToolEl[_0x588903(0x1af)]='画笔';break;case'eraser':toolEraser[_0x588903(0x26e)][_0x588903(0x22a)](_0x588903(0x152)),currentToolEl['textContent']=_0x588903(0x1c6);break;case _0x588903(0x151):toolText['classList']['add'](_0x588903(0x152)),currentToolEl[_0x588903(0x1af)]='文字';break;}currentSizeEl['textContent']=brushSize,drawingStatus[_0x588903(0x26e)][_0x588903(0x214)](_0x588903(0x287)),updateCursorStyle();}function setBrushColor(_0x4be102){const _0x9ac581=_0x1fd5e3;brushColor=_0x4be102,document[_0x9ac581(0x239)](_0x9ac581(0x224))[_0x9ac581(0x155)]=_0x4be102,addLog(_0x9ac581(0x28b)+_0x4be102);}function getCanvasCoordinates(_0x445e34,_0x25fa17,_0x3ec4d5=![]){const _0x12c73c=_0x1fd5e3,_0x28c13d=_0x445e34[_0x12c73c(0x281)](),_0x49932d=_0x445e34[_0x12c73c(0x241)]/_0x28c13d['width'],_0x47015a=_0x445e34[_0x12c73c(0x1b8)]/_0x28c13d[_0x12c73c(0x1b8)];let _0x41eb0c,_0x452e73;return _0x3ec4d5?(_0x41eb0c=(_0x25fa17['touches'][0x0][_0x12c73c(0x1ef)]-_0x28c13d[_0x12c73c(0x277)])*_0x49932d,_0x452e73=(_0x25fa17[_0x12c73c(0x260)][0x0]['clientY']-_0x28c13d[_0x12c73c(0x15c)])*_0x47015a):(_0x41eb0c=(_0x25fa17[_0x12c73c(0x1ef)]-_0x28c13d[_0x12c73c(0x277)])*_0x49932d,_0x452e73=(_0x25fa17['clientY']-_0x28c13d['top'])*_0x47015a),{'x':_0x41eb0c,'y':_0x452e73};}function isPointOnImage(_0x910dd4,_0x21f144){const _0x5d451c=_0x1fd5e3;if(!sourceImage)return![];const _0xf371ae=imageScale/0x64;let _0x255fd6=sourceImage[_0x5d451c(0x241)]*_0xf371ae,_0x5526ad=sourceImage['height']*_0xf371ae;return imageRotation%0xb4!==0x0&&([_0x255fd6,_0x5526ad]=[_0x5526ad,_0x255fd6]),_0x910dd4>=imageOffset['x']&&_0x910dd4<=imageOffset['x']+_0x255fd6&&_0x21f144>=imageOffset['y']&&_0x21f144<=imageOffset['y']+_0x5526ad;}function startDrawing(_0x19e931){const _0x2929c5=getCanvasCoordinates(canvas,_0x19e931);startDrawingCommon(_0x2929c5);}function startDrawingFloat(_0x2cf84b){const _0x23afc0=getCanvasCoordinates(floatCanvas,_0x2cf84b);startDrawingCommon(_0x23afc0);}function handleTouchStart(_0x352dca){const _0x59a15c=_0x1fd5e3;_0x352dca[_0x59a15c(0x182)]();if(_0x352dca[_0x59a15c(0x260)][_0x59a15c(0x220)]!==0x1)return;const _0x37f9f4=getCanvasCoordinates(canvas,_0x352dca,!![]);startDrawingCommon(_0x37f9f4);}function handleFloatTouchStart(_0x58a621){const _0x14707a=_0x1fd5e3;_0x58a621[_0x14707a(0x182)]();if(_0x58a621[_0x14707a(0x260)][_0x14707a(0x220)]!==0x1)return;const _0x10fb81=getCanvasCoordinates(floatCanvas,_0x58a621,!![]);startDrawingCommon(_0x10fb81);}function startDrawingCommon(_0x4eaf35){const _0x456517=_0x1fd5e3;lastX=_0x4eaf35['x'],lastY=_0x4eaf35['y'],isDrawing=!![];if(!isDrawingModeActive&&sourceImage&&(isPointOnImage(_0x4eaf35['x'],_0x4eaf35['y'])&&currentTool!=='text'))isDraggingImage=!![],dragStartPos={'x':_0x4eaf35['x'],'y':_0x4eaf35['y']},isDrawing=![],canvas['style'][_0x456517(0x194)]='move',floatCanvas[_0x456517(0x160)][_0x456517(0x194)]='move';else currentTool===_0x456517(0x151)&&(addTextToCanvas(_0x4eaf35['x'],_0x4eaf35['y']),isDrawing=![]);}function draw(_0x4a9278){const _0x1c8de9=getCanvasCoordinates(canvas,_0x4a9278);drawCommon(_0x1c8de9);}function drawFloat(_0x2cf787){const _0x147c30=getCanvasCoordinates(floatCanvas,_0x2cf787);drawCommon(_0x147c30);}function handleTouchMove(_0x14df94){const _0x4bc267=_0x1fd5e3;_0x14df94['preventDefault']();if(_0x14df94[_0x4bc267(0x260)][_0x4bc267(0x220)]!==0x1)return;const _0x560d4e=getCanvasCoordinates(canvas,_0x14df94,!![]);drawCommon(_0x560d4e);}function handleFloatTouchMove(_0x1e6d2){const _0x3c42b6=_0x1fd5e3;_0x1e6d2['preventDefault']();if(_0x1e6d2['touches'][_0x3c42b6(0x220)]!==0x1)return;const _0x330325=getCanvasCoordinates(floatCanvas,_0x1e6d2,!![]);drawCommon(_0x330325);}function drawCommon(_0x45081e){if(isDraggingImage&&!isDrawingModeActive){const _0x345baf=_0x45081e['x']-dragStartPos['x'],_0x514832=_0x45081e['y']-dragStartPos['y'];imageOffset['x']+=_0x345baf,imageOffset['y']+=_0x514832,dragStartPos=_0x45081e,redrawImageWithScaleAndOffset();return;}if(!isDrawing)return;drawOnCanvas(lastX,lastY,_0x45081e['x'],_0x45081e['y']),lastX=_0x45081e['x'],lastY=_0x45081e['y'],syncCanvases();}function stopDrawing(){isDrawing=![],isDraggingImage&&(isDraggingImage=![],updateCursorStyle());}function handleTouchEnd(){stopDrawing();}function drawOnCanvas(_0x1f88c7,_0x198f1d,_0x1805aa,_0x5cfd82){const _0x179108=_0x1fd5e3;ctx[_0x179108(0x1f4)](),ctx['lineCap']='round',ctx[_0x179108(0x1d6)]='round',ctx[_0x179108(0x229)]=brushSize;if(currentTool===_0x179108(0x26b))ctx[_0x179108(0x1ec)]=brushColor;else currentTool===_0x179108(0x17a)&&(ctx[_0x179108(0x1ec)]=_0x179108(0x250),ctx[_0x179108(0x229)]=brushSize*0x2);ctx['beginPath'](),ctx[_0x179108(0x198)](_0x1f88c7,_0x198f1d),ctx[_0x179108(0x288)](_0x1805aa,_0x5cfd82),ctx[_0x179108(0x223)](),ctx['restore']();}function addTextToCanvas(_0x4c5753,_0x5ecd07){const _0x10b94a=_0x1fd5e3,_0x3e0d3b=textInput[_0x10b94a(0x155)]||_0x10b94a(0x26a),_0x564d3e=parseInt(fontSizeInput['value']),_0x267f42=fontFamilySelect[_0x10b94a(0x155)];if(!_0x3e0d3b[_0x10b94a(0x1cb)]())return;ctx['save'](),ctx[_0x10b94a(0x24a)]=_0x564d3e+'px\x20'+_0x267f42,ctx[_0x10b94a(0x226)]=brushColor,ctx[_0x10b94a(0x26c)]=_0x10b94a(0x15c),ctx[_0x10b94a(0x25e)](_0x3e0d3b,_0x4c5753,_0x5ecd07),ctx[_0x10b94a(0x1c7)](),syncCanvases(),addLog('已添加文字:\x20\x22'+_0x3e0d3b+'\x22');}function addTextManually(){const _0x376528=_0x1fd5e3;setDrawingTool(_0x376528(0x151));if(textInput['value'][_0x376528(0x1cb)]()){const _0x5ef058=getSelectedCanvasSize(),_0x3c842e=_0x5ef058[_0x376528(0x241)]/0x2,_0x817683=_0x5ef058[_0x376528(0x1b8)]/0x2;addTextToCanvas(_0x3c842e,_0x817683);}else addLog('请先输入要添加的文字');}function clearCanvas(){const _0x10bcb5=_0x1fd5e3;confirm(_0x10bcb5(0x275))&&(ctx['save'](),ctx[_0x10bcb5(0x226)]=_0x10bcb5(0x250),ctx[_0x10bcb5(0x1b3)](0x0,0x0,canvas['width'],canvas[_0x10bcb5(0x1b8)]),ctx[_0x10bcb5(0x1c7)](),syncCanvases(),addLog(_0x10bcb5(0x23d)));}function syncCanvases(){const _0x114e7c=_0x1fd5e3;floatCtx[_0x114e7c(0x215)](0x0,0x0,floatCanvas[_0x114e7c(0x241)],floatCanvas['height']),floatCtx[_0x114e7c(0x271)](canvas,0x0,0x0);}function changeImageScale(_0x5232c5){const _0x4f47f7=_0x1fd5e3;if(!sourceImage)return;imageScale=Math[_0x4f47f7(0x282)](0x0,Math[_0x4f47f7(0x1c0)](0x3e8,imageScale+_0x5232c5)),imageScaleSlider[_0x4f47f7(0x155)]=imageScale,updateImageScale();}function updateImageScale(){const _0x380fd0=_0x1fd5e3;if(!sourceImage)return;imageScale=parseInt(imageScaleSlider['value']),imageScaleValue[_0x380fd0(0x1af)]=imageScale+'%',redrawImageWithScaleAndOffset();}function redrawImageWithScaleAndOffset(){const _0x118ab5=_0x1fd5e3;if(!sourceImage)return;ctx[_0x118ab5(0x226)]=_0x118ab5(0x250),ctx['fillRect'](0x0,0x0,canvas[_0x118ab5(0x241)],canvas['height']);const _0x58dd47=imageScale/0x64;let _0x418afb=sourceImage[_0x118ab5(0x241)]*_0x58dd47,_0x37b1c8=sourceImage[_0x118ab5(0x1b8)]*_0x58dd47;ctx['save'](),ctx[_0x118ab5(0x234)](imageOffset['x']+_0x418afb/0x2,imageOffset['y']+_0x37b1c8/0x2),ctx['rotate'](imageRotation*Math['PI']/0xb4),ctx['drawImage'](sourceImage,-_0x418afb/0x2,-_0x37b1c8/0x2,_0x418afb,_0x37b1c8),ctx['restore'](),syncCanvases();}function fitImageToCanvas(){const _0x66c925=_0x1fd5e3;if(!sourceImage)return;const _0x3a551e=getSelectedCanvasSize();let _0x215279=_0x3a551e[_0x66c925(0x241)],_0x43751a=_0x3a551e[_0x66c925(0x1b8)];const _0x39300a=_0x215279/sourceImage[_0x66c925(0x241)],_0x57f1e9=_0x43751a/sourceImage['height'],_0x255b07=Math[_0x66c925(0x1c0)](_0x39300a,_0x57f1e9);imageScale=_0x255b07*0x64,imageScaleSlider[_0x66c925(0x155)]=imageScale,imageScaleValue[_0x66c925(0x1af)]=imageScale[_0x66c925(0x14b)](0x0)+'%',imageOffset['x']=(_0x215279-sourceImage[_0x66c925(0x241)]*_0x255b07)/0x2,imageOffset['y']=(_0x43751a-sourceImage[_0x66c925(0x1b8)]*_0x255b07)/0x2,redrawImageWithScaleAndOffset(),addLog(_0x66c925(0x183));}function fillCanvas(){const _0x59b4e4=_0x1fd5e3;if(!sourceImage)return;const _0x5f0fd6=getSelectedCanvasSize();let _0x350b84=_0x5f0fd6['width'],_0x6948b0=_0x5f0fd6[_0x59b4e4(0x1b8)];const _0x155be8=_0x350b84/sourceImage[_0x59b4e4(0x241)],_0x240418=_0x6948b0/sourceImage[_0x59b4e4(0x1b8)];imageScale=Math[_0x59b4e4(0x282)](_0x155be8,_0x240418)*0x64,imageScaleSlider[_0x59b4e4(0x155)]=imageScale,imageScaleValue[_0x59b4e4(0x1af)]=imageScale[_0x59b4e4(0x14b)](0x0)+'%',imageOffset['x']=0x0,imageOffset['y']=0x0,redrawImageWithScaleAndOffset(),addLog(_0x59b4e4(0x265));}function centerImageOnCanvas(){const _0x47b526=_0x1fd5e3;if(!sourceImage)return;const _0x4f1603=getSelectedCanvasSize();let _0x598ea4=_0x4f1603[_0x47b526(0x241)],_0xf58176=_0x4f1603[_0x47b526(0x1b8)];const _0x4722e9=imageScale/0x64;let _0x70120c=sourceImage[_0x47b526(0x241)]*_0x4722e9,_0x343ca5=sourceImage[_0x47b526(0x1b8)]*_0x4722e9;imageRotation%0xb4!==0x0&&([_0x70120c,_0x343ca5]=[_0x343ca5,_0x70120c]),imageOffset['x']=(_0x598ea4-_0x70120c)/0x2,imageOffset['y']=(_0xf58176-_0x343ca5)/0x2,redrawImageWithScaleAndOffset(),addLog('图片已居中显示');}function rotateImage(_0x4d983e){const _0x15a185=_0x1fd5e3;if(!sourceImage){addLog(_0x15a185(0x1fb));return;}imageRotation=(imageRotation+_0x4d983e)%0x168,redrawImageWithScaleAndOffset(),addLog(_0x15a185(0x1e3)+imageRotation+'°');}function resizeImage(_0x341a41,_0x2bfc82){const _0x25dd46=_0x1fd5e3;if(!sourceImage||!originalImage)return;const _0x2e8934=originalImage[_0x25dd46(0x241)]/originalImage[_0x25dd46(0x1b8)];let _0x48e38d=sourceImage[_0x25dd46(0x241)]+_0x341a41,_0x4b49e8=sourceImage[_0x25dd46(0x1b8)]+_0x2bfc82;_0x48e38d=Math[_0x25dd46(0x282)](0x32,_0x48e38d),_0x4b49e8=Math[_0x25dd46(0x282)](0x32,_0x4b49e8),imageWidthInput[_0x25dd46(0x155)]=Math[_0x25dd46(0x278)](_0x48e38d),imageHeightInput[_0x25dd46(0x155)]=Math['round'](_0x4b49e8);const _0x5a4412=new Image();_0x5a4412[_0x25dd46(0x16e)]=function(){const _0x17224b=_0x25dd46;sourceImage=_0x5a4412,redrawImageWithScaleAndOffset(),addLog('图片尺寸已调整为:\x20'+_0x48e38d+_0x17224b(0x177)+_0x4b49e8);};const _0x415cb9=document[_0x25dd46(0x284)]('canvas');_0x415cb9[_0x25dd46(0x241)]=_0x48e38d,_0x415cb9['height']=_0x4b49e8;const _0x1d2369=_0x415cb9[_0x25dd46(0x174)]('2d');_0x1d2369[_0x25dd46(0x271)](originalImage,0x0,0x0,_0x48e38d,_0x4b49e8),_0x5a4412[_0x25dd46(0x254)]=_0x415cb9[_0x25dd46(0x199)]();}function applyImageDimensions(){const _0x2814ce=_0x1fd5e3,_0x13f544=parseInt(imageWidthInput[_0x2814ce(0x155)]),_0xd5dab1=parseInt(imageHeightInput['value']);if(isNaN(_0x13f544)||isNaN(_0xd5dab1)||_0x13f544<0x32||_0xd5dab1<0x32){addLog(_0x2814ce(0x1fc));return;}if(originalImage){const _0x575da3=new Image();_0x575da3[_0x2814ce(0x16e)]=function(){const _0x4a6c0a=_0x2814ce;sourceImage=_0x575da3,fitImageToCanvas(),addLog(_0x4a6c0a(0x1d2)+_0x13f544+_0x4a6c0a(0x177)+_0xd5dab1);};const _0x1f416a=document['createElement'](_0x2814ce(0x1ca));_0x1f416a[_0x2814ce(0x241)]=_0x13f544,_0x1f416a[_0x2814ce(0x1b8)]=_0xd5dab1;const _0x2d8caa=_0x1f416a['getContext']('2d');_0x2d8caa[_0x2814ce(0x271)](originalImage,0x0,0x0,_0x13f544,_0xd5dab1),_0x575da3[_0x2814ce(0x254)]=_0x1f416a[_0x2814ce(0x199)]();}else addLog(_0x2814ce(0x1d2)+_0x13f544+_0x2814ce(0x177)+_0xd5dab1);}function handleImageUpload(_0x3501c8){const _0x242566=_0x1fd5e3,_0xf703dd=_0x3501c8[_0x242566(0x1f5)]['files'][0x0];if(!_0xf703dd)return;document[_0x242566(0x239)](_0x242566(0x23f))[_0x242566(0x1af)]='文件名:\x20'+_0xf703dd[_0x242566(0x1d0)]+'\x20('+formatFileSize(_0xf703dd['size'])+')',document[_0x242566(0x239)](_0x242566(0x23f))['classList'][_0x242566(0x214)](_0x242566(0x287));const _0x5539b7=new FileReader();_0x5539b7['onload']=function(_0x109554){const _0x272df8=_0x242566,_0x3ca7a9=new Image();_0x3ca7a9[_0x272df8(0x16e)]=function(){const _0xfaffd=_0x272df8;originalImage=new Image(),originalImage['src']=_0x3ca7a9['src'],sourceImage=new Image(),sourceImage['src']=_0x3ca7a9[_0xfaffd(0x254)],imageRotation=0x0,imageWidthInput[_0xfaffd(0x155)]=_0x3ca7a9[_0xfaffd(0x241)],imageHeightInput[_0xfaffd(0x155)]=_0x3ca7a9[_0xfaffd(0x1b8)],fitImageToCanvas(),saveOriginalCanvasState(),addLog(_0xfaffd(0x15b)+_0xf703dd[_0xfaffd(0x1d0)]),addLog(_0xfaffd(0x212)+_0x3ca7a9[_0xfaffd(0x241)]+_0xfaffd(0x177)+_0x3ca7a9[_0xfaffd(0x1b8)]),addLog(_0xfaffd(0x18d)),updateCanvasVisibility();},_0x3ca7a9[_0x272df8(0x254)]=_0x109554[_0x272df8(0x1f5)][_0x272df8(0x166)];},_0x5539b7['readAsDataURL'](_0xf703dd);}function saveOriginalCanvasState(){const _0xa824f2=_0x1fd5e3,_0x5f2b4b=getSelectedCanvasSize();originalCanvasData=ctx[_0xa824f2(0x27a)](0x0,0x0,_0x5f2b4b['width'],_0x5f2b4b['height']);}function clearLog(){const _0x33c2bc=_0x1fd5e3;logContainer['innerHTML']=_0x33c2bc(0x255),addLog(_0x33c2bc(0x150));}function preConnect(){const _0x1ee312=_0x1fd5e3;if(gattServer!=null&&gattServer[_0x1ee312(0x1bd)])bleDevice!=null&&bleDevice[_0x1ee312(0x245)][_0x1ee312(0x1bd)]&&(addLog(_0x1ee312(0x162)+(bleDevice['name']||_0x1ee312(0x169))+_0x1ee312(0x185)),bleDevice[_0x1ee312(0x245)][_0x1ee312(0x164)]());else{resetBluetoothVariables();try{navigator['bluetooth'][_0x1ee312(0x1ce)]({'filters':[{'namePrefix':'NRF_'}],'optionalServices':[_0x1ee312(0x17e)]})[_0x1ee312(0x1f8)](_0x1a0cf6=>{const _0x1275b9=_0x1ee312;addLog(_0x1275b9(0x1fd)+(_0x1a0cf6[_0x1275b9(0x1d0)]||'NRF设备(未知名称)')),bleDevice=_0x1a0cf6,bleDevice['addEventListener'](_0x1275b9(0x18b),disconnect),setTimeout(()=>connect(),0x12c);})[_0x1ee312(0x273)](_0xf1045f=>{const _0x12d644=_0x1ee312;addLog('蓝牙设备选择失败:\x20'+_0xf1045f['message']),_0xf1045f[_0x12d644(0x1d0)]===_0x12d644(0x17f)&&addLog('未找到NRF前缀的蓝牙设备，请确认设备已开启');});}catch(_0x55fd38){addLog('蓝牙操作异常:\x20'+_0x55fd38[_0x1ee312(0x23b)]),addLog(_0x1ee312(0x243));}}}async function connect(){const _0x2f6a8e=_0x1fd5e3;if(!bleDevice){addLog('连接失败:\x20未选择蓝牙设备');return;}if(epdCharacteristic){addLog('已经连接到设备，无需重复连接');return;}try{addLog(_0x2f6a8e(0x1e5)+(bleDevice['name']||_0x2f6a8e(0x1df))),gattServer=await bleDevice[_0x2f6a8e(0x245)][_0x2f6a8e(0x1aa)](),epdService=await gattServer[_0x2f6a8e(0x1ea)](_0x2f6a8e(0x17e)),epdCharacteristic=await epdService[_0x2f6a8e(0x161)](_0x2f6a8e(0x184)),addLog('已成功连接到设备！'),await epdCharacteristic[_0x2f6a8e(0x1e2)](),epdCharacteristic[_0x2f6a8e(0x193)](_0x2f6a8e(0x22f),_0xfb18b2=>{const _0xabb2ff=_0x2f6a8e;handleNotify(_0xfb18b2[_0xabb2ff(0x1f5)]['value']);}),await write(EpdCmd[_0x2f6a8e(0x202)]),document[_0x2f6a8e(0x239)]('connectbutton')[_0x2f6a8e(0x1e1)]=_0x2f6a8e(0x1c2),updateButtonStatus();}catch(_0x9a1a86){addLog(_0x2f6a8e(0x1a4)+_0x9a1a86['message']),disconnect();}}function disconnect(){const _0x252393=_0x1fd5e3;bleDevice&&bleDevice[_0x252393(0x245)]['connected']&&bleDevice['gatt'][_0x252393(0x164)](),resetBluetoothVariables(),addLog(_0x252393(0x1c4)),document[_0x252393(0x239)](_0x252393(0x1a2))['innerHTML']=_0x252393(0x28d),updateButtonStatus();}function resetBluetoothVariables(){gattServer=null,epdService=null,epdCharacteristic=null,msgIndex=0x0;}async function write(_0x4c03a3,_0x4eb11b,_0x5e0067=!![]){const _0x2fad15=_0x1fd5e3;if(!epdCharacteristic)return addLog('未连接蓝牙设备'),![];let _0x5c1c55=[_0x4c03a3];if(_0x4eb11b){if(typeof _0x4eb11b=='string')_0x4eb11b=hex2bytes(_0x4eb11b);if(_0x4eb11b instanceof Uint8Array)_0x4eb11b=Array[_0x2fad15(0x16a)](_0x4eb11b);_0x5c1c55['push'](..._0x4eb11b);}try{if(_0x5e0067)await epdCharacteristic['writeValueWithResponse'](Uint8Array[_0x2fad15(0x16a)](_0x5c1c55));else await epdCharacteristic[_0x2fad15(0x175)](Uint8Array[_0x2fad15(0x16a)](_0x5c1c55));}catch(_0x245e08){return addLog(_0x2fad15(0x264)+_0x245e08[_0x2fad15(0x23b)]),![];}return!![];}async function writeImage(_0x42b84f,_0x1f1251='bw'){const _0x59df2b=_0x1fd5e3,_0x5bd7cf=document[_0x59df2b(0x239)](_0x59df2b(0x217))[_0x59df2b(0x155)]-0x2,_0x55a92e=document[_0x59df2b(0x239)]('interleavedcount')[_0x59df2b(0x155)],_0x4d0b4e=Math[_0x59df2b(0x26d)](_0x42b84f[_0x59df2b(0x220)]/_0x5bd7cf);let _0x320076=0x0,_0x3cd836=_0x55a92e;const _0x2a83af=getSelectedCanvasSize();for(let _0x10d59a=0x0;_0x10d59a<_0x42b84f[_0x59df2b(0x220)];_0x10d59a+=_0x5bd7cf){let _0x24b3d3=(new Date()[_0x59df2b(0x210)]()-startTime)/0x3e8;addLog((_0x1f1251=='bw'?'黑白':'红色')+_0x59df2b(0x201)+(_0x320076+0x1)+'/'+_0x4d0b4e+_0x59df2b(0x27e)+_0x24b3d3[_0x59df2b(0x14b)](0x1)+'s');const _0x46c8b9=[(_0x1f1251=='bw'?0xf:0x0)|(_0x10d59a==0x0?0x0:0xf0),..._0x42b84f[_0x59df2b(0x1a1)](_0x10d59a,_0x10d59a+_0x5bd7cf)];_0x3cd836>0x0?(await write(EpdCmd[_0x59df2b(0x189)],_0x46c8b9,![]),_0x3cd836--):(await write(EpdCmd[_0x59df2b(0x189)],_0x46c8b9,!![]),_0x3cd836=_0x55a92e),_0x320076++;}}function downloadImageFile(){const _0x194740=_0x1fd5e3;if(!checkCanvasHasContent(canvas)){addLog(_0x194740(0x258));return;}const _0xe2f366=getSelectedCanvasSize(),{width:_0xe2a8a,height:_0x54c706}=getEffectiveCanvasSize(_0xe2f366),_0x2efb87=getRotatedImageData(canvas,_0xe2f366,imageRotation),_0x527691=ditherMode[_0x194740(0x155)],_0x20a674=processImageData(_0x2efb87,_0x527691,_0xe2a8a,_0x54c706),_0x2ddb63=_0x20a674[_0x194740(0x220)],_0x39057b=(_0x2ddb63/0x400)[_0x194740(0x14b)](0x2),_0x684ce5=_0xe2a8a*_0x54c706,_0x48a736=_0x20a674[_0x194740(0x16c)](_0x7cedb9=>_0x7cedb9[_0x194740(0x233)](0x10)[_0x194740(0x1c8)](0x2,'0'))[_0x194740(0x23a)]('\x20'),_0x42e5fe=new Blob([_0x48a736],{'type':_0x194740(0x154)}),_0x30d284=URL[_0x194740(0x1ba)](_0x42e5fe),_0x122c02=document['createElement']('a');_0x122c02['href']=_0x30d284,_0x122c02[_0x194740(0x25a)]=_0x194740(0x261)+new Date()[_0x194740(0x210)]()+_0x194740(0x25f),document[_0x194740(0x207)][_0x194740(0x268)](_0x122c02),_0x122c02[_0x194740(0x19b)](),setTimeout(()=>{const _0x357df6=_0x194740;document[_0x357df6(0x207)][_0x357df6(0x25c)](_0x122c02),URL[_0x357df6(0x1f3)](_0x30d284);},0x0),addLog(_0x194740(0x221)+_0x2ddb63+_0x194740(0x22b)+_0x39057b+'\x20KB)，像素:\x20'+_0x684ce5);}function showTimeDialog(){const _0x3e2c93=_0x1fd5e3;if(!epdCharacteristic){addLog('请先连接蓝牙设备！');return;}const _0xc38522=new Date(),_0x4eb733=new Date(_0xc38522[_0x3e2c93(0x210)]()-_0xc38522[_0x3e2c93(0x15f)]()*0xea60)[_0x3e2c93(0x285)]()['slice'](0x0,0x10);datetimeInput[_0x3e2c93(0x155)]=_0x4eb733,timeDialog[_0x3e2c93(0x26e)][_0x3e2c93(0x214)](_0x3e2c93(0x287));}function hideTimeDialog(){const _0xcb9830=_0x1fd5e3;timeDialog[_0xcb9830(0x26e)][_0xcb9830(0x22a)](_0xcb9830(0x287));}async function setTime(){const _0x3ad0fd=_0x1fd5e3;if(!epdCharacteristic){addLog(_0x3ad0fd(0x1f2)),hideTimeDialog();return;}const _0x1986ed=datetimeInput['value'];if(!_0x1986ed){addLog('请选择日期和时间');return;}const _0x445840=new Date(_0x1986ed),_0x236787=Math['floor'](_0x445840[_0x3ad0fd(0x210)]()/0x3e8),_0x143586=[_0x236787>>0x18&0xff,_0x236787>>0x10&0xff,_0x236787>>0x8&0xff,_0x236787&0xff];try{setStatus('正在设置时间...'),statusContainer[_0x3ad0fd(0x160)][_0x3ad0fd(0x244)]='block',await write(EpdCmd[_0x3ad0fd(0x1d5)],_0x143586),addLog(_0x3ad0fd(0x1d9)+_0x445840[_0x3ad0fd(0x256)]()),addLog(_0x3ad0fd(0x25d)+_0x236787+_0x3ad0fd(0x18f)+_0x236787[_0x3ad0fd(0x233)](0x10)['toUpperCase']()+')'),setTimeout(()=>{const _0x4475e6=_0x3ad0fd;statusContainer['style'][_0x4475e6(0x244)]=_0x4475e6(0x1ae);},0x7d0);}catch(_0x4b84e6){addLog(_0x3ad0fd(0x186)+_0x4b84e6[_0x3ad0fd(0x23b)]);}finally{hideTimeDialog();}}async function setClockMode(){const _0x178af1=_0x1fd5e3;if(!epdCharacteristic){addLog('请先连接蓝牙设备！');return;}try{setStatus(_0x178af1(0x1cd)),statusContainer[_0x178af1(0x160)][_0x178af1(0x244)]=_0x178af1(0x15e),await write(EpdCmd[_0x178af1(0x225)],[DisplayMode[_0x178af1(0x18c)]]),currentMode='clock',addLog(_0x178af1(0x1f6)),setTimeout(()=>{const _0x488705=_0x178af1;statusContainer[_0x488705(0x160)][_0x488705(0x244)]=_0x488705(0x1ae);},0x7d0);}catch(_0x34ae8e){addLog('切换模式失败:\x20'+_0x34ae8e[_0x178af1(0x23b)]);}}async function setCalendarMode(){const _0x22f248=_0x1fd5e3;if(!epdCharacteristic){addLog(_0x22f248(0x1f2));return;}try{setStatus(_0x22f248(0x1f7)),statusContainer[_0x22f248(0x160)][_0x22f248(0x244)]='block',await write(EpdCmd[_0x22f248(0x225)],[DisplayMode[_0x22f248(0x270)]]),currentMode=_0x22f248(0x283),addLog(_0x22f248(0x1db)),setTimeout(()=>{const _0x4f949d=_0x22f248;statusContainer[_0x4f949d(0x160)][_0x4f949d(0x244)]=_0x4f949d(0x1ae);},0x7d0);}catch(_0xaac321){addLog(_0x22f248(0x1e9)+_0xaac321[_0x22f248(0x23b)]);}}async function clearScreen(){const _0x31a2e8=_0x1fd5e3;if(!epdCharacteristic){addLog(_0x31a2e8(0x1f2));return;}if(!confirm(_0x31a2e8(0x1dd)))return;try{setStatus(_0x31a2e8(0x206)),statusContainer['style']['display']='block',await write(EpdCmd[_0x31a2e8(0x1ed)]),await write(EpdCmd['REFRESH']),addLog('已清空墨水屏显示内容'),setTimeout(()=>{const _0xdc761b=_0x31a2e8;statusContainer[_0xdc761b(0x160)][_0xdc761b(0x244)]=_0xdc761b(0x1ae);},0x7d0);}catch(_0x5134ff){addLog('清空屏幕失败:\x20'+_0x5134ff['message']);}}function getEffectiveCanvasSize(_0x2ec1e9){let _0x18707e=_0x2ec1e9['width'],_0x139ef6=_0x2ec1e9['height'];return imageRotation%0xb4!==0x0&&([_0x18707e,_0x139ef6]=[_0x139ef6,_0x18707e]),{'width':_0x18707e,'height':_0x139ef6};}function getRotatedImageData(_0x49a632,_0x2aaa6d,_0x3034e7){const _0x568c77=_0x1fd5e3,_0x145ebb=document[_0x568c77(0x284)](_0x568c77(0x1ca)),_0x4028d7=_0x145ebb[_0x568c77(0x174)]('2d'),{width:_0x2eac2f,height:_0x24fc28}=getEffectiveCanvasSize(_0x2aaa6d);_0x145ebb['width']=_0x2eac2f,_0x145ebb['height']=_0x24fc28,_0x4028d7['save']();if(_0x3034e7===0x5a)_0x4028d7[_0x568c77(0x234)](_0x2eac2f,0x0),_0x4028d7[_0x568c77(0x28c)](Math['PI']/0x2);else{if(_0x3034e7===0xb4)_0x4028d7['translate'](_0x2eac2f,_0x24fc28),_0x4028d7[_0x568c77(0x28c)](Math['PI']);else _0x3034e7===0x10e&&(_0x4028d7['translate'](0x0,_0x24fc28),_0x4028d7[_0x568c77(0x28c)](0x3*Math['PI']/0x2));}return _0x4028d7[_0x568c77(0x271)](_0x49a632,0x0,0x0),_0x4028d7[_0x568c77(0x1c7)](),_0x4028d7[_0x568c77(0x27a)](0x0,0x0,_0x2eac2f,_0x24fc28);}function getDitherAlgorithmName(_0x1e7e23){const _0x3045d1=_0x1fd5e3,_0x27d42d={'floydSteinberg':_0x3045d1(0x179),'atkinson':_0x3045d1(0x1cf),'bayer':'Bayer','stucki':_0x3045d1(0x272),'jarvis':_0x3045d1(0x1d1)};return _0x27d42d[_0x1e7e23]||_0x1e7e23;}function setDitherMode(_0x5e0698){const _0x1dfb66=_0x1fd5e3;ditherMode['value']=_0x5e0698,addLog('已选择'+(_0x5e0698===_0x1dfb66(0x1cc)?'黑白':'黑白红')+'模式');}function onDitherAlgChange(_0x2e2316){const _0x418ef6=_0x1fd5e3;currentParams[_0x418ef6(0x1b7)]=_0x2e2316[_0x418ef6(0x1f5)]['value'],addLog('已选择'+getDitherAlgorithmName(currentParams[_0x418ef6(0x1b7)])+_0x418ef6(0x205));}function getSelectedCanvasSize(){const _0x19f3d0=_0x1fd5e3,_0x5b7bb8=document[_0x19f3d0(0x239)](_0x19f3d0(0x274))[_0x19f3d0(0x155)];return canvasSizes[_0x19f3d0(0x262)](_0x4e860c=>_0x4e860c[_0x19f3d0(0x1d0)]===_0x5b7bb8)||canvasSizes[0x1];}let originalImageData=null;function updateCanvasSize(_0x49c791=![]){const _0x48756d=_0x1fd5e3,_0x5376d4=getSelectedCanvasSize(),_0x527b30=checkCanvasHasContent(canvas);imageWidthInput[_0x48756d(0x155)]=_0x5376d4[_0x48756d(0x241)],imageHeightInput[_0x48756d(0x155)]=_0x5376d4[_0x48756d(0x1b8)],canvas[_0x48756d(0x241)]=_0x5376d4['width'],canvas[_0x48756d(0x1b8)]=_0x5376d4[_0x48756d(0x1b8)],floatCanvas[_0x48756d(0x241)]=_0x5376d4[_0x48756d(0x241)],floatCanvas[_0x48756d(0x1b8)]=_0x5376d4[_0x48756d(0x1b8)],_0x49c791&&_0x527b30?originalCanvasData&&ctx[_0x48756d(0x1eb)](originalCanvasData,0x0,0x0):(ctx[_0x48756d(0x226)]=_0x48756d(0x250),ctx['fillRect'](0x0,0x0,_0x5376d4[_0x48756d(0x241)],_0x5376d4[_0x48756d(0x1b8)])),syncCanvases(),processedImageInfo[_0x48756d(0x1af)]=_0x5376d4[_0x48756d(0x241)]+_0x48756d(0x177)+_0x5376d4[_0x48756d(0x1b8)]+_0x48756d(0x15d),updateCanvasVisibility();}function updateDitcherOptions(){const _0x2b208e=_0x1fd5e3,_0x50d8a7=document[_0x2b208e(0x239)](_0x2b208e(0x27d)),_0x1683c4=_0x50d8a7[_0x2b208e(0x228)][_0x50d8a7['selectedIndex']],_0x1cb90c=_0x1683c4[_0x2b208e(0x191)](_0x2b208e(0x14d)),_0x693589=_0x1683c4['getAttribute']('data-size');if(_0x1cb90c)ditherMode[_0x2b208e(0x155)]=_0x1cb90c;if(_0x693589){const _0x4d36dd=canvasSizes[_0x2b208e(0x16d)](_0x51bc34=>_0x51bc34[_0x2b208e(0x1d0)]===_0x693589);_0x4d36dd&&(document['getElementById']('canvasSize')['value']=_0x693589);}updateCanvasSize(!![]);}function processImage(){const _0x3c624b=_0x1fd5e3;saveOriginalCanvasState(),addLog(_0x3c624b(0x291)+getDitherAlgorithmName(currentParams[_0x3c624b(0x1b7)])+'算法...');const _0x33fae9=getSelectedCanvasSize();let _0xe5fe7c=ctx[_0x3c624b(0x27a)](0x0,0x0,_0x33fae9[_0x3c624b(0x241)],_0x33fae9['height']);_0xe5fe7c=adjustImageParameters(_0xe5fe7c,currentParams);const _0x367425=ditherMode[_0x3c624b(0x155)];let _0x1dce57;const _0x3c3deb=window[_0x3c624b(0x276)](_0xe5fe7c,document[_0x3c624b(0x239)](_0x3c624b(0x1da))[_0x3c624b(0x155)],document[_0x3c624b(0x239)](_0x3c624b(0x248))[_0x3c624b(0x155)],document[_0x3c624b(0x239)](_0x3c624b(0x176))['value'],document[_0x3c624b(0x239)](_0x3c624b(0x14f))['value']/0xa,_0x367425,document[_0x3c624b(0x239)](_0x3c624b(0x1b7))[_0x3c624b(0x155)]);ctx[_0x3c624b(0x1eb)](_0x3c3deb,0x0,0x0),syncCanvases(),processedImageInfo[_0x3c624b(0x1af)]=_0x33fae9[_0x3c624b(0x241)]+_0x3c624b(0x177)+_0x33fae9[_0x3c624b(0x1b8)]+_0x3c624b(0x21d)+(_0x367425===_0x3c624b(0x1cc)?'黑白':_0x3c624b(0x1a8))+')',addLog(_0x3c624b(0x187)),updateCanvasVisibility();}async function sendimg(){const _0x573d64=_0x1fd5e3,_0x3c5520=document[_0x573d64(0x239)]('canvasSize')['value'],_0xf5dfb0=document[_0x573d64(0x239)](_0x573d64(0x172))['value'],_0x18d0a1=document['getElementById'](_0x573d64(0x27d)),_0x5e13ff=_0x18d0a1[_0x573d64(0x228)][_0x18d0a1[_0x573d64(0x1fa)]];startTime=new Date()['getTime']();const _0x4500e5=document['getElementById']('status');_0x4500e5[_0x573d64(0x231)][_0x573d64(0x160)]['display']=_0x573d64(0x15e);const _0x1b1a04=ctx[_0x573d64(0x27a)](0x0,0x0,canvas['width'],canvas[_0x573d64(0x1b8)]),_0x138b72=processImageData(_0x1b1a04,_0xf5dfb0);updateButtonStatus(!![]);if(_0xf5dfb0===_0x573d64(0x14a))await writeImage(_0x138b72,_0x573d64(0x1c1));else{if(_0xf5dfb0===_0x573d64(0x21e)){const _0x40a0af=Math[_0x573d64(0x170)](_0x138b72[_0x573d64(0x220)]/0x2);await writeImage(_0x138b72[_0x573d64(0x1a1)](0x0,_0x40a0af),'bw'),await writeImage(_0x138b72[_0x573d64(0x1a1)](_0x40a0af),_0x573d64(0x1ad));}else{if(_0xf5dfb0==='blackWhiteColor')await writeImage(_0x138b72,'bw');else{updateButtonStatus();return;}}}await write(EpdCmd[_0x573d64(0x1c3)]),updateButtonStatus();const _0x3ac6c4=(new Date()['getTime']()-startTime)/0x3e8;addLog('发送完成！耗时:\x20'+_0x3ac6c4+'s'),setTimeout(()=>{const _0x5aaac0=_0x573d64;_0x4500e5[_0x5aaac0(0x231)][_0x5aaac0(0x160)]['display']=_0x5aaac0(0x1ae);},0x1388);}function adjustImageParameters(_0x50a635,_0x1a1bea){const _0x5a3a75=_0x1fd5e3,_0x48ef70=_0x50a635[_0x5a3a75(0x279)],_0x162d8b=_0x1a1bea['saturation']/0x64,_0x56b6b3=_0x1a1bea['brightness']/0x64,_0x4ee741=_0x1a1bea['contrast']/0x64,_0x286a2c=_0x1a1bea[_0x5a3a75(0x14f)]/0x64,_0x211165=_0x4ee741!==0x0?0x103*(_0x4ee741+0xff)/(0xff*(0x103-_0x4ee741)):0x1,_0x55982b=new Uint8ClampedArray(_0x48ef70);for(let _0x4678af=0x0;_0x4678af<_0x48ef70['length'];_0x4678af+=0x4){let _0x42f74a=Math['min'](0xff,Math['max'](0x0,_0x55982b[_0x4678af]*_0x56b6b3)),_0x17f892=Math[_0x5a3a75(0x1c0)](0xff,Math[_0x5a3a75(0x282)](0x0,_0x55982b[_0x4678af+0x1]*_0x56b6b3)),_0x3703d9=Math['min'](0xff,Math[_0x5a3a75(0x282)](0x0,_0x55982b[_0x4678af+0x2]*_0x56b6b3));_0x42f74a=Math['min'](0xff,Math[_0x5a3a75(0x282)](0x0,_0x211165*(_0x42f74a-0x80)+0x80)),_0x17f892=Math[_0x5a3a75(0x1c0)](0xff,Math[_0x5a3a75(0x282)](0x0,_0x211165*(_0x17f892-0x80)+0x80)),_0x3703d9=Math[_0x5a3a75(0x1c0)](0xff,Math[_0x5a3a75(0x282)](0x0,_0x211165*(_0x3703d9-0x80)+0x80));const _0x2facd6=0.299*_0x42f74a+0.587*_0x17f892+0.114*_0x3703d9;_0x42f74a=Math[_0x5a3a75(0x1c0)](0xff,Math['max'](0x0,_0x2facd6+_0x162d8b*(_0x42f74a-_0x2facd6))),_0x17f892=Math[_0x5a3a75(0x1c0)](0xff,Math[_0x5a3a75(0x282)](0x0,_0x2facd6+_0x162d8b*(_0x17f892-_0x2facd6))),_0x3703d9=Math[_0x5a3a75(0x1c0)](0xff,Math['max'](0x0,_0x2facd6+_0x162d8b*(_0x3703d9-_0x2facd6)));if(_0x286a2c>0x0){const _0x4e0ea5=_0x50a635[_0x5a3a75(0x241)],_0x59c0ed=_0x4678af/0x4%_0x4e0ea5,_0x1cb87f=Math['floor'](_0x4678af/0x4/_0x4e0ea5);if(_0x59c0ed>0x0&&_0x1cb87f>0x0){const _0x51770c=_0x4678af-0x4*(_0x4e0ea5+0x1);_0x42f74a=Math['floor'](_0x42f74a*(0x1-_0x286a2c)+_0x55982b[_0x51770c]*_0x286a2c),_0x17f892=Math[_0x5a3a75(0x170)](_0x17f892*(0x1-_0x286a2c)+_0x55982b[_0x51770c+0x1]*_0x286a2c),_0x3703d9=Math[_0x5a3a75(0x170)](_0x3703d9*(0x1-_0x286a2c)+_0x55982b[_0x51770c+0x2]*_0x286a2c);}}_0x48ef70[_0x4678af]=_0x42f74a,_0x48ef70[_0x4678af+0x1]=_0x17f892,_0x48ef70[_0x4678af+0x2]=_0x3703d9;}return _0x50a635;}function convertToBlackWhite(_0x24b692,_0x26b4d0){const _0x4ddb03=_0x1fd5e3,_0x53d72c=_0x24b692[_0x4ddb03(0x241)],_0x1db156=_0x24b692[_0x4ddb03(0x1b8)],_0x1c92f8=ctx[_0x4ddb03(0x1b1)](_0x53d72c,_0x1db156);return _0x1c92f8[_0x4ddb03(0x279)][_0x4ddb03(0x266)](_0x24b692[_0x4ddb03(0x279)]),applyDitheringAlgorithm(_0x1c92f8,0x80,_0x26b4d0),{'imageData':_0x1c92f8};}function convertToBlackWhiteRed(_0x3fcc36,_0x56a017){const _0x5bf943=_0x1fd5e3,_0xed7eb8=_0x3fcc36['width'],_0x53714c=_0x3fcc36['height'],_0x4a377d=ctx[_0x5bf943(0x1b1)](_0xed7eb8,_0x53714c);_0x4a377d[_0x5bf943(0x279)][_0x5bf943(0x266)](_0x3fcc36[_0x5bf943(0x279)]);const _0x1df252=_0x4a377d[_0x5bf943(0x279)];for(let _0x4b4c8c=0x0;_0x4b4c8c<_0x1df252[_0x5bf943(0x220)];_0x4b4c8c+=0x4){const _0x3d4549=_0x1df252[_0x4b4c8c],_0x6c227c=_0x1df252[_0x4b4c8c+0x1],_0xf830e6=_0x1df252[_0x4b4c8c+0x2];if(_0x3d4549>0xb4&&_0x6c227c<_0x3d4549*0.6&&_0xf830e6<_0x3d4549*0.6)_0x1df252[_0x4b4c8c+0x3]=0x1;else{const _0x1e39b4=0.299*_0x3d4549+0.587*_0x6c227c+0.114*_0xf830e6;_0x1df252[_0x4b4c8c]=_0x1e39b4,_0x1df252[_0x4b4c8c+0x1]=_0x1e39b4,_0x1df252[_0x4b4c8c+0x2]=_0x1e39b4,_0x1df252[_0x4b4c8c+0x3]=0x0;}}applyDitheringAlgorithm(_0x4a377d,0x64,_0x56a017,!![]);for(let _0x510491=0x0;_0x510491<_0x1df252['length'];_0x510491+=0x4){if(_0x1df252[_0x510491+0x3]===0x1)_0x1df252[_0x510491]=0xff,_0x1df252[_0x510491+0x1]=0x0,_0x1df252[_0x510491+0x2]=0x0;else{const _0x24124a=_0x1df252[_0x510491]>0x64?0xff:0x0;_0x1df252[_0x510491]=_0x1df252[_0x510491+0x1]=_0x1df252[_0x510491+0x2]=_0x24124a;}_0x1df252[_0x510491+0x3]=0xff;}return{'imageData':_0x4a377d};}function applyDitheringAlgorithm(_0x58ee27,_0x13ed2f,_0x1d39f1,_0x3d675b=![]){const _0x163322=_0x1fd5e3,_0x2134af=_0x58ee27['data'],_0x340f63=_0x58ee27[_0x163322(0x241)],_0x4d9620=_0x58ee27[_0x163322(0x1b8)],_0x251c1b=_0x1d39f1[_0x163322(0x1b7)],_0x375ce7=_0x1d39f1[_0x163322(0x14f)]/0x64,_0x131444=new Uint8ClampedArray(_0x2134af);for(let _0x8731b5=0x0;_0x8731b5<_0x4d9620;_0x8731b5++){for(let _0x445a72=0x0;_0x445a72<_0x340f63;_0x445a72++){const _0x3c7d15=(_0x8731b5*_0x340f63+_0x445a72)*0x4;if(_0x3d675b&&_0x131444[_0x3c7d15+0x3]===0x1)continue;const _0x5a4037=_0x131444[_0x3c7d15],_0x54f700=_0x5a4037<_0x13ed2f?0x0:0xff,_0x2da9b1=_0x5a4037-_0x54f700,_0x36410e=0x1+_0x375ce7;switch(_0x251c1b){case _0x163322(0x1c5):propagateError(_0x131444,_0x445a72,_0x8731b5,_0x340f63,_0x4d9620,_0x2da9b1*_0x36410e,0x7/0x10,0x1,0x0),propagateError(_0x131444,_0x445a72,_0x8731b5,_0x340f63,_0x4d9620,_0x2da9b1*_0x36410e,0x3/0x10,-0x1,0x1),propagateError(_0x131444,_0x445a72,_0x8731b5,_0x340f63,_0x4d9620,_0x2da9b1*_0x36410e,0x5/0x10,0x0,0x1),propagateError(_0x131444,_0x445a72,_0x8731b5,_0x340f63,_0x4d9620,_0x2da9b1*_0x36410e,0x1/0x10,0x1,0x1);break;case'atkinson':propagateError(_0x131444,_0x445a72,_0x8731b5,_0x340f63,_0x4d9620,_0x2da9b1*_0x36410e,0x1/0x8,0x1,0x0),propagateError(_0x131444,_0x445a72,_0x8731b5,_0x340f63,_0x4d9620,_0x2da9b1*_0x36410e,0x1/0x8,0x2,0x0),propagateError(_0x131444,_0x445a72,_0x8731b5,_0x340f63,_0x4d9620,_0x2da9b1*_0x36410e,0x1/0x8,-0x1,0x1),propagateError(_0x131444,_0x445a72,_0x8731b5,_0x340f63,_0x4d9620,_0x2da9b1*_0x36410e,0x1/0x8,0x0,0x1),propagateError(_0x131444,_0x445a72,_0x8731b5,_0x340f63,_0x4d9620,_0x2da9b1*_0x36410e,0x1/0x8,0x1,0x1),propagateError(_0x131444,_0x445a72,_0x8731b5,_0x340f63,_0x4d9620,_0x2da9b1*_0x36410e,0x1/0x8,0x0,0x2);break;default:break;}_0x2134af[_0x3c7d15]=_0x54f700,_0x2134af[_0x3c7d15+0x1]=_0x54f700,_0x2134af[_0x3c7d15+0x2]=_0x54f700;}}}function propagateError(_0x2466ab,_0x3bf93b,_0x2f5cfc,_0x361d2d,_0x5371d8,_0x991634,_0x50789f,_0x36401a,_0x4eeb76){const _0x5aa717=_0x1fd5e3,_0x1b6e04=_0x3bf93b+_0x36401a,_0x1d82a3=_0x2f5cfc+_0x4eeb76;if(_0x1b6e04>=0x0&&_0x1b6e04<_0x361d2d&&_0x1d82a3>=0x0&&_0x1d82a3<_0x5371d8){const _0x4fdeeb=(_0x1d82a3*_0x361d2d+_0x1b6e04)*0x4;_0x2466ab[_0x4fdeeb]=Math[_0x5aa717(0x282)](0x0,Math[_0x5aa717(0x1c0)](0xff,_0x2466ab[_0x4fdeeb]+_0x991634*_0x50789f));}}function processImageData(_0x16a1a8,_0x4266c5){const _0x532dfc=_0x1fd5e3,_0x2af053=_0x16a1a8[_0x532dfc(0x241)],_0x96732a=_0x16a1a8['height'],_0x189950=_0x16a1a8[_0x532dfc(0x279)];let _0x22e236;if(_0x4266c5===_0x532dfc(0x188)){_0x22e236=new Uint8Array(_0x2af053*_0x96732a);for(let _0x566180=0x0;_0x566180<_0x96732a;_0x566180++){for(let _0x1077cd=0x0;_0x1077cd<_0x2af053;_0x1077cd++){const _0x1c6d34=(_0x566180*_0x2af053+_0x1077cd)*0x4,_0x26d726=_0x189950[_0x1c6d34],_0x9d1fce=_0x189950[_0x1c6d34+0x1],_0x227df4=_0x189950[_0x1c6d34+0x2],_0x3e9165=findClosestColor(_0x26d726,_0x9d1fce,_0x227df4,_0x4266c5),_0x3938ef=_0x1077cd*_0x96732a+(_0x96732a-0x1-_0x566180);_0x22e236[_0x3938ef]=_0x3e9165[_0x532dfc(0x155)];}}}else{if(_0x4266c5==='fourColor'){_0x22e236=new Uint8Array(Math[_0x532dfc(0x26d)](_0x2af053*_0x96732a/0x4));for(let _0x6de1a=0x0;_0x6de1a<_0x96732a;_0x6de1a++){for(let _0xa1a631=0x0;_0xa1a631<_0x2af053;_0xa1a631++){const _0x265ef6=(_0x6de1a*_0x2af053+_0xa1a631)*0x4,_0x58e95a=_0x189950[_0x265ef6],_0x222e6f=_0x189950[_0x265ef6+0x1],_0x4e08ff=_0x189950[_0x265ef6+0x2],_0x5bd4d9=findClosestColor(_0x58e95a,_0x222e6f,_0x4e08ff,_0x4266c5),_0xca9677=_0x5bd4d9['value'],_0x455b94=(_0x6de1a*_0x2af053+_0xa1a631)/0x4|0x0,_0x55d9af=0x6-_0xa1a631%0x4*0x2;_0x22e236[_0x455b94]|=_0xca9677<<_0x55d9af;}}}else{if(_0x4266c5===_0x532dfc(0x1cc)){const _0x201443=Math[_0x532dfc(0x26d)](_0x2af053/0x8);_0x22e236=new Uint8Array(_0x201443*_0x96732a);const _0xd3df37=0x8c;for(let _0x46a925=0x0;_0x46a925<_0x96732a;_0x46a925++){for(let _0x342d53=0x0;_0x342d53<_0x2af053;_0x342d53++){const _0x4c988d=(_0x46a925*_0x2af053+_0x342d53)*0x4,_0x21fcfd=_0x189950[_0x4c988d],_0x1e854c=_0x189950[_0x4c988d+0x1],_0x1facb3=_0x189950[_0x4c988d+0x2],_0x56c6b2=Math[_0x532dfc(0x278)](0.299*_0x21fcfd+0.587*_0x1e854c+0.114*_0x1facb3),_0x57565a=_0x56c6b2>=_0xd3df37?0x1:0x0,_0x18132d=_0x46a925*_0x201443+Math[_0x532dfc(0x170)](_0x342d53/0x8),_0x1f98f3=0x7-_0x342d53%0x8;_0x22e236[_0x18132d]|=_0x57565a<<_0x1f98f3;}}}else{if(_0x4266c5==='threeColor'){const _0x98ab76=Math[_0x532dfc(0x26d)](_0x2af053/0x8),_0x57a084=0x8c,_0x19f4d2=0xa0,_0x3742b5=new Uint8Array(_0x96732a*_0x98ab76),_0x4829be=new Uint8Array(_0x96732a*_0x98ab76);for(let _0x2eadc2=0x0;_0x2eadc2<_0x96732a;_0x2eadc2++){for(let _0x540c21=0x0;_0x540c21<_0x2af053;_0x540c21++){const _0x5dd727=(_0x2eadc2*_0x2af053+_0x540c21)*0x4,_0x3eafc0=_0x189950[_0x5dd727],_0x408edd=_0x189950[_0x5dd727+0x1],_0x381bc8=_0x189950[_0x5dd727+0x2],_0x559d6d=Math[_0x532dfc(0x278)](0.299*_0x3eafc0+0.587*_0x408edd+0.114*_0x381bc8),_0x3ea61c=_0x559d6d>=_0x57a084?0x1:0x0,_0x8c6b38=_0x2eadc2*_0x98ab76+Math['floor'](_0x540c21/0x8),_0x4d2680=0x7-_0x540c21%0x8;_0x3ea61c?_0x3742b5[_0x8c6b38]|=0x1<<_0x4d2680:_0x3742b5[_0x8c6b38]&=~(0x1<<_0x4d2680);const _0x2482a6=_0x3eafc0>_0x19f4d2&&_0x3eafc0>_0x408edd&&_0x3eafc0>_0x381bc8?0x0:0x1,_0x1422aa=_0x2eadc2*_0x98ab76+Math[_0x532dfc(0x170)](_0x540c21/0x8),_0x2897ed=0x7-_0x540c21%0x8;_0x2482a6?_0x4829be[_0x1422aa]|=0x1<<_0x2897ed:_0x4829be[_0x1422aa]&=~(0x1<<_0x2897ed);}}_0x22e236=new Uint8Array(_0x3742b5[_0x532dfc(0x220)]+_0x4829be['length']),_0x22e236[_0x532dfc(0x266)](_0x3742b5,0x0),_0x22e236[_0x532dfc(0x266)](_0x4829be,_0x3742b5['length']);}}}}return _0x22e236;}function toggleCanvas(){const _0xd6866b=_0x1fd5e3;floatingCanvasContainer[_0xd6866b(0x26e)][_0xd6866b(0x19a)](_0xd6866b(0x287))?(floatingCanvasContainer[_0xd6866b(0x26e)][_0xd6866b(0x214)](_0xd6866b(0x287)),toggleCanvasFloat[_0xd6866b(0x1e1)]='<i\x20class=\x22fa\x20fa-compress\x20mr-1\x22></i>隐藏画布',addLog(_0xd6866b(0x28e))):hideCanvas();}function hideCanvas(){const _0x3c6e00=_0x1fd5e3;floatingCanvasContainer[_0x3c6e00(0x26e)][_0x3c6e00(0x22a)]('hidden'),toggleCanvasFloat[_0x3c6e00(0x1e1)]=_0x3c6e00(0x24f),addLog('已隐藏浮动画布');}function updateCanvasVisibility(){const _0x59556f=_0x1fd5e3,_0x33b3a3=checkCanvasHasContent(canvas);_0x33b3a3?(noImagePlaceholder[_0x59556f(0x26e)]['add'](_0x59556f(0x287)),canvas[_0x59556f(0x26e)][_0x59556f(0x214)](_0x59556f(0x287)),floatPreviewCanvas['classList'][_0x59556f(0x214)](_0x59556f(0x287))):(noImagePlaceholder[_0x59556f(0x26e)][_0x59556f(0x214)]('hidden'),canvas[_0x59556f(0x26e)][_0x59556f(0x22a)](_0x59556f(0x287)),floatPreviewCanvas[_0x59556f(0x26e)][_0x59556f(0x22a)](_0x59556f(0x287)));}function checkCanvasHasContent(_0x73e590){const _0x15ec74=_0x1fd5e3,_0xaf6885=_0x73e590['getContext']('2d'),_0x319ad3=_0xaf6885[_0x15ec74(0x27a)](0x0,0x0,_0x73e590['width'],_0x73e590[_0x15ec74(0x1b8)]),_0x44c245=_0x319ad3[_0x15ec74(0x279)];for(let _0x83e476=0x0;_0x83e476<_0x44c245[_0x15ec74(0x220)];_0x83e476+=0x4){if(_0x44c245[_0x83e476]!==0xff||_0x44c245[_0x83e476+0x1]!==0xff||_0x44c245[_0x83e476+0x2]!==0xff)return!![];}return![];}function startDrag(_0x4e6aa1){const _0x239e6a=_0x1fd5e3;isDragging=!![];const _0x1b8133=floatingCanvasContainer['getBoundingClientRect']();dragOffset['x']=_0x4e6aa1[_0x239e6a(0x1ef)]-_0x1b8133[_0x239e6a(0x277)],dragOffset['y']=_0x4e6aa1[_0x239e6a(0x263)]-_0x1b8133[_0x239e6a(0x15c)];}function drag(_0x449022){const _0x42ef46=_0x1fd5e3;if(!isDragging)return;_0x449022['preventDefault']();const _0xb6f0a7=_0x449022[_0x42ef46(0x1ef)]-dragOffset['x'],_0x2ef618=_0x449022[_0x42ef46(0x263)]-dragOffset['y'],_0x39bd06=window['innerWidth'],_0x4dd7d6=window[_0x42ef46(0x1dc)],_0x5ea87b=floatingCanvasContainer[_0x42ef46(0x257)],_0x381780=floatingCanvasContainer[_0x42ef46(0x22c)],_0x464be8=Math['max'](0x0,Math[_0x42ef46(0x1c0)](_0xb6f0a7,_0x39bd06-_0x5ea87b)),_0x4acc38=Math['max'](0x0,Math[_0x42ef46(0x1c0)](_0x2ef618,_0x4dd7d6-_0x381780));floatingCanvasContainer['style']['left']=_0x464be8+'px',floatingCanvasContainer[_0x42ef46(0x160)]['top']=_0x4acc38+'px';}function _0x5681(_0x49350d,_0x9446bb){const _0x31d59d=_0x31d5();return _0x5681=function(_0x5681a3,_0x28e172){_0x5681a3=_0x5681a3-0x148;let _0x333efa=_0x31d59d[_0x5681a3];return _0x333efa;},_0x5681(_0x49350d,_0x9446bb);}function stopDrag(){isDragging=![];}function startResize(_0x1e101e){const _0x37ecd0=_0x1fd5e3;isResizing=!![],_0x1e101e[_0x37ecd0(0x182)]();}function resize(_0x2975f4){const _0xec03db=_0x1fd5e3;if(!isResizing)return;_0x2975f4[_0xec03db(0x182)]();const _0x52d514=floatingCanvasContainer[_0xec03db(0x281)](),_0x2e5190=_0x2975f4['clientX']-_0x52d514['left'],_0x1438c9=_0x2975f4[_0xec03db(0x263)]-_0x52d514[_0xec03db(0x15c)];_0x2e5190>0xc8&&_0x1438c9>0x96&&(floatingCanvasContainer[_0xec03db(0x160)][_0xec03db(0x241)]=_0x2e5190+'px',floatingCanvasContainer[_0xec03db(0x160)][_0xec03db(0x1b8)]=_0x1438c9+'px');}function _0x31d5(){const _0x5064c5=['toggleDrawingMode','EPD_CMD_D_S','scrollTop','32120001-0bf6-448a-9608-1b01a1a8f75c','NotFoundError','toolEraser','btnDownload','preventDefault','图片已适应画布大小','32120002-0bf6-448a-9608-1b01a1a8f75c','\x20的连接...','设置时间失败:\x20','图片处理完成','sixColor','WRITE_IMG','xuanzhuan','gattserverdisconnected','CLOCK','提示：按住Shift键拖动图片，或直接点击图片拖动','liang_add','\x20(0x','btnBlackWhiteRed','getAttribute','childNodes','addEventListener','cursor','欢迎使用墨水屏蓝牙图片工具！','J_S_start','J_S_hour','moveTo','toDataURL','contains','click','color_led','已同步时间！','toolPen','statusContainer','.italic','slice','connectbutton','mousemove','连接过程出错:\x20','647094TiTkWN','EPD_CMD_LED','fanxian1','黑白红','mousedown','connect','color_11','N_Z_min','red','none','textContent','btnProcess','createImageData','jieqi_color','fillRect','jushua_time','bg-primary','已重置处理效果，保留原始图片和设置','ditherAlg','height','主机已同步时间！','createObjectURL','2788504YtEEQm','528992klxiOq','connected','jushua_time1','touchcancel','min','color','<i\x20class=\x22fa\x20fa-unplug\x20mr-1\x22></i>断开','REFRESH','已断开连接','floydSteinberg','橡皮擦','restore','padStart','<i\x20class=\x22fa\x20fa-stop\x20mr-1\x22></i>退出绘画','canvas','trim','blackWhiteColor','正在切换到时钟模式...','requestDevice','Atkinson','name','Jarvis-Judice-Ninke','图像尺寸已设置为:\x20','canvasResizeHandle','move','SET_TIME','lineJoin','\x20MB','EPD_CMD_J_H','已设置时间:\x20','brightness','已切换到日历模式','innerHeight','确定要清空墨水屏显示内容吗？','firstChild','NRF设备(未知名称)','2676570LasiTb','innerHTML','startNotifications','图片已旋转至\x20','mb-1\x20border-b\x20border-gray-100\x20pb-1\x20last:border-0\x20last:mb-0\x20last:pb-0','正在连接:\x20','epdpins','<i\x20class=\x22fa\x20fa-pencil\x20mr-1\x22></i>开始绘画','4.2_400_300','切换模式失败:\x20','getPrimaryService','putImageData','strokeStyle','CLEAR','key','clientX','change','floatingCanvasContainer','请先连接蓝牙设备！','revokeObjectURL','save','target','已切换到时钟模式','正在切换到日历模式...','then','fanxian','selectedIndex','请先上传图片','请输入有效的尺寸（最小50x50像素）','已选择设备:\x20','EPD_CMD_4_ZF','4MFPQLS','substr','包:\x20','INIT','fontFamily','\x20KB','抖动算法','正在清空屏幕...','body','closeTimeDialog','<span\x20class=\x22text-gray-500\x22>[','收到通知:','touchend','14656023OMrqsd','shichen_color','14yZxLBs','log','getTime','mouseup','图片原始尺寸:\x20','toolText','remove','clearRect','currentTool','mtusize','forEach','已退出绘画模式，图片可以移动','touchmove','keys','closeCanvas','\x20像素\x20(','threeColor','liangdu','length','图像文本文件已下载\x20-\x20数据量:\x20','querySelector','stroke','customColor','SET_MODE','fillStyle','text-amber-300','options','lineWidth','add','\x20字节\x20(','offsetHeight','210423Sqsznd','btnClearLog','characteristicvaluechanged','xuanzhuan1','parentElement','liang_s','toString','translate','input','toLocaleTimeString','moshi_id','status','getElementById','join','message','toggleCanvasFloat','已清除画布内容','imageHeight','fileInfo','EPD_CMD_COLOR','width','wendu_color','请检查蓝牙是否已开启并授予权限','display','gatt','尝试重新连接设备...',']</span>\x20<span\x20class=\x22text-gray-800\x22>','contrast','104527yflRae','font','time_color','N_Z_start','imageWidth','J_S_min','<i\x20class=\x22fa\x20fa-arrows-alt\x20mr-1\x22></i>浮动画布','#FFFFFF','xianshi_peizhi','btnReset','color_1','src','<div\x20class=\x22text-gray-500\x20italic\x22>操作日志将显示在这里...</div>','toLocaleString','offsetWidth','请先上传或绘制图像并处理后再下载','datetimeInput','download','#000000','removeChild','时间戳:\x20','fillText','.txt','touches','e-paper-image-','find','clientY','发送失败:\x20','图片已铺满画布','set','bg-amber-500','appendChild','previewCanvas','请输入文字','pen','textBaseline','ceil','classList','sqrt','CALENDAR','drawImage','Stucki','catch','canvasSize','确定要清除画布内容吗？','processImage1','left','round','data','getImageData','url(\x22data:image/svg+xml,%3Csvg\x20xmlns=\x27http://www.w3.org/2000/svg\x27\x20width=\x2724\x27\x20height=\x2724\x27\x20viewBox=\x270\x200\x2024\x2024\x27\x20fill=\x27none\x27\x20stroke=\x27black\x27\x20stroke-width=\x272\x27\x20stroke-linecap=\x27round\x27\x20stroke-linejoin=\x27round\x27%3E%3Cpath\x20d=\x27M18\x2013L5\x205\x27/%3E%3C/svg%3E\x22)\x200\x2024,\x20auto','contrastValue','epddriver',',\x20用时:\x20','logContainer','timeDialog','getBoundingClientRect','max','calendar','createElement','toISOString','disabled','hidden','lineTo','keyup','opacity-50','已选择画笔颜色:\x20','rotate','<i\x20class=\x22fa\x20fa-plug\x20mr-1\x22></i>连接','已显示浮动画布','keydown','saturationValue','开始处理图片，使用','2.13_122_250','diffusionValue','</span>','scrollHeight','fourColor','toFixed','confirmTimeBtn','data-color','className','diffusion','日志已清除','text','active','addTextBtn','text/plain','value','crosshair','Shift','brightnessValue','D_S_hour','pow','已加载图片:\x20','top','\x20像素','block','getTimezoneOffset','style','getCharacteristic','正在断开与\x20','div','disconnect','drawingModeIndicator','result','imageScaleValue','cursor-not-allowed','未知设备','from','r_jushua_time','map','some','onload','mouseout','floor','currentSize','ditherMode','EPD_CMD_N_Z','getContext','writeValueWithoutResponse','saturation','\x20×\x20','liang_time','Floyd-Steinberg','eraser'];_0x31d5=function(){return _0x5064c5;};return _0x31d5();}function stopResize(){isResizing=![];}function resetProcessing(){const _0x3fcacd=_0x1fd5e3;if(0x1){ctx[_0x3fcacd(0x1eb)](originalCanvasData,0x0,0x0),syncCanvases();const _0x2b7f54=getSelectedCanvasSize();processedImageInfo[_0x3fcacd(0x1af)]=_0x2b7f54[_0x3fcacd(0x241)]+'\x20×\x20'+_0x2b7f54[_0x3fcacd(0x1b8)]+_0x3fcacd(0x15d),addLog(_0x3fcacd(0x1b6));}else ctx[_0x3fcacd(0x226)]='#FFFFFF',ctx[_0x3fcacd(0x1b3)](0x0,0x0,canvas['width'],canvas['height']),syncCanvases(),addLog('已清空画布，保留设置和图片');}function addLog(_0x34e76b){const _0x1a6fad=_0x1fd5e3,_0x2ffa4d=new Date()[_0x1a6fad(0x236)](),_0x16105b=document[_0x1a6fad(0x284)](_0x1a6fad(0x163));_0x16105b[_0x1a6fad(0x14e)]=_0x1a6fad(0x1e4),_0x16105b[_0x1a6fad(0x1e1)]=_0x1a6fad(0x209)+_0x2ffa4d+_0x1a6fad(0x247)+_0x34e76b+_0x1a6fad(0x148);logContainer[_0x1a6fad(0x222)](_0x1a6fad(0x1a0))&&(logContainer[_0x1a6fad(0x1e1)]='');logContainer['appendChild'](_0x16105b),logContainer[_0x1a6fad(0x17d)]=logContainer[_0x1a6fad(0x149)];while(logContainer[_0x1a6fad(0x192)][_0x1a6fad(0x220)]>0x1e){logContainer['removeChild'](logContainer[_0x1a6fad(0x1de)]);}}function setStatus(_0x4a1b31){const _0x1365c2=_0x1fd5e3;document[_0x1365c2(0x239)](_0x1365c2(0x238))['textContent']=_0x4a1b31;}function updateButtonStatus(_0x40f162=![]){const _0x39a9a0=_0x1fd5e3,_0x1c85ad=gattServer!=null&&gattServer[_0x39a9a0(0x1bd)],_0x3563aa=_0x40f162||!_0x1c85ad;btnSend[_0x39a9a0(0x286)]=_0x3563aa,btnSetTime[_0x39a9a0(0x286)]=_0x3563aa,_0x3563aa?(btnSend[_0x39a9a0(0x26e)]['add'](_0x39a9a0(0x28a),_0x39a9a0(0x168)),btnSetTime['classList'][_0x39a9a0(0x22a)](_0x39a9a0(0x28a),_0x39a9a0(0x168))):(btnSend['classList'][_0x39a9a0(0x214)](_0x39a9a0(0x28a),_0x39a9a0(0x168)),btnSetTime[_0x39a9a0(0x26e)][_0x39a9a0(0x214)](_0x39a9a0(0x28a),_0x39a9a0(0x168)));}function reConnect(){const _0x2f9b72=_0x1fd5e3;addLog(_0x2f9b72(0x246)),preConnect();}function handleNotify(_0x2a9a0c){const _0x339693=_0x1fd5e3;console[_0x339693(0x20f)](_0x339693(0x20a),_0x2a9a0c);}function hex2bytes(_0xc481ab){const _0x210253=_0x1fd5e3,_0x57f713=[];for(let _0x166488=0x0;_0x166488<_0xc481ab['length'];_0x166488+=0x2){_0x57f713['push'](parseInt(_0xc481ab[_0x210253(0x200)](_0x166488,0x2),0x10));}return _0x57f713;}function formatFileSize(_0x16f569){const _0x3eda56=_0x1fd5e3;if(_0x16f569<0x400)return _0x16f569+'\x20B';else{if(_0x16f569<0x100000)return(_0x16f569/0x400)['toFixed'](0x2)+_0x3eda56(0x204);else return(_0x16f569/0x100000)['toFixed'](0x2)+_0x3eda56(0x1d7);}}async function set_EPD_CMD_J_H(){const _0x1f3b21=_0x1fd5e3;await write(EpdCmd[_0x1f3b21(0x1d8)],document[_0x1f3b21(0x239)](_0x1f3b21(0x1e6))[_0x1f3b21(0x155)]);}async function set_EPD_CMD_N_Z(){const _0x6d6e8c=_0x1fd5e3,_0x6bf07a=document[_0x6d6e8c(0x239)]('N_Z_hour')[_0x6d6e8c(0x155)],_0x4551cd=document[_0x6d6e8c(0x239)](_0x6d6e8c(0x1ac))[_0x6d6e8c(0x155)],_0x4591a4=document[_0x6d6e8c(0x239)](_0x6d6e8c(0x24c))[_0x6d6e8c(0x155)],_0x2c487a=[0x4];_0x2c487a[0x0]=0x0,_0x2c487a[0x1]=0x0,_0x2c487a[0x2]=_0x6bf07a,_0x2c487a[0x3]=_0x4551cd,_0x2c487a[0x4]=_0x4591a4,await write(EpdCmd[_0x6d6e8c(0x173)],_0x2c487a);}async function set_EPD_CMD_D_S(){const _0x25d070=_0x1fd5e3,_0x11905c=document[_0x25d070(0x239)](_0x25d070(0x159))[_0x25d070(0x155)],_0x4b9b8d=document['getElementById']('D_S_min')['value'],_0xfd6154=document['getElementById']('D_S_start')[_0x25d070(0x155)],_0x3f7abf=[0x4];_0x3f7abf[0x0]=0x0,_0x3f7abf[0x1]=0x0,_0x3f7abf[0x2]=_0x11905c,_0x3f7abf[0x3]=_0x4b9b8d,_0x3f7abf[0x4]=_0xfd6154,await write(EpdCmd[_0x25d070(0x17c)],_0x3f7abf);}async function set_EPD_CMD_J_S(){const _0x4a9626=_0x1fd5e3,_0x41a1b9=document[_0x4a9626(0x239)](_0x4a9626(0x197))[_0x4a9626(0x155)],_0x258a56=document[_0x4a9626(0x239)](_0x4a9626(0x24e))[_0x4a9626(0x155)],_0x388c0a=document[_0x4a9626(0x239)](_0x4a9626(0x196))[_0x4a9626(0x155)],_0x4502a6=[0x4];_0x4502a6[0x0]=0x0,_0x4502a6[0x1]=0x0,_0x4502a6[0x2]=_0x41a1b9,_0x4502a6[0x3]=_0x258a56,_0x4502a6[0x4]=_0x388c0a,await write(EpdCmd['EPD_CMD_J_S'],_0x4502a6);}async function set_EPD_CMD_LED(){const _0x307f27=_0x1fd5e3,_0x14db54=document[_0x307f27(0x239)]('color_led')['value'],_0x2183c6=document[_0x307f27(0x239)](_0x307f27(0x178))['value'],_0x51db3a=document[_0x307f27(0x239)](_0x307f27(0x18e))[_0x307f27(0x155)],_0x24d298=document[_0x307f27(0x239)](_0x307f27(0x21f))[_0x307f27(0x155)],_0x2c6917=document[_0x307f27(0x239)]('liang_s')[_0x307f27(0x155)],_0xa9b278=[0x5];_0xa9b278[0x0]=_0x14db54,_0xa9b278[0x1]=_0x2183c6,_0xa9b278[0x2]=_0x51db3a,_0xa9b278[0x3]=_0x24d298,_0xa9b278[0x4]=_0x2c6917,await write(EpdCmd[_0x307f27(0x1a6)],_0xa9b278);}async function set_EPD_CMD_LED1(){const _0x19d4d4=_0x1fd5e3,_0x34fda4=document[_0x19d4d4(0x239)](_0x19d4d4(0x19c))[_0x19d4d4(0x155)],_0x2d036d=document[_0x19d4d4(0x239)](_0x19d4d4(0x178))[_0x19d4d4(0x155)],_0x31d335=document['getElementById'](_0x19d4d4(0x18e))[_0x19d4d4(0x155)],_0x236188=document[_0x19d4d4(0x239)](_0x19d4d4(0x21f))[_0x19d4d4(0x155)],_0x56e3ce=document[_0x19d4d4(0x239)](_0x19d4d4(0x232))[_0x19d4d4(0x155)],_0x3f960e=[0x5];_0x3f960e[0x0]=_0x34fda4,_0x3f960e[0x1]=_0x2d036d,_0x3f960e[0x2]=_0x31d335,_0x3f960e[0x3]=_0x236188,_0x3f960e[0x4]=_0x56e3ce,await write(EpdCmd['EPD_CMD_4_LED'],_0x3f960e);}async function set_EPD_CMD_MY(){const _0x266c4b=_0x1fd5e3,_0x15d23f=document['getElementById'](_0x266c4b(0x1f9))[_0x266c4b(0x155)],_0x33ff1e=document[_0x266c4b(0x239)](_0x266c4b(0x18a))[_0x266c4b(0x155)],_0x310a2c=document['getElementById']('qiangzhi_shuaxing')[_0x266c4b(0x155)],_0xdfb89=document[_0x266c4b(0x239)](_0x266c4b(0x1b4))['value'],_0x474e5d=[0x4];_0x474e5d[0x0]=_0x15d23f,_0x474e5d[0x1]=_0x33ff1e,_0x474e5d[0x2]=_0x310a2c,_0x474e5d[0x3]=_0xdfb89,await write(EpdCmd['EPD_CMD_MY'],_0x474e5d);}async function set_EPD_CMD_COLOR(){const _0x1e4349=_0x1fd5e3,_0x234f14=document[_0x1e4349(0x239)](_0x1e4349(0x253))[_0x1e4349(0x155)],_0x5b8f1d=document[_0x1e4349(0x239)](_0x1e4349(0x24b))[_0x1e4349(0x155)],_0x56f6ae=document[_0x1e4349(0x239)](_0x1e4349(0x242))['value'],_0x2e431f=document[_0x1e4349(0x239)]('gongli_color')[_0x1e4349(0x155)],_0x2a8a87=document[_0x1e4349(0x239)](_0x1e4349(0x20d))['value'],_0x2d466b=document['getElementById'](_0x1e4349(0x1b2))[_0x1e4349(0x155)],_0x57bdfa=document[_0x1e4349(0x239)](_0x1e4349(0x16b))[_0x1e4349(0x155)],_0x4ddc7d=[0x7];_0x4ddc7d[0x0]=_0x234f14,_0x4ddc7d[0x1]=_0x5b8f1d,_0x4ddc7d[0x2]=_0x56f6ae,_0x4ddc7d[0x3]=_0x2e431f,_0x4ddc7d[0x4]=_0x2a8a87,_0x4ddc7d[0x5]=_0x2d466b,_0x4ddc7d[0x6]=_0x57bdfa,await write(EpdCmd[_0x1e4349(0x240)],_0x4ddc7d);}async function set_EPD_CMD_4_MS(){const _0x501ac4=_0x1fd5e3,_0x17a466=document[_0x501ac4(0x239)](_0x501ac4(0x1a7))[_0x501ac4(0x155)],_0x2b2b6e=document[_0x501ac4(0x239)](_0x501ac4(0x230))['value'],_0x23a24e=document['getElementById'](_0x501ac4(0x1be))['value'],_0x3e6e9f=document['getElementById'](_0x501ac4(0x251))[_0x501ac4(0x155)],_0x1d633c=document[_0x501ac4(0x239)](_0x501ac4(0x237))[_0x501ac4(0x155)],_0x210458=document[_0x501ac4(0x239)](_0x501ac4(0x1ab))[_0x501ac4(0x155)],_0x1a6ef6=document['getElementById']('silian_ziti')[_0x501ac4(0x155)],_0x3ef156=[0x7];_0x3ef156[0x0]=_0x17a466,_0x3ef156[0x1]=_0x2b2b6e,_0x3ef156[0x2]=_0x23a24e,_0x3ef156[0x3]=_0x3e6e9f,_0x3ef156[0x4]=_0x1d633c,_0x3ef156[0x5]=_0x210458,_0x3ef156[0x6]=_0x1a6ef6,await write(EpdCmd['EPD_CMD_4_MS'],_0x3ef156);}async function syncTime(_0x4f5eb1){const _0x16fc11=_0x1fd5e3,_0x5e35f8=new Date()[_0x16fc11(0x210)]()/0x3e8,_0x2abca9=new Uint8Array([_0x5e35f8>>0x18&0xff,_0x5e35f8>>0x10&0xff,_0x5e35f8>>0x8&0xff,_0x5e35f8&0xff,-(new Date()[_0x16fc11(0x15f)]()/0x3c),_0x4f5eb1]);await write(EpdCmd[_0x16fc11(0x1d5)],_0x2abca9)&&addLog(_0x16fc11(0x19d));}async function set_EPD_CMD_4_ZF(_0x1056e0){const _0x32aec4=_0x1fd5e3,_0x589b25=[0x1];_0x589b25[0x0]=_0x1056e0,await write(EpdCmd[_0x32aec4(0x1fe)],_0x589b25),_0x1056e0==0x0&&(syncTime(0x2),addLog(_0x32aec4(0x1b9)));}window[_0x1fd5e3(0x16e)]=init;
