const _0x17a788=_0x7824;(function(_0x38f072,_0x591c72){const _0x26062f=_0x7824,_0x463068=_0x38f072();while(!![]){try{const _0x32a431=-parseInt(_0x26062f(0x187))/0x1*(parseInt(_0x26062f(0x17d))/0x2)+parseInt(_0x26062f(0x1aa))/0x3*(parseInt(_0x26062f(0x179))/0x4)+-parseInt(_0x26062f(0x161))/0x5*(parseInt(_0x26062f(0x1a5))/0x6)+parseInt(_0x26062f(0x13b))/0x7*(-parseInt(_0x26062f(0x19a))/0x8)+-parseInt(_0x26062f(0x16e))/0x9+parseInt(_0x26062f(0x178))/0xa*(parseInt(_0x26062f(0x193))/0xb)+parseInt(_0x26062f(0x14a))/0xc*(parseInt(_0x26062f(0x113))/0xd);if(_0x32a431===_0x591c72)break;else _0x463068['push'](_0x463068['shift']());}catch(_0x5e14f9){_0x463068['push'](_0x463068['shift']());}}}(_0x32eb,0x9f589));let bleDevice,gattServer,epdService,epdCharacteristic,startTime,msgIndex,appVersion,canvas,ctx,textDecoder;const EpdCmd={'SET_PINS':0x0,'INIT':0x1,'CLEAR':0x2,'SEND_CMD':0x3,'SEND_DATA':0x4,'REFRESH':0x5,'SLEEP':0x6,'SET_TIME':0x20,'WRITE_IMG':0x30,'SET_CONFIG':0x90,'SYS_RESET':0x91,'SYS_SLEEP':0x92,'CFG_ERASE':0x99,'EPD_CMD_J_H':0xff,'EPD_CMD_N_Z':0xef,'EPD_CMD_J_S':0xee,'EPD_CMD_D_S':0xed,'EPD_CMD_LED':0xec,'EPD_CMD_MY':0xeb,'EPD_CMD_COLOR':0xea,'EPD_CMD_4_MS':0xfe,'EPD_CMD_4_C0LOR':0xfd,'EPD_CMD_4_XZ':0xfc,'EPD_CMD_4_ZF':0xfb},canvasSizes=[{'name':'1.54_152_152','width':0x98,'height':0x98},{'name':_0x17a788(0x141),'width':0xc8,'height':0xc8},{'name':_0x17a788(0x11a),'width':0xd4,'height':0x68},{'name':_0x17a788(0x1bf),'width':0xfa,'height':0x7a},{'name':_0x17a788(0x169),'width':0x128,'height':0x98},{'name':_0x17a788(0x1b8),'width':0x128,'height':0x80},{'name':_0x17a788(0x17a),'width':0x180,'height':0xa8},{'name':_0x17a788(0x18a),'width':0x180,'height':0xb8},{'name':_0x17a788(0x1ae),'width':0x1a0,'height':0xf0},{'name':_0x17a788(0x1bd),'width':0x320,'height':0x1e0},{'name':_0x17a788(0x180),'width':0x190,'height':0x12c},{'name':_0x17a788(0x115),'width':0x318,'height':0x110},{'name':_0x17a788(0x118),'width':0x320,'height':0x1e0},{'name':_0x17a788(0x145),'width':0x3c0,'height':0x280},{'name':_0x17a788(0x19c),'width':0x550,'height':0x1e0},{'name':_0x17a788(0x1c8),'width':0x3c0,'height':0x280},{'name':_0x17a788(0x15d),'width':0x258,'height':0x190},{'name':_0x17a788(0x183),'width':0x1e0,'height':0x320}];function _0x32eb(){const _0x4d1ae1=['const\x20uint16_t\x20imageWidth\x20=\x20','createObjectURL','EPD_CMD_J_H','height','firstChild','div','data-size','scrollHeight','SET_PINS','add','图片已旋转\x20','onload','没有链接蓝牙','21kMoYRx','gatt','href','getCharacteristic','J_S_min','N_Z_hour','1.54_200_200','color_1','qiangzhi_shuaxing','getImageData','10.2_960_640','innerHTML','setAttribute','N_Z_start','正在连接:\x20','3633168dEGIbt','files','requestDevice:\x20','innerText','options','J_S_start','bluetooth','disabled','fillStyle','正在重连','xuanzhuan','save','D_S_min','请检查蓝牙，推荐使用Edge浏览器！','span','jieqi_color','getMinutes','块:\x20','buffer','4E_600_400','debug-mode','message','WRITE_IMG','1303865IasBJw','epddriver','padStart','startNotifications:\x20','translate','appendChild','search','getAttribute','2.66_296_152','shichen_color','location','startNotifications','liang_time','543123ZHzGpS','classList','name','parentElement','mtu=','sixColor','push','getTime','gongli_color','action','8473670zNhUWd','28xzJxnT','2.9_384_168','substr','substring','62bDpFbd','const\x20uint16_t\x20imageHeight\x20=\x20','liang_add','4.2_400_300','D_S_hour','className','7.3E6','jushua_time','EPD_CMD_N_Z','createElement','40867JkaXbC','当前固件不支持此颜色模式。','已同步时间！','3.5_384_184','toString','length','writeValueWithResponse','getContext','color_led','ditherAlg','putImageData','J_S_hour','11lmZjTU','debug-toggle','epdpins','fanxian','ditherStrength','join','data','2467272jyZEiu','ditherContrast','10.85_1360_480','body','liangdu','abs','min','const\x20uint8_t\x20imageData[]\x20IMAGE\x20=\x20{','62750001-d828-918d-fb46-b6c11c675aec','threeColor','toFixed','12WvEspA','INIT','none','D_S_start','get','197127bCUxyY','EPD_CMD_J_S','wendu_color','width','3.7_416_240','download','status','connect','blackWhiteColor','#FFFFFF','byteLength','getHours','62750003-d828-918d-fb46-b6c11c675aec','childNodes','2.9_296_128','0000','slice','getSeconds','addEventListener','3.97_800_480','disconnect','2.13_250_122','imageFile','byteOffset','EPD_CMD_MY','const\x20uint8_t\x20colorMode\x20=\x20','ditherMode','CLEAR','block','change','11.6_960_640','input','revokeObjectURL','getUint8','drawImage','pathname','requestDevice','cmdTXT','clearscreenbutton','decode','EPD_CMD_D_S','value','setDriverbutton','readValue',',\x20总用时:\x20','connected','canvasSize','log','debug','src','from','getElementById','fourColor','REFRESH','getTimezoneOffset','91XRYieJ','text/plain','5.79_792_272','display','connectbutton','7.5_800_480','EPD_CMD_COLOR','2.13_212_104','time_color','mtusize','red','characteristicvaluechanged','ditherStrengthValue','N_Z_min','selectedIndex','62750002-d828-918d-fb46-b6c11c675aec','错误：预期','white','style','已断开连接.','writeValueWithoutResponse','error','string','r_jushua_time','发送完成！耗时:\x20','restore','startsWith'];_0x32eb=function(){return _0x4d1ae1;};return _0x32eb();}function hex2bytes(_0x3c92ad){const _0x195487=_0x17a788;for(var _0x443186=[],_0x7538a2=0x0;_0x7538a2<_0x3c92ad[_0x195487(0x18c)];_0x7538a2+=0x2)_0x443186[_0x195487(0x174)](parseInt(_0x3c92ad[_0x195487(0x17b)](_0x7538a2,0x2),0x10));return new Uint8Array(_0x443186);}function bytes2hex(_0x1b4989){return new Uint8Array(_0x1b4989)['reduce'](function(_0xa1e599,_0x49123c){const _0x4e1176=_0x7824;return _0xa1e599+('0'+_0x49123c[_0x4e1176(0x18b)](0x10))[_0x4e1176(0x1ba)](-0x2);},'');}function _0x7824(_0x315e16,_0x2d4157){const _0x32ebf7=_0x32eb();return _0x7824=function(_0x7824fa,_0x48a296){_0x7824fa=_0x7824fa-0xfc;let _0x3ac46d=_0x32ebf7[_0x7824fa];return _0x3ac46d;},_0x7824(_0x315e16,_0x2d4157);}function intToHex(_0x1495c7){const _0x16b567=_0x17a788;let _0x18eea2=(_0x16b567(0x1b9)+_0x1495c7[_0x16b567(0x18b)](0x10))[_0x16b567(0x17b)](-0x4);return _0x18eea2[_0x16b567(0x17c)](0x2,0x4)+_0x18eea2['substring'](0x0,0x2);}function resetVariables(){const _0x4d7c66=_0x17a788;gattServer=null,epdService=null,epdCharacteristic=null,msgIndex=0x0,document[_0x4d7c66(0x10f)](_0x4d7c66(0x10b))['value']='';}async function write(_0x56c713,_0x299a8d,_0x432da5=!![]){const _0x5c6e4b=_0x17a788;if(!epdCharacteristic)return addLog(_0x5c6e4b(0x13a)),![];let _0x128ce8=[_0x56c713];if(_0x299a8d){if(typeof _0x299a8d==_0x5c6e4b(0x129))_0x299a8d=hex2bytes(_0x299a8d);if(_0x299a8d instanceof Uint8Array)_0x299a8d=Array[_0x5c6e4b(0x10e)](_0x299a8d);_0x128ce8['push'](..._0x299a8d);}try{if(_0x432da5)await epdCharacteristic[_0x5c6e4b(0x18d)](Uint8Array[_0x5c6e4b(0x10e)](_0x128ce8));else await epdCharacteristic[_0x5c6e4b(0x127)](Uint8Array[_0x5c6e4b(0x10e)](_0x128ce8));}catch(_0x11ff55){console[_0x5c6e4b(0x128)](_0x11ff55);if(_0x11ff55[_0x5c6e4b(0x15f)])addLog('write:\x20'+_0x11ff55['message']);return![];}return!![];}async function writeImage(_0x17e457,_0x1c37e6='bw'){const _0x5a5830=_0x17a788,_0x5240c5=document['getElementById'](_0x5a5830(0x11c))[_0x5a5830(0x105)]-0x2,_0x39b8a3=document[_0x5a5830(0x10f)]('interleavedcount')[_0x5a5830(0x105)],_0x187cec=Math['round'](_0x17e457[_0x5a5830(0x18c)]/_0x5240c5);let _0x5858e5=0x0,_0x464beb=_0x39b8a3;for(let _0x57a684=0x0;_0x57a684<_0x17e457[_0x5a5830(0x18c)];_0x57a684+=_0x5240c5){let _0x462900=(new Date()['getTime']()-startTime)/0x3e8;setStatus((_0x1c37e6=='bw'?'黑白':'红色')+_0x5a5830(0x15b)+(_0x5858e5+0x1)+'/'+(_0x187cec+0x1)+_0x5a5830(0x108)+_0x462900+'s');const _0x109a0f=[(_0x1c37e6=='bw'?0xf:0x0)|(_0x57a684==0x0?0x0:0xf0),..._0x17e457['slice'](_0x57a684,_0x57a684+_0x5240c5)];_0x464beb>0x0?(await write(EpdCmd['WRITE_IMG'],_0x109a0f,![]),_0x464beb--):(await write(EpdCmd[_0x5a5830(0x160)],_0x109a0f,!![]),_0x464beb=_0x39b8a3),_0x5858e5++;}}async function setDriver(){const _0x112490=_0x17a788;await write(EpdCmd[_0x112490(0x136)],document[_0x112490(0x10f)](_0x112490(0x195))[_0x112490(0x105)]),await write(EpdCmd['INIT'],document['getElementById'](_0x112490(0x162))['value']);}async function set_EPD_CMD_J_H(){const _0x21cecc=_0x17a788;await write(EpdCmd[_0x21cecc(0x130)],document['getElementById'](_0x21cecc(0x195))[_0x21cecc(0x105)]);}async function set_EPD_CMD_N_Z(){const _0x515285=_0x17a788,_0x3a3cb7=document['getElementById'](_0x515285(0x140))[_0x515285(0x105)],_0x52ecd5=document[_0x515285(0x10f)](_0x515285(0x120))[_0x515285(0x105)],_0x56e2b7=document[_0x515285(0x10f)](_0x515285(0x148))[_0x515285(0x105)],_0x25f06c=[0x4];_0x25f06c[0x0]=0x0,_0x25f06c[0x1]=0x0,_0x25f06c[0x2]=_0x3a3cb7,_0x25f06c[0x3]=_0x52ecd5,_0x25f06c[0x4]=_0x56e2b7,await write(EpdCmd[_0x515285(0x185)],_0x25f06c);}async function set_EPD_CMD_D_S(){const _0x2952d3=_0x17a788,_0x5ca7d9=document[_0x2952d3(0x10f)](_0x2952d3(0x181))['value'],_0x4f7d41=document[_0x2952d3(0x10f)](_0x2952d3(0x156))['value'],_0x59c154=document['getElementById'](_0x2952d3(0x1a8))[_0x2952d3(0x105)],_0x151534=[0x4];_0x151534[0x0]=0x0,_0x151534[0x1]=0x0,_0x151534[0x2]=_0x5ca7d9,_0x151534[0x3]=_0x4f7d41,_0x151534[0x4]=_0x59c154,await write(EpdCmd[_0x2952d3(0x104)],_0x151534);}async function set_EPD_CMD_J_S(){const _0x8edbd9=_0x17a788,_0x40ecd0=document[_0x8edbd9(0x10f)](_0x8edbd9(0x192))['value'],_0x176ba1=document['getElementById'](_0x8edbd9(0x13f))[_0x8edbd9(0x105)],_0x5c91d9=document[_0x8edbd9(0x10f)](_0x8edbd9(0x14f))[_0x8edbd9(0x105)],_0x3b30fb=[0x4];_0x3b30fb[0x0]=0x0,_0x3b30fb[0x1]=0x0,_0x3b30fb[0x2]=_0x40ecd0,_0x3b30fb[0x3]=_0x176ba1,_0x3b30fb[0x4]=_0x5c91d9,await write(EpdCmd[_0x8edbd9(0x1ab)],_0x3b30fb);}async function set_EPD_CMD_LED(){const _0x19db12=_0x17a788,_0x346bb4=document[_0x19db12(0x10f)](_0x19db12(0x18f))[_0x19db12(0x105)],_0x4dbaac=document[_0x19db12(0x10f)](_0x19db12(0x16d))[_0x19db12(0x105)],_0x598f3e=document[_0x19db12(0x10f)](_0x19db12(0x17f))[_0x19db12(0x105)],_0x374cc6=document[_0x19db12(0x10f)](_0x19db12(0x19e))[_0x19db12(0x105)],_0x489ce0=document['getElementById'](_0x19db12(0x19e))[_0x19db12(0x105)],_0x326366=[0x5];_0x326366[0x0]=_0x346bb4,_0x326366[0x1]=_0x4dbaac,_0x326366[0x2]=_0x598f3e,_0x326366[0x3]=_0x374cc6,_0x326366[0x4]=_0x489ce0,await write(EpdCmd['EPD_CMD_LED'],_0x326366);}async function set_EPD_CMD_MY(){const _0x1bcde4=_0x17a788,_0x334328=document[_0x1bcde4(0x10f)](_0x1bcde4(0x196))['value'],_0x555e04=document[_0x1bcde4(0x10f)](_0x1bcde4(0x154))[_0x1bcde4(0x105)],_0x3593d1=document[_0x1bcde4(0x10f)](_0x1bcde4(0x143))[_0x1bcde4(0x105)],_0x11edd0=document['getElementById'](_0x1bcde4(0x184))[_0x1bcde4(0x105)],_0x37a168=[0x4];_0x37a168[0x0]=_0x334328,_0x37a168[0x1]=_0x555e04,_0x37a168[0x2]=_0x3593d1,_0x37a168[0x3]=_0x11edd0,await write(EpdCmd[_0x1bcde4(0x1c2)],_0x37a168);}async function set_EPD_CMD_COLOR(){const _0x31e7c2=_0x17a788,_0x415e74=document[_0x31e7c2(0x10f)](_0x31e7c2(0x142))[_0x31e7c2(0x105)],_0x2754eb=document[_0x31e7c2(0x10f)](_0x31e7c2(0x11b))[_0x31e7c2(0x105)],_0x5eee51=document[_0x31e7c2(0x10f)](_0x31e7c2(0x1ac))[_0x31e7c2(0x105)],_0x4570b1=document[_0x31e7c2(0x10f)](_0x31e7c2(0x176))[_0x31e7c2(0x105)],_0x201ecc=document[_0x31e7c2(0x10f)](_0x31e7c2(0x16a))[_0x31e7c2(0x105)],_0x40e1bd=document['getElementById'](_0x31e7c2(0x159))[_0x31e7c2(0x105)],_0x377e10=document['getElementById'](_0x31e7c2(0x12a))[_0x31e7c2(0x105)],_0x4eb02a=[0x7];_0x4eb02a[0x0]=_0x415e74,_0x4eb02a[0x1]=_0x2754eb,_0x4eb02a[0x2]=_0x5eee51,_0x4eb02a[0x3]=_0x4570b1,_0x4eb02a[0x4]=_0x201ecc,_0x4eb02a[0x5]=_0x40e1bd,_0x4eb02a[0x6]=_0x377e10,await write(EpdCmd[_0x31e7c2(0x119)],_0x4eb02a);}async function syncTime(_0x3c81ef){const _0x18d441=_0x17a788,_0x12df67=new Date()[_0x18d441(0x175)]()/0x3e8,_0x4c571d=new Uint8Array([_0x12df67>>0x18&0xff,_0x12df67>>0x10&0xff,_0x12df67>>0x8&0xff,_0x12df67&0xff,-(new Date()[_0x18d441(0x112)]()/0x3c),_0x3c81ef]);await write(EpdCmd['SET_TIME'],_0x4c571d)&&addLog(_0x18d441(0x189));}async function clearScreen(){const _0x318ec3=_0x17a788;0x1&&(await write(EpdCmd[_0x318ec3(0x1c5)]),addLog('已清除屏慕！'));}async function sendcmd(){const _0x2fdeaf=_0x17a788,_0x36edf9=document[_0x2fdeaf(0x10f)](_0x2fdeaf(0x101))[_0x2fdeaf(0x105)];if(_0x36edf9=='')return;const _0x2ba8b6=hex2bytes(_0x36edf9);await write(_0x2ba8b6[0x0],_0x2ba8b6[_0x2fdeaf(0x18c)]>0x1?_0x2ba8b6[_0x2fdeaf(0x1ba)](0x1):null);}async function sendimg(){const _0x479d47=_0x17a788,_0x3ea190=document['getElementById']('canvasSize')['value'],_0x27d2ed=document[_0x479d47(0x10f)]('ditherMode')['value'],_0x28de8d=document[_0x479d47(0x10f)](_0x479d47(0x162)),_0x3616b2=_0x28de8d[_0x479d47(0x14e)][_0x28de8d[_0x479d47(0x121)]];startTime=new Date()[_0x479d47(0x175)]();const _0x458368=document[_0x479d47(0x10f)](_0x479d47(0x1b0));_0x458368['parentElement'][_0x479d47(0x125)]['display']=_0x479d47(0x1c6);const _0x3e03e6=ctx['getImageData'](0x0,0x0,canvas[_0x479d47(0x1ad)],canvas['height']),_0x3b8fdd=processImageData(_0x3e03e6,_0x27d2ed);updateButtonStatus(!![]);if(_0x27d2ed===_0x479d47(0x110))await writeImage(_0x3b8fdd,'color');else{if(_0x27d2ed===_0x479d47(0x1a3)){const _0x2bb7fa=Math['floor'](_0x3b8fdd[_0x479d47(0x18c)]/0x2);await writeImage(_0x3b8fdd[_0x479d47(0x1ba)](0x0,_0x2bb7fa),'bw'),await writeImage(_0x3b8fdd['slice'](_0x2bb7fa),_0x479d47(0x11d));}else{if(_0x27d2ed==='blackWhiteColor')await writeImage(_0x3b8fdd,'bw');else{addLog(_0x479d47(0x188)),updateButtonStatus();return;}}}await write(EpdCmd[_0x479d47(0x111)]),updateButtonStatus();const _0x3cf461=(new Date()[_0x479d47(0x175)]()-startTime)/0x3e8;addLog(_0x479d47(0x12b)+_0x3cf461+'s'),setStatus('发送完成！耗时:\x20'+_0x3cf461+'s'),addLog('请等待屏幕刷新完成！'),setTimeout(()=>{const _0xe65795=_0x479d47;_0x458368[_0xe65795(0x171)]['style'][_0xe65795(0x116)]=_0xe65795(0x1a7);},0x1388);}function downloadDataArray(){const _0x5cbf3b=_0x17a788;if(isCropMode())return;const _0x334b03=document['getElementById'](_0x5cbf3b(0x1c4))[_0x5cbf3b(0x105)],_0x1c743a=ctx[_0x5cbf3b(0x144)](0x0,0x0,canvas[_0x5cbf3b(0x1ad)],canvas[_0x5cbf3b(0x131)]),_0x1094d5=processImageData(_0x1c743a,_0x334b03);if(_0x334b03===_0x5cbf3b(0x173)&&_0x1094d5['length']!==canvas['width']*canvas[_0x5cbf3b(0x131)]){console[_0x5cbf3b(0x10b)](_0x5cbf3b(0x123)+canvas[_0x5cbf3b(0x1ad)]*canvas[_0x5cbf3b(0x131)]+'字节，但得到'+_0x1094d5['length']+'字节');return;}const _0x2381d7=[];for(let _0x38d358=0x0;_0x38d358<_0x1094d5[_0x5cbf3b(0x18c)];_0x38d358++){const _0x174de2=(_0x1094d5[_0x38d358]&0xff)[_0x5cbf3b(0x18b)](0x10)[_0x5cbf3b(0x163)](0x2,'0');_0x2381d7[_0x5cbf3b(0x174)]('0x'+_0x174de2);}const _0x5ab9ae=[];for(let _0x300d91=0x0;_0x300d91<_0x2381d7['length'];_0x300d91+=0x10){_0x5ab9ae[_0x5cbf3b(0x174)](_0x2381d7['slice'](_0x300d91,_0x300d91+0x10)[_0x5cbf3b(0x198)](',\x20'));}const _0x4d3e3a=_0x334b03===_0x5cbf3b(0x173)?0x0:_0x334b03===_0x5cbf3b(0x110)?0x1:_0x334b03===_0x5cbf3b(0x1b2)?0x2:0x3,_0x2da5fa=[_0x5cbf3b(0x1a1),_0x5ab9ae[_0x5cbf3b(0x198)](',\x0a'),'};',_0x5cbf3b(0x12e)+canvas['width']+';',_0x5cbf3b(0x17e)+canvas['height']+';',_0x5cbf3b(0x1c3)+_0x4d3e3a+';'][_0x5cbf3b(0x198)]('\x0a'),_0x3aa6d5=new Blob([_0x2da5fa],{'type':_0x5cbf3b(0x114)}),_0x578b28=document['createElement']('a');_0x578b28[_0x5cbf3b(0x1af)]='image.h',_0x578b28[_0x5cbf3b(0x13d)]=URL[_0x5cbf3b(0x12f)](_0x3aa6d5),_0x578b28['click'](),URL[_0x5cbf3b(0xfc)](_0x578b28[_0x5cbf3b(0x13d)]);}function updateButtonStatus(_0x21d3b6=![]){const _0x10fab8=_0x17a788,_0x3c0522=gattServer!=null&&gattServer[_0x10fab8(0x109)],_0x4ee4c4=_0x21d3b6?_0x10fab8(0x151):_0x3c0522?null:_0x10fab8(0x151);document[_0x10fab8(0x10f)]('reconnectbutton')[_0x10fab8(0x151)]=gattServer==null||gattServer[_0x10fab8(0x109)]?'disabled':null,document['getElementById']('sendcmdbutton')[_0x10fab8(0x151)]=_0x4ee4c4,document[_0x10fab8(0x10f)]('calendarmodebutton')['disabled']=_0x4ee4c4,document[_0x10fab8(0x10f)]('clockmodebutton')[_0x10fab8(0x151)]=_0x4ee4c4,document['getElementById'](_0x10fab8(0x102))['disabled']=_0x4ee4c4,document[_0x10fab8(0x10f)]('sendimgbutton')[_0x10fab8(0x151)]=_0x4ee4c4,document[_0x10fab8(0x10f)](_0x10fab8(0x106))['disabled']=_0x4ee4c4;}function disconnect(){const _0x31c542=_0x17a788;updateButtonStatus(),resetVariables(),addLog(_0x31c542(0x126)),document[_0x31c542(0x10f)](_0x31c542(0x117))[_0x31c542(0x146)]='连接';}async function preConnect(){const _0x4bc913=_0x17a788;if(gattServer!=null&&gattServer['connected'])bleDevice!=null&&bleDevice[_0x4bc913(0x13c)][_0x4bc913(0x109)]&&bleDevice[_0x4bc913(0x13c)]['disconnect']();else{resetVariables();try{bleDevice=await navigator[_0x4bc913(0x150)][_0x4bc913(0x100)]({'optionalServices':['62750001-d828-918d-fb46-b6c11c675aec'],'acceptAllDevices':!![]});}catch(_0x5923fb){console[_0x4bc913(0x128)](_0x5923fb);if(_0x5923fb[_0x4bc913(0x15f)])addLog(_0x4bc913(0x14c)+_0x5923fb[_0x4bc913(0x15f)]);addLog(_0x4bc913(0x157));return;}await bleDevice['addEventListener']('gattserverdisconnected',disconnect),setTimeout(async function(){await connect();},0x12c);}}async function reConnect(){const _0x2acca3=_0x17a788;if(bleDevice!=null&&bleDevice[_0x2acca3(0x13c)][_0x2acca3(0x109)])bleDevice[_0x2acca3(0x13c)][_0x2acca3(0x1be)]();resetVariables(),addLog(_0x2acca3(0x153)),setTimeout(async function(){await connect();},0x12c);}function handleNotify(_0x6055ec,_0x23ebaa){const _0x8e426=_0x17a788,_0x412d53=new Uint8Array(_0x6055ec[_0x8e426(0x15c)],_0x6055ec[_0x8e426(0x1c1)],_0x6055ec[_0x8e426(0x1b4)]);if(_0x23ebaa==0x0){}else{if(textDecoder==null)textDecoder=new TextDecoder();const _0x4272e8=textDecoder[_0x8e426(0x103)](_0x412d53);if(_0x4272e8[_0x8e426(0x12d)](_0x8e426(0x172))&&_0x4272e8[_0x8e426(0x18c)]>0x4){const _0x2d079e=parseInt(_0x4272e8[_0x8e426(0x17c)](0x4));document[_0x8e426(0x10f)]('mtusize')['value']=_0x2d079e;}else{if(_0x4272e8[_0x8e426(0x12d)]('t=')&&_0x4272e8[_0x8e426(0x18c)]>0x2){const _0x4d42de=parseInt(_0x4272e8[_0x8e426(0x17c)](0x2))+new Date()[_0x8e426(0x112)]()*0x3c;}}}}async function connect(){const _0x500f5d=_0x17a788;if(bleDevice==null||epdCharacteristic!=null)return;try{addLog(_0x500f5d(0x149)+bleDevice[_0x500f5d(0x170)]),gattServer=await bleDevice[_0x500f5d(0x13c)][_0x500f5d(0x1b1)](),epdService=await gattServer['getPrimaryService'](_0x500f5d(0x1a2)),epdCharacteristic=await epdService['getCharacteristic'](_0x500f5d(0x122)),addLog('已连接！');}catch(_0x1ca6b0){console['error'](_0x1ca6b0);if(_0x1ca6b0[_0x500f5d(0x15f)])addLog('connect:\x20'+_0x1ca6b0[_0x500f5d(0x15f)]);disconnect();return;}try{const _0x14d1d8=await epdService[_0x500f5d(0x13e)](_0x500f5d(0x1b6)),_0x529b18=await _0x14d1d8[_0x500f5d(0x107)]();appVersion=_0x529b18[_0x500f5d(0xfd)](0x0);}catch(_0x38d01e){console[_0x500f5d(0x128)](_0x38d01e),appVersion=0x15;}try{await epdCharacteristic[_0x500f5d(0x16c)](),epdCharacteristic[_0x500f5d(0x1bc)](_0x500f5d(0x11e),_0x1958e0=>{handleNotify(_0x1958e0['target']['value'],msgIndex++);});}catch(_0x7ca266){console[_0x500f5d(0x128)](_0x7ca266);if(_0x7ca266[_0x500f5d(0x15f)])addLog(_0x500f5d(0x164)+_0x7ca266[_0x500f5d(0x15f)]);}await write(EpdCmd[_0x500f5d(0x1a6)]),document[_0x500f5d(0x10f)](_0x500f5d(0x117))[_0x500f5d(0x146)]='断开',updateButtonStatus();}function setStatus(_0x165927){const _0x22d296=_0x17a788;document[_0x22d296(0x10f)](_0x22d296(0x1b0))[_0x22d296(0x146)]=_0x165927;}function addLog(_0x19114b,_0x5f3ac7=''){const _0x22c3b6=_0x17a788,_0x58e202=document[_0x22c3b6(0x10f)](_0x22c3b6(0x10b)),_0x4fb565=new Date(),_0x36aeab=String(_0x4fb565[_0x22c3b6(0x1b5)]())['padStart'](0x2,'0')+':'+String(_0x4fb565[_0x22c3b6(0x15a)]())[_0x22c3b6(0x163)](0x2,'0')+':'+String(_0x4fb565[_0x22c3b6(0x1bb)]())[_0x22c3b6(0x163)](0x2,'0')+'\x20',_0x142354=document[_0x22c3b6(0x186)](_0x22c3b6(0x133)),_0x26d2d2=document[_0x22c3b6(0x186)]('span');_0x26d2d2[_0x22c3b6(0x182)]='time',_0x26d2d2['textContent']=_0x36aeab,_0x142354[_0x22c3b6(0x166)](_0x26d2d2);if(_0x5f3ac7!==''){const _0x5820e9=document['createElement'](_0x22c3b6(0x158));_0x5820e9[_0x22c3b6(0x182)]=_0x22c3b6(0x177),_0x5820e9[_0x22c3b6(0x146)]=_0x5f3ac7,_0x142354[_0x22c3b6(0x166)](_0x5820e9);}_0x142354[_0x22c3b6(0x166)](document['createTextNode'](_0x19114b)),_0x58e202[_0x22c3b6(0x166)](_0x142354),_0x58e202['scrollTop']=_0x58e202[_0x22c3b6(0x135)];while(_0x58e202[_0x22c3b6(0x1b7)][_0x22c3b6(0x18c)]>0x14){_0x58e202['removeChild'](_0x58e202[_0x22c3b6(0x132)]);}}function clearLog(){const _0x11a212=_0x17a788;document['getElementById'](_0x11a212(0x10b))[_0x11a212(0x146)]='';}function fillCanvas(_0xf5abac){const _0x10e871=_0x17a788;ctx[_0x10e871(0x152)]=_0xf5abac,ctx['fillRect'](0x0,0x0,canvas[_0x10e871(0x1ad)],canvas[_0x10e871(0x131)]);}const image=new Image();function updateImage(){const _0x422b46=_0x17a788,_0x592fb8=document[_0x422b46(0x10f)](_0x422b46(0x1c0));if(_0x592fb8[_0x422b46(0x14b)][_0x422b46(0x18c)]==0x0){fillCanvas(_0x422b46(0x124));return;}image[_0x422b46(0x139)]=function(){const _0xed9720=_0x422b46;URL[_0xed9720(0xfc)](this[_0xed9720(0x10d)]);if(image[_0xed9720(0x1ad)]/ image[_0xed9720(0x131)]==canvas['width']/canvas['height']){if(isCropMode())exitCropMode();ctx[_0xed9720(0xfe)](image,0x0,0x0,image[_0xed9720(0x1ad)],image[_0xed9720(0x131)],0x0,0x0,canvas[_0xed9720(0x1ad)],canvas[_0xed9720(0x131)]),redrawTextElements(),redrawLineSegments(),convertDithering();}else initializeCrop();},image['src']=URL[_0x422b46(0x12f)](_0x592fb8['files'][0x0]);}function updateCanvasSize(){const _0x4b7b4d=_0x17a788,_0x402a35=document['getElementById'](_0x4b7b4d(0x10a))[_0x4b7b4d(0x105)],_0x200fa2=canvasSizes['find'](_0x1de4a9=>_0x1de4a9[_0x4b7b4d(0x170)]===_0x402a35);canvas[_0x4b7b4d(0x1ad)]=_0x200fa2['width'],canvas['height']=_0x200fa2[_0x4b7b4d(0x131)],updateImage();}function updateDitcherOptions(){const _0x5d2958=_0x17a788,_0x5b75f0=document[_0x5d2958(0x10f)]('epddriver'),_0x37755b=_0x5b75f0[_0x5d2958(0x14e)][_0x5b75f0[_0x5d2958(0x121)]],_0x2785fc=_0x37755b[_0x5d2958(0x168)]('data-color'),_0x16ab58=_0x37755b['getAttribute'](_0x5d2958(0x134));if(_0x2785fc)document[_0x5d2958(0x10f)](_0x5d2958(0x1c4))[_0x5d2958(0x105)]=_0x2785fc;if(_0x16ab58)document[_0x5d2958(0x10f)](_0x5d2958(0x10a))[_0x5d2958(0x105)]=_0x16ab58;updateCanvasSize();}function rotateCanvas(){const _0x4c5207=_0x17a788,_0x160791=canvas[_0x4c5207(0x1ad)],_0x930b85=canvas[_0x4c5207(0x131)];canvas[_0x4c5207(0x1ad)]=_0x930b85,canvas[_0x4c5207(0x131)]=_0x160791,updateImage();}function clearCanvas(){const _0x5cdaa8=_0x17a788;if(0x1){fillCanvas(_0x5cdaa8(0x124)),textElements=[],lineSegments=[];if(isCropMode())exitCropMode();return!![];}return![];}function convertDithering(){const _0x4e6973=_0x17a788,_0x4202a0=parseFloat(document[_0x4e6973(0x10f)](_0x4e6973(0x19b))[_0x4e6973(0x105)]),_0x47d017=ctx[_0x4e6973(0x144)](0x0,0x0,canvas['width'],canvas['height']),_0x35a7e9=new ImageData(new Uint8ClampedArray(_0x47d017[_0x4e6973(0x199)]),_0x47d017['width'],_0x47d017[_0x4e6973(0x131)]);adjustContrast(_0x35a7e9,_0x4202a0);const _0x43a723=document['getElementById']('ditherAlg')[_0x4e6973(0x105)],_0x3266e8=parseFloat(document[_0x4e6973(0x10f)](_0x4e6973(0x197))[_0x4e6973(0x105)]),_0x49b91d=document[_0x4e6973(0x10f)]('ditherMode')[_0x4e6973(0x105)],_0x1adf6e=processImageData(ditherImage(_0x35a7e9,_0x43a723,_0x3266e8,_0x49b91d),_0x49b91d),_0x10039f=decodeProcessedData(_0x1adf6e,canvas[_0x4e6973(0x1ad)],canvas['height'],_0x49b91d);ctx[_0x4e6973(0x191)](_0x10039f,0x0,0x0);}function initEventHandlers(){const _0x473061=_0x17a788;document[_0x473061(0x10f)](_0x473061(0x162))['addEventListener']('change',updateDitcherOptions),document[_0x473061(0x10f)](_0x473061(0x1c0))[_0x473061(0x1bc)](_0x473061(0x1c7),updateImage),document[_0x473061(0x10f)](_0x473061(0x1c4))[_0x473061(0x1bc)](_0x473061(0x1c7),finishCrop),document['getElementById'](_0x473061(0x190))[_0x473061(0x1bc)](_0x473061(0x1c7),finishCrop),document['getElementById'](_0x473061(0x197))[_0x473061(0x1bc)]('input',function(){const _0x375072=_0x473061;finishCrop(),document[_0x375072(0x10f)](_0x375072(0x11f))[_0x375072(0x14d)]=parseFloat(this[_0x375072(0x105)])[_0x375072(0x1a4)](0x1);}),document['getElementById'](_0x473061(0x19b))['addEventListener'](_0x473061(0x1c9),function(){const _0x11c358=_0x473061;finishCrop(),document[_0x11c358(0x10f)]('ditherContrastValue')['innerText']=parseFloat(this[_0x11c358(0x105)])[_0x11c358(0x1a4)](0x1);}),document[_0x473061(0x10f)]('canvasSize')[_0x473061(0x1bc)]('change',updateCanvasSize);}function checkDebugMode(){const _0x2c6f9e=_0x17a788,_0x1085f3=document[_0x2c6f9e(0x10f)](_0x2c6f9e(0x194)),_0x5090bc=new URLSearchParams(window[_0x2c6f9e(0x16b)][_0x2c6f9e(0x167)]),_0x121ed9=_0x5090bc[_0x2c6f9e(0x1a9)](_0x2c6f9e(0x10c));document[_0x2c6f9e(0x19d)][_0x2c6f9e(0x16f)][_0x2c6f9e(0x137)](_0x2c6f9e(0x15e)),_0x1085f3[_0x2c6f9e(0x147)]('href',window[_0x2c6f9e(0x16b)][_0x2c6f9e(0xff)]);}document['body'][_0x17a788(0x139)]=()=>{const _0x4d3ca2=_0x17a788;textDecoder=null,canvas=document[_0x4d3ca2(0x10f)]('canvas'),ctx=canvas[_0x4d3ca2(0x18e)]('2d'),ctx[_0x4d3ca2(0x152)]=_0x4d3ca2(0x124),ctx['fillRect'](0x0,0x0,canvas[_0x4d3ca2(0x1ad)],canvas[_0x4d3ca2(0x131)]),initPaintTools(),initCropTools(),initEventHandlers(),updateButtonStatus(),checkDebugMode();};let currentRotation=0x0,originalImage=null;originalImage=image;const statusElement=document['getElementById'](_0x17a788(0x1b0)),rotationDisplay=document[_0x17a788(0x10f)]('rotationDegrees'),logElement=document[_0x17a788(0x10f)]('log');function drawImage(){const _0x316c07=_0x17a788;ctx['clearRect'](0x0,0x0,canvas[_0x316c07(0x1ad)],canvas[_0x316c07(0x131)]),ctx['fillStyle']=_0x316c07(0x1b3),ctx['fillRect'](0x0,0x0,canvas[_0x316c07(0x1ad)],canvas[_0x316c07(0x131)]),ctx[_0x316c07(0x155)](),ctx[_0x316c07(0x165)](canvas[_0x316c07(0x1ad)]/0x2,canvas[_0x316c07(0x131)]/0x2),ctx['rotate'](currentRotation*Math['PI']/0xb4);let _0x471a4b=originalImage[_0x316c07(0x1ad)],_0x1eacef=originalImage[_0x316c07(0x131)];Math[_0x316c07(0x19f)](currentRotation)%0xb4===0x5a&&([_0x471a4b,_0x1eacef]=[_0x1eacef,_0x471a4b]);const _0x56ac7a=Math[_0x316c07(0x1a0)](canvas[_0x316c07(0x1ad)]/_0x471a4b,canvas[_0x316c07(0x131)]/_0x1eacef);ctx['drawImage'](originalImage,-originalImage['width']*_0x56ac7a/0x2,-originalImage[_0x316c07(0x131)]*_0x56ac7a/0x2,originalImage[_0x316c07(0x1ad)]*_0x56ac7a,originalImage['height']*_0x56ac7a),convertDithering(),ctx[_0x316c07(0x12c)]();}function rotateImage(_0x46cb1f){const _0x6e4b75=_0x17a788;currentRotation=(currentRotation+_0x46cb1f)%0x168,drawImage(),addLog(_0x6e4b75(0x138)+currentRotation+'°');}