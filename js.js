const _0x308368=_0x16c3;(function(_0x178f40,_0x2e4d8c){const _0x529907=_0x16c3,_0x511dcb=_0x178f40();while(!![]){try{const _0x27ed36=parseInt(_0x529907(0xf2))/0x1+parseInt(_0x529907(0x8e))/0x2*(parseInt(_0x529907(0x97))/0x3)+parseInt(_0x529907(0xda))/0x4+parseInt(_0x529907(0x8d))/0x5+parseInt(_0x529907(0x99))/0x6+parseInt(_0x529907(0xe9))/0x7*(-parseInt(_0x529907(0x106))/0x8)+parseInt(_0x529907(0x143))/0x9*(-parseInt(_0x529907(0xd2))/0xa);if(_0x27ed36===_0x2e4d8c)break;else _0x511dcb['push'](_0x511dcb['shift']());}catch(_0x284389){_0x511dcb['push'](_0x511dcb['shift']());}}}(_0x95b4,0xd0553));let bleDevice,gattServer,epdService,epdCharacteristic,startTime,msgIndex,appVersion,canvas,ctx,textDecoder;const EpdCmd={'SET_PINS':0x0,'INIT':0x1,'CLEAR':0x2,'SEND_CMD':0x3,'SEND_DATA':0x4,'REFRESH':0x5,'SLEEP':0x6,'SET_TIME':0x20,'WRITE_IMG':0x30,'SET_CONFIG':0x90,'SYS_RESET':0x91,'SYS_SLEEP':0x92,'CFG_ERASE':0x99,'EPD_CMD_J_H':0xff,'EPD_CMD_N_Z':0xef,'EPD_CMD_J_S':0xee,'EPD_CMD_D_S':0xed,'EPD_CMD_LED':0xec,'EPD_CMD_MY':0xeb,'EPD_CMD_COLOR':0xea,'EPD_CMD_4_MS':0xfe,'EPD_CMD_4_C0LOR':0xfd,'EPD_CMD_4_XZ':0xfc,'EPD_CMD_4_ZF':0xfb},canvasSizes=[{'name':_0x308368(0x114),'width':0x98,'height':0x98},{'name':'1.54_200_200','width':0xc8,'height':0xc8},{'name':_0x308368(0x15e),'width':0xd4,'height':0x68},{'name':_0x308368(0x148),'width':0xfa,'height':0x7a},{'name':_0x308368(0xa5),'width':0x128,'height':0x98},{'name':_0x308368(0x15a),'width':0x128,'height':0x80},{'name':'2.9_384_168','width':0x180,'height':0xa8},{'name':'3.5_384_184','width':0x180,'height':0xb8},{'name':_0x308368(0x14d),'width':0x1a0,'height':0xf0},{'name':_0x308368(0x95),'width':0x320,'height':0x1e0},{'name':_0x308368(0xce),'width':0x190,'height':0x12c},{'name':'5.79_792_272','width':0x318,'height':0x110},{'name':_0x308368(0xf6),'width':0x320,'height':0x1e0},{'name':_0x308368(0x10f),'width':0x3c0,'height':0x280},{'name':_0x308368(0xb9),'width':0x550,'height':0x1e0},{'name':_0x308368(0xf0),'width':0x3c0,'height':0x280},{'name':_0x308368(0xb4),'width':0x258,'height':0x190},{'name':_0x308368(0x119),'width':0x1e0,'height':0x320}];function hex2bytes(_0x30803c){const _0x58f587=_0x308368;for(var _0x104670=[],_0x3bb55a=0x0;_0x3bb55a<_0x30803c[_0x58f587(0x11c)];_0x3bb55a+=0x2)_0x104670[_0x58f587(0xb7)](parseInt(_0x30803c[_0x58f587(0x127)](_0x3bb55a,0x2),0x10));return new Uint8Array(_0x104670);}function bytes2hex(_0x2a3b70){const _0x3f3064=_0x308368;return new Uint8Array(_0x2a3b70)[_0x3f3064(0x9c)](function(_0x298e4f,_0x2d6828){return _0x298e4f+('0'+_0x2d6828['toString'](0x10))['slice'](-0x2);},'');}function intToHex(_0x14f470){const _0x457632=_0x308368;let _0x43a4f8=('0000'+_0x14f470['toString'](0x10))[_0x457632(0x127)](-0x4);return _0x43a4f8[_0x457632(0x15f)](0x2,0x4)+_0x43a4f8[_0x457632(0x15f)](0x0,0x2);}function resetVariables(){const _0x191ab6=_0x308368;gattServer=null,epdService=null,epdCharacteristic=null,msgIndex=0x0,document[_0x191ab6(0xc8)]('log')['value']='';}async function write(_0x4addcd,_0xd7cfef,_0x2f07ca=!![]){const _0x16b043=_0x308368;if(!epdCharacteristic)return addLog(_0x16b043(0xe6)),![];let _0x4163fe=[_0x4addcd];if(_0xd7cfef){if(typeof _0xd7cfef==_0x16b043(0xa8))_0xd7cfef=hex2bytes(_0xd7cfef);if(_0xd7cfef instanceof Uint8Array)_0xd7cfef=Array['from'](_0xd7cfef);_0x4163fe[_0x16b043(0xb7)](..._0xd7cfef);}try{if(_0x2f07ca)await epdCharacteristic[_0x16b043(0xbb)](Uint8Array[_0x16b043(0x157)](_0x4163fe));else await epdCharacteristic[_0x16b043(0x8f)](Uint8Array[_0x16b043(0x157)](_0x4163fe));}catch(_0x30df71){console[_0x16b043(0x122)](_0x30df71);if(_0x30df71['message'])addLog(_0x16b043(0xec)+_0x30df71[_0x16b043(0xa9)]);return![];}return!![];}async function writeImage(_0x2c9c99,_0x46fe23='bw'){const _0x4187c0=_0x308368,_0x3c9a84=document['getElementById'](_0x4187c0(0x111))[_0x4187c0(0xca)]-0x2,_0x5a695b=document['getElementById'](_0x4187c0(0x153))['value'],_0x423578=Math[_0x4187c0(0x121)](_0x2c9c99['length']/_0x3c9a84);let _0x34c774=0x0,_0x57c128=_0x5a695b;for(let _0xa68b14=0x0;_0xa68b14<_0x2c9c99[_0x4187c0(0x11c)];_0xa68b14+=_0x3c9a84){let _0x281d46=(new Date()[_0x4187c0(0xc0)]()-startTime)/0x3e8;setStatus((_0x46fe23=='bw'?'黑白':'红色')+_0x4187c0(0x129)+(_0x34c774+0x1)+'/'+(_0x423578+0x1)+_0x4187c0(0xbf)+_0x281d46+'s');const _0x1bbb4c=[(_0x46fe23=='bw'?0xf:0x0)|(_0xa68b14==0x0?0x0:0xf0),..._0x2c9c99[_0x4187c0(0xe8)](_0xa68b14,_0xa68b14+_0x3c9a84)];_0x57c128>0x0?(await write(EpdCmd[_0x4187c0(0x12a)],_0x1bbb4c,![]),_0x57c128--):(await write(EpdCmd[_0x4187c0(0x12a)],_0x1bbb4c,!![]),_0x57c128=_0x5a695b),_0x34c774++;}}async function setDriver(){const _0x3dbcf2=_0x308368;await write(EpdCmd['SET_PINS'],document['getElementById']('epdpins')['value']),await write(EpdCmd[_0x3dbcf2(0xe2)],document[_0x3dbcf2(0xc8)](_0x3dbcf2(0xac))[_0x3dbcf2(0xca)]);}async function set_EPD_CMD_J_H(){const _0x4ea760=_0x308368;await write(EpdCmd[_0x4ea760(0x14a)],document[_0x4ea760(0xc8)](_0x4ea760(0x107))[_0x4ea760(0xca)]);}async function set_EPD_CMD_N_Z(){const _0x360e32=_0x308368,_0x222f9e=document[_0x360e32(0xc8)](_0x360e32(0x10c))[_0x360e32(0xca)],_0xdf8621=document[_0x360e32(0xc8)](_0x360e32(0xb1))['value'],_0xb58233=document[_0x360e32(0xc8)](_0x360e32(0xb6))['value'],_0x2c3681=[0x4];_0x2c3681[0x0]=0x0,_0x2c3681[0x1]=0x0,_0x2c3681[0x2]=_0x222f9e,_0x2c3681[0x3]=_0xdf8621,_0x2c3681[0x4]=_0xb58233,await write(EpdCmd[_0x360e32(0x159)],_0x2c3681);}async function set_EPD_CMD_D_S(){const _0x3b9e19=_0x308368,_0x22d6f3=document[_0x3b9e19(0xc8)](_0x3b9e19(0x11e))[_0x3b9e19(0xca)],_0x45840a=document[_0x3b9e19(0xc8)](_0x3b9e19(0xfc))[_0x3b9e19(0xca)],_0x4219d2=document['getElementById'](_0x3b9e19(0xd5))[_0x3b9e19(0xca)],_0x5d6979=[0x4];_0x5d6979[0x0]=0x0,_0x5d6979[0x1]=0x0,_0x5d6979[0x2]=_0x22d6f3,_0x5d6979[0x3]=_0x45840a,_0x5d6979[0x4]=_0x4219d2,await write(EpdCmd[_0x3b9e19(0xab)],_0x5d6979);}async function set_EPD_CMD_J_S(){const _0x489d02=_0x308368,_0x33ca0f=document[_0x489d02(0xc8)](_0x489d02(0xf9))['value'],_0x166b8b=document['getElementById'](_0x489d02(0x98))[_0x489d02(0xca)],_0x58a0e6=document['getElementById']('J_S_start')[_0x489d02(0xca)],_0x44f7eb=[0x4];_0x44f7eb[0x0]=0x0,_0x44f7eb[0x1]=0x0,_0x44f7eb[0x2]=_0x33ca0f,_0x44f7eb[0x3]=_0x166b8b,_0x44f7eb[0x4]=_0x58a0e6,await write(EpdCmd['EPD_CMD_J_S'],_0x44f7eb);}async function set_EPD_CMD_LED(){const _0x568bb4=_0x308368,_0x36358=document['getElementById'](_0x568bb4(0x9b))[_0x568bb4(0xca)],_0x47a026=document['getElementById'](_0x568bb4(0x110))['value'],_0x28afb8=document[_0x568bb4(0xc8)](_0x568bb4(0x115))[_0x568bb4(0xca)],_0xc6101d=document['getElementById'](_0x568bb4(0x15d))[_0x568bb4(0xca)],_0x5db4d9=document[_0x568bb4(0xc8)](_0x568bb4(0x15d))[_0x568bb4(0xca)],_0x201bb9=[0x5];_0x201bb9[0x0]=_0x36358,_0x201bb9[0x1]=_0x47a026,_0x201bb9[0x2]=_0x28afb8,_0x201bb9[0x3]=_0xc6101d,_0x201bb9[0x4]=_0x5db4d9,await write(EpdCmd[_0x568bb4(0xea)],_0x201bb9);}async function set_EPD_CMD_MY(){const _0xbef064=_0x308368,_0x441a2f=document['getElementById'](_0xbef064(0x131))['value'],_0x23c454=document[_0xbef064(0xc8)](_0xbef064(0x91))['value'],_0x25028f=document[_0xbef064(0xc8)](_0xbef064(0x11b))[_0xbef064(0xca)],_0x205d74=document[_0xbef064(0xc8)](_0xbef064(0xae))['value'],_0x534348=[0x4];_0x534348[0x0]=_0x441a2f,_0x534348[0x1]=_0x23c454,_0x534348[0x2]=_0x25028f,_0x534348[0x3]=_0x205d74,await write(EpdCmd[_0xbef064(0x8c)],_0x534348);}async function set_EPD_CMD_COLOR(){const _0x18374a=_0x308368,_0x285532=document[_0x18374a(0xc8)](_0x18374a(0xeb))[_0x18374a(0xca)],_0x5dfcf2=document[_0x18374a(0xc8)](_0x18374a(0x10e))[_0x18374a(0xca)],_0x50cb39=document['getElementById'](_0x18374a(0x101))[_0x18374a(0xca)],_0x33bdf5=document['getElementById'](_0x18374a(0xa6))[_0x18374a(0xca)],_0x24e8e0=document[_0x18374a(0xc8)](_0x18374a(0xe4))[_0x18374a(0xca)],_0x2bb512=document[_0x18374a(0xc8)]('jieqi_color')[_0x18374a(0xca)],_0x15a088=document[_0x18374a(0xc8)](_0x18374a(0x11d))[_0x18374a(0xca)],_0x50de84=[0x7];_0x50de84[0x0]=_0x285532,_0x50de84[0x1]=_0x5dfcf2,_0x50de84[0x2]=_0x50cb39,_0x50de84[0x3]=_0x33bdf5,_0x50de84[0x4]=_0x24e8e0,_0x50de84[0x5]=_0x2bb512,_0x50de84[0x6]=_0x15a088,await write(EpdCmd[_0x18374a(0x149)],_0x50de84);}async function set_EPD_CMD_4_MS(){const _0x53e860=_0x308368,_0xedec9a=document[_0x53e860(0xc8)](_0x53e860(0x96))['value'],_0x500e96=document[_0x53e860(0xc8)](_0x53e860(0xc6))['value'],_0x5bc778=document[_0x53e860(0xc8)]('jushua_time1')[_0x53e860(0xca)],_0x4d3187=document[_0x53e860(0xc8)](_0x53e860(0x13c))[_0x53e860(0xca)],_0x2b889c=document[_0x53e860(0xc8)]('moshi_id')['value'],_0x1ed99e=document[_0x53e860(0xc8)]('color_11')[_0x53e860(0xca)],_0x52aa47=[0x4];_0x52aa47[0x0]=_0xedec9a,_0x52aa47[0x1]=_0x500e96,_0x52aa47[0x2]=_0x5bc778,_0x52aa47[0x3]=_0x4d3187,_0x52aa47[0x4]=_0x2b889c,_0x52aa47[0x5]=_0x1ed99e,await write(EpdCmd['EPD_CMD_4_MS'],_0x52aa47);}async function set_EPD_CMD_4_ZF(_0x4b8534){const _0x3cd930=_0x308368,_0x1a9558=[0x1];_0x1a9558[0x0]=_0x4b8534,await write(EpdCmd['EPD_CMD_4_ZF'],_0x1a9558),_0x4b8534==0x0&&(syncTime(0x2),addLog(_0x3cd930(0xdd)));}async function syncTime(_0x55f6eb){const _0x3f2078=_0x308368,_0x19e992=new Date()[_0x3f2078(0xc0)]()/0x3e8,_0x22cea7=new Uint8Array([_0x19e992>>0x18&0xff,_0x19e992>>0x10&0xff,_0x19e992>>0x8&0xff,_0x19e992&0xff,-(new Date()[_0x3f2078(0x139)]()/0x3c),_0x55f6eb]);await write(EpdCmd[_0x3f2078(0xc1)],_0x22cea7)&&addLog(_0x3f2078(0xed));}async function clearScreen(){const _0x3fecdd=_0x308368;0x1&&(await write(EpdCmd[_0x3fecdd(0x13b)]),addLog(_0x3fecdd(0x112)));}function _0x95b4(){const _0x2ab5e0=['canvas','disconnect','height','REFRESH','fourColor','1857015bOGuur','createObjectURL','ditherContrastValue','canvasSize','selectedIndex','2.13_250_122','EPD_CMD_COLOR','EPD_CMD_J_H','blackWhiteColor','byteLength','3.7_416_240','已连接！','change','rotationDegrees','log','debug-toggle','interleavedcount','startNotifications','62750003-d828-918d-fb46-b6c11c675aec','正在连接:\x20','from','textContent','EPD_CMD_N_Z','2.9_296_128','width','onload','liangdu','2.13_212_104','substring','status','debug-mode','EPD_CMD_MY','1774905YPyPfS','42qarDod','writeValueWithoutResponse','restore','xuanzhuan','getContext','getHours','characteristicvaluechanged','3.97_800_480','fanxian1','104991GMhNMI','J_S_min','2856288smilVo','style','color_led','reduce','get','ditherStrengthValue','classList','imageFile','add','setAttribute','scrollHeight','body','2.66_296_152','gongli_color','target','string','message','calendarmodebutton','EPD_CMD_D_S','epddriver','find','jushua_time','innerHTML','当前固件不支持此颜色模式。','N_Z_min','click','red','4E_600_400','href','N_Z_start','push','drawImage','10.85_1360_480','connectbutton','writeValueWithResponse','className','ditherStrength','none',',\x20总用时:\x20','getTime','SET_TIME','getImageData','sendcmdbutton','color','scrollTop','xuanzhuan1','padStart','getElementById','name','value','ditherContrast','div','62750002-d828-918d-fb46-b6c11c675aec','4.2_400_300','clearRect','span','readValue','40LMzAuv','location','发送完成！耗时:\x20','D_S_start','appendChild','min','floor','debug','279384LApOME','已断开连接.','ditherMode','主机已同步时间！','gatt','请检查蓝牙，推荐使用Edge浏览器！','62750001-d828-918d-fb46-b6c11c675aec','sixColor','INIT','reconnectbutton','shichen_color','disabled','没有链接蓝牙','fillStyle','slice','7jADWOk','EPD_CMD_LED','color_1','write:\x20','已同步时间！','请等待屏幕刷新完成！','const\x20uint8_t\x20imageData[]\x20IMAGE\x20=\x20{','11.6_960_640','startsWith','175152dnmlYz','data','options','toFixed','7.5_800_480','requestDevice','connected','J_S_hour','requestDevice:\x20','innerText','D_S_min','clockmodebutton','input','rotate','childNodes','wendu_color','cmdTXT','createTextNode','错误：预期','data-size','1058344fChZJm','epdpins','addEventListener','connect:\x20','getAttribute','src','N_Z_hour','image.h','time_color','10.2_960_640','liang_time','mtusize','已清除屏慕！','revokeObjectURL','1.54_152_152','liang_add','save','sendimgbutton','mtu=','7.3E6','connect','qiangzhi_shuaxing','length','r_jushua_time','D_S_hour','buffer','ditherAlg','round','error','clearscreenbutton','startNotifications:\x20','threeColor','download','substr','text/plain','块:\x20','WRITE_IMG','createElement','white','getUint8','字节，但得到','setDriverbutton','search','fanxian','byteOffset','gattserverdisconnected','action','join','fillRect','parentElement','data-color','getTimezoneOffset','time','CLEAR','xianshi_peizhi','正在重连'];_0x95b4=function(){return _0x2ab5e0;};return _0x95b4();}function _0x16c3(_0xa81fd6,_0x29eacd){const _0x95b480=_0x95b4();return _0x16c3=function(_0x16c3b6,_0x110ec7){_0x16c3b6=_0x16c3b6-0x8b;let _0x159fa3=_0x95b480[_0x16c3b6];return _0x159fa3;},_0x16c3(_0xa81fd6,_0x29eacd);}async function sendcmd(){const _0x301558=_0x308368,_0x8b58cf=document['getElementById'](_0x301558(0x102))[_0x301558(0xca)];if(_0x8b58cf=='')return;const _0x2944f2=hex2bytes(_0x8b58cf);await write(_0x2944f2[0x0],_0x2944f2[_0x301558(0x11c)]>0x1?_0x2944f2['slice'](0x1):null);}async function sendimg(){const _0x5b1a86=_0x308368,_0x1e8504=document[_0x5b1a86(0xc8)]('canvasSize')[_0x5b1a86(0xca)],_0x4d1c73=document[_0x5b1a86(0xc8)](_0x5b1a86(0xdc))[_0x5b1a86(0xca)],_0x370784=document[_0x5b1a86(0xc8)](_0x5b1a86(0xac)),_0x38cf8d=_0x370784['options'][_0x370784[_0x5b1a86(0x147)]];startTime=new Date()[_0x5b1a86(0xc0)]();const _0x54dd75=document['getElementById'](_0x5b1a86(0x160));_0x54dd75[_0x5b1a86(0x137)][_0x5b1a86(0x9a)]['display']='block';const _0x3bed80=ctx[_0x5b1a86(0xc2)](0x0,0x0,canvas[_0x5b1a86(0x15b)],canvas[_0x5b1a86(0x140)]),_0x595706=processImageData(_0x3bed80,_0x4d1c73);updateButtonStatus(!![]);if(_0x4d1c73===_0x5b1a86(0x142))await writeImage(_0x595706,_0x5b1a86(0xc4));else{if(_0x4d1c73===_0x5b1a86(0x125)){const _0x2b1bce=Math[_0x5b1a86(0xd8)](_0x595706[_0x5b1a86(0x11c)]/0x2);await writeImage(_0x595706['slice'](0x0,_0x2b1bce),'bw'),await writeImage(_0x595706[_0x5b1a86(0xe8)](_0x2b1bce),_0x5b1a86(0xb3));}else{if(_0x4d1c73===_0x5b1a86(0x14b))await writeImage(_0x595706,'bw');else{addLog(_0x5b1a86(0xb0)),updateButtonStatus();return;}}}await write(EpdCmd[_0x5b1a86(0x141)]),updateButtonStatus();const _0x43c94a=(new Date()[_0x5b1a86(0xc0)]()-startTime)/0x3e8;addLog(_0x5b1a86(0xd4)+_0x43c94a+'s'),setStatus(_0x5b1a86(0xd4)+_0x43c94a+'s'),addLog(_0x5b1a86(0xee)),setTimeout(()=>{const _0x13100b=_0x5b1a86;_0x54dd75[_0x13100b(0x137)][_0x13100b(0x9a)]['display']=_0x13100b(0xbe);},0x1388);}function downloadDataArray(){const _0x2e5efd=_0x308368;if(isCropMode())return;const _0x138f15=document[_0x2e5efd(0xc8)](_0x2e5efd(0xdc))[_0x2e5efd(0xca)],_0x64adef=ctx[_0x2e5efd(0xc2)](0x0,0x0,canvas[_0x2e5efd(0x15b)],canvas[_0x2e5efd(0x140)]),_0x438702=processImageData(_0x64adef,_0x138f15);if(_0x138f15===_0x2e5efd(0xe1)&&_0x438702[_0x2e5efd(0x11c)]!==canvas[_0x2e5efd(0x15b)]*canvas[_0x2e5efd(0x140)]){console[_0x2e5efd(0x151)](_0x2e5efd(0x104)+canvas[_0x2e5efd(0x15b)]*canvas['height']+_0x2e5efd(0x12e)+_0x438702['length']+'字节');return;}const _0x15690d=[];for(let _0x3a3d36=0x0;_0x3a3d36<_0x438702[_0x2e5efd(0x11c)];_0x3a3d36++){const _0x3af619=(_0x438702[_0x3a3d36]&0xff)['toString'](0x10)[_0x2e5efd(0xc7)](0x2,'0');_0x15690d[_0x2e5efd(0xb7)]('0x'+_0x3af619);}const _0x2554be=[];for(let _0x30f59b=0x0;_0x30f59b<_0x15690d[_0x2e5efd(0x11c)];_0x30f59b+=0x10){_0x2554be[_0x2e5efd(0xb7)](_0x15690d[_0x2e5efd(0xe8)](_0x30f59b,_0x30f59b+0x10)['join'](',\x20'));}const _0x2516b7=_0x138f15===_0x2e5efd(0xe1)?0x0:_0x138f15===_0x2e5efd(0x142)?0x1:_0x138f15===_0x2e5efd(0x14b)?0x2:0x3,_0x376d48=[_0x2e5efd(0xef),_0x2554be[_0x2e5efd(0x135)](',\x0a'),'};','const\x20uint16_t\x20imageWidth\x20=\x20'+canvas[_0x2e5efd(0x15b)]+';','const\x20uint16_t\x20imageHeight\x20=\x20'+canvas[_0x2e5efd(0x140)]+';','const\x20uint8_t\x20colorMode\x20=\x20'+_0x2516b7+';']['join']('\x0a'),_0x4d637f=new Blob([_0x376d48],{'type':_0x2e5efd(0x128)}),_0xb06cb=document['createElement']('a');_0xb06cb[_0x2e5efd(0x126)]=_0x2e5efd(0x10d),_0xb06cb['href']=URL[_0x2e5efd(0x144)](_0x4d637f),_0xb06cb[_0x2e5efd(0xb2)](),URL[_0x2e5efd(0x113)](_0xb06cb['href']);}function updateButtonStatus(_0x6e729a=![]){const _0x26c788=_0x308368,_0x1e870e=gattServer!=null&&gattServer[_0x26c788(0xf8)],_0x1c4cc1=_0x6e729a?_0x26c788(0xe5):_0x1e870e?null:'disabled';document[_0x26c788(0xc8)](_0x26c788(0xe3))['disabled']=gattServer==null||gattServer[_0x26c788(0xf8)]?_0x26c788(0xe5):null,document[_0x26c788(0xc8)](_0x26c788(0xc3))[_0x26c788(0xe5)]=_0x1c4cc1,document[_0x26c788(0xc8)](_0x26c788(0xaa))[_0x26c788(0xe5)]=_0x1c4cc1,document['getElementById'](_0x26c788(0xfd))[_0x26c788(0xe5)]=_0x1c4cc1,document[_0x26c788(0xc8)](_0x26c788(0x123))[_0x26c788(0xe5)]=_0x1c4cc1,document[_0x26c788(0xc8)](_0x26c788(0x117))[_0x26c788(0xe5)]=_0x1c4cc1,document[_0x26c788(0xc8)](_0x26c788(0x12f))[_0x26c788(0xe5)]=_0x1c4cc1;}function disconnect(){const _0x1194e4=_0x308368;updateButtonStatus(),resetVariables(),addLog(_0x1194e4(0xdb)),document[_0x1194e4(0xc8)](_0x1194e4(0xba))['innerHTML']='连接';}async function preConnect(){const _0x5586de=_0x308368;if(gattServer!=null&&gattServer[_0x5586de(0xf8)])bleDevice!=null&&bleDevice[_0x5586de(0xde)][_0x5586de(0xf8)]&&bleDevice['gatt']['disconnect']();else{resetVariables();try{bleDevice=await navigator['bluetooth'][_0x5586de(0xf7)]({'optionalServices':['62750001-d828-918d-fb46-b6c11c675aec'],'acceptAllDevices':!![]});}catch(_0x559cce){console['error'](_0x559cce);if(_0x559cce[_0x5586de(0xa9)])addLog(_0x5586de(0xfa)+_0x559cce['message']);addLog(_0x5586de(0xdf));return;}await bleDevice[_0x5586de(0x108)](_0x5586de(0x133),disconnect),setTimeout(async function(){await connect();},0x12c);}}async function reConnect(){const _0x3c9181=_0x308368;if(bleDevice!=null&&bleDevice['gatt'][_0x3c9181(0xf8)])bleDevice[_0x3c9181(0xde)][_0x3c9181(0x13f)]();resetVariables(),addLog(_0x3c9181(0x13d)),setTimeout(async function(){await connect();},0x12c);}function handleNotify(_0x5a1437,_0x494fc9){const _0x6768c8=_0x308368,_0x380da9=new Uint8Array(_0x5a1437[_0x6768c8(0x11f)],_0x5a1437[_0x6768c8(0x132)],_0x5a1437[_0x6768c8(0x14c)]);if(_0x494fc9==0x0){}else{if(textDecoder==null)textDecoder=new TextDecoder();const _0xff3028=textDecoder['decode'](_0x380da9);if(_0xff3028[_0x6768c8(0xf1)](_0x6768c8(0x118))&&_0xff3028[_0x6768c8(0x11c)]>0x4){const _0x324cac=parseInt(_0xff3028[_0x6768c8(0x15f)](0x4));document['getElementById'](_0x6768c8(0x111))[_0x6768c8(0xca)]=_0x324cac;}else{if(_0xff3028[_0x6768c8(0xf1)]('t=')&&_0xff3028['length']>0x2){const _0x3d6cb1=parseInt(_0xff3028['substring'](0x2))+new Date()[_0x6768c8(0x139)]()*0x3c;}}}}async function connect(){const _0xdbaaa9=_0x308368;if(bleDevice==null||epdCharacteristic!=null)return;try{addLog(_0xdbaaa9(0x156)+bleDevice[_0xdbaaa9(0xc9)]),gattServer=await bleDevice[_0xdbaaa9(0xde)][_0xdbaaa9(0x11a)](),epdService=await gattServer['getPrimaryService'](_0xdbaaa9(0xe0)),epdCharacteristic=await epdService['getCharacteristic'](_0xdbaaa9(0xcd)),addLog(_0xdbaaa9(0x14e));}catch(_0x170f11){console[_0xdbaaa9(0x122)](_0x170f11);if(_0x170f11[_0xdbaaa9(0xa9)])addLog(_0xdbaaa9(0x109)+_0x170f11[_0xdbaaa9(0xa9)]);disconnect();return;}try{const _0x130b0f=await epdService['getCharacteristic'](_0xdbaaa9(0x155)),_0x4f4b5b=await _0x130b0f[_0xdbaaa9(0xd1)]();appVersion=_0x4f4b5b[_0xdbaaa9(0x12d)](0x0);}catch(_0x4bb51e){console[_0xdbaaa9(0x122)](_0x4bb51e),appVersion=0x15;}try{await epdCharacteristic[_0xdbaaa9(0x154)](),epdCharacteristic[_0xdbaaa9(0x108)](_0xdbaaa9(0x94),_0x19a207=>{const _0xf8e9b8=_0xdbaaa9;handleNotify(_0x19a207[_0xf8e9b8(0xa7)]['value'],msgIndex++);});}catch(_0x21a04c){console[_0xdbaaa9(0x122)](_0x21a04c);if(_0x21a04c[_0xdbaaa9(0xa9)])addLog(_0xdbaaa9(0x124)+_0x21a04c[_0xdbaaa9(0xa9)]);}await write(EpdCmd[_0xdbaaa9(0xe2)]),document['getElementById'](_0xdbaaa9(0xba))['innerHTML']='断开',updateButtonStatus();}function setStatus(_0x4fbf7f){const _0x12a1c2=_0x308368;document['getElementById'](_0x12a1c2(0x160))[_0x12a1c2(0xaf)]=_0x4fbf7f;}function addLog(_0x1802fb,_0x3da517=''){const _0x1fd561=_0x308368,_0x217ed7=document['getElementById'](_0x1fd561(0x151)),_0x14da89=new Date(),_0x23c540=String(_0x14da89[_0x1fd561(0x93)]())['padStart'](0x2,'0')+':'+String(_0x14da89['getMinutes']())[_0x1fd561(0xc7)](0x2,'0')+':'+String(_0x14da89['getSeconds']())[_0x1fd561(0xc7)](0x2,'0')+'\x20',_0x5788d8=document['createElement'](_0x1fd561(0xcc)),_0x5be476=document['createElement'](_0x1fd561(0xd0));_0x5be476[_0x1fd561(0xbc)]=_0x1fd561(0x13a),_0x5be476[_0x1fd561(0x158)]=_0x23c540,_0x5788d8[_0x1fd561(0xd6)](_0x5be476);if(_0x3da517!==''){const _0x4f9e35=document[_0x1fd561(0x12b)](_0x1fd561(0xd0));_0x4f9e35['className']=_0x1fd561(0x134),_0x4f9e35['innerHTML']=_0x3da517,_0x5788d8[_0x1fd561(0xd6)](_0x4f9e35);}_0x5788d8['appendChild'](document[_0x1fd561(0x103)](_0x1802fb)),_0x217ed7[_0x1fd561(0xd6)](_0x5788d8),_0x217ed7[_0x1fd561(0xc5)]=_0x217ed7[_0x1fd561(0xa3)];while(_0x217ed7[_0x1fd561(0x100)][_0x1fd561(0x11c)]>0x14){_0x217ed7['removeChild'](_0x217ed7['firstChild']);}}function clearLog(){const _0x49917d=_0x308368;document['getElementById'](_0x49917d(0x151))[_0x49917d(0xaf)]='';}function fillCanvas(_0x1531ec){const _0x5a11aa=_0x308368;ctx[_0x5a11aa(0xe7)]=_0x1531ec,ctx[_0x5a11aa(0x136)](0x0,0x0,canvas[_0x5a11aa(0x15b)],canvas['height']);}const image=new Image();function updateImage(){const _0xbb848c=_0x308368,_0xccc5a=document[_0xbb848c(0xc8)](_0xbb848c(0xa0));if(_0xccc5a['files']['length']==0x0){fillCanvas(_0xbb848c(0x12c));return;}image['onload']=function(){const _0x3fe075=_0xbb848c;URL[_0x3fe075(0x113)](this[_0x3fe075(0x10b)]);if(image[_0x3fe075(0x15b)]/ image['height']==canvas[_0x3fe075(0x15b)]/canvas[_0x3fe075(0x140)]){if(isCropMode())exitCropMode();ctx[_0x3fe075(0xb8)](image,0x0,0x0,image[_0x3fe075(0x15b)],image['height'],0x0,0x0,canvas[_0x3fe075(0x15b)],canvas[_0x3fe075(0x140)]),redrawTextElements(),redrawLineSegments(),convertDithering();}else initializeCrop();},image[_0xbb848c(0x10b)]=URL[_0xbb848c(0x144)](_0xccc5a['files'][0x0]);}function updateCanvasSize(){const _0x55dfaa=_0x308368,_0x527813=document[_0x55dfaa(0xc8)](_0x55dfaa(0x146))[_0x55dfaa(0xca)],_0x49db71=canvasSizes[_0x55dfaa(0xad)](_0x14796c=>_0x14796c['name']===_0x527813);canvas[_0x55dfaa(0x15b)]=_0x49db71[_0x55dfaa(0x15b)],canvas[_0x55dfaa(0x140)]=_0x49db71[_0x55dfaa(0x140)],updateImage();}function updateDitcherOptions(){const _0x1eae5a=_0x308368,_0x1f8c37=document['getElementById'](_0x1eae5a(0xac)),_0x4e9770=_0x1f8c37[_0x1eae5a(0xf4)][_0x1f8c37[_0x1eae5a(0x147)]],_0x3a788e=_0x4e9770['getAttribute'](_0x1eae5a(0x138)),_0x844d1c=_0x4e9770[_0x1eae5a(0x10a)](_0x1eae5a(0x105));if(_0x3a788e)document['getElementById'](_0x1eae5a(0xdc))[_0x1eae5a(0xca)]=_0x3a788e;if(_0x844d1c)document[_0x1eae5a(0xc8)]('canvasSize')[_0x1eae5a(0xca)]=_0x844d1c;updateCanvasSize();}function rotateCanvas(){const _0x267339=_0x308368,_0x245b52=canvas[_0x267339(0x15b)],_0x100596=canvas[_0x267339(0x140)];canvas['width']=_0x100596,canvas['height']=_0x245b52,updateImage();}function clearCanvas(){const _0x54ca7d=_0x308368;if(0x1){fillCanvas(_0x54ca7d(0x12c)),textElements=[],lineSegments=[];if(isCropMode())exitCropMode();return!![];}return![];}function convertDithering(){const _0x554ef8=_0x308368,_0x418f5c=parseFloat(document[_0x554ef8(0xc8)](_0x554ef8(0xcb))['value']),_0x2c35da=ctx[_0x554ef8(0xc2)](0x0,0x0,canvas[_0x554ef8(0x15b)],canvas[_0x554ef8(0x140)]),_0x533f91=new ImageData(new Uint8ClampedArray(_0x2c35da[_0x554ef8(0xf3)]),_0x2c35da[_0x554ef8(0x15b)],_0x2c35da['height']);adjustContrast(_0x533f91,_0x418f5c);const _0x285873=document['getElementById'](_0x554ef8(0x120))[_0x554ef8(0xca)],_0x2b306f=parseFloat(document[_0x554ef8(0xc8)](_0x554ef8(0xbd))[_0x554ef8(0xca)]),_0x305a21=document[_0x554ef8(0xc8)]('ditherMode')[_0x554ef8(0xca)],_0x49bf44=processImageData(ditherImage(_0x533f91,_0x285873,_0x2b306f,_0x305a21),_0x305a21),_0x5c0263=decodeProcessedData(_0x49bf44,canvas['width'],canvas[_0x554ef8(0x140)],_0x305a21);ctx['putImageData'](_0x5c0263,0x0,0x0);}function initEventHandlers(){const _0x1ca17a=_0x308368;document[_0x1ca17a(0xc8)](_0x1ca17a(0xac))['addEventListener'](_0x1ca17a(0x14f),updateDitcherOptions),document[_0x1ca17a(0xc8)](_0x1ca17a(0xa0))[_0x1ca17a(0x108)](_0x1ca17a(0x14f),updateImage),document['getElementById'](_0x1ca17a(0xdc))['addEventListener'](_0x1ca17a(0x14f),finishCrop),document[_0x1ca17a(0xc8)](_0x1ca17a(0x120))[_0x1ca17a(0x108)](_0x1ca17a(0x14f),finishCrop),document[_0x1ca17a(0xc8)]('ditherStrength')[_0x1ca17a(0x108)](_0x1ca17a(0xfe),function(){const _0x41c97d=_0x1ca17a;finishCrop(),document[_0x41c97d(0xc8)](_0x41c97d(0x9e))['innerText']=parseFloat(this[_0x41c97d(0xca)])[_0x41c97d(0xf5)](0x1);}),document[_0x1ca17a(0xc8)](_0x1ca17a(0xcb))['addEventListener'](_0x1ca17a(0xfe),function(){const _0x628456=_0x1ca17a;finishCrop(),document[_0x628456(0xc8)](_0x628456(0x145))[_0x628456(0xfb)]=parseFloat(this[_0x628456(0xca)])[_0x628456(0xf5)](0x1);}),document[_0x1ca17a(0xc8)](_0x1ca17a(0x146))[_0x1ca17a(0x108)](_0x1ca17a(0x14f),updateCanvasSize);}function checkDebugMode(){const _0x3171e0=_0x308368,_0x49121e=document[_0x3171e0(0xc8)](_0x3171e0(0x152)),_0x212e85=new URLSearchParams(window[_0x3171e0(0xd3)][_0x3171e0(0x130)]),_0x2c87fb=_0x212e85[_0x3171e0(0x9d)](_0x3171e0(0xd9));document[_0x3171e0(0xa4)][_0x3171e0(0x9f)][_0x3171e0(0xa1)](_0x3171e0(0x8b)),_0x49121e[_0x3171e0(0xa2)](_0x3171e0(0xb5),window[_0x3171e0(0xd3)]['pathname']);}document[_0x308368(0xa4)][_0x308368(0x15c)]=()=>{const _0x417145=_0x308368;textDecoder=null,canvas=document[_0x417145(0xc8)](_0x417145(0x13e)),ctx=canvas[_0x417145(0x92)]('2d'),ctx[_0x417145(0xe7)]='white',ctx[_0x417145(0x136)](0x0,0x0,canvas[_0x417145(0x15b)],canvas[_0x417145(0x140)]),initPaintTools(),initCropTools(),initEventHandlers(),updateButtonStatus(),checkDebugMode();};let currentRotation=0x0,originalImage=null;originalImage=image;const statusElement=document[_0x308368(0xc8)](_0x308368(0x160)),rotationDisplay=document[_0x308368(0xc8)](_0x308368(0x150)),logElement=document['getElementById'](_0x308368(0x151));function drawImage(){const _0x2f9fd9=_0x308368;ctx[_0x2f9fd9(0xcf)](0x0,0x0,canvas[_0x2f9fd9(0x15b)],canvas['height']),ctx[_0x2f9fd9(0xe7)]='#FFFFFF',ctx[_0x2f9fd9(0x136)](0x0,0x0,canvas[_0x2f9fd9(0x15b)],canvas[_0x2f9fd9(0x140)]),ctx[_0x2f9fd9(0x116)](),ctx['translate'](canvas['width']/0x2,canvas[_0x2f9fd9(0x140)]/0x2),ctx[_0x2f9fd9(0xff)](currentRotation*Math['PI']/0xb4);let _0xe338be=originalImage[_0x2f9fd9(0x15b)],_0x1f95bc=originalImage['height'];Math['abs'](currentRotation)%0xb4===0x5a&&([_0xe338be,_0x1f95bc]=[_0x1f95bc,_0xe338be]);const _0x4d8209=Math[_0x2f9fd9(0xd7)](canvas[_0x2f9fd9(0x15b)]/_0xe338be,canvas[_0x2f9fd9(0x140)]/_0x1f95bc);ctx[_0x2f9fd9(0xb8)](originalImage,-originalImage[_0x2f9fd9(0x15b)]*_0x4d8209/0x2,-originalImage['height']*_0x4d8209/0x2,originalImage[_0x2f9fd9(0x15b)]*_0x4d8209,originalImage['height']*_0x4d8209),convertDithering(),ctx[_0x2f9fd9(0x90)]();}function rotateImage(_0x2033ca){currentRotation=(currentRotation+_0x2033ca)%0x168,drawImage(),addLog('图片已旋转\x20'+currentRotation+'°');}
