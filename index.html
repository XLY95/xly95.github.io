<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>墨水屏蓝牙图片工具</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/css/font-awesome.min.css" rel="stylesheet"> -->
    <link rel="stylesheet" href="css.css">  

<head>

<body class="bg-gray-100 min-h-screen text-gray-800">
    <header class="bg-dark text-white shadow-md">
        <div class="container mx-auto px-3 py-2">
            <h1 class="text-base font-bold flex items-center">
                <i class="fa fa-bluetooth-b text-primary mr-2"></i>
                墨水屏蓝牙图片工具
            </h1>
        </div>
    </header>

    <main class="container mx-auto px-3 py-2">
        <!-- 先显示画布区域 -->
        <div class="mb-3">
            <!-- 处理后画布 -->
            <div class="control-panel">
                <div class="flex justify-between items-center mb-1">
                    <h2 class="panel-title">
                        <i class="fa fa-eye text-primary mr-2"></i>处理后画布
                    </h2>
                    <div class="flex space-x-1">
                        <button id="toggleCanvasFloat" class="btn-action bg-gray-200 text-gray-700 text-xs px-2">
                            <i class="fa fa-arrows-alt mr-1"></i>浮动画布
                        </button>
                        <button id="toggleDrawingMode" class="btn-action bg-primary text-white text-xs px-2">
                            <i class="fa fa-pencil mr-1"></i>开始绘画
                        </button>
                    </div>
                </div>
                <div class="bg-gray-100 p-1.5 rounded-lg flex justify-center items-center min-h-[180px] border-2 border-gray-200 canvas-container">
                    <canvas id="previewCanvas" class="border border-gray-300 cursor-crosshair hidden" style="cursor: crosshair; transition: transform 0.2s;"></canvas>
                    <div id="noImagePlaceholder" class="text-center text-gray-500 text-xs">
                        <i class="fa fa-image text-2xl mb-1"></i>
                        <p>上传图片或直接在画布上绘画</p>
                    </div>
                </div>
                <div class="mt-1 grid grid-cols-1 gap-1 text-xs">
                    <div>
                        <span class="font-medium text-gray-700">处理后画布:</span>
                        <span id="processedImageInfo" class="text-gray-500">296 × 128 像素 (黑白红)</span>
                    </div>
                    <div id="drawingStatus" class="text-gray-600 hidden">
                        <i class="fa fa-info-circle mr-1"></i>
                        <span>当前工具: <span id="currentTool">画笔</span> (粗细: <span id="currentSize">3</span>) <span id="drawingModeIndicator" class="hidden bg-amber-100 text-amber-800 px-1 rounded">(绘画模式 - 图片已锁定)</span></span>
                    </div>
                </div>
            </div>
        </div>

        <!-- 下方显示控制面板 -->
        <!-- <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-2"> -->
            <!-- 左侧控制面板 -->
            <div class="lg:col-span-1 space-y-2">
                <!-- 蓝牙连接 -->
                <div class="control-panel">
                    <h2 class="panel-title">
                        <i class="fa fa-bluetooth text-primary mr-2"></i>蓝牙连接
                    </h2>
                    <div class="flex space-x-1 mb-1.5">
                        <button id="connectbutton" class="btn-action bg-primary text-white flex-1" onclick="preConnect()">
                            <i class="fa fa-plug mr-1"></i>连接
                        </button>
                        <button id="reconnectbutton" class="btn-action bg-secondary text-white flex-1" onclick="reConnect()" disabled=""style="display:none">
                            <i class="fa fa-refresh mr-1"style="display:none"></i>重连
                        </button>
                    </div>
                 
                </div>
      <!-- 设备与画布设置 -->
                <div class="control-panel">
                    <h2 class="panel-title">
                        <i class="fa fa-cogs text-primary mr-2"></i>设备设置
                    </h2>
                    <div class="space-y-1 text-xs">
                        <div>
                            <label class="block text-gray-600 mb-0.5">墨水屏驱动</label>
                            <select id="epddriver" class="input-control" onchange="updateDitcherOptions()">
                                <option value="uc_blackWhite" data-size="4.2_400_300" data-color="blackWhiteColor">UC开头芯片 黑白</option>
                                <option value="uc_threeColor" data-size="7.5_800_480" data-color="threeColor">UC开头芯片 三色</option>
                                <option value="ssd_blackWhite" data-size="2.13_122_250" data-color="blackWhiteColor">SSD开头芯片 黑白</option>
                                <option value="ssd_threeColor" data-size="7.5_800_480" data-color="threeColor">SSD开头芯片 三色</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-gray-600 mb-0.5">画布尺寸</label>
                            <select id="canvasSize" class="input-control" onchange="updateCanvasSize(true)">
                                <option value="2.13_122_250">2.13 (122x250)</option>
                                <option value="4.2_400_300" selected="">4.2 (400x300)</option>
                                <option value="7.5_800_480">7.5 (800x480)</option>
                            </select>
                        </div>
                <!-- 图片上传 -->
                <div class="control-panel">
                    <h2 class="panel-title">
                        <i class="fa fa-upload text-primary mr-2"></i>图片上传
                    </h2>
                    <label class="block border-2 border-dashed border-gray-300 rounded-lg p-1.5 text-center hover:bg-gray-50 transition-colors cursor-pointer text-xs">
                        <!-- <i class="fa fa-picture-o text-xl text-gray-400 mb-1"></i> -->
                        <p class="text-gray-600">点击此处</p>
                        <input type="file" id="imageFile" accept="image/*" class="hidden" onchange="handleImageUpload(event)">
                    </label>
                    <div id="fileInfo" class="hidden text-xs text-gray-600 mt-1"></div>
                    
                    <!-- 图片缩放控制 -->
                    <div class="mt-1.5 text-xs">
                        <label class="block text-gray-600 mb-0.5">图片缩放</label>
                        <div class="flex items-center space-x-1">
                            <button class="btn-action bg-gray-200 text-gray-700 px-1.5" onclick="changeImageScale(-50)">
                                <i class="fa fa-search-minus"></i>
                            </button>
                            <input type="range" id="imageScale" min="0" max="1000" value="100" class="w-full h-1 bg-gray-200 rounded-lg appearance-none cursor-pointer" oninput="updateImageScale()">
                            <button class="btn-action bg-gray-200 text-gray-700 px-1.5" onclick="changeImageScale(50)">
                                <i class="fa fa-search-plus"></i>
                            </button>
                        </div>
                        <div class="flex justify-between text-xs text-gray-500 mt-0.5">
                            <span>0%</span>
                            <span id="imageScaleValue">100%</span>
                            <span>1000%</span>
                        </div>
                        <div class="grid grid-cols-2 gap-1 mt-1">
                            <button class="btn-action bg-primary text-white text-xs" onclick="fitImageToCanvas()">
                                <i class="fa fa-expand mr-1"></i>适应画布
                            </button>
                            <button class="btn-action bg-purple-600 text-white text-xs" onclick="fillCanvas()">
                                <i class="fa fa-clone mr-1"></i>铺满画布
                            </button>
                            <button class="btn-action bg-secondary text-white text-xs" onclick="centerImageOnCanvas()">
                                <i class="fa fa-compress mr-1"></i>居中图片
                            </button>
                            <button class="btn-action bg-yellow-600 text-white text-xs" onclick="rotateImage(90)">
                                <i class="fa fa-rotate-right mr-1"></i>旋转图片
                            </button>
                        </div>
                        <!-- 图片尺寸调节按钮 -->
                        <div class="grid grid-cols-2 gap-1 mt-1">
                            <button class="btn-action bg-gray-600 text-white text-xs" onclick="resizeImage(-10, -10)">
                                <i class="fa fa-compress mr-1"></i>缩小尺寸
                            </button>
                            <button class="btn-action bg-gray-600 text-white text-xs" onclick="resizeImage(10, 10)">
                                <i class="fa fa-expand mr-1"></i>放大尺寸
                            </button>
                        </div>
                        <p class="text-gray-500 mt-1 text-xs">提示：按住Shift键拖动图片</p>
                    </div>
                </div>

          
                        
                        <!-- 图像长宽设置 -->
                        <div class="pt-1 border-t border-gray-100">
                            <label class="block text-gray-600 mb-0.5">自定义图像尺寸</label>
                            <div class="grid grid-cols-2 gap-1">
                                <div>
                                    <label class="block text-gray-500 text-xs mb-0.5">宽度 (像素)</label>
                                    <input type="number" id="imageWidth" min="50" max="2000" value="400" class="input-control text-xs">
                                </div>
                                <div>
                                    <label class="block text-gray-500 text-xs mb-0.5">高度 (像素)</label>
                                    <input type="number" id="imageHeight" min="50" max="2000" value="300" class="input-control text-xs">
                                </div>
                            </div>
                            <button class="btn-action bg-green-600 text-white text-xs w-full mt-1" onclick="applyImageDimensions()">
                                <i class="fa fa-check mr-1"></i>应用尺寸
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 右侧控制面板 -->
            <div class="lg:col-span-1 space-y-2">
                <!-- 绘画工具 -->
                <div class="control-panel">
                    <h2 class="panel-title">
                        <i class="fa fa-pencil text-primary mr-2"></i>绘画工具
                    </h2>
                    
                       <div class="flex justify-between mb-1.5">
                        <button class="drawing-tool active" id="toolPen" title="画笔" onclick="setDrawingTool('pen')">🖍
                            <i class="fa fa-pencil"></i>
                        </button>
                        <button class="drawing-tool" id="toolEraser" title="橡皮擦" onclick="setDrawingTool('eraser')">💄
                            <i class="fa fa-eraser"></i>
                        </button>
                        <button class="drawing-tool" id="toolText" title="文字" onclick="setDrawingTool('text')">📄
                            <i class="fa fa-font"></i>
                        </button>
                        <button class="drawing-tool" id="toolClear" title="清除画布" onclick="clearCanvas()">🗑
                            <i class="fa fa-trash"></i>
                        </button>
                    </div>
                    
                    <div class="space-y-1 text-xs">
                        <div>
                            <label class="block text-gray-600 mb-0.5">画笔颜色</label>
                            <div class="flex space-x-1">
                                <button class="w-5 h-5 rounded-full bg-black border-2 border-gray-300" onclick="setBrushColor('#000000')"></button>
                                <button class="w-5 h-5 rounded-full bg-white border-2 border-gray-300" onclick="setBrushColor('#FFFFFF')"></button>
                                <button class="w-5 h-5 rounded-full bg-red-600 border-2 border-gray-300" onclick="setBrushColor('#EF4444')"></button>
                                <input type="color" id="customColor" value="#000000" class="w-5 h-5 p-0 border-0" oninput="setBrushColor(this.value)">
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-gray-600 mb-0.5">画笔粗细</label>
                            <input type="range" id="brushSize" min="1" max="20" value="3" class="w-full h-1 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                        </div>
                        
                        <div>
                            <label class="block text-gray-600 mb-0.5">字体选择</label>
                            <select id="fontFamily" class="input-control text-xs">
                                <option value="Arial, sans-serif, SimHei, Microsoft YaHei">Arial / 黑体</option>
                                <option value="'Times New Roman', serif, SimSun">Times New Roman / 宋体</option>
                                <option value="'Courier New', monospace, SimSun">Courier New / 宋体</option>
                                <option value="Georgia, serif, KaiTi, STKaiti">Georgia / 楷体</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-gray-600 mb-0.5">字体大小</label>
                            <input type="number" id="fontSize" value="24" min="8" max="72" class="input-control text-xs">
                        </div>
                        
                        <div>
                            <label class="block text-gray-600 mb-0.5">输入文字</label>
                            <div class="flex space-x-1">
                                <input type="text" id="textInput" placeholder="输入要添加的文字" class="flex-1 input-control text-xs">
                                <button id="addTextBtn" class="btn-action bg-primary text-white px-1.5" onclick="addTextManually()">
                                    <i class="fa fa-plus"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 颜色与抖动设置 -->
                <div class="control-panel">
                    <h2 class="panel-title">
                        <i class="fa fa-paint-brush text-primary mr-2"></i>图像设置
                    </h2>
                    <div class="grid grid-cols-2 gap-1 mb-1">
                        <button id="btnBlackWhite" class="btn-action bg-primary text-white" onclick="setDitherMode('blackWhiteColor')">
                            <i class="fa fa-square-o mr-1"></i>黑白
                        </button>
                        <button id="btnBlackWhiteRed" class="btn-action bg-secondary text-white" onclick="setDitherMode('threeColor')">
                            <i class="fa fa-square text-accent mr-1"></i>黑白红
                        </button>
                    </div>
                    <div class="space-y-1 text-xs">
                        <div>
                            <label class="block text-gray-600 mb-0.5">颜色模式</label>
                            <select id="ditherMode" class="input-control">
                                <option value="blackWhiteColor">黑白模式</option>
                                <option value="threeColor">黑白红三色</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-gray-600 mb-0.5">抖动算法</label>
                            <select id="ditherAlg" class="input-control" onchange="onDitherAlgChange(event)">
                                <option value="floydSteinberg">Floyd-Steinberg</option>
                                <option value="atkinson">Atkinson</option>
                                <option value="bayer">Bayer</option>
                                <option value="stucki">Stucki</option>
                                <option value="jarvis">Jarvis-Judice-Ninke</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- 参数调节 -->
                <div class="control-panel">
                    <h2 class="panel-title">
                        <i class="fa fa-sliders text-primary mr-2"></i>参数调节
                    </h2>
                    <div class="space-y-1 text-xs">
                        <!-- 饱和度 -->
                        <div>
                            <div class="flex justify-between mb-0.5">
                                <label for="saturation" class="text-gray-700">饱和度</label>
                                <span id="saturationValue" class="text-gray-500">100%</span>
                            </div>
                            <input type="range" id="saturation" min="0" max="200" value="100" class="w-full h-1 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                        </div>
                        
                        <!-- 亮度 -->
                        <div>
                            <div class="flex justify-between mb-0.5">
                                <label for="brightness" class="text-gray-700">亮度</label>
                                <span id="brightnessValue" class="text-gray-500">100%</span>
                            </div>
                            <input type="range" id="brightness" min="0" max="200" value="100" class="w-full h-1 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                        </div>
                        
                        <!-- 对比度 -->
                        <div>
                            <div class="flex justify-between mb-0.5">
                                <label for="contrast" class="text-gray-700">对比度</label>
                                <span id="contrastValue" class="text-gray-500">100%</span>
                            </div>
                            <input type="range" id="contrast" min="0" max="200" value="100" class="w-full h-1 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                        </div>
                        
                        <!-- 扩散 -->
                        <div>
                            <div class="flex justify-between mb-0.5">
                                <label for="diffusion" class="text-gray-700">扩散强度</label>
                                <span id="diffusionValue" class="text-gray-500">50%</span>
                            </div>
                            <input type="range" id="diffusion" min="0" max="100" value="50" class="w-full h-1 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                        </div>
                    </div>
                </div>
          
                <!-- 操作按钮 -->
                <div class="control-panel">
                    <div class="flex flex-wrap gap-1.5">
                        <button id="btnProcess" class="btn-action bg-secondary text-white flex-1 sm:flex-auto">
                            <i class="fa fa-magic mr-1"></i>处理图片
                        </button>
                           <div class="grid grid-cols-2 gap-1 text-xs">
                     
                          
                       
                        <div>
                            <label class="block text-gray-600 mb-0.5"style="display:none">交织计数</label>
                            <input type="number" id="interleavedcount" value="3" min="1" max="10" class="input-control text-xs"style="display:none">
                        </div>
                    </div>
                     包:<input type="number" id="mtusize" value="50" min="20" max="180" class="btn-action bg-accent text-white flex-1 sm:flex-auto">
                        <button id="btnSend" class="btn-action bg-primary text-white flex-1 sm:flex-auto opacity-50 cursor-not-allowed" disabled="">
                             

                            <i class="fa fa-wifi mr-1"></i>发送图片到墨水屏
                        </button>
                        <button id="btnDownload" class="btn-action bg-blue-700 text-white flex-1 sm:flex-auto">
                            <i class="fa fa-download mr-1"></i>下载图像文件
                        </button>
                        <button id="btnReset" class="btn-action bg-accent text-white flex-1 sm:flex-auto">
                            <i class="fa fa-refresh mr-1"></i>重置
                        </button>
                        <button id="btnClearLog" class="btn-action bg-gray-500 text-white flex-1 sm:flex-auto">
                            <i class="fa fa-eraser mr-1"></i>清除日志
                        </button>
                    </div>
                    
                    <!-- 新增的时间和显示模式按钮 -->
                    <div class="flex flex-wrap gap-1.5 mt-1.5">
                        <button id="btnSetTime" class="btn-action bg-indigo-600 text-white flex-1 sm:flex-auto opacity-50 cursor-not-allowed" disabled="">
                            <i class="fa fa-clock-o mr-1"></i>设置时间
                        </button>
                         <button id="calendarmodebutton" type="button" class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto" onclick="syncTime(1)">日历模式</button>
                    <button id="clockmodebutton" type="button" class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto"onclick="syncTime(2)">时钟模式</button>
					<button id="clockmodebutton" type="button" class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto" onclick="syncTime(4)">数码管时钟</button>
					
					<button id="clearscreenbutton" type="button" class="btn-action bg-gray-700 text-white flex-1 sm:flex-auto" onclick="clearScreen()">清除屏幕</button>
           
					<input id="epdpins" type="text" value="激活输入"class="btn-action bg-gray-700 text-white flex-1 sm:flex-auto">
					<button id="setDriverbutton" type="button" class="btn-action bg-primary text-white flex-1 sm:flex-auto opacity-50 cursor-not-allowed" onclick="set_EPD_CMD_J_H()">激活</button>
				</div>
        
            </div>

		  <!-- 操作按钮和日志 -->
            <div class="lg:col-span-2 space-y-2">
                <!-- 操作按钮 -->
                <div class="control-panel">
            <legend class="fa fa-cogs text-primary mr-2">四连设置</legend>
      
			 <fieldset>

					<legend class="fa fa-cogs text-primary mr-2">主副机设置</legend>
			<button id="setDriverbutton" type="button" class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto" onclick="set_EPD_CMD_4_ZF(0)">主机零</button>
			<button id="setDriverbutton" type="button" class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto" onclick="set_EPD_CMD_4_ZF(1)">副机一</button>
			<button id="setDriverbutton" type="button" class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto" onclick="set_EPD_CMD_4_ZF(2)">副机二</button>
			<button id="setDriverbutton" type="button" class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto" onclick="set_EPD_CMD_4_ZF(3)">副机三</button>
			</fieldset>


				<div class="fa fa-cogs text-primary mr-2">
					<label for="fanxian1"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto">是否反显:</label>
					<select id="fanxian1"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto">
						
						<option value="01"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto">否</option>
						<option value="00"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto">是</option>
						
					</select>
			
					<label for="xuanzhuan1"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto">旋转屏幕:</label>
					<select id="xuanzhuan1"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto">
						
						<option value="00"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto">否</option>
						<option value="01"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto">是</option>
						
					</select>

					<label for="silian_ziti"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto">字体:</label>
					<select id="silian_ziti"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto">
						
						<option value="00"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto">数码</option>
						<option value="01"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto">衬线</option>
						
					</select>

					</div>
				<div class="fa fa-cogs text-primary mr-2">
					<label for="xianshi_peizhi"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto">电量&MAC:</label>
					<select id="xianshi_peizhi"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto">
						
						<option value="00"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto">否</option>
						<option value="01"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto">是</option>
						
					</select>
				
					<label for="moshi_id"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto">模式选择:</label>
					<select id="moshi_id"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto">
						<option value="02"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto">时钟模式</option>
						<option value="01"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto">日历模式</option>
						
						<option value="03"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto">温度模式</option>
						
					</select>
				</div>
			<div class="fa fa-cogs text-primary mr-2">
					<label for="color_11"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto">显示红色:</label>
					<select id="color_11"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto">
						
						<option value="00"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto">否</option>
						<option value="01"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto">是</option>
						
					</select>
			
				

					<label class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto" >局刷时长:<label>
					<input type="range" min="2" max="50" step="2" value="2" id="jushua_time1">
					
				
</div>
				<button id="setDriverbutton" type="button" class="btn-action bg-blue-700 text-white flex-1 sm:flex-auto" onclick="set_EPD_CMD_4_MS()">确认</button>
				
</fieldset>




 <!-- 操作按钮和日志 -->
            <div class="lg:col-span-2 space-y-2">
                <!-- 操作按钮 -->
                <div class="control-panel">
 <fieldset>
            <legend class="fa fa-cogs text-primary mr-2">显示设置</legend>
      

				<div class="fa fa-cogs text-primary mr-2">
					<label for="fanxian"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto ">是否反显:</label>
					<select id="fanxian"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto ">
						
						<option value="01"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto ">否</option>
						<option value="00"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto ">是</option>
						
					</select>
			
					<label for="xuanzhuan"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto ">旋转屏幕:</label>
					<select id="xuanzhuan"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto ">
						
						<option value="00"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto ">否</option>
						<option value="01"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto ">是</option>
						
					</select>
				
				
					<label for="qiangzhi_shuaxing" class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto ">强制刷新:</label>
					<select id="qiangzhi_shuaxing" class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto ">
						
						<option value="00"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto ">否</option>
						<option value="01"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto ">是</option>
						
					</select>
				
			
			
					<label class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto ">黑色局刷时长:<label>
					<input type="range" min="1" max="6" step="1" value="1" id="jushua_time"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto ">
					
				</div>

				<button id="setDriverbutton" type="button" class="btn-action bg-blue-700 text-white flex-1 sm:flex-auto"onclick="set_EPD_CMD_MY()">确认</button>
				
</div>
</fieldset>

 <fieldset>
 <!-- 操作按钮和日志 -->
            <div class="lg:col-span-2 space-y-2">
                <!-- 操作按钮 -->
                <div class="control-panel">

            <legend class="fa fa-cogs text-primary mr-2">时钟颜色设置</legend>
      

				<div class="flex-group right ">
					<label for="color_1"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto ">显示红色:</label>
					<select id="color_1"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto ">
						
						<option value="00"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto ">否</option>
						<option value="01"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto ">是</option>
						
					</select>
				
			
					<label for="time_color"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto ">时钟红否:</label>
					<select id="time_color"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto ">
						
						<option value="00"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto ">否</option>
						<option value="01"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto ">是</option>
						
					</select>
	
					<label for="wendu_color"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto ">温度红否:</label>
					<select id="wendu_color"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto ">
						
						<option value="00"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto ">否</option>
						<option value="01"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto ">是</option>
						
					</select>
				

			
					<label for="gongli_color"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto ">公历红否:</label>
					<select id="gongli_color"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto ">
						
						<option value="00"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto ">否</option>
						<option value="01"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto ">是</option>
						
					</select>
						
			

			
					<label for="shichen_color"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto ">时辰红否:</label>
					<select id="shichen_color"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto ">
						
						<option value="00"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto ">否</option>
						<option value="01"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto ">是</option>
						
					</select>
				

				
					<label for="jieqi_color"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto ">节气红否:</label>
					<select id="jieqi_color"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto ">
						
						<option value="00"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto ">否</option>
						<option value="01"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto ">是</option>
						
					</select>
				

			
					<label class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto ">红色局刷时长:<label>
					<input type="range" min="2" max="50" step="2" value="2" id="r_jushua_time"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto ">
					
				</div>
				<button id="setDriverbutton" type="button" class="btn-action bg-blue-700 text-white flex-1 sm:flex-auto" onclick="set_EPD_CMD_COLOR()">确认</button>
				

</fieldset>

	 <fieldset>
 <!-- 操作按钮和日志 -->
            <div class="lg:col-span-2 space-y-2">
                <!-- 操作按钮 -->
                <div class="control-panel">

            <legend class="fa fa-cogs text-primary mr-2">LED设置</legend>
      

				<div class="lg:col-span-2 space-y-2">
					<label for="color_led"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto ">选择颜色:</label>
					<select id="color_led"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto ">
						<option value="00"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto ">红色</option>
						<option value="01"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto ">绿色</option>
						<option value="02"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto ">红色</option>
						<option value="03"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto ">白色</option>
						<option value="04"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto ">黄色</option>
						<option value="05"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto ">紫色</option>
						<option value="06"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto ">天蓝</option>
						
					</select>
				

				<div class="lg:col-span-2 space-y-2">
					<label class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto "  >频率时长:<label>
					<input type="range" min="0" max="80" step="1" value="0" id="liang_time" class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto ">
					</div>
				

			
					<label class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto ">闪烁频率</label>
					
					<input type="number" id="liang_add" value="0" min="0" max="10" class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto ">
				
					

				
					
					<label class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto ">LED明暗:</label>
					<input type="number" id="liangdu" value="1" min="1" max="10" class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto ">
				
				
				
                        <label class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto "  >长亮时长:<label>
                        <input type="range" id="liang_s" value="1" min="1" max="250" class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto ">
				
					
					</div>
				<button id="setDriverbutton" type="button" class="btn-action bg-blue-700 text-white flex-1 sm:flex-auto" onclick="set_EPD_CMD_LED()">确认</button>
				<button id="setDriverbutton" type="button" class="btn-action bg-blue-700 text-white flex-1 sm:flex-auto" onclick="set_EPD_CMD_LED1()">四联全部确认</button>
				
            
	</fieldset>

 <fieldset>
     <!-- 操作按钮和日志 -->
            <div class="lg:col-span-2 space-y-2">
                <!-- 操作按钮 -->
                <div class="control-panel">
            <legend class="fa fa-cogs text-primary mr-2">闹钟设置</legend>
      
				
			
					<label for="N_Z_start"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto " >闹钟:</label>
					<select id="N_Z_start"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto " >
						<option value="00"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto " >关闭</option>
						<option value="01"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto " >开启</option>
						
		
					</select>
				
					<label class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto " >小时:</label>
					<input type="number" id="N_Z_hour" value="0" min="0" max="23"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto " >
					<label class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto " >分钟:</label>
					<input type="number" id="N_Z_min" value="0" min="0" max="59"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto " >
					<button id="setDriverbutton" type="button" class="btn-action bg-blue-700 text-white flex-1 sm:flex-auto" onclick="set_EPD_CMD_N_Z()">确认</button>

				
					<label for="D_S_start"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto " >定时:</label>
					<select id="D_S_start"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto " >
						<option value="00"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto " >关闭</option>
						<option value="01"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto " >开启</option>
						
		
					</select>
				
					<label class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto " >小时:</label>
					<input type="number" id="D_S_hour" value="0" min="0" max="23"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto " >
					<label class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto " >分钟:</label>
					<input type="number" id="D_S_min" value="0" min="0" max="59"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto " >
					<button id="setDriverbutton" type="button" class="btn-action bg-blue-700 text-white flex-1 sm:flex-auto" onclick="set_EPD_CMD_D_S()">确认</button>
			
					<label for="J_S_start"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto " >计时:</label>
					<select id="J_S_start"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto " >
						<option value="00"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto " >关闭</option>
						<option value="01"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto " >开启</option>
						
		
					</select>
				
					<label class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto " >小时:</label>
					<input type="number" id="J_S_hour" value="0" min="0" max="23"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto " >
					<label class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto " >分钟:</label>
					<input type="number" id="J_S_min" value="0" min="0" max="59"class="btn-action bg-emerald-600 text-white flex-1 sm:flex-auto " >
					<button id="setDriverbutton" type="button" class="btn-action bg-blue-700 text-white flex-1 sm:flex-auto" onclick="set_EPD_CMD_J_S()">确认</button>
				</div>
			
        </fieldset>

                <!-- 蓝牙状态和日志 -->
                <div class="control-panel">
                    <h2 class="panel-title">
                        <i class="fa fa-history text-primary mr-2"></i>传输状态与日志
                    </h2>
                    <div id="statusContainer" class="hidden mb-1 p-1 rounded-md bg-blue-50 border border-blue-200 text-xs">
                        <div class="flex items-center">
                            <i class="fa fa-circle-o-notch fa-spin text-primary mr-1"></i>
                            <span id="status" class="text-blue-800">准备传输...</span>
                        </div>
                    </div>
                    <div class="log-container text-xs max-h-[140px] overflow-y-auto p-1.5 bg-gray-50 rounded" id="logContainer">
                        <div class="text-gray-500 italic">操作日志将显示在这里...</div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- 浮动画布容器 (默认隐藏) -->
    <div id="floatingCanvasContainer" class="hidden fixed bg-white rounded-lg shadow-xl z-50 border border-gray-200 w-[500px] h-[400px] left-[20%] top-[20%]">
        <div class="bg-dark text-white p-1.5 cursor-move flex items-center justify-between text-sm">
            <span>处理后画布</span>
            <div class="flex space-x-1">
                <button id="floatToggleDrawingMode" class="hover:text-primary text-xs px-2 py-0.5">
                    <i class="fa fa-pencil mr-1"></i>开始绘画
                </button>
                <button id="closeCanvas" class="hover:text-primary">
                    <i class="fa fa-times"></i>
                </button>
            </div>
        </div>
        <div class="relative p-2 h-[calc(100%-40px)] overflow-auto bg-gray-50 flex justify-center items-center canvas-container">
            <canvas id="floatPreviewCanvas" class="border border-gray-300 cursor-crosshair" style="transition: transform 0.2s;"></canvas>
        </div>
        <div class="absolute w-4 h-4 bg-gray-300 right-0 bottom-0 cursor-se-resize" id="canvasResizeHandle"></div>
    </div>

    <!-- 时间设置对话框 (默认隐藏) -->
    <div id="timeDialog" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-3">
        <div class="bg-white rounded-lg shadow-lg w-full max-w-xs">
            <div class="bg-dark text-white p-2 rounded-t-lg flex justify-between items-center">
                <h3 class="font-bold">设置时间</h3>
                <button id="closeTimeDialog" class="text-white hover:text-primary">
                    <i class="fa fa-times"></i>
                </button>
            </div>
            <div class="p-3">
                <div class="mb-2">
                    <input type="datetime-local" id="datetimeInput" class="w-full p-2 border border-gray-300 rounded">
                </div>
                <div class="flex justify-end">
                    <button id="confirmTimeBtn" class="btn-action bg-primary text-white">
                        <i class="fa fa-check mr-1"></i>确认
                    </button>
                </div>
            </div>
        </div>
    </div>

    <footer class="bg-dark text-white mt-3 py-2 text-center text-xs">
        <div class="container mx-auto px-3">
            墨水屏蓝牙图片工具 © 2023
        </div>
    </footer>
 
     <script type="text/javascript" src="js.js"></script>
</body>
</html>
