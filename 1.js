const _0x2017d7=_0x228a;(function(_0x48de73,_0x3015bd){const _0x3ec29e=_0x228a,_0x367bfe=_0x48de73();while(!![]){try{const _0x4f0015=-parseInt(_0x3ec29e(0x182))/0x1+parseInt(_0x3ec29e(0x197))/0x2+parseInt(_0x3ec29e(0x1b5))/0x3*(parseInt(_0x3ec29e(0x19a))/0x4)+-parseInt(_0x3ec29e(0x1ba))/0x5*(parseInt(_0x3ec29e(0x174))/0x6)+parseInt(_0x3ec29e(0x16d))/0x7*(parseInt(_0x3ec29e(0x170))/0x8)+parseInt(_0x3ec29e(0x1a6))/0x9*(-parseInt(_0x3ec29e(0x173))/0xa)+parseInt(_0x3ec29e(0x162))/0xb;if(_0x4f0015===_0x3015bd)break;else _0x367bfe['push'](_0x367bfe['shift']());}catch(_0x4532be){_0x367bfe['push'](_0x367bfe['shift']());}}}(_0x2fb3,0xc331a));let painting=![],lastX=0x0,lastY=0x0,brushColor=_0x2017d7(0x1a3),brushSize=0x2,currentTool=null,textElements=[],lineSegments=[],isTextPlacementMode=![],draggingCanvasContext=null,selectedTextElement=null,isDraggingText=![],dragOffsetX=0x0,dragOffsetY=0x0,textBold=![],textItalic=![];function setCanvasTitle(_0x38487b){const _0x140728=_0x2017d7,_0x2440da=document[_0x140728(0x1b6)]('.canvas-title');_0x2440da&&(_0x2440da[_0x140728(0x198)]=_0x38487b,_0x2440da['style']['display']=_0x38487b&&_0x38487b!==''?_0x140728(0x164):_0x140728(0x1a2));}function initPaintTools(){const _0x26a78b=_0x2017d7;document[_0x26a78b(0x168)](_0x26a78b(0x195))['addEventListener'](_0x26a78b(0x176),()=>{const _0x313d3e=_0x26a78b;currentTool===_0x313d3e(0x16a)?setActiveTool(null,''):(setActiveTool(_0x313d3e(0x16a),_0x313d3e(0x181)),brushColor=document[_0x313d3e(0x168)](_0x313d3e(0x183))[_0x313d3e(0x192)]);}),document[_0x26a78b(0x168)](_0x26a78b(0x196))['addEventListener']('click',()=>{const _0x528406=_0x26a78b;currentTool===_0x528406(0x172)?setActiveTool(null,''):(setActiveTool(_0x528406(0x172),_0x528406(0x1b0)),brushColor=_0x528406(0x1af));}),document[_0x26a78b(0x168)]('text-mode')[_0x26a78b(0x166)]('click',()=>{const _0x112b9f=_0x26a78b;currentTool===_0x112b9f(0x194)?setActiveTool(null,''):(setActiveTool(_0x112b9f(0x194),'插入文字'),brushColor=document[_0x112b9f(0x168)](_0x112b9f(0x183))[_0x112b9f(0x192)]);}),document[_0x26a78b(0x168)](_0x26a78b(0x183))[_0x26a78b(0x166)]('change',_0x3a96a9=>{const _0x5f0a6c=_0x26a78b;brushColor=_0x3a96a9['target'][_0x5f0a6c(0x192)];}),document[_0x26a78b(0x168)]('brush-size')['addEventListener']('change',_0x273b06=>{const _0x3523b8=_0x26a78b;brushSize=parseInt(_0x273b06[_0x3523b8(0x18e)][_0x3523b8(0x192)]);}),document[_0x26a78b(0x168)]('add-text-btn')[_0x26a78b(0x166)](_0x26a78b(0x176),startTextPlacement),document[_0x26a78b(0x168)](_0x26a78b(0x1ae))[_0x26a78b(0x166)](_0x26a78b(0x176),()=>{const _0x1fac28=_0x26a78b;textBold=!textBold,document[_0x1fac28(0x168)](_0x1fac28(0x1ae))[_0x1fac28(0x1b3)][_0x1fac28(0x17f)](_0x1fac28(0x16c),textBold);}),document[_0x26a78b(0x168)](_0x26a78b(0x199))[_0x26a78b(0x166)]('click',()=>{const _0x5baf4c=_0x26a78b;textItalic=!textItalic,document[_0x5baf4c(0x168)](_0x5baf4c(0x199))[_0x5baf4c(0x1b3)][_0x5baf4c(0x17f)]('primary',textItalic);}),setupCanvasForPainting(),updateToolUI();}function setActiveTool(_0x333920,_0x1e4fc2){currentTool=_0x333920,updateToolUI(),setCanvasTitle(_0x1e4fc2),cancelTextPlacement();}function updateToolUI(){const _0x385209=_0x2017d7;document[_0x385209(0x168)](_0x385209(0x195))[_0x385209(0x1b3)][_0x385209(0x17f)](_0x385209(0x187),currentTool===_0x385209(0x16a)),document['getElementById'](_0x385209(0x196))['classList']['toggle'](_0x385209(0x187),currentTool===_0x385209(0x172)),document['getElementById'](_0x385209(0x1a0))['classList']['toggle'](_0x385209(0x187),currentTool===_0x385209(0x194)),document[_0x385209(0x18d)](_0x385209(0x18b))[_0x385209(0x1ac)](_0x52d019=>{const _0x1b8d54=_0x385209;_0x52d019[_0x1b8d54(0x169)][_0x1b8d54(0x190)]=[_0x1b8d54(0x16a),_0x1b8d54(0x172),_0x1b8d54(0x194)][_0x1b8d54(0x17a)](currentTool)?_0x1b8d54(0x1a7):'none';}),document[_0x385209(0x168)](_0x385209(0x183))[_0x385209(0x17d)]=currentTool===_0x385209(0x172),document[_0x385209(0x168)](_0x385209(0x1ab))['disabled']=currentTool==='text',document[_0x385209(0x18d)](_0x385209(0x17e))[_0x385209(0x1ac)](_0x3839e4=>{const _0x451e98=_0x385209;_0x3839e4[_0x451e98(0x169)]['display']=currentTool===_0x451e98(0x194)?_0x451e98(0x1a7):_0x451e98(0x1a2);});}function setupCanvasForPainting(){const _0x33e4fe=_0x2017d7;canvas[_0x33e4fe(0x166)](_0x33e4fe(0x179),startPaint),canvas[_0x33e4fe(0x166)](_0x33e4fe(0x1a1),paint),canvas[_0x33e4fe(0x166)](_0x33e4fe(0x19b),endPaint),canvas[_0x33e4fe(0x166)](_0x33e4fe(0x180),endPaint),canvas[_0x33e4fe(0x166)](_0x33e4fe(0x176),handleCanvasClick),canvas[_0x33e4fe(0x166)]('touchstart',handleTouchStart),canvas[_0x33e4fe(0x166)]('touchmove',handleTouchMove),canvas[_0x33e4fe(0x166)]('touchend',endPaint);}function startPaint(_0x2501e2){const _0x475ea0=_0x2017d7;if(!currentTool)return;if(currentTool===_0x475ea0(0x194)){const _0x5d7308=findTextElementAt(_0x2501e2);if(_0x5d7308&&_0x5d7308===selectedTextElement){isDraggingText=!![];const _0x7e8204=canvas['getBoundingClientRect'](),_0x2f7577=canvas[_0x475ea0(0x18a)]/_0x7e8204['width'],_0x466964=canvas[_0x475ea0(0x171)]/_0x7e8204[_0x475ea0(0x171)],_0x34b423=(_0x2501e2[_0x475ea0(0x19e)]-_0x7e8204[_0x475ea0(0x1ad)])*_0x2f7577,_0x2bfa6b=(_0x2501e2[_0x475ea0(0x163)]-_0x7e8204[_0x475ea0(0x18c)])*_0x466964;dragOffsetX=_0x5d7308['x']-_0x34b423,dragOffsetY=_0x5d7308['y']-_0x2bfa6b;return;}}else painting=!![],draw(_0x2501e2);}function endPaint(){painting=![],isDraggingText=![],lastX=0x0,lastY=0x0;}function paint(_0x46d791){if(!currentTool)return;currentTool==='text'?isDraggingText&&selectedTextElement&&dragText(_0x46d791):painting&&draw(_0x46d791);}function draw(_0x30da7a){const _0xa6ece5=_0x2017d7,_0x61d40f=canvas[_0xa6ece5(0x16b)](),_0x235b3d=canvas[_0xa6ece5(0x18a)]/_0x61d40f[_0xa6ece5(0x18a)],_0x53f7e0=canvas[_0xa6ece5(0x171)]/_0x61d40f[_0xa6ece5(0x171)],_0x571149=(_0x30da7a['clientX']-_0x61d40f[_0xa6ece5(0x1ad)])*_0x235b3d,_0x2d0614=(_0x30da7a[_0xa6ece5(0x163)]-_0x61d40f[_0xa6ece5(0x18c)])*_0x53f7e0;ctx[_0xa6ece5(0x1b4)]=_0xa6ece5(0x188),ctx[_0xa6ece5(0x175)]=_0xa6ece5(0x188),ctx[_0xa6ece5(0x184)]=brushColor,ctx[_0xa6ece5(0x16e)]=brushSize,ctx['beginPath'](),lastX===0x0&&lastY===0x0?(ctx[_0xa6ece5(0x1a5)](_0x571149,_0x2d0614),ctx[_0xa6ece5(0x1a4)](_0x571149+0.1,_0x2d0614+0.1),lineSegments[_0xa6ece5(0x1aa)]({'type':_0xa6ece5(0x1b2),'x':_0x571149,'y':_0x2d0614,'color':brushColor,'size':brushSize})):(ctx[_0xa6ece5(0x1a5)](lastX,lastY),ctx[_0xa6ece5(0x1a4)](_0x571149,_0x2d0614),lineSegments[_0xa6ece5(0x1aa)]({'type':_0xa6ece5(0x17c),'x1':lastX,'y1':lastY,'x2':_0x571149,'y2':_0x2d0614,'color':brushColor,'size':brushSize})),ctx[_0xa6ece5(0x1b8)](),lastX=_0x571149,lastY=_0x2d0614;}function handleCanvasClick(_0x20a028){const _0x40b283=_0x2017d7;currentTool===_0x40b283(0x194)&&isTextPlacementMode&&placeText(_0x20a028);}function handleTouchStart(_0xb71709){const _0x311069=_0x2017d7;_0xb71709['preventDefault']();const _0x4004f4=_0xb71709[_0x311069(0x193)][0x0];if(currentTool===_0x311069(0x194)&&isTextPlacementMode){const _0x114ef7=new MouseEvent(_0x311069(0x176),{'clientX':_0x4004f4[_0x311069(0x19e)],'clientY':_0x4004f4[_0x311069(0x163)]});canvas[_0x311069(0x177)](_0x114ef7);return;}const _0x4b89ff=new MouseEvent('mousedown',{'clientX':_0x4004f4['clientX'],'clientY':_0x4004f4['clientY']});canvas['dispatchEvent'](_0x4b89ff);}function handleTouchMove(_0x62f47){const _0x2aadff=_0x2017d7;_0x62f47[_0x2aadff(0x185)]();const _0x10eb89=_0x62f47['touches'][0x0],_0xcf0fff=new MouseEvent(_0x2aadff(0x1a1),{'clientX':_0x10eb89[_0x2aadff(0x19e)],'clientY':_0x10eb89['clientY']});canvas[_0x2aadff(0x177)](_0xcf0fff);}function _0x2fb3(){const _0x5af1dd=['eraser','379010owPPeh','6hmJvGg','lineCap','click','dispatchEvent','点击画布放置文字','mousedown','includes','fillStyle','line','disabled','.text-tools','toggle','mouseleave','画笔模式','1309814GSCNrQ','brush-color','strokeStyle','preventDefault','getImageData','active','round','bold\x20','width','.brush-tools','top','querySelectorAll','target','font','display','beginPath','value','touches','text','brush-mode','eraser-mode','59198iSEXjn','innerText','text-italic','12PBUoeT','mouseup','italic\x20','type','clientX','font-family','text-mode','mousemove','none','#000000','lineTo','moveTo','279wUGrig','flex','font-size','add','push','brush-size','forEach','left','text-bold','#FFFFFF','橡皮擦','remove','dot','classList','lineJoin','1432632OqKTWw','querySelector','text-placement-mode','stroke','color','3452190JIaCGY','text-input','24812711bPEEJO','clientY','block','putImageData','addEventListener','fillText','getElementById','style','brush','getBoundingClientRect','primary','359471MEyWyS','lineWidth','拖动新添加文字可调整位置','40zBzMwh','height'];_0x2fb3=function(){return _0x5af1dd;};return _0x2fb3();}function _0x228a(_0x404a82,_0x2f9c81){const _0x2fb3cb=_0x2fb3();return _0x228a=function(_0x228add,_0x1931f8){_0x228add=_0x228add-0x161;let _0x26b0b3=_0x2fb3cb[_0x228add];return _0x26b0b3;},_0x228a(_0x404a82,_0x2f9c81);}function dragText(_0x3f9ac5){const _0x4332b4=_0x2017d7,_0x59fe91=canvas[_0x4332b4(0x16b)](),_0x11941d=canvas[_0x4332b4(0x18a)]/_0x59fe91['width'],_0x2901fe=canvas[_0x4332b4(0x171)]/_0x59fe91[_0x4332b4(0x171)],_0x1ecd5e=(_0x3f9ac5[_0x4332b4(0x19e)]-_0x59fe91['left'])*_0x11941d,_0x4157f5=(_0x3f9ac5['clientY']-_0x59fe91[_0x4332b4(0x18c)])*_0x2901fe;selectedTextElement['x']=_0x1ecd5e+dragOffsetX,selectedTextElement['y']=_0x4157f5+dragOffsetY,draggingCanvasContext?ctx[_0x4332b4(0x165)](draggingCanvasContext,0x0,0x0):ctx['clearRect'](0x0,0x0,canvas[_0x4332b4(0x18a)],canvas[_0x4332b4(0x171)]),ctx[_0x4332b4(0x18f)]=selectedTextElement[_0x4332b4(0x18f)],ctx[_0x4332b4(0x17b)]=selectedTextElement[_0x4332b4(0x1b9)],ctx[_0x4332b4(0x167)](selectedTextElement[_0x4332b4(0x194)],selectedTextElement['x'],selectedTextElement['y']);}function findTextElementAt(_0x5a6bb2){const _0x2671c3=_0x2017d7,_0x2d22a7=canvas[_0x2671c3(0x16b)](),_0x40be5a=canvas[_0x2671c3(0x18a)]/_0x2d22a7[_0x2671c3(0x18a)],_0x28e80a=canvas[_0x2671c3(0x171)]/_0x2d22a7[_0x2671c3(0x171)],_0x11c12d=(_0x5a6bb2[_0x2671c3(0x19e)]-_0x2d22a7['left'])*_0x40be5a,_0x1f1d67=(_0x5a6bb2[_0x2671c3(0x163)]-_0x2d22a7[_0x2671c3(0x18c)])*_0x28e80a;for(let _0x5652de=textElements['length']-0x1;_0x5652de>=0x0;_0x5652de--){const _0x72e7b0=textElements[_0x5652de];ctx[_0x2671c3(0x18f)]=_0x72e7b0['font'];const _0xd50d72=ctx['measureText'](_0x72e7b0[_0x2671c3(0x194)])[_0x2671c3(0x18a)],_0x5a8840=_0x72e7b0[_0x2671c3(0x18f)]['match'](/(\d+)px/),_0x2b4a17=_0x5a8840?parseInt(_0x5a8840[0x1]):0xe,_0x52e8d2=_0x2b4a17*1.2,_0x258777=0x5;if(_0x11c12d>=_0x72e7b0['x']-_0x258777&&_0x11c12d<=_0x72e7b0['x']+_0xd50d72+_0x258777&&_0x1f1d67>=_0x72e7b0['y']-_0x52e8d2+_0x258777&&_0x1f1d67<=_0x72e7b0['y']+_0x258777)return _0x72e7b0;}return null;}function startTextPlacement(){const _0x56b1dd=_0x2017d7,_0x44a5c7=document[_0x56b1dd(0x168)](_0x56b1dd(0x161))[_0x56b1dd(0x192)]['trim']();if(!_0x44a5c7){alert('请输入文字内容');return;}isTextPlacementMode=!![],setCanvasTitle(_0x56b1dd(0x178)),canvas[_0x56b1dd(0x1b3)][_0x56b1dd(0x1a9)]('text-placement-mode');}function cancelTextPlacement(){const _0x367c01=_0x2017d7;isTextPlacementMode=![],canvas['classList'][_0x367c01(0x1b1)](_0x367c01(0x1b7)),isDraggingText=![],dragOffsetX=0x0,dragOffsetY=0x0,selectedTextElement=null,draggingCanvasContext=null;}function placeText(_0x421c95){const _0x1144c2=_0x2017d7,_0x11e84f=canvas[_0x1144c2(0x16b)](),_0x273445=canvas[_0x1144c2(0x18a)]/_0x11e84f['width'],_0x5b17fd=canvas[_0x1144c2(0x171)]/_0x11e84f['height'],_0x2514b5=(_0x421c95[_0x1144c2(0x19e)]-_0x11e84f[_0x1144c2(0x1ad)])*_0x273445,_0x1cb53b=(_0x421c95[_0x1144c2(0x163)]-_0x11e84f[_0x1144c2(0x18c)])*_0x5b17fd,_0x404e11=document[_0x1144c2(0x168)](_0x1144c2(0x161))[_0x1144c2(0x192)],_0x89bd38=document['getElementById'](_0x1144c2(0x19f))['value'],_0x26c778=document[_0x1144c2(0x168)](_0x1144c2(0x1a8))[_0x1144c2(0x192)];let _0xbf70bf='';if(textItalic)_0xbf70bf+=_0x1144c2(0x19c);if(textBold)_0xbf70bf+=_0x1144c2(0x189);const _0x1e90c5={'text':_0x404e11,'x':_0x2514b5,'y':_0x1cb53b,'font':''+_0xbf70bf+_0x26c778+'px\x20'+_0x89bd38,'color':brushColor};textElements['push'](_0x1e90c5),selectedTextElement=_0x1e90c5,draggingCanvasContext=ctx[_0x1144c2(0x186)](0x0,0x0,canvas[_0x1144c2(0x18a)],canvas[_0x1144c2(0x171)]),ctx['font']=_0x1e90c5[_0x1144c2(0x18f)],ctx[_0x1144c2(0x17b)]=_0x1e90c5[_0x1144c2(0x1b9)],ctx[_0x1144c2(0x167)](_0x1e90c5['text'],_0x1e90c5['x'],_0x1e90c5['y']),document['getElementById'](_0x1144c2(0x161))[_0x1144c2(0x192)]='',isTextPlacementMode=![],canvas[_0x1144c2(0x1b3)]['remove'](_0x1144c2(0x1b7)),setCanvasTitle(_0x1144c2(0x16f));}function redrawTextElements(){textElements['forEach'](_0x5c22cd=>{const _0x5b67ea=_0x228a;ctx[_0x5b67ea(0x18f)]=_0x5c22cd[_0x5b67ea(0x18f)],ctx[_0x5b67ea(0x17b)]=_0x5c22cd[_0x5b67ea(0x1b9)],ctx[_0x5b67ea(0x167)](_0x5c22cd[_0x5b67ea(0x194)],_0x5c22cd['x'],_0x5c22cd['y']);});}function redrawLineSegments(){const _0xc9c860=_0x2017d7;lineSegments[_0xc9c860(0x1ac)](_0x297869=>{const _0x346929=_0xc9c860;ctx['lineJoin']=_0x346929(0x188),ctx[_0x346929(0x175)]='round',ctx[_0x346929(0x184)]=_0x297869[_0x346929(0x1b9)],ctx[_0x346929(0x16e)]=_0x297869['size'],ctx[_0x346929(0x191)](),_0x297869[_0x346929(0x19d)]===_0x346929(0x1b2)?(ctx[_0x346929(0x1a5)](_0x297869['x'],_0x297869['y']),ctx[_0x346929(0x1a4)](_0x297869['x']+0.1,_0x297869['y']+0.1)):(ctx[_0x346929(0x1a5)](_0x297869['x1'],_0x297869['y1']),ctx['lineTo'](_0x297869['x2'],_0x297869['y2'])),ctx['stroke']();});}