const _0x1df994=_0x5b5e;(function(_0x4dff25,_0xec5d8d){const _0x35e6e9=_0x5b5e,_0x14a986=_0x4dff25();while(!![]){try{const _0x3afdd1=parseInt(_0x35e6e9(0x1dd))/0x1+parseInt(_0x35e6e9(0x1c0))/0x2+parseInt(_0x35e6e9(0x1f8))/0x3*(parseInt(_0x35e6e9(0x1f6))/0x4)+-parseInt(_0x35e6e9(0x1fb))/0x5+-parseInt(_0x35e6e9(0x1f5))/0x6*(parseInt(_0x35e6e9(0x203))/0x7)+-parseInt(_0x35e6e9(0x20b))/0x8+-parseInt(_0x35e6e9(0x200))/0x9*(parseInt(_0x35e6e9(0x1ea))/0xa);if(_0x3afdd1===_0xec5d8d)break;else _0x14a986['push'](_0x14a986['shift']());}catch(_0x106aff){_0x14a986['push'](_0x14a986['shift']());}}}(_0xca1a,0x53a33));let painting=![],lastX=0x0,lastY=0x0,brushColor=_0x1df994(0x1fc),brushSize=0x2,currentTool=null,textElements=[],lineSegments=[],isTextPlacementMode=![],draggingCanvasContext=null,selectedTextElement=null,isDraggingText=![],dragOffsetX=0x0,dragOffsetY=0x0,textBold=![],textItalic=![];function setCanvasTitle(_0x20d301){const _0x776fb9=_0x1df994,_0x48d162=document['querySelector'](_0x776fb9(0x1e0));_0x48d162&&(_0x48d162[_0x776fb9(0x1f0)]=_0x20d301,_0x48d162['style'][_0x776fb9(0x1d2)]=_0x20d301&&_0x20d301!==''?_0x776fb9(0x1ce):_0x776fb9(0x1f2));}function initPaintTools(){const _0x4e7f7e=_0x1df994;document[_0x4e7f7e(0x1db)]('brush-mode')['addEventListener']('click',()=>{const _0x231996=_0x4e7f7e;currentTool===_0x231996(0x212)?setActiveTool(null,''):(setActiveTool(_0x231996(0x212),_0x231996(0x201)),brushColor=document[_0x231996(0x1db)](_0x231996(0x1d1))[_0x231996(0x1d0)]);}),document[_0x4e7f7e(0x1db)](_0x4e7f7e(0x1c2))[_0x4e7f7e(0x1bd)](_0x4e7f7e(0x205),()=>{const _0xb18415=_0x4e7f7e;currentTool==='eraser'?setActiveTool(null,''):(setActiveTool(_0xb18415(0x1c9),_0xb18415(0x210)),brushColor=_0xb18415(0x1c5));}),document['getElementById'](_0x4e7f7e(0x1e4))['addEventListener'](_0x4e7f7e(0x205),()=>{const _0x5b8b78=_0x4e7f7e;currentTool===_0x5b8b78(0x1f9)?setActiveTool(null,''):(setActiveTool(_0x5b8b78(0x1f9),_0x5b8b78(0x1d8)),brushColor=document[_0x5b8b78(0x1db)](_0x5b8b78(0x1d1))[_0x5b8b78(0x1d0)]);}),document[_0x4e7f7e(0x1db)](_0x4e7f7e(0x1d1))[_0x4e7f7e(0x1bd)]('change',_0x46bd4d=>{const _0x301817=_0x4e7f7e;brushColor=_0x46bd4d[_0x301817(0x1eb)][_0x301817(0x1d0)];}),document[_0x4e7f7e(0x1db)](_0x4e7f7e(0x1ee))[_0x4e7f7e(0x1bd)](_0x4e7f7e(0x1c6),_0x4e402c=>{const _0x246ae1=_0x4e7f7e;brushSize=parseInt(_0x4e402c['target'][_0x246ae1(0x1d0)]);}),document[_0x4e7f7e(0x1db)](_0x4e7f7e(0x1e8))['addEventListener'](_0x4e7f7e(0x205),startTextPlacement),document[_0x4e7f7e(0x1db)](_0x4e7f7e(0x1e7))['addEventListener']('click',()=>{const _0x547422=_0x4e7f7e;textBold=!textBold,document['getElementById'](_0x547422(0x1e7))[_0x547422(0x20c)][_0x547422(0x1f4)](_0x547422(0x1fe),textBold);}),document[_0x4e7f7e(0x1db)](_0x4e7f7e(0x1d4))[_0x4e7f7e(0x1bd)](_0x4e7f7e(0x205),()=>{const _0x406b65=_0x4e7f7e;textItalic=!textItalic,document[_0x406b65(0x1db)](_0x406b65(0x1d4))['classList']['toggle'](_0x406b65(0x1fe),textItalic);}),setupCanvasForPainting(),updateToolUI();}function setActiveTool(_0x2d54ab,_0x469d85){currentTool=_0x2d54ab,updateToolUI(),setCanvasTitle(_0x469d85),cancelTextPlacement();}function updateToolUI(){const _0x505782=_0x1df994;document[_0x505782(0x1db)]('brush-mode')[_0x505782(0x20c)][_0x505782(0x1f4)](_0x505782(0x1e1),currentTool===_0x505782(0x212)),document[_0x505782(0x1db)](_0x505782(0x1c2))[_0x505782(0x20c)][_0x505782(0x1f4)](_0x505782(0x1e1),currentTool===_0x505782(0x1c9)),document['getElementById']('text-mode')[_0x505782(0x20c)][_0x505782(0x1f4)](_0x505782(0x1e1),currentTool===_0x505782(0x1f9)),document['querySelectorAll'](_0x505782(0x1ca))[_0x505782(0x216)](_0xadf466=>{const _0x4eeae7=_0x505782;_0xadf466[_0x4eeae7(0x219)][_0x4eeae7(0x1d2)]=[_0x4eeae7(0x212),_0x4eeae7(0x1c9),'text']['includes'](currentTool)?_0x4eeae7(0x202):_0x4eeae7(0x1f2);}),document['getElementById']('brush-color')[_0x505782(0x1f1)]=currentTool===_0x505782(0x1c9),document[_0x505782(0x1db)](_0x505782(0x1ee))['disabled']=currentTool===_0x505782(0x1be),document[_0x505782(0x1d9)](_0x505782(0x21b))[_0x505782(0x216)](_0x211599=>{const _0x195160=_0x505782;_0x211599[_0x195160(0x219)][_0x195160(0x1d2)]=currentTool===_0x195160(0x1f9)?_0x195160(0x202):'none';});}function setupCanvasForPainting(){const _0x2c4068=_0x1df994;canvas['addEventListener'](_0x2c4068(0x1c7),startPaint),canvas[_0x2c4068(0x1bd)](_0x2c4068(0x1fd),paint),canvas['addEventListener'](_0x2c4068(0x1ff),endPaint),canvas[_0x2c4068(0x1bd)](_0x2c4068(0x1fa),endPaint),canvas['addEventListener'](_0x2c4068(0x205),handleCanvasClick),canvas[_0x2c4068(0x1bd)](_0x2c4068(0x204),handleTouchStart),canvas[_0x2c4068(0x1bd)]('touchmove',handleTouchMove),canvas[_0x2c4068(0x1bd)](_0x2c4068(0x1e6),endPaint);}function _0x5b5e(_0x3b3a3c,_0x1cb9ea){const _0xca1aee=_0xca1a();return _0x5b5e=function(_0x5b5e7e,_0x536e31){_0x5b5e7e=_0x5b5e7e-0x1bd;let _0x88971f=_0xca1aee[_0x5b5e7e];return _0x88971f;},_0x5b5e(_0x3b3a3c,_0x1cb9ea);}function _0xca1a(){const _0x26a654=['#000000','mousemove','primary','mouseup','4365lRzXZu','画笔模式','flex','66829XqStAZ','touchstart','click','拖动新添加文字可调整位置','getBoundingClientRect','text-input','font-size','px\x20','2280816EJUSMq','classList','touches','length','clientY','橡皮擦','top','brush','push','点击画布放置文字','beginPath','forEach','lineCap','dispatchEvent','style','clearRect','.text-tools','addEventListener','text1','stroke','1249510kzsJTj','add','eraser-mode','bold\x20','lineTo','#FFFFFF','change','mousedown','lineJoin','eraser','.brush-tools','size','round','trim','block','fillText','value','brush-color','display','height','text-italic','font','remove','text-placement-mode','插入文字','querySelectorAll','left','getElementById','type','550499mzyqDx','color','italic\x20','.canvas-title','active','lineWidth','strokeStyle','text-mode','width','touchend','text-bold','add-text-btn','fillStyle','6350tYGoFU','target','clientX','match','brush-size','preventDefault','innerText','disabled','none','line','toggle','78QqbINI','980164bYqXAC','moveTo','3pBqwuX','text','mouseleave','1802640yVOeFi'];_0xca1a=function(){return _0x26a654;};return _0xca1a();}function startPaint(_0x332bbb){const _0x4ebb90=_0x1df994;if(!currentTool)return;if(currentTool===_0x4ebb90(0x1f9)){const _0x2979f7=findTextElementAt(_0x332bbb);if(_0x2979f7&&_0x2979f7===selectedTextElement){isDraggingText=!![];const _0x186ffd=canvas['getBoundingClientRect'](),_0x3c91ef=canvas[_0x4ebb90(0x1e5)]/_0x186ffd[_0x4ebb90(0x1e5)],_0x3dd66c=canvas['height']/_0x186ffd[_0x4ebb90(0x1d3)],_0x5e42df=(_0x332bbb[_0x4ebb90(0x1ec)]-_0x186ffd['left'])*_0x3c91ef,_0x4d107f=(_0x332bbb[_0x4ebb90(0x20f)]-_0x186ffd['top'])*_0x3dd66c;dragOffsetX=_0x2979f7['x']-_0x5e42df,dragOffsetY=_0x2979f7['y']-_0x4d107f;return;}}else painting=!![],draw(_0x332bbb);}function endPaint(){painting=![],isDraggingText=![],lastX=0x0,lastY=0x0;}function paint(_0x14bcab){const _0x35a99c=_0x1df994;if(!currentTool)return;currentTool===_0x35a99c(0x1f9)?isDraggingText&&selectedTextElement&&dragText(_0x14bcab):painting&&draw(_0x14bcab);}function draw(_0x339194){const _0x112930=_0x1df994,_0x47ab6d=canvas[_0x112930(0x207)](),_0x54e727=canvas[_0x112930(0x1e5)]/_0x47ab6d[_0x112930(0x1e5)],_0x4cd71f=canvas[_0x112930(0x1d3)]/_0x47ab6d['height'],_0x538ee6=(_0x339194[_0x112930(0x1ec)]-_0x47ab6d[_0x112930(0x1da)])*_0x54e727,_0x211eb9=(_0x339194[_0x112930(0x20f)]-_0x47ab6d[_0x112930(0x211)])*_0x4cd71f;ctx[_0x112930(0x1c8)]='round',ctx['lineCap']='round',ctx[_0x112930(0x1e3)]=brushColor,ctx[_0x112930(0x1e2)]=brushSize,ctx[_0x112930(0x215)](),lastX===0x0&&lastY===0x0?(ctx[_0x112930(0x1f7)](_0x538ee6,_0x211eb9),ctx[_0x112930(0x1c4)](_0x538ee6+0.1,_0x211eb9+0.1),lineSegments[_0x112930(0x213)]({'type':'dot','x':_0x538ee6,'y':_0x211eb9,'color':brushColor,'size':brushSize})):(ctx[_0x112930(0x1f7)](lastX,lastY),ctx['lineTo'](_0x538ee6,_0x211eb9),lineSegments['push']({'type':_0x112930(0x1f3),'x1':lastX,'y1':lastY,'x2':_0x538ee6,'y2':_0x211eb9,'color':brushColor,'size':brushSize})),ctx[_0x112930(0x1bf)](),lastX=_0x538ee6,lastY=_0x211eb9;}function handleCanvasClick(_0x481b54){const _0x39cf32=_0x1df994;currentTool===_0x39cf32(0x1f9)&&isTextPlacementMode&&placeText(_0x481b54);}function handleTouchStart(_0x32c4e7){const _0x1328fe=_0x1df994;_0x32c4e7[_0x1328fe(0x1ef)]();const _0x38cbd8=_0x32c4e7[_0x1328fe(0x20d)][0x0];if(currentTool===_0x1328fe(0x1f9)&&isTextPlacementMode){const _0x3f3818=new MouseEvent(_0x1328fe(0x205),{'clientX':_0x38cbd8[_0x1328fe(0x1ec)],'clientY':_0x38cbd8[_0x1328fe(0x20f)]});canvas['dispatchEvent'](_0x3f3818);return;}const _0x744c8e=new MouseEvent(_0x1328fe(0x1c7),{'clientX':_0x38cbd8[_0x1328fe(0x1ec)],'clientY':_0x38cbd8[_0x1328fe(0x20f)]});canvas[_0x1328fe(0x218)](_0x744c8e);}function handleTouchMove(_0x3f50bd){const _0x91a8ce=_0x1df994;_0x3f50bd['preventDefault']();const _0x303985=_0x3f50bd[_0x91a8ce(0x20d)][0x0],_0x44d46e=new MouseEvent(_0x91a8ce(0x1fd),{'clientX':_0x303985[_0x91a8ce(0x1ec)],'clientY':_0x303985['clientY']});canvas['dispatchEvent'](_0x44d46e);}function dragText(_0x196469){const _0x1556db=_0x1df994,_0x214b93=canvas[_0x1556db(0x207)](),_0x35b973=canvas['width']/_0x214b93[_0x1556db(0x1e5)],_0x219955=canvas[_0x1556db(0x1d3)]/_0x214b93[_0x1556db(0x1d3)],_0x349145=(_0x196469[_0x1556db(0x1ec)]-_0x214b93['left'])*_0x35b973,_0x47c855=(_0x196469[_0x1556db(0x20f)]-_0x214b93[_0x1556db(0x211)])*_0x219955;selectedTextElement['x']=_0x349145+dragOffsetX,selectedTextElement['y']=_0x47c855+dragOffsetY,draggingCanvasContext?ctx['putImageData'](draggingCanvasContext,0x0,0x0):ctx[_0x1556db(0x21a)](0x0,0x0,canvas[_0x1556db(0x1e5)],canvas[_0x1556db(0x1d3)]),ctx['font']=selectedTextElement[_0x1556db(0x1d5)],ctx[_0x1556db(0x1e9)]=selectedTextElement[_0x1556db(0x1de)],ctx[_0x1556db(0x1cf)](selectedTextElement[_0x1556db(0x1f9)],selectedTextElement['x'],selectedTextElement['y']);}function findTextElementAt(_0x2c7fa2){const _0x5d06cc=_0x1df994,_0x39c376=canvas[_0x5d06cc(0x207)](),_0x4401be=canvas['width']/_0x39c376[_0x5d06cc(0x1e5)],_0x279388=canvas[_0x5d06cc(0x1d3)]/_0x39c376['height'],_0x375dd2=(_0x2c7fa2[_0x5d06cc(0x1ec)]-_0x39c376['left'])*_0x4401be,_0x26ffc8=(_0x2c7fa2[_0x5d06cc(0x20f)]-_0x39c376[_0x5d06cc(0x211)])*_0x279388;for(let _0x4f8660=textElements[_0x5d06cc(0x20e)]-0x1;_0x4f8660>=0x0;_0x4f8660--){const _0x25d32e=textElements[_0x4f8660];ctx[_0x5d06cc(0x1d5)]=_0x25d32e[_0x5d06cc(0x1d5)];const _0x32dc2f=ctx['measureText'](_0x25d32e[_0x5d06cc(0x1f9)])[_0x5d06cc(0x1e5)],_0x5b1be6=_0x25d32e[_0x5d06cc(0x1d5)][_0x5d06cc(0x1ed)](/(\d+)px/),_0x599bac=_0x5b1be6?parseInt(_0x5b1be6[0x1]):0xe,_0x47bfd8=_0x599bac*1.2,_0x1d9b19=0x5;if(_0x375dd2>=_0x25d32e['x']-_0x1d9b19&&_0x375dd2<=_0x25d32e['x']+_0x32dc2f+_0x1d9b19&&_0x26ffc8>=_0x25d32e['y']-_0x47bfd8+_0x1d9b19&&_0x26ffc8<=_0x25d32e['y']+_0x1d9b19)return _0x25d32e;}return null;}function startTextPlacement(){const _0x4e7ca5=_0x1df994,_0x198dff=document[_0x4e7ca5(0x1db)](_0x4e7ca5(0x208))[_0x4e7ca5(0x1d0)][_0x4e7ca5(0x1cd)]();if(!_0x198dff){alert('请输入文字内容');return;}isTextPlacementMode=!![],setCanvasTitle(_0x4e7ca5(0x214)),canvas[_0x4e7ca5(0x20c)][_0x4e7ca5(0x1c1)](_0x4e7ca5(0x1d7));}function cancelTextPlacement(){const _0x5aa927=_0x1df994;isTextPlacementMode=![],canvas[_0x5aa927(0x20c)][_0x5aa927(0x1d6)]('text-placement-mode'),isDraggingText=![],dragOffsetX=0x0,dragOffsetY=0x0,selectedTextElement=null,draggingCanvasContext=null;}function placeText(_0x5b17da){const _0x3f0cc5=_0x1df994,_0x2ea531=canvas['getBoundingClientRect'](),_0x56d2a7=canvas[_0x3f0cc5(0x1e5)]/_0x2ea531[_0x3f0cc5(0x1e5)],_0x19f78b=canvas[_0x3f0cc5(0x1d3)]/_0x2ea531[_0x3f0cc5(0x1d3)],_0x44948e=(_0x5b17da['clientX']-_0x2ea531[_0x3f0cc5(0x1da)])*_0x56d2a7,_0x136b4b=(_0x5b17da[_0x3f0cc5(0x20f)]-_0x2ea531[_0x3f0cc5(0x211)])*_0x19f78b,_0x2e4d62=document[_0x3f0cc5(0x1db)](_0x3f0cc5(0x208))[_0x3f0cc5(0x1d0)],_0x8882a5=document[_0x3f0cc5(0x1db)]('font-family')[_0x3f0cc5(0x1d0)],_0x2fd4d1=document[_0x3f0cc5(0x1db)](_0x3f0cc5(0x209))['value'];let _0x81e744='';if(textItalic)_0x81e744+=_0x3f0cc5(0x1df);if(textBold)_0x81e744+=_0x3f0cc5(0x1c3);const _0x4290be={'text':_0x2e4d62,'x':_0x44948e,'y':_0x136b4b,'font':''+_0x81e744+_0x2fd4d1+_0x3f0cc5(0x20a)+_0x8882a5,'color':brushColor};textElements[_0x3f0cc5(0x213)](_0x4290be),selectedTextElement=_0x4290be,draggingCanvasContext=ctx['getImageData'](0x0,0x0,canvas[_0x3f0cc5(0x1e5)],canvas[_0x3f0cc5(0x1d3)]),ctx[_0x3f0cc5(0x1d5)]=_0x4290be['font'],ctx[_0x3f0cc5(0x1e9)]=_0x4290be[_0x3f0cc5(0x1de)],ctx[_0x3f0cc5(0x1cf)](_0x4290be[_0x3f0cc5(0x1f9)],_0x4290be['x'],_0x4290be['y']),document[_0x3f0cc5(0x1db)](_0x3f0cc5(0x208))[_0x3f0cc5(0x1d0)]='',isTextPlacementMode=![],canvas[_0x3f0cc5(0x20c)][_0x3f0cc5(0x1d6)](_0x3f0cc5(0x1d7)),setCanvasTitle(_0x3f0cc5(0x206));}function redrawTextElements(){const _0x478ed7=_0x1df994;textElements[_0x478ed7(0x216)](_0x4ff8c0=>{const _0x89bf16=_0x478ed7;ctx[_0x89bf16(0x1d5)]=_0x4ff8c0[_0x89bf16(0x1d5)],ctx[_0x89bf16(0x1e9)]=_0x4ff8c0[_0x89bf16(0x1de)],ctx['fillText'](_0x4ff8c0[_0x89bf16(0x1f9)],_0x4ff8c0['x'],_0x4ff8c0['y']);});}function redrawLineSegments(){const _0x514ad3=_0x1df994;lineSegments[_0x514ad3(0x216)](_0x3637bd=>{const _0x28741f=_0x514ad3;ctx['lineJoin']=_0x28741f(0x1cc),ctx[_0x28741f(0x217)]=_0x28741f(0x1cc),ctx[_0x28741f(0x1e3)]=_0x3637bd[_0x28741f(0x1de)],ctx[_0x28741f(0x1e2)]=_0x3637bd[_0x28741f(0x1cb)],ctx[_0x28741f(0x215)](),_0x3637bd[_0x28741f(0x1dc)]==='dot'?(ctx[_0x28741f(0x1f7)](_0x3637bd['x'],_0x3637bd['y']),ctx[_0x28741f(0x1c4)](_0x3637bd['x']+0.1,_0x3637bd['y']+0.1)):(ctx[_0x28741f(0x1f7)](_0x3637bd['x1'],_0x3637bd['y1']),ctx['lineTo'](_0x3637bd['x2'],_0x3637bd['y2'])),ctx['stroke']();});}
